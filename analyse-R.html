<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>analyse-R</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<link href="libs/bootstrap-3.3.1/css/flatly.print.min.css" rel="stylesheet" />
<link rel="stylesheet" href="./include/analyse-R.css" />

</head>

<body>

<style type = "text/css">
/* CSS générées par knitr */

.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}

code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}

img {
  max-width:100%;
  height: auto;
}

code{white-space: pre;}

table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }

pre:not([class]) {
  background-color: white;
}

/* Ne pas afficher les tables de matières des chapitres */
.TOC {display: none;}

/* Print CSS */
@media print {
  math {margin: 11px auto;}

  @page {
		size: A4;
 		@bottom {content: "\2013\0000a0\0000a0\0000a0\0000a0" counter(page) "\0000a0\0000a0\0000a0\0000a0\2013"; font-size: 9pt;}
   	@top {content: string(titre_chap); font-style: italic; font-size: 9pt;}
		@footnotes {
			border-top: solid black thin;
			padding-top: 8pt;
    }
	}
	@page:first {
  	@top{content: "";}
  }
	article{page-break-before: right;}
	h1 {string-set: titre_chap content();}
	h1, h2, h3, h4, heading, caption {page-break-after: avoid;}
	figcaption {page-break-before: avoid;}
	figure, table, pre {page-break-inside: avoid;}
	div.note, div.info, div.astuce, div.important, div.attention {page-break-inside: avoid;}

}

</style>

<div class="container-fluid main-container">
<article>

<div id="header">
<h1 class="title">analyse-R</h1>
</div>


<div class="jumbotron">
<h1>
Introduction<br/>Ã  lâ€™analyse dâ€™enquÃªtes<br/> avec R et RStudio
</h1>
<p>
DerniÃ¨re mise Ã  jourÂ : 20 mai 2015
</p>
</div>
<p>Ce projet de site web est basÃ© sur le support de cours <a href="https://github.com/larmarange/intro-r/tree/CoursM2">Introduction Ã  lâ€™analyse dâ€™enquÃªtes avec R</a> de Joseph Larmarange, qui est lui-mÃªme une adaptation de lâ€™<a href="https://github.com/juba/intro-r">Introduction Ã  R</a> de Julien Barnier.</p>
<div id="contributeurs" class="section level2">
<h2>Contributeurs</h2>
<p><strong>Par ordre alphabÃ©tiqueÂ :</strong></p>
<p>Julien Barnier, Julien Biaudet, Milan Bouchet-Valat, FrÃ©dÃ©rique Giraud, JoÃ«l Gombin, Mayeul Kauffmann, Joseph Larmarange, Nicolas Robette.</p>
<p><strong>MaintenanceÂ :</strong></p>
<p>Joseph Larmarange â€” <a href="http://joseph.larmarange.net" class="uri">http://joseph.larmarange.net</a></p>
</div>
<div id="tdm" class="section level2">
<h2>Table des matiÃ¨res</h2>
<div class="row">
<div class="col-md-4">
<p>
<strong>Prise en main</strong>
</p>
<div class="list-group">
<a href="#pem_presentation_installation" class="list-group-item">PrÃ©sentation et Installation</a> <a href="#pem_premier_contact" class="list-group-item">Premier contact</a> <a href="#pem_premier_travail" class="list-group-item">Premier travail avec des donnÃ©es</a> <a href="#pem_stat_univ" class="list-group-item">Statistique univariÃ©e</a> <a href="#pem_import_export" class="list-group-item">Import / Export de donnÃ©es</a> <a href="#pem_manipulation" class="list-group-item">Manipulation de donnÃ©es</a>
</div>
</div>
<div class="col-md-4">
<p>
<strong>Analyses</strong>
</p>
<div class="list-group">
<a href="#analyses_stat_biv" class="list-group-item">Statistique bivariÃ©e</a> <a href="#analyses_reglog" class="list-group-item">RÃ©gression logistique</a> <a href="#analyses_donnees_pond" class="list-group-item">DonnÃ©es pondÃ©rÃ©es</a> <a href="#analyses_acm" class="list-group-item">Analyse des correspondances multiples (ACM)</a> <a href="#analyses_cah" class="list-group-item">Classification ascendante hiÃ©rarchique (CAH)</a> <a href="#analyses_seq" class="list-group-item">Analyse de sÃ©quences</a>
</div>
</div>
<div class="col-md-4">
<p>
<strong>AvancÃ©</strong>
</p>
<div class="list-group">
<span class="list-group-item list-group-item-header">Astuces</span> <a href="#avance_age" class="list-group-item">Calculer un Ã¢ge</a>
</div>
</div>
</div>
</div>
<div id="licence" class="section level2">
<h2>Licence</h2>
<p>Le contenu de ce site est diffusÃ© sous licence <em>Creative Commons Attribution - Pas dÂ’utilisation commerciale - Partage dans les mÃªmes conditions</em> (<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/" class="uri">https://creativecommons.org/licenses/by-nc-sa/3.0/fr/</a>).</p>
<p><img src="images\by-nc-sa.png" alt="CC by-nc-sa"/></p>
</div>

</article>
<article id="pem_presentation_installation">

<div id="pem_presentation_installation_header">
<h1 class="title">PrÃ©sentation et Installation</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#pem_presentation_installation_presentation-de-r">PrÃ©sentation de R</a></li>
<li><a href="#pem_presentation_installation_philosophie-de-r">Philosophie de R</a></li>
<li><a href="#pem_presentation_installation_presentation-de-rstudio">PrÃ©sentation de RStudio</a></li>
<li><a href="#pem_presentation_installation_installation">Installation</a><ul>
<li><a href="#pem_presentation_installation_installation-de-r">Installation de R</a></li>
<li><a href="#pem_presentation_installation_installation-de-rstudio">Installation de RStudio</a></li>
</ul></li>
<li><a href="#pem_presentation_installation_installer_extensions">Installer des extensions</a><ul>
<li><a href="#pem_presentation_installation_presentation">PrÃ©sentation</a></li>
<li><a href="#pem_presentation_installation_installation-depuis-cran">Installation depuis CRAN</a></li>
<li><a href="#pem_presentation_installation_installation-depuis-github">Installation depuis GitHub</a></li>
</ul></li>
<li><a href="#pem_presentation_installation_mise-a-jour-de-r-sous-windows">Mise Ã  jour de R sous Windows</a></li>
</ul>
</div>

<div id="pem_presentation_installation_presentation-de-r" class="section level2">
<h2>PrÃ©sentation de R</h2>
<p><strong>R</strong> est un langage orientÃ© vers le traitement de donnÃ©es et lâ€™analyse statistique dÃ©rivÃ© du langage <strong>S</strong>. Il est dÃ©veloppÃ© depuis une vingtaine dâ€™annÃ©es par un groupe de volontaires de diffÃ©rents pays. Câ€™est un logiciel libre<a href="#pem_presentation_installation_fn1" class="footnoteRef" id="pem_presentation_installation_fnref1"><sup>1</sup></a>, publiÃ© sous licence GNU GPL.</p>
<p>Lâ€™utilisation de <strong>R</strong> prÃ©sente plusieurs avantagesÂ :</p>
<ul>
<li>câ€™est un logiciel multiplateforme, qui fonctionne aussi bien sur des sytÃ¨mes <strong>Linux</strong>, <strong>Mac OS X</strong> ou <strong>Windows</strong>Â ;</li>
<li>câ€™est un logiciel libre, dÃ©veloppÃ© par ses utilisateurs et modifiable par tout un chacunÂ ;</li>
<li>câ€™est un logiciel gratuitÂ ;</li>
<li>câ€™est un logiciel trÃ¨s puissant, dont les fonctionnalitÃ©s de base peuvent Ãªtre Ã©tendues Ã  lâ€™aide de plusieurs milliers dâ€™extensions<a href="#pem_presentation_installation_fn2" class="footnoteRef" id="pem_presentation_installation_fnref2"><sup>2</sup></a>Â ;</li>
<li>câ€™est un logiciel dont le dÃ©veloppement est trÃ¨s actif et dont la communautÃ© dâ€™utilisateurs ne cesse de sâ€™Ã©largirÂ ;</li>
<li>les possibilitÃ©s de manipulation de donnÃ©es sous <strong>R</strong> sont en gÃ©nÃ©ral largement supÃ©rieures Ã  celles des autres logiciels usuels dâ€™analyse statistiqueÂ ;</li>
<li>câ€™est un logiciel avec dâ€™excellentes capacitÃ©s graphiques et de nombreuses possibilitÃ©s dâ€™exportÂ ;</li>
<li>avec <em>Rmarkdown</em><a href="#pem_presentation_installation_fn3" class="footnoteRef" id="pem_presentation_installation_fnref3"><sup>3</sup></a>, il est devenu trÃ¨s aisÃ© de produire des rapports automatisÃ©s dans divers format (<strong>Word</strong>, <strong>PDF</strong>, <strong>HTML</strong>, â€¦)Â ;</li>
<li><strong>R</strong> est de plus utilisÃ© dans tous les secteurs scientifiques, y compris dans le domaine des analyses dâ€™enquÃªtes et, plus gÃ©nÃ©ralement, des sciences sociales.</li>
</ul>
<p>Comme rien nâ€™est parfait, on peut Ã©galement trouver quelques inconvÃ©nientsÂ :</p>
<ul>
<li>le logiciel, la documentation de rÃ©fÃ©rence et les principales ressources sont en anglais. Il est toutefois parfaitement possible dâ€™utiliser <strong>R</strong> sans spÃ©cialement maÃ®triser cette langueÂ ;</li>
<li>il nâ€™existe pas encore dâ€™interface graphique pour <strong>R</strong> Ã©quivalente Ã  celle dâ€™autres logiciels comme <strong>SPSS</strong> ou <strong>Modalisa</strong>. <strong>R</strong> fonctionne Ã  lâ€™aide de <em>scripts</em> (des petits programmes) Ã©ditÃ©s et exÃ©cutÃ©s au fur et Ã  mesure de lâ€™analyse et se rapprocherait davantage de <strong>SAS</strong> dans son utilisation (mais avec une syntaxe et une philosophie trÃ¨s diffÃ©rentes). Ce point, qui peut apparaÃ®tre comme un gros handicap, sâ€™avÃ¨re aprÃ¨s un temps dâ€™apprentissage Ãªtre un mode dâ€™utilisation dâ€™une grande souplesseÂ ;</li>
<li>comme <strong>R</strong> sâ€™apparente davantage Ã  un langage de programmation quâ€™Ã  un logiciel proprement dit, la courbe dâ€™apprentissage peut Ãªtre un peu Â«Â raideÂ Â», notamment pour ceux nâ€™ayant jamais programmÃ© auparavant.</li>
</ul>
<p>Il est Ã  noter que le dÃ©veloppement autour de <strong>R</strong> a Ã©tÃ© particuliÃ¨rement actif ces derniÃ¨res annÃ©es. On trouvera dÃ¨s lors aujourdâ€™hui de nombreuses extensions permettant de se Â«Â faciliter la vieÂ Â» au quotidien, ce qui nâ€™Ã©tait pas vraiment encore le cas il y a 5 ans.</p>
</div>
<div id="pem_presentation_installation_philosophie-de-r" class="section level2">
<h2>Philosophie de R</h2>
<p>Quelques points particuliers dans le fonctionnement de <strong>R</strong> peuvent parfois dÃ©router les utilisateurs habituÃ©s Ã  dâ€™autres logicielsÂ :</p>
<ul>
<li>Sous <strong>R</strong>, en gÃ©nÃ©ral, on ne voit pas directement les donnÃ©es sur lesquelles on travailleÂ ; on ne dispose pas en permanence dâ€™une vue des donnÃ©es sous forme de tableau<a href="#pem_presentation_installation_fn4" class="footnoteRef" id="pem_presentation_installation_fnref4"><sup>4</sup></a>, comme sous <strong>Modalisa ou SPSS</strong>. Ceci peut Ãªtre dÃ©routant au dÃ©but, mais on se rend vite compte quâ€™on nâ€™a pas besoin de voir en permanence les donnÃ©es pour les analyser.</li>
<li>Alors quâ€™avec la plupart des logiciels on rÃ©flÃ©chira avec un fichier de donnÃ©es ouvert Ã  la fois, chaque fichier de donnÃ©es correspondra Ã  un objet diffÃ©rent, permettant de manipuler trÃ¨s facilement plusieurs objets Ã  la fois (par exemple dans le cadre de fusion de tables^[Voir par exemple la section dÃ©diÃ©e Ã  ce sujet dans le <a href="#pem_manipulation_fusion_tables">chapitre sur la manipulation de donnÃ©es</a>.).</li>
<li>Avec les autres logiciels, en gÃ©nÃ©ral la production dâ€™une analyse gÃ©nÃ¨re un grand nombre de rÃ©sultats de toutes sortes dans lesquels lâ€™utilisateur est censÃ© retrouver et isoler ceux qui lâ€™intÃ©ressent. Avec <strong>R</strong>, câ€™est lâ€™inverseÂ : par dÃ©faut lâ€™affichage est rÃ©duit au minimum, et câ€™est lâ€™utilisateur qui demande Ã  voir des rÃ©sultats supplÃ©mentaires ou plus dÃ©taillÃ©s.</li>
<li>Sous <strong>R</strong>, les rÃ©sultats des analyses sont eux aussi stockÃ©s dans des objets et sont dÃ¨s lors manipulables</li>
</ul>
<p>Inhabituel au dÃ©but, ce fonctionnement permet en fait assez rapidement de gagner du temps dans la conduite des analyses.</p>
</div>
<div id="pem_presentation_installation_presentation-de-rstudio" class="section level2">
<h2>PrÃ©sentation de RStudio</h2>
<p>Lâ€™interface de base de <strong>R</strong> est assez rudimentaire (voir figure ci-aprÃ¨s).</p>
<figure>
<img src="images/capture_RGui.png" alt="Interface de R sous Windows"/>
<figcaption>
Interface de R sous Windows
</figcaption>
</figure>
<p><strong>RStudio</strong> est un environnement de dÃ©veloppement intÃ©grÃ© libre, gratuit, et qui fonctionne sous <strong>Windows</strong>, <strong>Mac OS X</strong> et <strong>Linux</strong>. Il complÃ¨te <strong>R</strong> et fournit un Ã©diteur de script avec coloration syntaxique, des fonctionnalitÃ©s pratiques dâ€™Ã©dition et dâ€™exÃ©cution du code (comme lâ€™autocomplÃ©tion), un affichage simultanÃ© du code, de la console R, des fichiers, graphiques et pages dâ€™aide, une gestion des extensions, une intÃ©gration avec des systÃ¨mes de contrÃ´le de versions comme <strong>git</strong>, etc. Il intÃ¨gre de base divers outils comme par exemple la production de rapports au format <strong>Rmarkdown</strong>. Il est en dÃ©veloppement actif et de nouvelles fonctionnalitÃ©s sont ajoutÃ©es rÃ©guliÃ¨rement. Son principal dÃ©faut est dâ€™avoir une interface uniquement anglophone.</p>
<figure>
<img src="images/capture_RStudio.png" alt="Interface de RStudio sous Windows"/>
<figcaption>
Interface de RStudio sous Windows
</figcaption>
</figure>
<p>Pour une prÃ©sentation plus gÃ©nÃ©rale de <strong>RStudio</strong> on pourra se rÃ©fÃ©rer au site du projetÂ : <a href="http://www.rstudio.com/" class="uri">http://www.rstudio.com/</a>.</p>
<p><strong>RStudio</strong> peut tout Ã  fait Ãªtre utilisÃ© pour dÃ©couvrir et dÃ©marrer avec <strong>R</strong>. Les diffÃ©rents chapitres dâ€™<strong>analyse-R</strong> partent du principe que vous utilisez <strong>R</strong> avec <strong>RStudio</strong>. Cependant, Ã  part les Ã©lÃ©ments portant sur lâ€™interface de <strong>RStudio</strong>, lâ€™ensemble du code et des fonctions <strong>R</strong> peuvent Ãªtre utilisÃ©s directement dans <strong>R</strong>, mÃªme en lâ€™absence de <strong>RStudio</strong>.</p>
<p>La documentation de <strong>RStudio</strong> (en anglais) est disponible en ligne Ã  <a href="https://support.rstudio.com" class="uri">https://support.rstudio.com</a>. Pour Ãªtre tenu informÃ© des derniÃ¨res Ã©volutions de <strong>RStudio</strong>, mais Ã©galement de plusieurs extensions dÃ©veloppÃ©es dans le cadre de ce projet, vous pouvez suivre le blog dÃ©diÃ© <a href="http://blog.rstudio.org/" class="uri">http://blog.rstudio.org/</a>.</p>
</div>
<div id="pem_presentation_installation_installation" class="section level2">
<h2>Installation</h2>
<p>Il est prÃ©fÃ©rable de commencer par installer <strong>R</strong> avant dâ€™installer <strong>RStudio</strong>.</p>
<div id="pem_presentation_installation_installation-de-r" class="section level3">
<h3>Installation de R</h3>
<p>Pour une installation sous <strong>Windows</strong>, on se rendra sur cette pageÂ : <a href="http://cran.r-project.org/bin/windows/base/" class="uri">http://cran.r-project.org/bin/windows/base/</a> et lâ€™on suivra le premier lien pour tÃ©lÃ©charger le programme dâ€™installation. Une fois le programme dâ€™installation lancÃ©, il suffira dâ€™installer <strong>R</strong> avec les options par dÃ©faut<a href="#pem_presentation_installation_fn5" class="footnoteRef" id="pem_presentation_installation_fnref5"><sup>5</sup></a>.</p>
<p>Pour <strong>Mac OS X</strong>, les fichiers dâ€™installation sont disponibles Ã  <a href="http://cran.r-project.org/bin/macosx/" class="uri">http://cran.r-project.org/bin/macosx/</a>.</p>
<p>Si vous travaillez sous <strong>Linux</strong>, vous devriez pouvoir trouver <strong>R</strong> via votre gestionnaire de paquets, cela pouvant dÃ©pendre dâ€™une distribution de <strong>Linux</strong> Ã  une autre.</p>
</div>
<div id="pem_presentation_installation_installation-de-rstudio" class="section level3">
<h3>Installation de RStudio</h3>
<p>Une fois <strong>R</strong> correctement installÃ©, rendez-vous sur <a href="http://www.rstudio.com/products/rstudio/download/" class="uri">http://www.rstudio.com/products/rstudio/download/</a> pour tÃ©lÃ©charger la derniÃ¨re version stable de <strong>RStudio</strong>. Plus prÃ©cisÃ©ment, il sâ€™agit de lâ€™Ã©dition <em>Open Source</em> de <strong>RStudio Desktop</strong> (en effet, il existe aussi une version serveur).</p>
<p>Choisissez lâ€™installateur correspondant Ã  votre systÃ¨me dâ€™exploitation et suivez les instructions du programme dâ€™installation.</p>
<p>Si vous voulez tester les derniÃ¨res fonctionnalitÃ©s de <strong>RStudio</strong>, vous pouvez tÃ©lÃ©charger la version de dÃ©veloppement (plus riche en fonctionnalitÃ© que la version stable, mais pouvant contenir des bugs) sur <a href="http://www.rstudio.com/products/rstudio/download/preview/" class="uri">http://www.rstudio.com/products/rstudio/download/preview/</a>.</p>
</div>
</div>
<div id="pem_presentation_installation_installer_extensions" class="section level2">
<h2>Installer des extensions</h2>
<div id="pem_presentation_installation_presentation" class="section level3">
<h3>PrÃ©sentation</h3>
<p>Lâ€™installation par dÃ©faut du logiciel <strong>R</strong> contient le cÅ“ur du programme ainsi quâ€™un ensemble de fonctions de base fournissant un grand nombre dâ€™outils de traitement de donnÃ©es et dâ€™analyse statistiques.</p>
<p><strong>R</strong> Ã©tant un logiciel libre, il bÃ©nÃ©ficie dâ€™une forte communautÃ© dâ€™utilisateurs qui peuvent librement contribuer au dÃ©veloppement du logiciel en lui ajoutant des fonctionnalitÃ©s supplÃ©mentaires. Ces contributions prennent la forme dâ€™extensions (<em>packages</em>) pouvant Ãªtre installÃ©es par lâ€™utilisateur et fournissant alors diverses fonctions supplÃ©mentaires.</p>
<p>Il existe un trÃ¨s grand nombre dâ€™extensions (plus de 6500 Ã  ce jour), qui sont diffusÃ©es par un rÃ©seau baptisÃ© <strong>CRAN</strong> (<em>Comprehensive R Archive Network</em>).</p>
<p>La liste de toutes les extensions disponibles sur <strong>CRAN</strong> est disponible iciÂ : <a href="http://cran.r-project.org/web/packages/" class="uri">http://cran.r-project.org/web/packages/</a>.</p>
<p>Pour faciliter un peu le repÃ©rage des extensions, il existe un ensemble de regroupements thÃ©matiques (Ã©conomÃ©trie, finance, gÃ©nÃ©tique, donnÃ©es spatialesâ€¦) baptisÃ©s <em>Task views</em>Â : <a href="http://cran.r-project.org/web/views/" class="uri">http://cran.r-project.org/web/views/</a>.</p>
<p>On y trouve notamment une <em>Task view</em> dÃ©diÃ©e aux sciences sociales, listant de nombreuses extensions potentiellement utiles pour les analyses statistiques dans ce champ disciplinaireÂ : <a href="http://cran.r-project.org/web/views/SocialSciences.html" class="uri">http://cran.r-project.org/web/views/SocialSciences.html</a>.</p>
</div>
<div id="pem_presentation_installation_installation-depuis-cran" class="section level3">
<h3>Installation depuis CRAN</h3>
<p>Lâ€™installation dâ€™une extension se fait par la fonction <code>install.packages</code>{utils}, Ã  qui on fournit le nom de lâ€™extension. Par exemple, si on souhaite installer lâ€™extension <strong>ade4</strong>Â :</p>
<p>install.packages(â€œade4â€, dep = TRUE)</p>
<p>Lâ€™option <code>dep=TRUE</code> indique Ã  R de tÃ©lÃ©charger et dâ€™installer Ã©galement toutes les extensions dont lâ€™extension choisie dÃ©pend pour son fonctionnement.</p>
<p>Sous <strong>RStudio</strong>, on pourra Ã©galement cliquer sur <em>Install</em> dans lâ€™onglet <em>Packages</em> du quadrant infÃ©rieur droit.</p>
<p>Une fois lâ€™extension installÃ©e, elle peut Ãªtre appelÃ©e depuis la console ou un fichier script avec la fonction <code data-package="base">library</code> ou la fonction <code data-package="base" data-rdocumentation="library">require</code>Â :</p>
<p>library(ade4)</p>
<p>Ã€ partir de lÃ , on peut utiliser les fonctions de lâ€™extension, consulter leur page dâ€™aide en ligne, accÃ©der aux jeux de donnÃ©es quâ€™elle contient, etc.</p>
<p>Pour mettre Ã  jour lâ€™ensemble des extensions installÃ©es, la fonction <code data-package="utils">update.packages</code> suffitÂ :</p>
<p>update.packages()</p>
<p>Sous <strong>RStudio</strong>, on pourra alternativement cliquer sur <em>Update</em> dans lâ€™onglet <em>Packages</em> du quadrant infÃ©rieur droit.</p>
<p>Si on souhaite dÃ©sinstaller une extension prÃ©cÃ©demment installÃ©e, on peut utiliser la fonction <code data-package="utils">remove.packages</code>Â :</p>
<p>remove.packages(â€œade4â€)</p>
<div class="important">
Il est important de bien comprendre la diffÃ©rence entre <code data-package="utils">install.packages</code> et <code data-package="base">library</code>. La premiÃ¨re va chercher les extensions sur internet et les installe en local sur le disque dur de lâ€™ordinateur. On nâ€™a besoin dâ€™effectuer cette opÃ©ration quâ€™une seule fois. La seconde lit les informations de lâ€™extension sur le disque dur et les met Ã  disposition de <strong>R</strong>. On a besoin de lâ€™exÃ©cuter Ã  chaque dÃ©but de session ou de script.
</div>
</div>
<div id="pem_presentation_installation_installation-depuis-github" class="section level3">
<h3>Installation depuis GitHub</h3>
<p>Certains packages sont dÃ©veloppÃ©s sur <a href="https://github.com/">GitHub</a>. DÃ¨s lors, la version de dÃ©veloppement sur <strong>GitHub</strong> peut contenir des fonctions qui ne sont pas encore disponibles dans la version stable disponible sur <strong>CRAN</strong>. Ils arrivent aussi parfois que certains packages ne soient disponibles que sur <strong>GitHub</strong>.</p>
<p>Lâ€™installation dâ€™un package depuis <strong>GitHub</strong> est trÃ¨s facile grÃ¢ce Ã  la fonction <code data-package="devtools">install_github</code> de lâ€™extension <strong class="package">devtools</strong> (que lâ€™on aura prÃ©alablement installÃ©e depuis <strong>CRAN</strong> ;-) ).</p>
</div>
</div>
<div id="pem_presentation_installation_mise-a-jour-de-r-sous-windows" class="section level2">
<h2>Mise Ã  jour de R sous Windows</h2>
<p>Pour mettre Ã  jour <strong>R</strong> sous <strong>Windows</strong>, il suffit de tÃ©lÃ©charger et dâ€™installer la derniÃ¨re version du programme dâ€™installation.</p>
<p>Petite particularitÃ©, la nouvelle version sera installÃ©e Ã  cÃ´tÃ© de lâ€™ancienne version. Si vous souhaitez faire de la place sur votre disque dur, vous pouvez dÃ©sinstaller lâ€™ancienne version en utilisant lâ€™utilitaire <em>DÃ©sinstaller un programme</em> de <strong>Windows</strong>.</p>
<p>Lorsque plusieurs versions de <strong>R</strong> sont disponibles, <strong>RStudio</strong> choisit par dÃ©faut la plus rÃ©cente. Il est vous est possible de spÃ©cifier Ã  <strong>RStudio</strong> quelle version de <strong>R</strong> utiliser via le menu <em>Tools</em> &gt; <em>Global Options</em> &gt; <em>General</em>.</p>
<p>Petit dÃ©faut, les extensions (<em>packages</em>) sont installÃ©es par dÃ©faut sous <strong>Windows</strong> dans le rÃ©pertoire <code>Documents de l'utilisateur &gt; R &gt; win-library &gt; x.y</code> avec <code>x.y</code> correspondant au numÃ©ro de la version de <strong>R</strong>. Ainsi, si lâ€™on travaillait avec la version 3.0 et que lâ€™on passe Ã  la version 3.2, les extensions que lâ€™on avait sous lâ€™ancienne version ne sont plus disponibles pour la nouvelle version. Une astuce consiste Ã  recopier le contenu du rÃ©pertoire <code>3.0</code> dans le rÃ©pertoire <code>3.2</code>. Puis, on lancera <strong>RStudio</strong> (sâ€™il Ã©tait dÃ©jÃ  ouvert, on le fermera puis relancera) et on mettra Ã  jour lâ€™ensemble des packages, soit avec la fonction, <code data-package="utils">update.packages</code> soit en cliquant sur <em>Update</em> dans lâ€™onglet <em>Packages</em> du quadrant infÃ©rieur droit.</p>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="pem_presentation_installation_fn1"><p>Pour plus dâ€™informations sur ce quâ€™est un logiciel libre, voirÂ : <a href="http://www.gnu.org/philosophy/free-sw.fr.html" class="uri">http://www.gnu.org/philosophy/free-sw.fr.html</a><a href="#pem_presentation_installation_fnref1">â†©</a></p></li>
<li id="pem_presentation_installation_fn2"><p>Voir MAJ_LIEN.<a href="#pem_presentation_installation_fnref2">â†©</a></p></li>
<li id="pem_presentation_installation_fn3"><p>AbordÃ© dans un chapitre dÃ©diÃ©, MAJ_LIEN<a href="#pem_presentation_installation_fnref3">â†©</a></p></li>
<li id="pem_presentation_installation_fn4"><p>On verra quâ€™il est possible avec <strong>RStudio</strong> de disposer dâ€™une telle vue<a href="#pem_presentation_installation_fnref4">â†©</a></p></li>
<li id="pem_presentation_installation_fn5"><p>Dans le cas particulier oÃ¹ votre ordinateur est situÃ© derriÃ¨re un <em>proxy</em>, il est prÃ©fÃ©rable de choisir <em>Options de dÃ©marrage personnalisÃ©es</em> lorsque cela vous sera demandÃ© par le programme dâ€™installation, puis <em>Internet2</em> lorsquâ€™on vous demandera le mode de connexion Ã  Internet. Ainsi, <strong>R</strong> utilisera par dÃ©faut la configuration internet du navigateur <strong>Internet Explorer</strong> et prendra ainsi en compte les paramÃ¨tres du <em>proxy</em>.<a href="#pem_presentation_installation_fnref5">â†©</a></p></li>
</ol>
</div>

</article>
<article id="pem_premier_contact">

<div id="pem_premier_contact_header">
<h1 class="title">Premier contact</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#pem_premier_contact_linvite-de-commandes">Lâ€™invite de commandes</a></li>
<li><a href="#pem_premier_contact_des-objets">Des objets</a><ul>
<li><a href="#pem_premier_contact_objets-simples">Objets simples</a></li>
<li><a href="#pem_premier_contact_vecteurs">Vecteurs</a></li>
</ul></li>
<li><a href="#pem_premier_contact_des-fonctions">Des fonctions</a><ul>
<li><a href="#pem_premier_contact_arguments">Arguments</a></li>
<li><a href="#pem_premier_contact_quelques-fonctions-utiles">Quelques fonctions utiles</a></li>
<li><a href="#pem_premier_contact_aide-sur-une-fonction">Aide sur une fonction</a></li>
<li><a href="#pem_premier_contact_interpretation-des-arguments">InterprÃ©tation des arguments</a></li>
<li><a href="#pem_premier_contact_auto-completion">Auto-complÃ©tion</a></li>
</ul></li>
</ul>
</div>

<div class="note">
Ce chapitre est inspirÃ© de la section <em>Prise en main</em> du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a> rÃ©alisÃ© par Julien Barnier.
</div>
<p>Une fois <strong>RStudio</strong> lancÃ©, vous devriez obtenir une fenÃªtre similaire Ã  la figure ci-aprÃ¨s.</p>
<figure>
<img src="images/capture_RStudio.png" alt="Interface de RStudio au dÃ©marrage"/>
<figcaption>
Interface de RStudio au dÃ©marrage
</figcaption>
</figure>
<p>Lâ€™interface de <strong>RStudio</strong> est divisÃ©e en quatre quadrantsÂ :</p>
<ul>
<li>le quadrant supÃ©rieur gauche est dÃ©diÃ© aux diffÃ©rents fichiers de travail (nous y reviendrons dans le chapitre <a href="#pem_premier_travail">Premier travail avec les donnÃ©es</a>)Â ;</li>
<li>le quadrant infÃ©rieur gauche correspond Ã  ce que lâ€™on appelle la <em>console</em>, câ€™est-Ã -dire Ã  <strong>R</strong> proprement ditÂ ;</li>
<li>le quadrant supÃ©rieur droit permet de connaÃ®tre
<ul>
<li>la liste des objets en mÃ©moire (onglet <em>Environment</em>)</li>
<li>ainsi que lâ€™historique des commandes saisies dans la console (onglet <em>History</em>)Â ;</li>
</ul></li>
<li>le quadrant infÃ©rieur droit affiche
<ul>
<li>la liste des fichiers du rÃ©pertoire de travail (onglet <em>Files</em>),</li>
<li>les graphiques rÃ©alisÃ©s (onglet <em>Plots</em>),</li>
<li>la liste des extensions disponibles (onglet <em>Packages</em>),</li>
<li>lâ€™aide en ligne (onglet <em>Help</em>)</li>
<li>et un <em>Viewer</em> utilisÃ© pour visualiser certains types de graphiques au format web.</li>
</ul></li>
</ul>
<p>Inutile de tout retenir pour le moment. Nous aborderons chaque outil en temps utile. Pour lâ€™heure, concentrons-nous sur la <em>console</em>, câ€™est-Ã -dire le quadrant infÃ©rieur gauche.</p>
<div id="pem_premier_contact_linvite-de-commandes" class="section level2">
<h2>Lâ€™invite de commandes</h2>
<p>Au dÃ©marrage, la console contient un petit texte de bienvenue ressemblant Ã  peu prÃ¨s Ã  ce qui suitÂ :</p>
<pre><code>R version 3.2.0 (2015-04-16) -- "Full of Ingredients"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.</code></pre>
<p>suivi dâ€™une ligne commenÃ§ant par le caractÃ¨re <code>&gt;</code> et sur laquelle devrait se trouver votre curseur. Cette ligne est appelÃ©e lâ€™<em>invite de commande</em> (ou <em>prompt</em> en anglais). Elle signifie que <strong>R</strong> est disponible et en attente de votre prochaine commande.</p>
<p>Nous allons tout de suite lui fournir une premiÃ¨re commande. Tapez <code>2 + 3</code> dans la console et validez avec la touche <kbd>EntrÃ©e</kbd>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span></code></pre>
<pre><code>[1] 5</code></pre>
<p>En premier lieu, vous pouvez noter la convention typographique utilisÃ©e dans ce documents. Les commandes saisies dans la console sont indiquÃ©es sur un fond gris et prÃ©cÃ©dÃ© de <code>R&gt;</code>. Le rÃ©sultat renvoyÃ© par <strong>R</strong> est quant Ã  lui affichÃ© juste en-dessous sur fond blanc.</p>
<p>Bien, nous savons dÃ©sormais que <strong>R</strong> sait faire les additions Ã  un chiffre<a href="#pem_premier_contact_fn1" class="footnoteRef" id="pem_premier_contact_fnref1"><sup>1</sup></a>. Nous pouvons dÃ©sormais continuer avec dâ€™autres opÃ©rations arithmÃ©tiques de baseÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">8</span> -<span class="st"> </span><span class="dv">12</span></code></pre>
<pre><code>[1] -4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">14</span> *<span class="st"> </span><span class="dv">25</span></code></pre>
<pre><code>[1] 350</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">-<span class="dv">3</span>/<span class="dv">10</span></code></pre>
<pre><code>[1] -0.3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">-<span class="fl">0.3</span></code></pre>
<pre><code>[1] -0.3</code></pre>
<p>On remarquera que <strong>R</strong> est anglo-saxon. Les nombres sont donc saisies Â«Â Ã  lâ€™anglaiseÂ Â», câ€™est-Ã -dire en utilisant le point (<code>.</code>) comme sÃ©parateur pour les dÃ©cimales.</p>
<div class="astuce">
<p>Une petite astuce trÃ¨s utile lorsque vous tapez des commandes directement dans la consoleÂ : en utilisant les flÃ¨ches Haut et Bas du clavier, vous pouvez naviguer dans lâ€™historique des commandes tapÃ©es prÃ©cÃ©demment, que vous pouvez alors facilement rÃ©exÃ©cuter ou modifier une commande particuliÃ¨re.</p>
<p>Sous <strong>RStudio</strong>, lâ€™onglet History du quadrant haut-droite vous permet de consulter lâ€™historique des commandes que vous avez transmises Ã  <strong>R</strong>.</p>
<p><img src="images/capture_RStudio_onglet_history.png" alt="Onglet History sous RStudio"/></p>
<p>Un double-clic sur une commande la recopiera automatiquement dans la console. Vous pouvez Ã©galement sÃ©lectionner une ou plusieurs commandes puis cliquer sur <em>To Console</em>.</p>
Voir Ã©galement (en anglais)Â : <a href="http://www.rstudio.com/ide/docs/using/history" class="uri">http://www.rstudio.com/ide/docs/using/history</a>
</div>
<p>Lorsquâ€™on fournit Ã  <strong>R</strong> une commande incomplÃ¨te, celui-ci nous propose de la complÃ©ter en nous prÃ©sentant une invite de commande spÃ©ciale utilisant les signe <code>+</code>. Imaginons par exemple que nous avons malencontreusement tapÃ© sur <kbd>EntrÃ©e</kbd> alors que nous souhaitions calculer <code>4 * 3</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">4</span> *</code></pre>
<p>On peut alors complÃ©ter la commande en saisissant simplement <code>3</code> :</p>
<pre class="r">4 *
+ 3
</pre>
<pre>
[1] 12
</pre>
<div class="info">
<p>Pour des commandes plus complexes, il arrive parfois quâ€™on se retrouve coincÃ© avec une invite <code>+</code> sans plus savoir comment complÃ©ter la saisie correctement. On peut alors annuler la commande en utilisant la touche <kbd>Echap</kbd> ou <kbd>Esc</kbd> sous <strong>Windows</strong>.</p>
Sous <strong>Linux</strong> on utilise le traditionnel <kbd>Control + C</kbd>.
</div>
<p>Ã€ noter que les espaces autour des opÃ©rateurs nâ€™ont pas dâ€™importance lorsque lâ€™on saisit les commandes dans <strong>R</strong>. Les trois commandes suivantes sont donc Ã©quivalentes, mais on privilÃ©gie en gÃ©nÃ©ral la deuxiÃ¨me pour des raisons de lisibilitÃ© du code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">10+2</span>
<span class="dv">10</span> +<span class="st"> </span><span class="dv">2</span>
<span class="dv">10</span>    +<span class="st">    </span><span class="dv">2</span></code></pre>
</div>
<div id="pem_premier_contact_des-objets" class="section level2">
<h2>Des objets</h2>
<div id="pem_premier_contact_objets-simples" class="section level3">
<h3>Objets simples</h3>
<p>Faire des opÃ©rations arithmÃ©tiques, câ€™est bien, mais sans doute pas totalement suffisant. Notamment, on aimerait pouvoir rÃ©utiliser le rÃ©sultat dâ€™une opÃ©ration sans avoir Ã  le resaisir ou Ã  le copier/coller.</p>
<p>Comme tout langage de programmation, <strong>R</strong> permet de faire cela en utilisant des objets. Prenons tout de suite un exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">2</span></code></pre>
<p>Que signifie cette commandeÂ ? Lâ€™opÃ©rateur <code>&lt;-</code> est appelÃ© <em>opÃ©rateur dâ€™assignation</em>. Il prend une valeur quelconque Ã  droite et la place dans lâ€™objet indiquÃ© Ã  gauche. La commande pourrait donc se lire <em>mettre la valeur 2 dans lâ€™objet nommÃ© <code>x</code></em>.</p>
<p>On va ensuite pouvoir rÃ©utiliser cet objet dans dâ€™autres calculs ou simplement afficher son contenuÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">x +<span class="st"> </span><span class="dv">3</span></code></pre>
<pre><code>[1] 5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x</code></pre>
<pre><code>[1] 2</code></pre>
<div class="info">
Par dÃ©faut, si on donne Ã  <strong>R</strong> seulement le nom dâ€™un objet, il va se dÃ©brouiller pour nous prÃ©senter son contenu dâ€™une maniÃ¨re plus ou moins lisible.
</div>
<p>On peut utiliser autant dâ€™objets quâ€™on veut. Ceux-ci peuvent contenir des nombres, des chaÃ®nes de caractÃ¨res (indiquÃ©es par des guillemets droits doubles <code>"</code> ou simples <code>'</code>) et bien dâ€™autres choses encoreÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">27</span>
y &lt;-<span class="st"> </span><span class="dv">10</span>
foo &lt;-<span class="st"> </span>x +<span class="st"> </span>y
foo</code></pre>
<pre><code>[1] 37</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> "Hello"</span>
foo &lt;-<span class="st"> </span>x
foo</code></pre>
<pre><code>[1] "Hello"</code></pre>
<div class="important">
<p>Les noms dâ€™objets peuvent contenir des lettres, des chiffres (mais ils ne peuvent pas commencer par un chiffre), les symboles <code>.</code> et <code>_</code>. Ils doivent impÃ©rativement commencer par une lettre. <strong>R</strong> fait la diffÃ©rence entre les majuscules et les minuscules, ce qui signifie que <code>x</code> et <code>X</code> sont deux objets diffÃ©rents. On Ã©vitera Ã©galement dâ€™utiliser des caractÃ¨res accentuÃ©s dans les noms dâ€™objets. Comme les espaces ne sont pas autorisÃ©s on pourra les remplacer par un point ou un tiret bas.</p>
Enfin, signalons que certains noms courts sont rÃ©servÃ©s par <strong>R</strong> pour son usage interne et doivent Ãªtre Ã©vitÃ©s. On citera notamment <code>c</code>, <code>q</code>, <code>t</code>, <code>C</code>, <code>D</code>, <code>F</code>, <code>I</code>, <code>T</code>, <code>max</code>, <code>min</code>â€¦
</div>
<p>Dans <strong>RStudio</strong>, lâ€™onglet <em>Environment</em> dans le quadrant supÃ©rieur droit indique la liste des objets que vous avez prÃ©cÃ©demment crÃ©Ã©s, leur type et la taille quâ€™ils occupent en mÃ©moire.</p>
<figure>
<img src="images/capture_RStudio_onglet_environment.png" alt="Onglet Environment de RStudio"/>
<figcaption>
Onglet Environment de RStudio
</figcaption>
</figure>
</div>
<div id="pem_premier_contact_vecteurs" class="section level3">
<h3>Vecteurs</h3>
<p>Imaginons maintenant que nous avons interrogÃ© dix personnes au hasard dans la rue et que nous avons relevÃ© pour chacune dâ€™elle sa taille en centimÃ¨tres. Nous avons donc une sÃ©rie de dix nombres que nous souhaiterions pouvoir rÃ©unir de maniÃ¨re Ã  pouvoir travailler sur lâ€™ensemble de nos mesures.</p>
<p>Un ensemble de donnÃ©es de mÃªme nature constituent pour <strong>R</strong> un vecteur (en anglais <em>vector</em>) et se construit Ã  lâ€™aide dâ€™une fonction nommÃ©e <code data-package="base">c</code><a href="#pem_premier_contact_fn2" class="footnoteRef" id="pem_premier_contact_fnref2"><sup>2</sup></a>. On lâ€™utilise en lui donnant la liste de nos donnÃ©es, entre parenthÃ¨ses, sÃ©parÃ©es par des virgulesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">tailles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">167</span>, <span class="dv">192</span>, <span class="dv">173</span>, <span class="dv">174</span>, <span class="dv">172</span>, <span class="dv">167</span>, <span class="dv">171</span>, <span class="dv">185</span>, 
  <span class="dv">163</span>, <span class="dv">170</span>)</code></pre>
<p>Ce faisant, nous avons crÃ©Ã© un objet nommÃ© <code>tailles</code> et comprenant lâ€™ensemble de nos donnÃ©es, que nous pouvons afficherÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">tailles</code></pre>
<pre><code> [1] 167 192 173 174 172 167 171 185 163 170</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">144</span>, <span class="dv">168</span>, <span class="dv">179</span>, <span class="dv">175</span>, <span class="dv">182</span>, <span class="dv">188</span>, <span class="dv">167</span>, <span class="dv">152</span>, <span class="dv">163</span>, <span class="dv">145</span>, 
  <span class="dv">176</span>, <span class="dv">155</span>, <span class="dv">156</span>, <span class="dv">164</span>, <span class="dv">167</span>, <span class="dv">155</span>, <span class="dv">157</span>, <span class="dv">185</span>, <span class="dv">155</span>, <span class="dv">169</span>, 
  <span class="dv">124</span>, <span class="dv">178</span>, <span class="dv">182</span>, <span class="dv">195</span>, <span class="dv">151</span>, <span class="dv">185</span>, <span class="dv">159</span>, <span class="dv">156</span>, <span class="dv">184</span>, <span class="dv">172</span>)</code></pre>
<pre><code> [1] 144 168 179 175 182 188 167 152 163 145 176
[12] 155 156 164 167 155 157 185 155 169 124 178
[23] 182 195 151 185 159 156 184 172</code></pre>
<p>On a bien notre suite de trente tailles, mais on peut remarquer la prÃ©sence de nombres entre crochets au dÃ©but de chaque ligne (<code>[1]</code>, <code>[12]</code> et <code>[23]</code>). En fait ces nombres entre crochets indiquent la position du premier Ã©lÃ©ment de la ligne dans notre vecteur. Ainsi, le 155 en dÃ©but de deuxiÃ¨me ligne est le 12<sup>e</sup> Ã©lÃ©ment du vecteur, tandis que le 182 de la troisiÃ¨me ligne est Ã  la 23<sup>e</sup> position.</p>
<p>On en dÃ©duira dâ€™ailleurs que lorsque lâ€™on faitÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span></code></pre>
<pre><code>[1] 2</code></pre>
<p><strong>R</strong> considÃ¨re en fait le nombre 2 comme un vecteur Ã  un seul Ã©lÃ©ment.</p>
<p>On peut appliquer des opÃ©rations arithmÃ©tiques simples directement sur des vecteursÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">tailles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">167</span>, <span class="dv">192</span>, <span class="dv">173</span>, <span class="dv">174</span>, <span class="dv">172</span>, <span class="dv">167</span>, <span class="dv">171</span>, <span class="dv">185</span>, 
  <span class="dv">163</span>, <span class="dv">170</span>)
tailles +<span class="st"> </span><span class="dv">20</span></code></pre>
<pre><code> [1] 187 212 193 194 192 187 191 205 183 190</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tailles/<span class="dv">100</span></code></pre>
<pre><code> [1] 1.67 1.92 1.73 1.74 1.72 1.67 1.71 1.85 1.63
[10] 1.70</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tailles^<span class="dv">2</span></code></pre>
<pre><code> [1] 27889 36864 29929 30276 29584 27889 29241
 [8] 34225 26569 28900</code></pre>
<p>On peut aussi combiner des vecteurs entre eux. Lâ€™exemple suivant calcule lâ€™indice de masse corporelle Ã  partir de la taille et du poidsÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">tailles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">167</span>, <span class="dv">192</span>, <span class="dv">173</span>, <span class="dv">174</span>, <span class="dv">172</span>, <span class="dv">167</span>, <span class="dv">171</span>, <span class="dv">185</span>, 
  <span class="dv">163</span>, <span class="dv">170</span>)
poids &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">86</span>, <span class="dv">74</span>, <span class="dv">83</span>, <span class="dv">50</span>, <span class="dv">78</span>, <span class="dv">66</span>, <span class="dv">66</span>, <span class="dv">51</span>, <span class="dv">50</span>, <span class="dv">55</span>)
tailles.m &lt;-<span class="st"> </span>tailles/<span class="dv">100</span>
imc &lt;-<span class="st"> </span>poids/(tailles.m^<span class="dv">2</span>)
imc</code></pre>
<pre><code> [1] 30.83653 20.07378 27.73230 16.51473 26.36560
 [6] 23.66524 22.57105 14.90139 18.81892 19.03114</code></pre>
<div class="important">
<p>Quand on fait des opÃ©rations sur les vecteurs, il faut veiller Ã  soit utiliser un vecteur et un chiffre (dans des opÃ©rations du type <code>v * 2</code> ou <code>v + 10</code>), soit Ã  utiliser des vecteurs de mÃªme longueur (dans des opÃ©rations du type <code>u + v</code>).</p>
Si on utilise des vecteurs de longueur diffÃ©rentes, on peut avoir quelques surprises. Quand <strong>R</strong> effectue une opÃ©ration avec deux vecteurs de longueurs diffÃ©rentes, il recopie le vecteur le plus court de maniÃ¨re Ã  lui donner la mÃªme taille que le plus long, ce qui sâ€™appelle la rÃ¨gle de recyclage (<em>recycling rule</em>). Ainsi, <code>c(1,2) + c(4,5,6,7,8)</code> vaudra lâ€™Ã©quivalent de <code>c(1,2,1,2,1) + c(4,5,6,7,8)</code>.
</div>
<p>On a vu jusque-lÃ  des vecteurs composÃ©s de nombres, mais on peut tout Ã  fait crÃ©er des vecteurs composÃ©s de chaÃ®nes de caractÃ¨res, reprÃ©sentant par exemple les rÃ©ponses Ã  une question ouverte ou fermÃ©eÂ :</p>
<p>reponse &lt;- c(â€œBac+2â€, â€œBacâ€, â€œCAPâ€, â€œBacâ€, â€œBacâ€, â€œCAPâ€, â€œBEPâ€)</p>
<p>Enfin, notons que lâ€™on peut accÃ©der Ã  un Ã©lÃ©ment particulier du vecteur en faisant suivre le nom du vecteur de crochets contenant le numÃ©ro de lâ€™Ã©lÃ©ment dÃ©sirÃ©. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">reponse &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Bac+2"</span>, <span class="st">"Bac"</span>, <span class="st">"CAP"</span>, <span class="st">"Bac"</span>, <span class="st">"Bac"</span>, <span class="st">"CAP"</span>, 
  <span class="st">"BEP"</span>)
reponse[<span class="dv">2</span>]</code></pre>
<pre><code>[1] "Bac"</code></pre>
<p>Cette opÃ©ration sâ€™appelle lâ€™<em>indexation</em> dâ€™un vecteur. Il sâ€™agit ici de sa forme la plus simple, mais il en existe dâ€™autres beaucoup plus complexes. Lâ€™indexation des vecteurs et des tableaux dans <strong>R</strong> est lâ€™un des Ã©lÃ©ments particuliÃ¨rement souples et puissants du langage (mais aussi lâ€™un des plus dÃ©licats Ã  comprendre et Ã  maÃ®triser). Nous en reparlerons dans le chapitre sur la <a href="#pem_manipulation_indexation">manipulation de donnÃ©es</a>.</p>
<p>Sous <strong>RStudio</strong>, vous avez du remarquer que ce dernier effectue une coloration syntaxique. Lorsque vous tapez une commande, les valeurs numÃ©riques sont affichÃ©es dans une certaine couleur, les valeurs textuelles dans une autre et les noms des fonctions dans une troisiÃ¨me. De plus, si vous tapez une parenthÃ¨se ouvrante, <strong>RStudio</strong> va crÃ©er automatiquement aprÃ¨s le curseur la parenthÃ¨se fermante correspondante (de mÃªme avec les guillements ou les crochets). De plus, si vous placez le curseur juste aprÃ¨s une parenthÃ¨se fermante, la parenthÃ¨se ouvrante correspondante sera surlignÃ©e, ce qui sera bien pratique lors de la rÃ©daction de commandes complexes.</p>
</div>
</div>
<div id="pem_premier_contact_des-fonctions" class="section level2">
<h2>Des fonctions</h2>
<p>Nous savons dÃ©sormais faire des opÃ©rations simples sur des nombres et des vecteurs, stocker ces donnÃ©es et rÃ©sultats dans des objets pour les rÃ©utiliser par la suite.</p>
<p>Pour aller un peu plus loin nous allons aborder, aprÃ¨s les objets, lâ€™autre concept de base de <strong>R</strong>, Ã  savoir les <em>fonctions</em>. Une fonction se caractÃ©rise de la maniÃ¨re suivanteÂ :</p>
<ul>
<li>elle a un nomÂ ;</li>
<li>elle accepte des arguments (qui peuvent avoir un nom ou pas)Â ;</li>
<li>elle retourne un rÃ©sultat et peut effectuer une action comme dessiner un graphique ou lire un fichier.</li>
</ul>
<p>En fait rien de bien nouveau puisque nous avons dÃ©jÃ  utilisÃ© plusieurs fonctions jusquâ€™ici, dont la plus visible est la fonction <code data-package="&quot;base">c</code>. Dans la ligne suivanteÂ :</p>
<p>reponse &lt;- c(â€œBac+2â€, â€œBacâ€, â€œCAPâ€, â€œBacâ€, â€œBacâ€, â€œCAPâ€, â€œBEPâ€)</p>
<p>on fait appel Ã  la fonction nommÃ©e <code data-package="base">c</code>, on lui passe en arguments (entre parenthÃ¨ses et sÃ©parÃ©es par des virgules) une sÃ©rie de chaÃ®nes de caractÃ¨res et elle retourne comme rÃ©sultat un vecteur de chaÃ®nes de caractÃ¨res, que nous stockons dans lâ€™objet <code>reponse</code>.</p>
<p>Prenons tout de suite dâ€™autres exemples de fonctions courantesÂ :</p>
<p>tailles &lt;- c(167, 192, 173, 174, 172, 167, 171, 185, 163, 170) length(tailles) mean(tailles) var(tailles)</p>
<p>Ici, la fonction <code data-package="base">length</code> nous renvoie le nombre dâ€™Ã©lÃ©ments du vecteur, la fonction <code data-package="base">mean</code> nous donne la moyenne des Ã©lÃ©ments du vecteur et fonction <code data-package="stats" data-rdocumentation="cor">var</code> sa variance.</p>
<div id="pem_premier_contact_arguments" class="section level3">
<h3>Arguments</h3>
<p>Les arguments de la fonction lui sont indiquÃ©s entre parenthÃ¨ses, juste aprÃ¨s son nom. En gÃ©nÃ©ral les premiers arguments passÃ©s Ã  la fonction sont des donnÃ©es servant au calcul et les suivants des paramÃ¨tres influant sur ce calcul. Ceux-ci sont en gÃ©nÃ©ral transmis sous la forme dâ€™argument nommÃ©s.</p>
<p>Reprenons lâ€™exemple des tailles prÃ©cÃ©dentÂ :</p>
<p>tailles &lt;- c(167, 192, 173, 174, 172, 167, 171, 185, 163, 170)</p>
<p>Imaginons que le deuxiÃ¨me enquÃªtÃ© nâ€™ait pas voulu nous rÃ©pondre. Nous avons alors dans notre vecteur une valeur manquante. Celle-ci est symbolisÃ©e dans <strong>R</strong> par le code <code>NA</code>Â :</p>
<p>tailles &lt;- c(167, NA, 173, 174, 172, 167, 171, 185, 163, 170)</p>
<p>Recalculons notre taille moyenneÂ :</p>
<p>mean(tailles)</p>
<p>Et oui, par dÃ©faut, <strong>R</strong> renvoie <code>NA</code> pour un grand nombre de calculs (dont la moyenne) lorsque les donnÃ©es comportent une valeur manquante. On peut cependant modifier ce comportement en fournissant un paramÃ¨tre supplÃ©mentaire Ã  la fonction <code data-package="base">mean</code>, nommÃ© <code>na.rm</code>Â :</p>
<p>mean(tailles, na.rm = TRUE)</p>
<p>Positionner le paramÃ¨tre <code>na.rm</code> Ã  <code>TRUE</code> (vrai) indique Ã  la fonction <code data-package="base">mean</code> de ne pas tenir compte des valeurs manquantes dans le calcul.</p>
<p>Lorsquâ€™on passe un argument Ã  une fonction de cette maniÃ¨re, câ€™est-Ã -dire sous la forme <code>nom=valeur</code>, on parle dâ€™<em>argument nommÃ©</em>.</p>
<div class="important">
<code>NA</code> signifie <em>not available</em>. Cette valeur particuliÃ¨re peut Ãªtre utilisÃ©e pour indiquer une valeur manquante pour tout type de liste (nombres, textes, valeurs logique, etc.).
</div>
</div>
<div id="pem_premier_contact_quelques-fonctions-utiles" class="section level3">
<h3>Quelques fonctions utiles</h3>
<p>RÃ©capitulons la liste des fonctions que nous avons dÃ©jÃ  rencontrÃ©esÂ :</p>
<table>
<thead>
<tr class="header">
<th align="left">Fonction</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code data-package="base">c</code></td>
<td align="left">construit un vecteur Ã  partir dâ€™une sÃ©rie de valeurs</td>
</tr>
<tr class="even">
<td align="left"><code data-package="base">length</code></td>
<td align="left">nombre dâ€™Ã©lÃ©ments dâ€™un vecteur</td>
</tr>
<tr class="odd">
<td align="left"><code data-package="base">mean</code></td>
<td align="left">moyenne dâ€™un vecteur de type numÃ©rique</td>
</tr>
<tr class="even">
<td align="left"><code data-package="stats" data-rdocumentation="cor">var</code></td>
<td align="left">variance dâ€™un vecteur de type numÃ©rique</td>
</tr>
<tr class="odd">
<td align="left"><code data-package="base" data-rdocumentation="Arithmetic">+</code>, <code data-package="base" data-rdocumentation="Arithmetic">-</code>, <code data-package="base" data-rdocumentation="Arithmetic">*</code>, <code data-package="base" data-rdocumentation="Arithmetic">/</code></td>
<td align="left">opÃ©rateurs mathÃ©matiques de base</td>
</tr>
<tr class="even">
<td align="left"><code data-package="base" data-rdocumentation="Arithmetic">Ë†</code></td>
<td align="left">passage Ã  la puissance</td>
</tr>
</tbody>
</table>
<p>On peut rajouter les fonctions de base suivantesÂ :</p>
<table>
<thead>
<tr class="header">
<th align="left">Fonction</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code data-package="base" data-rdocumentation="Extremes">min</code></td>
<td align="left">valeur minimale dâ€™un vecteur numÃ©rique</td>
</tr>
<tr class="even">
<td align="left"><code data-package="base" data-rdocumentation="Extremes">max</code></td>
<td align="left">valeur maximale dâ€™un vecteur numÃ©rique</td>
</tr>
<tr class="odd">
<td align="left"><code data-package="stats">sd</code></td>
<td align="left">Ã©cart-type dâ€™un vecteur numÃ©rique</td>
</tr>
<tr class="even">
<td align="left"><code data-package="base" data-rdocumentation="Colon">:</code></td>
<td align="left">gÃ©nÃ¨re une sÃ©quence de nombres. <code>1:4</code> Ã©quivaut Ã  <code>c(1,2,3,4)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="pem_premier_contact_aide-sur-une-fonction" class="section level3">
<h3>Aide sur une fonction</h3>
<p>Il est trÃ¨s frÃ©quent de ne plus se rappeler quels sont les paramÃ¨tres dâ€™une fonction ou le type de rÃ©sultat quâ€™elle retourne. Dans ce cas on peut trÃ¨s facilement accÃ©der Ã  lâ€™aide dÃ©crivant une fonction particuliÃ¨re avec <code data-package="=&quot;utils&quot;" data-rdocumentation="=&quot;Question&quot;">?</code> ou <code data-package="utils">help</code>. Ainsi, pour obtenir de lâ€™aide sur la fonction <code data-package="base">mean</code>, on saisira lâ€™une des deux entrÃ©es Ã©quivalentes suivantesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="st">`</span><span class="dt">?</span><span class="st">`</span>(mean)
<span class="kw">help</span>(<span class="st">"mean"</span>)</code></pre>
<div class="note">
Lâ€™utilisation du raccourci <code data-package="=&quot;utils&quot;" data-rdocumentation="=&quot;Question&quot;">?</code> ne fonctionne pas pour certains opÃ©rateurs comme <code data-package="base" data-rdocumentation="Arithmetic">*</code>. Dans ce cas on pourra utiliser <code>?'*'</code> ou bien simplement <code>help("*")</code>.
</div>
<p>Sous <strong>RStudio</strong>, le fichier dâ€™aide associÃ© apparaitra dans le quadrant infÃ©rieur droit sous lâ€™onglet <em>Help</em>.</p>
<figure>
<img src="images/capture_RStudio_onglet_help.png" alt="Onglet Help de RStudio"/>
<figcaption>
Onglet Help de RStudio
</figcaption>
</figure>
<p>Cette page dÃ©crit (en anglais) la fonction, ses arguments, son rÃ©sultat, le tout accompagnÃ© de diverses notes, rÃ©fÃ©rences et exemples. Ces pages dâ€™aide contiennent Ã  peu prÃ¨s tout ce que vous pourrez chercher Ã  savoir, mais elles ne sont pas toujours dâ€™une lecture aisÃ©e.</p>
<p>Un autre cas trÃ¨s courant dans <strong>R</strong> est de ne pas se souvenir ou de ne pas connaÃ®tre le nom de la fonction effectuant une tÃ¢che donnÃ©e. Dans ce cas on se reportera aux diffÃ©rentes maniÃ¨res de trouver de lâ€™aide dÃ©crites dans le chapitre [OÃ¹ trouver de lâ€™aideÂ ?] MAJ_LIEN.</p>
</div>
<div id="pem_premier_contact_interpretation-des-arguments" class="section level3">
<h3>InterprÃ©tation des arguments</h3>
<p>Prenons lâ€™exemple de la fonction <code data-package="base">format</code> dont la version de base permet de mettre en forme un nombre. Affichons le fichier dâ€™aide associÃ©.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="st">`</span><span class="dt">?</span><span class="st">`</span>(format)</code></pre>
<p>La section <em>Usage</em> prÃ©sente les arguments de cette fonction et leur valeur par dÃ©fautÂ :</p>
<pre>
format(x, trim = FALSE, digits = NULL, nsmall = 0L,
       justify = c("left", "right", "centre", "none"),
       width = NULL, na.encode = TRUE, scientific = NA,
       big.mark = "",   big.interval = 3L,
       small.mark = "", small.interval = 5L,
       decimal.mark = ".", zero.print = NULL,
       drop0trailing = FALSE, ...)
</pre>
<p>Regardons ce que cette fonction peut faire. Passons-lui un vecteur avec deux nombresÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="kw">c</span>(<span class="fl">12.3</span>, <span class="dv">5678</span>))</code></pre>
<pre><code>[1] "  12.3" "5678.0"</code></pre>
<p>Elle renvoie un vecteur de chaÃ®nes de caractÃ¨res. Le nombre de dÃ©cimales a Ã©tÃ© harmonisÃ© et des espaces ont Ã©tÃ© ajoutÃ©s au dÃ©but du premier nombre afin que lâ€™ensemble des valeurs soient alignÃ©es vers la droite.</p>
<p>Lâ€™argument <code>trim</code> permet de supprimer les espaces ajoutÃ©s en dÃ©but de chaÃ®ne.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="kw">c</span>(<span class="fl">12.3</span>, <span class="dv">5678</span>), <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] "12.3"   "5678.0"</code></pre>
<p>Dans le cas prÃ©sent, nous avons saisi les arguments de la fonction sans les nommer. DÃ¨s lors, <strong>R</strong> considÃ¨re lâ€™ordre dans lesquels nous avons saisi les arguments, ordre qui correspond Ã  celui du fichier dâ€™aide. Il a dÃ¨s lors considÃ©rÃ© que <code>c(12.3, 5678)</code> correspond Ã  la valeur attribuÃ©e Ã  <code>x</code> et que <code>TRUE</code> est la valeur attribuÃ©e Ã  <code>trim</code>.</p>
<p>Lâ€™argument <code>nsmall</code> permet dâ€™indiquer le nombre minimum de dÃ©cimales que lâ€™on souhaite afficher. Il est en quatriÃ¨me position. DÃ¨s lors, pour pouvoir le renseigner avec des arguments non nommÃ©s, il faut fournir Ã©galement une valeur pour le troisiÃ¨me argument <code>digits</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="kw">c</span>(<span class="fl">12.3</span>, <span class="dv">5678</span>), <span class="ot">TRUE</span>, <span class="ot">NULL</span>, <span class="dv">2</span>)</code></pre>
<pre><code>[1] "12.30"   "5678.00"</code></pre>
<p>Ce nâ€™est pas forcÃ©ment ce quâ€™il y a de plus pratique. Dâ€™oÃ¹ lâ€™intÃ©rÃªt des <em>arguments nommÃ©s</em>. En prÃ©cisant <code>nsmall =</code> dans lâ€™appel de la fonction, on pourra indiquer que lâ€™on souhaite modifier spÃ©cifiquement cet argument. Lorsque lâ€™on utilise des arguments non nommÃ©s, lâ€™ordre nâ€™importe plus puisque <strong>R</strong> sera en capacitÃ© de reconnaÃ®tre ses petits.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="dt">nsmall =</span> <span class="dv">2</span>, <span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">12.3</span>, <span class="dv">5678</span>))</code></pre>
<pre><code>[1] "  12.30" "5678.00"</code></pre>
<p>Ã€ lâ€™usage, on aura le plus souvent recours Ã  une combinaison dâ€™arguments non nommÃ©s et dâ€™arguments nommÃ©s. On indiquera les premiers arguments (qui correspondent en gÃ©nÃ©ral aux donnÃ©es de dÃ©part) sans les nommer et on prÃ©cisera les options souhaitÃ©es avec des arguments nommÃ©s. Par exemple, pour un affichage Ã  la franÃ§aiseÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="kw">c</span>(<span class="fl">12.3</span>, <span class="dv">5678</span>), <span class="dt">decimal.mark =</span> <span class="st">","</span>, <span class="dt">big.mark =</span> <span class="st">" "</span>)</code></pre>
<pre><code>[1] "   12,3" "5 678,0"</code></pre>
<p>Lorsque lâ€™on regarde la section <em>Usage</em> du fichier dâ€™aide, il apparait que certains arguments, suivi par le symbole <code>=</code>, ont une valeur par dÃ©faut. Il nâ€™est donc pas nÃ©cessaire de les inclure dans lâ€™appel de la fonction, auquel cas la valeur pas dÃ©faut sera prise en compte. Par contre, dâ€™autres arguments, ici <code>x</code>, nâ€™ont pas de valeur par dÃ©faut et il est donc nÃ©cessaire de fournir systÃ©matique une valeur.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">format</span>(<span class="dt">decimal.mark =</span> <span class="st">","</span>)</code></pre>
<pre><code>Error in format.default(decimal.mark = ","): l'argument "x" est manquant, avec aucune valeur par dÃ©faut</code></pre>
<p>Enfin, pour certaines fonctions, on verra parfois apparaÃ®tre le symbole <code>...</code> Ce dernier correspond Ã  un nombre indÃ©terminÃ© dâ€™arguments. Il peut sâ€™agir, comme dans le cas de <code data-package="base">format</code> dâ€™arguments additionnels qui seront utilisÃ©s dans certains cas de figure, ou bien dâ€™arguments qui seront transmis Ã  une fonction secondaire appelÃ©e par la fonction principale, ou encore, comme pour le cas de la fonction <code data-package="base">c</code>, de la possibilitÃ© de saisir un nombre indÃ©fini de donnÃ©es sources.</p>
</div>
<div id="pem_premier_contact_auto-completion" class="section level3">
<h3>Auto-complÃ©tion</h3>
<p><strong>RStudio</strong> fournit un outil bien pratique appelÃ© <em>auto-complÃ©tion</em>. Saisissez les premiÃ¨res lettres dâ€™une fonction, par exemple <code>me</code> puis appuyez sur la touche <kbd>Tabulation</kbd>. <strong>RStudio</strong> affichera la liste des fonctions dont le nom commence par <code>me</code> ainsi quâ€™un court descriptif de chacune. Un appui sur la touche <kbd>EntrÃ©e</kbd> provoquera la saisie du nom complet de la fonction choisie.</p>
<figure>
<img src="images/capture_RStudio_autocompletion.png" alt="Auto-complÃ©tion sous RStudio"/>
<figcaption>
Auto-complÃ©tion sous RStudio
</figcaption>
</figure>
<p>Ã€ lâ€™intÃ©rieur des parenthÃ¨ses dâ€™une fonctionn, vous pouvez utiliser lâ€™auto-complÃ©tion pour retrouver un argument de cette fonction.</p>
<p>Vous pouvez Ã©galement utiliser lâ€™auto-complÃ©tion pour retrouver le nom dâ€™un objet que vous avez prÃ©cÃ©demment crÃ©Ã©.</p>
<p>Pour plus de dÃ©tails, voir la documentation officielle de <strong>RStudio</strong> (MAJ_LIEN).</p>
</div>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="pem_premier_contact_fn1"><p>La prÃ©sence du <code>[1]</code> en dÃ©but de ligne sera expliquÃ©e par la suite dans la section sur les <a href="#pem_premier_contact_vecteurs">vecteurs</a>.<a href="#pem_premier_contact_fnref1">â†©</a></p></li>
<li id="pem_premier_contact_fn2"><p><code data-package="base">c</code> est lâ€™abbrÃ©viation de <em>combine</em>. Le nom de cette fonction est trÃ¨s court car on lâ€™utilise trÃ¨s souvent.<a href="#pem_premier_contact_fnref2">â†©</a></p></li>
</ol>
</div>

</article>
<article id="pem_premier_travail">

<div id="pem_premier_travail_header">
<h1 class="title">Premier travail avec des donnÃ©es</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#pem_premier_travail_regrouper-les-commandes-dans-des-scripts">Regrouper les commandes dans des scripts</a></li>
<li><a href="#pem_premier_travail_ajouter-des-commentaires">Ajouter des commentaires</a></li>
<li><a href="#pem_premier_travail_tableaux-de-donnees">Tableaux de donnÃ©es</a></li>
<li><a href="#pem_premier_travail_inspecter-les-donnees">Inspecter les donnÃ©es</a><ul>
<li><a href="#pem_premier_travail_structure-du-tableau">Structure du tableau</a></li>
<li><a href="#pem_premier_travail_inspection-visuelle">Inspection visuelle</a></li>
<li><a href="#pem_premier_travail_acceder-aux-variables">AccÃ©der aux variables</a></li>
</ul></li>
</ul>
</div>

<div class="note">
Ce chapitre est inspirÃ© de la section <em>Premier travail avec les donnÃ©es</em> du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a> rÃ©alisÃ© par Julien Barnier.
</div>
<div id="pem_premier_travail_regrouper-les-commandes-dans-des-scripts" class="section level2">
<h2>Regrouper les commandes dans des scripts</h2>
<p>Jusquâ€™Ã  maintenant nous avons utilisÃ© uniquement la console pour communiquer avec <strong>R</strong> via lâ€™invite de commandes. Le principal problÃ¨me de ce mode dâ€™interaction est quâ€™une fois quâ€™une commande est tapÃ©e, elle est pour ainsi dire Â«Â perdueÂ Â», câ€™est-Ã -dire quâ€™on doit la saisir Ã  nouveau si on veut lâ€™exÃ©cuter une seconde fois. Lâ€™utilisation de la console est donc restreinte aux petites commandes Â«Â jetablesÂ Â», le plus souvent utilisÃ©es comme test.</p>
<p>La plupart du temps, les commandes seront stockÃ©es dans un fichier Ã  part, que lâ€™on pourra facilement ouvrir, Ã©diter et exÃ©cuter en tout ou partie si besoin. On appelle en gÃ©nÃ©ral ce type de fichier un <em>script</em>.</p>
<p>Pour comprendre comment cela fonctionne, dans <strong>RStudio</strong> cliquez sur lâ€™icÃ´ne en haut Ã  gauche reprÃ©sentant un fichier avec un signe + vert, puis choisissez <em>R script</em>.</p>
<figure>
<img src="images/capture_RStudio_new_R_script.png" alt="CrÃ©er un nouveau script R dans RStudio"/>
<figcaption>
CrÃ©er un nouveau script R dans RStudio
</figcaption>
</figure>
<p>Un nouvel onglet apparaÃ®t dans le quadrant supÃ©rieur gauche.</p>
<figure>
<img src="images/capture_RStudio_onglet_R_script.png" alt="Onglet dâ€™un script R dans RStudio"/>
<figcaption>
Onglet dâ€™un script R dans RStudio
</figcaption>
</figure>
<p>Nous pouvons dÃ©sormais y saisir des commandes. Par exemple, tapez sur la premiÃ¨re ligne la commande suivanteÂ : <code>2 + 2</code>. Ensuite, cliquez sur lâ€™icÃ´ne <em>Run</em> (en haut Ã  droite de lâ€™onglet du script) ou bien pressez simulatÃ©ment les touches <kbd>CTRL</kbd> et <kbd>EntrÃ©e</kbd><a href="#pem_premier_travail_fn1" class="footnoteRef" id="pem_premier_travail_fnref1"><sup>1</sup></a>.</p>
<p>Les lignes suivantes ont dÃ» faire leur apparition dans la consoleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> +<span class="st"> </span><span class="dv">2</span></code></pre>
<pre><code>[1] 4</code></pre>
<p>Voici donc comment soumettre rapidement Ã  <strong>R</strong> les commandes saisies dans votre fichier. Vous pouvez dÃ©sormais lâ€™enregistrer, lâ€™ouvrir plus tard, et en exÃ©cuter tout ou partie. Ã€ noter que vous avez plusieurs possibilitÃ©s pour soumettre des commandes Ã  <strong>R</strong>Â :</p>
<ul>
<li>vous pouvez exÃ©cuter la ligne sur laquelle se trouve votre curseur en cliquant sur <em>Run</em> ou en pressant simulatÃ©ment les touches <kbd>CTRL</kbd> et <kbd>EntrÃ©e</kbd>Â ;</li>
<li>vous pouvez sÃ©lectionner plusieurs lignes contenant des commandes et les exÃ©cuter toutes en une seule fois exactement de la mÃªme maniÃ¨reÂ ;</li>
<li>vous pouvez exÃ©cuter dâ€™un coup lâ€™intÃ©gralitÃ© de votre fichier en cliquant sur lâ€™icÃ´ne <em>Source</em>.</li>
</ul>
<p>La plupart du travail sous <strong>R</strong> consistera donc Ã  Ã©diter un ou plusieurs fichiers de commandes et Ã  envoyer rÃ©guliÃ¨rement les commandes saisies Ã  <strong>R</strong> en utilisant les raccourcis clavier <em>ad hoc</em>.</p>
<p>Pour plus dâ€™information sur lâ€™utilisation des scripts <strong>R</strong> dans <strong>RStudio</strong>, voir (en anglais)Â : <a href="http://www.rstudio.com/ide/docs/using/source" class="uri">http://www.rstudio.com/ide/docs/using/source</a>.</p>
<div class="note">
Quand vous enregistrez un script sous <strong>RStudio</strong>, il est possible quâ€™il vous demande de choisir un type dâ€™encodage des caractÃ¨res (<em>Choose Encoding</em>). Si tel est le cas, utilisez de prÃ©fÃ©rence <strong>UTF-8</strong>.
</div>
</div>
<div id="pem_premier_travail_ajouter-des-commentaires" class="section level2">
<h2>Ajouter des commentaires</h2>
<p>Un commentaire est une ligne ou une portion de ligne qui sera ignorÃ©e par <strong>R</strong>. Ceci signifie quâ€™on peut y Ã©crire ce quâ€™on veut et quâ€™on va les utiliser pour ajouter tout un tas de commentaires Ã  notre code permettant de dÃ©crire les diffÃ©rentes Ã©tapes du travail, les choses Ã  se rappeler, les questions en suspens, etc.</p>
<p>Un commentaire sous <strong>R</strong> commence par un ou plusieurs symboles <code>#</code> (qui sâ€™obtient avec les touches <kbd>AltÂ Gr</kbd> et <kbd>3</kbd> sur les claviers de type PC). Tout ce qui suit ce symbole jusquâ€™Ã  la fin de la ligne est considÃ©rÃ© comme un commentaire. On peut crÃ©er une ligne entiÃ¨re de commentaire en la faisant dÃ©buter par <code>##</code>. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">## Tableau croisÃ© de la CSP par le nombre de livres
## lus Attention au nombre de non rÃ©ponses !</code></pre>
<p>On peut aussi crÃ©er des commentaires pour une ligne en coursÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">2</span>  <span class="co"># On met 2 dans x, parce qu'il le vaut bien</span></code></pre>
<div class="important">
Dans tous les cas, il est trÃ¨s important de documenter ses fichiers <strong>R</strong> au fur et Ã  mesure, faute de quoi on risque de ne plus y comprendre grand chose si on les reprend ne serait-ce que quelques semaines plus tard.
</div>
<p>Avec <strong>RStudio</strong>, vous pouvez Ã©galement utiliser les commentaires pour crÃ©er des sections au sein de votre script et naviguer plus rapidement. Il suffit de faire suivre une ligne de commentaires dâ€™au moins 4 signes moins (<code>----</code>). Par exemple, si vous saisissez ceci dans votre scriptÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">## CrÃ©er les objets ----

x &lt;-<span class="st"> </span><span class="dv">2</span>
y &lt;-<span class="st"> </span><span class="dv">5</span>

## Calculs ----

x +<span class="st"> </span>y</code></pre>
<p>Vous verrez apparaÃ®tre en bas Ã  gauche de la fenÃªtre du script un symbole diÃ¨se orange. Si vous cliquez dessus, un menu de navigation sâ€™affichera vous permettant de vous dÃ©placez rapidement au sein de votre script. Pour plus dâ€™information, voir la documentation de <strong>RStudio</strong> (en anglais)Â : <a href="http://www.rstudio.com/ide/docs/using/code_folding" class="uri">http://www.rstudio.com/ide/docs/using/code_folding</a>.</p>
<figure>
<img src="images/capture_RStudio_navigation_script.png" alt="Navigation rapide dans les scripts sous RStudio"/>
<figcaption>
Navigation rapide dans les scripts sous RStudio
</figcaption>
</figure>
<p>NoteÂ : on remarquera au passage que le titre de lâ€™onglet est affichÃ© en rouge et suivi dâ€™une astÃ©risque (<code>*</code>), nous indiquant ainsi quâ€™il y a des modifications non enregistrÃ©es dans notre fichier.</p>
</div>
<div id="pem_premier_travail_tableaux-de-donnees" class="section level2">
<h2>Tableaux de donnÃ©es</h2>
<p>Dans cette partie nous allons utiliser un jeu de donnÃ©es inclus dans lâ€™extension <strong class="package">questionr</strong>. Lâ€™installation dâ€™extension est dÃ©crite dans le chapitre <a href="#pem_presentation_installation_installer_extensions">PrÃ©sentation et Installation</a>.</p>
<p>Le jeu de donnÃ©es en question est un extrait de lâ€™enquÃªte <em>Histoire de vie</em> rÃ©alisÃ©e par lâ€™INSEE en 2003. Il contient 2000 individus et 20 variables. Pour pouvoir utiliser ces donnÃ©es, il faut dâ€™abord charger lâ€™extension <strong class="package">questionr</strong> (aprÃ¨s lâ€™avoir installÃ©e, bien entendu). Le chargement dâ€™une extension en mÃ©moire se fait Ã  lâ€™aide de la fonction <code data-package="base">library</code>. Sous <strong>RStudio</strong>, vous pouvez Ã©galement charger une extension en allant dans lâ€™onglet <em>Packages</em> du quadrant infÃ©rieur droit qui liste lâ€™ensemble des packages disponibles et en cliquant la case Ã  cocher situÃ©e Ã  gauche du nom du package dÃ©sirÃ©.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)</code></pre>
<p>Puis nous allons indiquer Ã  <strong>R</strong> que nous souhaitons accÃ©der au jeu de donnÃ©es <code data-package="questionr">hdv2003</code> Ã  lâ€™aide de la fonction <code data-package="utils">data</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(hdv2003)</code></pre>
<p>Bien. Et maintenant, elles sont oÃ¹ mes donnÃ©esÂ ? Et bien elles se trouvent dans un objet nommÃ© <code>hdv2003</code> dÃ©sormais chargÃ© en mÃ©moire et accessible directement. Dâ€™ailleurs, cet objet est maintenant visible dans lâ€™onglet <em>Environment</em> du quadrant supÃ©rieur droit.</p>
<p>Essayons de taper son nom Ã  lâ€™invite de commandeÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">hdv2003</code></pre>
<p>Le rÃ©sultat (non reproduit ici) ne ressemble pas forcÃ©ment Ã  grand-choseâ€¦ Il faut se rappeler que par dÃ©faut, lorsquâ€™on lui fournit seulement un nom dâ€™objet, <strong>R</strong> essaye de lâ€™afficher de la maniÃ¨re la meilleure (ou la moins pire) possible. La rÃ©ponse Ã  la commande <code>hdv2003</code> nâ€™est donc rien moins que lâ€™affichage des donnÃ©es brutes contenues dans cet objet.</p>
<p>Ce qui signifie donc que lâ€™intÃ©gralitÃ© de notre jeu de donnÃ©es est inclus dans lâ€™objet nommÃ© <code>hdv2003</code>Â ! En effet, dans <strong>R</strong>, un objet peut trÃ¨s bien contenir un simple nombre, un vecteur ou bien le rÃ©sultat dâ€™une enquÃªte tout entier. Dans ce cas, les objets sont appelÃ©s des <em>data frames</em>, ou tableaux de donnÃ©es. Ils peuvent Ãªtre manipulÃ©s comme tout autre objet. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>hdv2003</code></pre>
<p>va entraÃ®ner la copie de lâ€™ensemble de nos donnÃ©es dans un nouvel objet nommÃ© <code>d</code>, ce qui peut paraÃ®tre parfaitement inutile mais a en fait lâ€™avantage de fournir un objet avec un nom beaucoup plus court, ce qui diminuera la quantitÃ© de texte Ã  saisir par la suite.</p>
<p><strong>RÃ©sumons</strong></p>
<p>Comme nous avons dÃ©sormais dÃ©cidÃ© de saisir nos commandes dans un script et non plus directement dans la console, les premiÃ¨res lignes de notre fichier de travail sur les donnÃ©es de lâ€™enquÃªte <em>Histoire de vie</em> pourraient donc ressembler Ã  ceciÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">## Chargement des extensions nÃ©cessaires ----
<span class="kw">library</span>(questionr)
## Jeu de donnÃ©es hdv2003 ----
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003</code></pre>
</div>
<div id="pem_premier_travail_inspecter-les-donnees" class="section level2">
<h2>Inspecter les donnÃ©es</h2>
<div id="pem_premier_travail_structure-du-tableau" class="section level3">
<h3>Structure du tableau</h3>
<p>Avant de travailler sur les donnÃ©es, nous allons essayer de voir Ã  quoi elles ressemblent. Dans notre cas il sâ€™agit de se familiariser avec la stucture du fichier. Lors de lâ€™import de donnÃ©es depuis un autre logiciel, il sâ€™agira souvent de vÃ©rifier que lâ€™importation sâ€™est bien dÃ©roulÃ©e.</p>
<p>Un tableau de donnÃ©es est organisÃ© en lignes et en colonnes, les lignes correspondant aux observations et les colonnes aux variables. Les fonctions <code data-package="base">nrow</code>, <code data-package="base" data-rdocumentation="nrow">ncol</code> et <code data-package="base">dim</code> donnent respectivement le nombre de lignes, le nombre de colonnes et les dimensions de notre tableau. Nous pouvons donc dâ€™ores et dÃ©jÃ  vÃ©rifier que nous avons bien 2000 lignes et 20 colonnesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(d)</code></pre>
<pre><code>[1] 2000</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ncol</span>(d)</code></pre>
<pre><code>[1] 20</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(d)</code></pre>
<pre><code>[1] 2000   20</code></pre>
<p>La fonction <code data-package="base">names</code> donne les noms des colonnes de notre tableau, câ€™est-Ã -dire les noms des variablesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(d)</code></pre>
<pre><code> [1] "id"            "age"          
 [3] "sexe"          "nivetud"      
 [5] "poids"         "occup"        
 [7] "qualif"        "freres.soeurs"
 [9] "clso"          "relig"        
[11] "trav.imp"      "trav.satisf"  
[13] "hard.rock"     "lecture.bd"   
[15] "peche.chasse"  "cuisine"      
[17] "bricol"        "cinema"       
[19] "sport"         "heures.tv"    </code></pre>
<p>La fonction <code data-package="utils">str</code> est plus complÃ¨te. Elle liste les diffÃ©rentes variables, indique leur type et donne le cas Ã©chÃ©ant des informations supplÃ©mentaires ainsi quâ€™un Ã©chantillon des premiÃ¨res valeurs prises par cette variableÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d)</code></pre>
<pre><code>'data.frame':   2000 obs. of  20 variables:
 $ id           : int  1 2 3 4 5 6 7 8 9 10 ...
 $ age          : int  28 23 59 34 71 35 60 47 20 28 ...
 $ sexe         : Factor w/ 2 levels "Homme","Femme": 2 2 1 1 2 2 2 1 2 1 ...
 $ nivetud      : Factor w/ 8 levels "N'a jamais fait d'etudes",..: 8 NA 3 8 3 6 3 6 NA 7 ...
 $ poids        : num  2634 9738 3994 5732 4329 ...
 $ occup        : Factor w/ 7 levels "Exerce une profession",..: 1 3 1 1 4 1 6 1 3 1 ...
 $ qualif       : Factor w/ 7 levels "Ouvrier specialise",..: 6 NA 3 3 6 6 2 2 NA 7 ...
 $ freres.soeurs: int  8 2 2 1 0 5 1 5 4 2 ...
 $ clso         : Factor w/ 3 levels "Oui","Non","Ne sait pas": 1 1 2 2 1 2 1 2 1 2 ...
 $ relig        : Factor w/ 6 levels "Pratiquant regulier",..: 4 4 4 3 1 4 3 4 3 2 ...
 $ trav.imp     : Factor w/ 4 levels "Le plus important",..: 4 NA 2 3 NA 1 NA 4 NA 3 ...
 $ trav.satisf  : Factor w/ 3 levels "Satisfaction",..: 2 NA 3 1 NA 3 NA 2 NA 1 ...
 $ hard.rock    : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ lecture.bd   : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ peche.chasse : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 2 2 1 1 ...
 $ cuisine      : Factor w/ 2 levels "Non","Oui": 2 1 1 2 1 1 2 2 1 1 ...
 $ bricol       : Factor w/ 2 levels "Non","Oui": 1 1 1 2 1 1 1 2 1 1 ...
 $ cinema       : Factor w/ 2 levels "Non","Oui": 1 2 1 2 1 2 1 1 2 2 ...
 $ sport        : Factor w/ 2 levels "Non","Oui": 1 2 2 2 1 2 1 1 1 2 ...
 $ heures.tv    : num  0 1 0 2 3 2 2.9 1 2 2 ...</code></pre>
<p>La premiÃ¨re ligne nous informe quâ€™il sâ€™agit bien dâ€™un tableau de donnÃ©es avec 2000 observations et 20 variables. Vient ensuite la liste des variables. La premiÃ¨re se nomme <em>id</em> et est de type nombre entier (<em>int</em>). La seconde se nomme <em>age</em> et est de type numÃ©rique. La troisiÃ¨me se nomme <em>sexe</em>, il sâ€™agit dâ€™un facteur (<em>factor</em>).</p>
<p>Un facteur et une variable pouvant prendre un nombre limitÃ© de modalitÃ©s (<em>levels</em>). Ici notre variable a deux modalitÃ©s possiblesÂ : Â«Â HommeÂ Â» et Â«Â FemmeÂ Â». Ce type de variable est dÃ©crit plus en dÃ©tail dans le chapitre sur la <a href="#pem_manipulation_variables">manipulation de donnÃ©es</a>.</p>
<div class="important">
La fonction <code data-package="utils">str</code> est essentielle Ã  connaÃ®tre et peut sâ€™appliquer Ã  nâ€™importe quel type dâ€™objet. Câ€™est un excellent moyen de connaÃ®tre la structure dâ€™un objet.
</div>
</div>
<div id="pem_premier_travail_inspection-visuelle" class="section level3">
<h3>Inspection visuelle</h3>
<p>La particularitÃ© de <strong>R</strong> par rapport Ã  dâ€™autres logiciels comme <strong>Modalisa</strong> ou <strong>SPSS</strong> est de ne pas proposer, par dÃ©faut, de vue des donnÃ©es sous forme de tableau. Ceci peut parfois Ãªtre un peu dÃ©stabilisant dans les premiers temps dâ€™utilisation, mÃªme si on perd vite lâ€™habitude et quâ€™on finit par se rendre compte que Â«Â voirÂ Â» les donnÃ©es nâ€™est pas forcÃ©ment un gage de productivitÃ© ou de rigueur dans le traitement.</p>
<p>NÃ©anmoins, <strong>R</strong> propose une interface permettant de visualiser le contenu dâ€™un tableau de donnÃ©es Ã  lâ€™aide de la fonction <code data-package="utils">View</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(d)</code></pre>
<p>Sous <strong>RStudio</strong>, on peut aussi afficher la visionneusee (<em>viewer</em>) en cliquant sur la petite icÃ´ne en forme de tableau situÃ©e Ã  droite de la ligne dâ€™un tableau de donnÃ©es dans lâ€™onglet <em>Environment</em> du quadrant supÃ©rieur droit (cf.Â figure ci-aprÃ¨s).</p>
<figure>
<img src="images/capture_RStudio_icone_viewer.png" alt="IcÃ´ne pour afficher une vue du contenu dâ€™un tableau"/>
<figcaption>
IcÃ´ne pour afficher une vue du contenu dâ€™un tableau
</figcaption>
</figure>
<p>Dans tous les cas, <strong>RStudio</strong> lancera le <em>viewer</em> dans un onglet dÃ©diÃ© dans le quadrant supÃ©rieur gauche. Le visualiseur de <strong>RStudio</strong> est plus avancÃ© que celui-de base fournit par <strong>R</strong>. Il est possible de trier les donnÃ©es selon une variable en cliquant sur le nom de cette derniÃ¨re. Il y a Ã©galement un champs de recherche et un bouton <em>Filter</em> donnant accÃ¨s Ã  des options de filtrage avancÃ©es.</p>
<figure>
<img src="images/capture_RStudio_data_viewer.png" alt="La visionneuse de donnÃ©es de RStudio"/>
<figcaption>
La visionneuse de donnÃ©es de RStudio
</figcaption>
</figure>
</div>
<div id="pem_premier_travail_acceder-aux-variables" class="section level3">
<h3>AccÃ©der aux variables</h3>
<p><code>d</code> reprÃ©sente donc lâ€™ensemble de notre tableau de donnÃ©es. Nous avons vu que si lâ€™on saisit simplement <code>d</code> Ã  lâ€™invite de commandes, on obtient un affichage du tableau en question. Mais comment accÃ©der aux variables, câ€™est Ã  dire aux colonnes de notre tableauÂ ?</p>
<p>La rÃ©ponse est simpleÂ : on utilise le nom de lâ€™objet, suivi de lâ€™opÃ©rateur <code data-package="base" data-rdocumentation="Extract">$</code>, suivi du nom de la variable, comme ceciÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe</code></pre>
<p>Au regard du rÃ©sultat (non reproduit ici), on constate alors que <strong>R</strong> a bien accÃ©dÃ© au contenu de notre variable <em>sexe</em> du tableau <code>d</code> et a affichÃ© son contenu, câ€™est-Ã -dire lâ€™ensemble des valeurs prises par la variable.</p>
<p>Les fonctions <code data-package="utils">head</code> et <code data-package="utils" data-rdocumentation="head">tail</code> permettent dâ€™afficher seulement les premiÃ¨res (respectivement les derniÃ¨res) valeurs prises par la variable. On peut leur passer en argument le nombre dâ€™Ã©lÃ©ments Ã  afficherÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d$sport)</code></pre>
<pre><code>[1] Non Oui Oui Oui Non Oui
Levels: Non Oui</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(d$age, <span class="dv">10</span>)</code></pre>
<pre><code> [1] 52 42 50 41 46 45 46 24 24 66</code></pre>
<p>Ã€ noter que ces fonctions marchent aussi pour afficher les lignes du tableau <code>d</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d, <span class="dv">2</span>)</code></pre>
<pre><code>  id age  sexe
1  1  28 Femme
2  2  23 Femme
                                               nivetud
1 Enseignement superieur y compris technique superieur
2                                                 &lt;NA&gt;
     poids                 occup  qualif
1 2634.398 Exerce une profession Employe
2 9738.396       Etudiant, eleve    &lt;NA&gt;
  freres.soeurs clso                       relig
1             8  Oui Ni croyance ni appartenance
2             2  Oui Ni croyance ni appartenance
       trav.imp    trav.satisf hard.rock
1 Peu important Insatisfaction       Non
2          &lt;NA&gt;           &lt;NA&gt;       Non
  lecture.bd peche.chasse cuisine bricol cinema
1        Non          Non     Oui    Non    Non
2        Non          Non     Non    Non    Oui
  sport heures.tv
1   Non         0
2   Oui         1</code></pre>
</div>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="pem_premier_travail_fn1"><p>Sous <strong>Mac OS X</strong>, on utilise les touches <kbd>Pomme</kbd> et <kbd>EntrÃ©e</kbd>.<a href="#pem_premier_travail_fnref1">â†©</a></p></li>
</ol>
</div>

</article>
<article id="pem_stat_univ">

<div id="pem_stat_univ_header">
<h1 class="title">Statistique univariÃ©e</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#pem_stat_univ_variable-quantitative">Variable quantitative</a><ul>
<li><a href="#pem_stat_univ_principaux-indicateurs">Principaux indicateurs</a></li>
<li><a href="#pem_stat_univ_histogramme">Histogramme</a></li>
<li><a href="#pem_stat_univ_boites-a-moustaches">BoÃ®tes Ã  moustaches</a></li>
<li><a href="#pem_stat_univ_intervalle-de-confiance">Intervalle de confiance</a></li>
</ul></li>
<li><a href="#pem_stat_univ_variable-qualitative">Variable qualitative</a><ul>
<li><a href="#pem_stat_univ_tris-a-plat">Tris Ã  plat</a></li>
<li><a href="#pem_stat_univ_representation-graphique">ReprÃ©sentation graphique</a></li>
<li><a href="#pem_stat_univ_intervalle-de-confiance-1">Intervalle de confiance</a></li>
</ul></li>
</ul>
</div>

<div class="note">
Ce chapitre est inspirÃ© de la section <em>Premier travail avec les donnÃ©es</em> du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a> rÃ©alisÃ© par Julien Barnier.
</div>
<p>Faisant suite au chapitre <a href="#pem_premier_travail">Premier travail avec les donnÃ©es</a>, nous reprendrons dans ce chapitre les donnÃ©es de lâ€™enquÃªte <em>Histoire de vie 2003</em> fournies avec lâ€™extension <strong class="package">questionr</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(<span class="st">"hdv2003"</span>)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">str</span>(d)</code></pre>
<pre><code>'data.frame':   2000 obs. of  20 variables:
 $ id           : int  1 2 3 4 5 6 7 8 9 10 ...
 $ age          : int  28 23 59 34 71 35 60 47 20 28 ...
 $ sexe         : Factor w/ 2 levels "Homme","Femme": 2 2 1 1 2 2 2 1 2 1 ...
 $ nivetud      : Factor w/ 8 levels "N'a jamais fait d'etudes",..: 8 NA 3 8 3 6 3 6 NA 7 ...
 $ poids        : num  2634 9738 3994 5732 4329 ...
 $ occup        : Factor w/ 7 levels "Exerce une profession",..: 1 3 1 1 4 1 6 1 3 1 ...
 $ qualif       : Factor w/ 7 levels "Ouvrier specialise",..: 6 NA 3 3 6 6 2 2 NA 7 ...
 $ freres.soeurs: int  8 2 2 1 0 5 1 5 4 2 ...
 $ clso         : Factor w/ 3 levels "Oui","Non","Ne sait pas": 1 1 2 2 1 2 1 2 1 2 ...
 $ relig        : Factor w/ 6 levels "Pratiquant regulier",..: 4 4 4 3 1 4 3 4 3 2 ...
 $ trav.imp     : Factor w/ 4 levels "Le plus important",..: 4 NA 2 3 NA 1 NA 4 NA 3 ...
 $ trav.satisf  : Factor w/ 3 levels "Satisfaction",..: 2 NA 3 1 NA 3 NA 2 NA 1 ...
 $ hard.rock    : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ lecture.bd   : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ peche.chasse : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 2 2 1 1 ...
 $ cuisine      : Factor w/ 2 levels "Non","Oui": 2 1 1 2 1 1 2 2 1 1 ...
 $ bricol       : Factor w/ 2 levels "Non","Oui": 1 1 1 2 1 1 1 2 1 1 ...
 $ cinema       : Factor w/ 2 levels "Non","Oui": 1 2 1 2 1 2 1 1 2 2 ...
 $ sport        : Factor w/ 2 levels "Non","Oui": 1 2 2 2 1 2 1 1 1 2 ...
 $ heures.tv    : num  0 1 0 2 3 2 2.9 1 2 2 ...</code></pre>
<div id="pem_stat_univ_variable-quantitative" class="section level2">
<h2>Variable quantitative</h2>
<div id="pem_stat_univ_principaux-indicateurs" class="section level3">
<h3>Principaux indicateurs</h3>
<p>Comme la fonction <code data-package="utils">str</code> nous lâ€™a indiquÃ©, notre tableau <code>d</code> contient plusieurs valeurs numÃ©riques, dont la variable <em>heures.tv</em> qui reprÃ©sente le nombre moyen passÃ© par les enquÃªtÃ©s Ã  regarder la tÃ©lÃ©vision quotidiennement. On peut essayer de dÃ©terminer quelques caractÃ©ristiques de cette variable, en utilisant les fonctions <code data-package="base">mean</code>, <code data-package="stats">sd</code>, <code data-package="base" data-rdocumentation="Extremes">min</code>, <code data-package="base" data-rdocumentation="Extremes">max</code> et <code data-package="base">range</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$heures.tv)</code></pre>
<pre><code>[1] NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 2.246566</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 1.775853</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">min</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 12</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1]  0 12</code></pre>
<p>On peut lui ajouter la fonction <code data-package="stats">median</code> qui donne la valeur mÃ©diane, <code data-package="stats">quantile</code> qui calcule plus gÃ©nÃ©ralement tout type de quantiles, et le trÃ¨s utile <code data-package="base">summary</code> qui donne toutes ces informations ou presque en une seule fois, avec en prime le nombre de valeurs manquantes (<code>NA</code>)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>  0%  25%  50%  75% 100% 
   0    1    2    3   12 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$heures.tv)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   1.000   2.000   2.247   3.000  12.000 
   NA's 
      5 </code></pre>
<p>La fonction <code data-package="base">summary</code> est une fonction gÃ©nÃ©rique qui peut Ãªtre utilisÃ©e sur tout type dâ€™objet, y compris un tableau de donnÃ©es. Essayez donc <code>summary(d)</code>.</p>
</div>
<div id="pem_stat_univ_histogramme" class="section level3">
<h3>Histogramme</h3>
<p>Tout cela est bien pratique, mais pour pouvoir observer la distribution des valeurs dâ€™une variable quantitative, il nâ€™y a quand mÃªme rien de mieux quâ€™un bon graphique.</p>
<p>On peut commencer par un histogramme de la rÃ©partition des valeurs. Celui-ci peut Ãªtre gÃ©nÃ©rÃ© trÃ¨s facilement avec la fonction <code data-package="graphics">hist</code>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(d$heures.tv, <span class="dt">main =</span> <span class="st">"Nombre d'heures passÃ©es devant la tÃ©lÃ© par jour"</span>, 
  <span class="dt">xlab =</span> <span class="st">"Heures"</span>, <span class="dt">ylab =</span> <span class="st">"Effectif"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-4-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple dâ€™histogramme
</figcaption>
</figure>
<p>Sous <strong>RStudio</strong>, les graphiques sâ€™affichent dans lâ€™onglet <em>Plots</em> du quadrant infÃ©rieur droit. Il est possible dâ€™afficher une version plus grande de votre graphique en cliquant sur <em>Zoom</em>.</p>
<p>Ici, les options <code>main</code>, <code>xlab</code> et <code>ylab</code> permettent de personnaliser le titre du graphique, ainsi que les Ã©tiquettes des axes. De nombreuses autres options existent pour personnaliser lâ€™histogramme, parmi celles-ci on noteraÂ :</p>
<ul>
<li><code>probability</code> si elle vaut <code>TRUE</code>, lâ€™histogramme indique la proportion des classes de valeurs au lieu des effectifs.</li>
<li><code>breaks</code> permet de contrÃ´ler les classes de valeurs. On peut lui passer un chiffre, qui indiquera alors le nombre de classes, un vecteur, qui indique alors les limites des diffÃ©rentes classes, ou encore une chaÃ®ne de caractÃ¨re ou une fonction indiquant comment les classes doivent Ãªtre calculÃ©es.</li>
<li><code>col</code> la couleur de lâ€™histogramme<a href="#pem_stat_univ_fn1" class="footnoteRef" id="pem_stat_univ_fnref1"><sup>1</sup></a>.</li>
</ul>
<p>Voir la page dâ€™aide de la fonction <code data-package="graphics">hist</code> pour plus de dÃ©tails sur les diffÃ©rentes options. Les deux figures ci-aprÃ¨s sont deux autres exemples dâ€™histogramme.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(d$heures.tv, <span class="dt">main =</span> <span class="st">"Heures de tÃ©lÃ© en 7 classes"</span>, 
  <span class="dt">breaks =</span> <span class="dv">7</span>, <span class="dt">xlab =</span> <span class="st">"Heures"</span>, <span class="dt">ylab =</span> <span class="st">"Proportion"</span>, 
  <span class="dt">probability =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"orange"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-5-1.png" title="" alt="" width="1050"/>
<figcaption>
Un autre exemple dâ€™histogramme
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(d$heures.tv, <span class="dt">main =</span> <span class="st">"Heures de tÃ©lÃ© avec classes spÃ©cifiÃ©es"</span>, 
  <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">12</span>), <span class="dt">xlab =</span> <span class="st">"Heures"</span>, <span class="dt">ylab =</span> <span class="st">"Proportion"</span>, 
  <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-6-1.png" title="" alt="" width="1050"/>
<figcaption>
Encore un autre exemple dâ€™histogramme
</figcaption>
</figure>
</div>
<div id="pem_stat_univ_boites-a-moustaches" class="section level3">
<h3>BoÃ®tes Ã  moustaches</h3>
<p>Les boÃ®tes Ã  moustaches, ou <em>boxplot</em> en anglais, sont une autre reprÃ©sentation graphique de la rÃ©partition des valeurs dâ€™une variable quantitative. Elles sont particuliÃ¨rement utiles pour comparer les distributions de plusieurs variables ou dâ€™une mÃªme variable entre diffÃ©rents groupes, mais peuvent aussi Ãªtre utilisÃ©es pour reprÃ©senter la dispersion dâ€™une unique variable. La fonction qui produit ces graphiques est la fonction <code data-package="graphics">boxplot</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(d$heures.tv, <span class="dt">main =</span> <span class="st">"Nombre d'heures passÃ©es devant la tÃ©lÃ© par jour"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Heures"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-7-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de boÃ®te Ã  moustaches
</figcaption>
</figure>
<p>Comment interprÃ©ter ce graphiqueÂ ? On le comprendra mieux Ã  partir de la figure ci-aprÃ¨s<a href="#pem_stat_univ_fn2" class="footnoteRef" id="pem_stat_univ_fnref2"><sup>2</sup></a>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(d$heures.tv, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.8</span>), <span class="dt">main =</span> <span class="st">"Nombre d'heures passÃ©es devant la tÃ©lÃ© par jour"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Heures"</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">median</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">col =</span> <span class="st">"navy"</span>, 
  <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">text</span>(<span class="fl">1.35</span>, <span class="kw">median</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) +<span class="st"> </span><span class="fl">0.15</span>, 
  <span class="st">"MÃ©diane"</span>, <span class="dt">col =</span> <span class="st">"navy"</span>)
Q1 &lt;-<span class="st"> </span><span class="kw">quantile</span>(d$heures.tv, <span class="dt">probs =</span> <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> Q1, <span class="dt">col =</span> <span class="st">"darkred"</span>)
<span class="kw">text</span>(<span class="fl">1.35</span>, Q1 +<span class="st"> </span><span class="fl">0.15</span>, <span class="st">"Q1 : premier quartile"</span>, <span class="dt">col =</span> <span class="st">"darkred"</span>, 
  <span class="dt">lty =</span> <span class="dv">2</span>)
Q3 &lt;-<span class="st"> </span><span class="kw">quantile</span>(d$heures.tv, <span class="dt">probs =</span> <span class="fl">0.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> Q3, <span class="dt">col =</span> <span class="st">"darkred"</span>)
<span class="kw">text</span>(<span class="fl">1.35</span>, Q3 +<span class="st"> </span><span class="fl">0.15</span>, <span class="st">"Q3 : troisiÃ¨me quartile"</span>, <span class="dt">col =</span> <span class="st">"darkred"</span>, 
  <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">arrows</span>(<span class="dt">x0 =</span> <span class="fl">0.7</span>, <span class="dt">y0 =</span> <span class="kw">quantile</span>(d$heures.tv, <span class="dt">probs =</span> <span class="fl">0.75</span>, 
  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">x1 =</span> <span class="fl">0.7</span>, <span class="dt">y1 =</span> <span class="kw">quantile</span>(d$heures.tv, 
  <span class="dt">probs =</span> <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">length =</span> <span class="fl">0.1</span>, <span class="dt">code =</span> <span class="dv">3</span>)
<span class="kw">text</span>(<span class="fl">0.7</span>, Q1 +<span class="st"> </span>(Q3 -<span class="st"> </span>Q1)/<span class="dv">2</span> +<span class="st"> </span><span class="fl">0.15</span>, <span class="st">"h"</span>, <span class="dt">pos =</span> <span class="dv">2</span>)
<span class="kw">mtext</span>(<span class="st">"L'Ã©cart inter-quartile h contient 50 % des individus"</span>, 
  <span class="dt">side =</span> <span class="dv">1</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> Q1 -<span class="st"> </span><span class="fl">1.5</span> *<span class="st"> </span>(Q3 -<span class="st"> </span>Q1), <span class="dt">col =</span> <span class="st">"darkgreen"</span>)
<span class="kw">text</span>(<span class="fl">1.35</span>, Q1 -<span class="st"> </span><span class="fl">1.5</span> *<span class="st"> </span>(Q3 -<span class="st"> </span>Q1) +<span class="st"> </span><span class="fl">0.15</span>, <span class="st">"Q1 -1.5 h"</span>, 
  <span class="dt">col =</span> <span class="st">"darkgreen"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> Q3 +<span class="st"> </span><span class="fl">1.5</span> *<span class="st"> </span>(Q3 -<span class="st"> </span>Q1), <span class="dt">col =</span> <span class="st">"darkgreen"</span>)
<span class="kw">text</span>(<span class="fl">1.35</span>, Q3 +<span class="st"> </span><span class="fl">1.5</span> *<span class="st"> </span>(Q3 -<span class="st"> </span>Q1) +<span class="st"> </span><span class="fl">0.15</span>, <span class="st">"Q3 +1.5 h"</span>, 
  <span class="dt">col =</span> <span class="st">"darkgreen"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-8-1.png" title="" alt="" width="1050"/>
<figcaption>
InterprÃ©tation dâ€™une boÃ®te Ã  moustaches
</figcaption>
</figure>
<p>Le carrÃ© au centre du graphique est dÃ©limitÃ© par les premiers et troisiÃ¨me quartiles, avec la mÃ©diane reprÃ©sentÃ©e par une ligne plus sombre au milieu. Les Â«Â fourchettesÂ Â» sâ€™Ã©tendant de part et dâ€™autres vont soit jusquâ€™Ã  la valeur minimale ou maximale, soit jusquâ€™Ã  une valeur approximativement Ã©gale au quartile le plus proche plus 1,5 fois lâ€™Ã©cart inter-quartile. Les points se situant en-dehors de cette fourchette sont reprÃ©sentÃ©s par des petits ronds et sont gÃ©nÃ©ralement considÃ©rÃ©s comme des valeurs extrÃªmes, potentiellement aberrantes.</p>
<p>On peut ajouter la reprÃ©sentation des valeurs sur le graphique pour en faciliter la lecture avec des petits traits dessinÃ©s sur lâ€™axe vertical (fonction <code data-package="graphics">rug</code>)Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(d$heures.tv, <span class="dt">main =</span> <span class="st">"Nombre d'heures passÃ©es devant la tÃ©lÃ© par</span><span class="ch">\n</span><span class="st">jour"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Heures"</span>)
<span class="kw">rug</span>(d$heures.tv, <span class="dt">side =</span> <span class="dv">2</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-9-1.png" title="" alt="" width="1050"/>
<figcaption>
BoÃ®te Ã  moustaches avec reprÃ©sentation des valeurs
</figcaption>
</figure>
</div>
<div id="pem_stat_univ_intervalle-de-confiance" class="section level3">
<h3>Intervalle de confiance</h3>
<p>Lâ€™intervalle de confiance dâ€™une moyenne peut Ãªtre calculÃ© avec la fonction <code data-package="stats">t.test</code> (fonction qui permet Ã©galement de rÃ©aliser un test <em>t</em> de Student comme nous le verrons dans le chapitre dÃ©diÃ© Ã  la <a href="#analyses_stat_biv_comp_moyennes">statistique bivariÃ©e</a>)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t.test</span>(d$heures.tv)</code></pre>
<pre><code>
    One Sample t-test

data:  d$heures.tv
t = 56.505, df = 1994, p-value &lt; 2.2e-16
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 2.168593 2.324540
sample estimates:
mean of x 
 2.246566 </code></pre>
<p>Le niveau de confiance peut Ãªtre prÃ©cisÃ© via lâ€™argument <code>conf.level</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t.test</span>(d$heures.tv, <span class="dt">conf.level =</span> <span class="fl">0.9</span>)</code></pre>
<pre><code>
    One Sample t-test

data:  d$heures.tv
t = 56.505, df = 1994, p-value &lt; 2.2e-16
alternative hypothesis: true mean is not equal to 0
90 percent confidence interval:
 2.181138 2.311995
sample estimates:
mean of x 
 2.246566 </code></pre>
<p>Le nombre dâ€™heures moyennes Ã  regarder la tÃ©lÃ©vision parmi les enquÃªtÃ©s sâ€™avÃ¨re Ãªtre de 2,2 heures, avec un intervalle de confiance Ã  95Â % de [2,17Â -Â 2,33] et un intervalle de confiance Ã  90Â % de [2,18Â -Â 2,31].</p>
</div>
</div>
<div id="pem_stat_univ_variable-qualitative" class="section level2">
<h2>Variable qualitative</h2>
<div id="pem_stat_univ_tris-a-plat" class="section level3">
<h3>Tris Ã  plat</h3>
<p>La fonction la plus utilisÃ©e pour le traitement et lâ€™analyse des variables qualitatives (variable prenant ses valeurs dans un ensemble de modalitÃ©s) est sans aucun doute la fonction <code data-package="base">table</code>, qui donne les effectifs de chaque modalitÃ© de la variable.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sexe)</code></pre>
<pre><code>
Homme Femme 
  899  1101 </code></pre>
<p>La tableau prÃ©cÃ©dent nous indique que parmi nos enquÃªtÃ©s on trouve 899 hommes et 1101 femmes.</p>
<p>Quand le nombre de modalitÃ©s est Ã©levÃ©, on peut ordonner le tri Ã  plat selon les effectifs Ã  lâ€™aide de la fonction <code data-package="base">sort</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$occup)</code></pre>
<pre><code>
Exerce une profession               Chomeur 
                 1049                   134 
      Etudiant, eleve              Retraite 
                   94                   392 
  Retire des affaires              Au foyer 
                   77                   171 
        Autre inactif 
                   83 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">table</span>(d$occup))</code></pre>
<pre><code>
  Retire des affaires         Autre inactif 
                   77                    83 
      Etudiant, eleve               Chomeur 
                   94                   134 
             Au foyer              Retraite 
                  171                   392 
Exerce une profession 
                 1049 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">table</span>(d$occup), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>
Exerce une profession              Retraite 
                 1049                   392 
             Au foyer               Chomeur 
                  171                   134 
      Etudiant, eleve         Autre inactif 
                   94                    83 
  Retire des affaires 
                   77 </code></pre>
<p>Ã€ noter que la fonction <code data-package="base">table</code> exclut par dÃ©faut les non-rÃ©ponses du tableau rÃ©sultat. Lâ€™argument <code>useNA</code> de cette fonction permet de modifier ce comportementÂ :</p>
<ul>
<li>avec <code>useNA="no"</code> (valeur par dÃ©faut), les valeurs manquantes ne sont jamais incluses dans le tri Ã  platÂ ;</li>
<li>avec <code>useNA="ifany"</code>, une colonne <code>NA</code> est ajoutÃ©e si des valeurs manquantes sont prÃ©sentes dans les donnÃ©esÂ ;</li>
<li>avec <code>useNA="always"</code>, une colonne <code>NA</code> est toujours ajoutÃ©e, mÃªme sâ€™il nâ€™y a pas de valeurs manquantes dans les donnÃ©es.</li>
</ul>
<p>On peut donc utiliserÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$trav.satisf, <span class="dt">useNA =</span> <span class="st">"ifany"</span>)</code></pre>
<pre><code>
  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          &lt;NA&gt; 
           952 </code></pre>
<p>Lâ€™utilisation de <code data-package="base">summary</code> permet Ã©galement lâ€™affichage du tri Ã  plat et du nombre de non-rÃ©ponsesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf)</code></pre>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          NA's 
           952 </code></pre>
<p>Pour obtenir un tableau avec la rÃ©partition en pourcentages, on peut utiliser la fonction <code data-package="questionr">freq</code> de lâ€™extension <strong class="package">questionr</strong><a href="#pem_stat_univ_fn3" class="footnoteRef" id="pem_stat_univ_fnref3"><sup>3</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$qualif)</code></pre>
<pre><code>                           n    % val%
Ouvrier specialise       203 10.2 12.3
Ouvrier qualifie         292 14.6 17.7
Technicien                86  4.3  5.2
Profession intermediaire 160  8.0  9.7
Cadre                    260 13.0 15.7
Employe                  594 29.7 35.9
Autre                     58  2.9  3.5
NA                       347 17.3   NA</code></pre>
<p>La colonne <code>n</code> donne les effectifs bruts, la colonne <code>%</code> la rÃ©partition en pourcentages et <code>val%</code> la rÃ©partition en pourcentages, donnÃ©es manquantes exclues. La fonction accepte plusieurs paramÃ¨tres permettant dâ€™afficher les totaux, les pourcentages cumulÃ©s, de trier selon les effectifs ou de contrÃ´ler lâ€™affichage. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$qualif, <span class="dt">cum =</span> <span class="ot">TRUE</span>, <span class="dt">total =</span> <span class="ot">TRUE</span>, <span class="dt">sort =</span> <span class="st">"inc"</span>, 
  <span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">exclude =</span> <span class="ot">NA</span>)</code></pre>
<pre><code>                            n      %   %cum
Autre                      58   3.51   3.51
Technicien                 86   5.20   8.71
Profession intermediaire  160   9.68  18.39
Ouvrier specialise        203  12.28  30.67
Cadre                     260  15.73  46.40
Ouvrier qualifie          292  17.66  64.07
Employe                   594  35.93 100.00
Total                    1653 100.00 100.00</code></pre>
<p>La colonne <code>%cum</code> indique ici le pourcentage cumulÃ©, ce qui est ici une trÃ¨s mauvaise idÃ©e puisque pour ce type de variable cela nâ€™a aucun sens. Les lignes du tableau rÃ©sultat ont Ã©tÃ© triÃ©s par effectifs croissants, les totaux ont Ã©tÃ© ajoutÃ©s, les non-rÃ©ponses exclues et les pourcentages arrondis Ã  deux dÃ©cimales.</p>
<p>Pour plus dâ€™informations sur la fonction <code data-package="questionr">freq</code>, consultez sa page dâ€™aide en ligne avec <code>?freq</code> ou <code>help("freq")</code>.</p>
</div>
<div id="pem_stat_univ_representation-graphique" class="section level3">
<h3>ReprÃ©sentation graphique</h3>
<p>Pour reprÃ©senter la rÃ©partition des effectifs parmi les modalitÃ©s dâ€™une variable qualitative, on a souvent tendance Ã  utiliser des diagrammes en secteurs (camemberts). Ceci est possible sous <strong>R</strong> avec la fonction <code data-package="graphics">pie</code>, mais la page dâ€™aide de la dite fonction nous le dÃ©conseille assez vivementÂ : les diagrammes en secteur sont en effet une mauvaise maniÃ¨re de prÃ©senter ce type dâ€™information, car lâ€™oeil humain prÃ©fÃ¨re comparer des longueurs plutÃ´t que des surfaces<a href="#pem_stat_univ_fn4" class="footnoteRef" id="pem_stat_univ_fnref4"><sup>4</sup></a>.</p>
<p>On privilÃ©giera donc dâ€™autres formes de reprÃ©sentations, Ã  savoir les diagrammes en bÃ¢tons et les <em>diagrammes de Cleveland</em>.</p>
<p>Les diagrammes en bÃ¢tons sont utilisÃ©s automatiquement par <strong>R</strong> lorsquâ€™on applique la fonction gÃ©nÃ©rique <code data-package="graphics" data-rdocumentation="plot.table">plot</code> Ã  un tri Ã  plat obtenu avec <code data-package="base">table</code>. On privilÃ©giera cependant ce type de reprÃ©sentations pour les variables de type numÃ©rique comportant un nombre fini de valeurs. Le nombre de frÃ¨res, soeurs, demi-frÃ¨res et demi-soeurs est un bon exempleÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">table</span>(d$freres.soeurs), <span class="dt">main =</span> <span class="st">"Nombre de frÃ¨res, soeurs, demi-frÃ¨res et demi-soeurs"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Effectif"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-18-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de diagramme en bÃ¢tons
</figcaption>
</figure>
<p>Pour les autres types de variables qualitatives, on privilÃ©giera les <em>diagrammes de Cleveland</em>, obtenus avec la fonction <code data-package="graphics">dotchart</code>. On doit appliquer cette fonction au tri Ã  plat de la variable, obtenu avec <code data-package="base">table</code><a href="#pem_stat_univ_fn5" class="footnoteRef" id="pem_stat_univ_fnref5"><sup>5</sup></a>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dotchart</span>(<span class="kw">as.matrix</span>(<span class="kw">table</span>(d$clso)), <span class="dt">main =</span> <span class="st">"Sentiment d'appartenance Ã  une classe sociale"</span>, 
  <span class="dt">pch =</span> <span class="dv">19</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-19-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de diagramme de Cleveland
</figcaption>
</figure>
<p>Quand la variable comprend un grand nombre de modalitÃ©s, il est prÃ©fÃ©rable dâ€™ordonner le tri Ã  plat obtenu Ã  lâ€™aide de la fonction <code data-package="base">sort</code>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dotchart</span>(<span class="kw">as.matrix</span>(<span class="kw">sort</span>(<span class="kw">table</span>(d$qualif))), <span class="dt">main =</span> <span class="st">"Niveau de qualification"</span>)</code></pre>
<img src="images/pem_stat_univ/unnamed-chunk-20-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de diagramme de Cleveland ordonnÃ©
</figcaption>
</figure>
<div class="astuce">
<p>Lâ€™agument <code>pch</code>, qui est utilisÃ© par la plupart des graphiques de type points, permet de spÃ©cifier le symbole Ã  utiliser. Il peut prendre soit un nombre entier compris entre 0 et 25, soit un charactÃ¨re textuel (voir ci-dessous).</p>
<img src="images/pem_stat_univ/unnamed-chunk-21-1.png" title="" alt="" width="1050"/>
</div>
</div>
<div id="pem_stat_univ_intervalle-de-confiance-1" class="section level3">
<h3>Intervalle de confiance</h3>
<p>La fonction <code data-package="stats">prop.test</code> permet de calculer lâ€™intervalle de confiance dâ€™une proportion. Une premiÃ¨re possibilitÃ© consiste Ã  lui transmettre une table Ã  une dimension et deux entrÃ©es. Par exemple, si lâ€™on sâ€™intÃ©resse Ã  la proportion de personnes ayant pratiquÃ© une activitÃ© physique au cours des douze derniers moisÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$sport)</code></pre>
<pre><code>       n    % val%
Non 1277 63.8 63.8
Oui  723 36.1 36.1
NA     0  0.0   NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="kw">table</span>(d$sport))</code></pre>
<pre><code>
    1-sample proportions test with continuity
    correction

data:  table(d$sport), null probability 0.5
X-squared = 152.9, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.6169447 0.6595179
sample estimates:
     p 
0.6385 </code></pre>
<p>On remarquera que la fonction a calculÃ© lâ€™intervalle de confiance correspondant Ã  la premiÃ¨re entrÃ©e du tableau, autrement dit celui de la proportion dâ€™enquÃªtÃ©s nâ€™ayant pas pratiquÃ© une activitÃ© sportive. Or, nous sommes intÃ©ressÃ© par la proportion complÃ©mentaire, Ã  savoir celle dâ€™enquÃªtÃ©s ayant pratiquÃ© une activitÃ© sportive. On peut dÃ¨s lors modifier lâ€™ordre de la table en indiquant notre modalitÃ© dâ€™intÃ©rÃªt avec la fonction <code data-package="stats">relevel</code> ou bien indiquer Ã  <code data-package="stats">prop.test</code> dâ€™abord le nombre de succÃ¨s puis lâ€™effectif totalÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="kw">table</span>(<span class="kw">relevel</span>(d$sport, <span class="st">"Oui"</span>)))</code></pre>
<pre><code>
    1-sample proportions test with continuity
    correction

data:  table(relevel(d$sport, "Oui")), null probability 0.5
X-squared = 152.9, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3404821 0.3830553
sample estimates:
     p 
0.3615 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="kw">sum</span>(d$sport ==<span class="st"> "Oui"</span>), <span class="kw">length</span>(d$sport))</code></pre>
<pre><code>
    1-sample proportions test with continuity
    correction

data:  sum(d$sport == "Oui") out of length(d$sport), null probability 0.5
X-squared = 152.9, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3404821 0.3830553
sample estimates:
     p 
0.3615 </code></pre>
<p>Enfin, le niveau de confiance peut Ãªtre modifiÃ© via lâ€™argument <code>conf.level</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="kw">table</span>(<span class="kw">relevel</span>(d$sport, <span class="st">"Oui"</span>)), <span class="dt">conf.level =</span> <span class="fl">0.9</span>)</code></pre>
<pre><code>
    1-sample proportions test with continuity
    correction

data:  table(relevel(d$sport, "Oui")), null probability 0.5
X-squared = 152.9, df = 1, p-value &lt; 2.2e-16
alternative hypothesis: true p is not equal to 0.5
90 percent confidence interval:
 0.3437806 0.3795989
sample estimates:
     p 
0.3615 </code></pre>
<p>Pour se simplifier un peu la vie, le package <strong class="package">JLutils</strong> propose une fonction <code data-package="JLutils">prop.ci</code> (et ses deux variantes <code data-package="JLutils">prop.ci.lower</code> et <code data-package="JLutils">prop.ci.upper</code>) permettant dâ€™appeler plus facilement <code data-package="stats">prop.test</code> et renvoyant directement lâ€™intervalle de confiance.</p>
<p><strong class="package">JLutils</strong> nâ€™Ã©tant disponible que sur <a href="https://github.com/larmarange/JLutils">GitHub</a>, on aura recours au package <strong class="package">devtools</strong> et Ã  sa fonction <code data-package="devtools">install_github</code> pour lâ€™installerÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"larmarange/JLutils"</span>)</code></pre>
<p><code data-package="JLutils">prop.ci</code> fonction accepte directement un tri Ã  plat obtenu avec <code data-package="base">table</code>, un vecteur de donnÃ©es, un vecteur logique (issu dâ€™une condition), ou bien le nombre de succÃ¨s et le nombre total dâ€™essais. Voir les exemples ci-aprÃ¨sÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(JLutils)
<span class="kw">freq</span>(d$sport)</code></pre>
<pre><code>       n    % val%
Non 1277 63.8 63.8
Oui  723 36.1 36.1
NA     0  0.0   NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci</span>(d$sport)</code></pre>
<pre><code>[1] 0.6169447 0.6595179</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci.lower</span>(d$sport)</code></pre>
<pre><code>[1] 0.6169447</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci.upper</span>(d$sport)</code></pre>
<pre><code>[1] 0.6595179</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci</span>(d$sport, <span class="dt">conf.level =</span> <span class="fl">0.9</span>)</code></pre>
<pre><code>[1] 0.6204011 0.6562194</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci</span>(<span class="kw">table</span>(d$sport))</code></pre>
<pre><code>[1] 0.6169447 0.6595179</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci</span>(d$sport ==<span class="st"> "Non"</span>)</code></pre>
<pre><code>[1] 0.6169447 0.6595179</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci</span>(d$sport ==<span class="st"> "Oui"</span>)</code></pre>
<pre><code>[1] 0.3404821 0.3830553</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci.lower</span>(<span class="kw">c</span>(<span class="dv">1277</span>, <span class="dv">723</span>), <span class="dt">n =</span> <span class="dv">2000</span>)</code></pre>
<pre><code>[1] 0.6169447 0.3404821</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.ci.upper</span>(<span class="kw">c</span>(<span class="dv">1277</span>, <span class="dv">723</span>), <span class="dt">n =</span> <span class="dv">2000</span>)</code></pre>
<pre><code>[1] 0.6595179 0.3830553</code></pre>
<div class="info">
Il existe de nombreuses maniÃ¨res de calculer un intervalle de confiance pour une proportion. En lâ€™occurence, lâ€™intervalle calculÃ© par <code data-package="stats">prop.test</code> correspond dans le cas prÃ©sent Ã  un intervalle bilatÃ©ral selon la mÃ©thode des scores de Wilson avec correction de continuitÃ©. Pour plus dâ€™information, on pourra lire <a href="http://joseph.larmarange.net/?Intervalle-de-confiance-bilateral" class="uri">http://joseph.larmarange.net/?Intervalle-de-confiance-bilateral</a>.
</div>
</div>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="pem_stat_univ_fn1"><p>Il existe un grand nombre de couleurs prÃ©dÃ©finies dans <strong>R</strong>. On peut rÃ©cupÃ©rer leur liste en utilisant la fonction <code data-package="grDevices">colors</code> en tapant simplement <code>colors()</code> dans la console, ou en consultant le document suivantÂ : <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" class="uri">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a>.<a href="#pem_stat_univ_fnref1">â†©</a></p></li>
<li id="pem_stat_univ_fn2"><p>Le code ayant servi Ã  gÃ©nÃ©rer cette figure est une copie quasi conforme de celui prÃ©sentÃ© dans lâ€™excellent document de Jean Lobry sur les graphiques de base avec <strong>R</strong>, tÃ©lÃ©chargeable sur le site du PÃ´le bioinformatique lyonnaisÂ : <a href="http://pbil.univ-lyon1.fr/R/pdf/lang04.pdf" class="uri">http://pbil.univ-lyon1.fr/R/pdf/lang04.pdf</a>.<a href="#pem_stat_univ_fnref2">â†©</a></p></li>
<li id="pem_stat_univ_fn3"><p>En lâ€™absence de lâ€™extension <strong class="package">questionr</strong>, on pourra se rabattre sur la fonction <code data-package="base">prop.table</code> avec la commande suivanteÂ : <code>prop.table(table(d$qualif))</code>.<a href="#pem_stat_univ_fnref3">â†©</a></p></li>
<li id="pem_stat_univ_fn4"><p>On trouvera des exemples illustrant cette idÃ©e dans le document de Jean Lobry citÃ© prÃ©cÃ©demment.<a href="#pem_stat_univ_fnref4">â†©</a></p></li>
<li id="pem_stat_univ_fn5"><p>Pour des raisons liÃ©es au fonctionnement interne de la fonction <code data-package="graphics">dotchart</code>, on doit transformer le tri Ã  plat en matrice, dâ€™oÃ¹ lâ€™appel Ã  la fonction <code data-package="base" data-rdocumentation="matrix">as.matrix</code>.<a href="#pem_stat_univ_fnref5">â†©</a></p></li>
</ol>
</div>

</article>
<article id="pem_import_export">

<div id="pem_import_export_header">
<h1 class="title">Import / Export de donnÃ©es</h1>
</div>


<p>Ã  venir</p>

</article>
<article id="pem_manipulation">

<div id="pem_manipulation_header">
<h1 class="title">Manipulation de donnÃ©es</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#pem_manipulation_variables">Variables</a><ul>
<li><a href="#pem_manipulation_types-de-variables">Types de variables</a></li>
<li><a href="#pem_manipulation_renommer-des-variables">Renommer des variables</a></li>
<li><a href="#pem_manipulation_facteurs">Facteurs</a></li>
</ul></li>
<li><a href="#pem_manipulation_indexation">Indexation</a><ul>
<li><a href="#pem_manipulation_indexation-directe">Indexation directe</a></li>
<li><a href="#pem_manipulation_indexation-par-nom">Indexation par nom</a></li>
<li><a href="#pem_manipulation_indexation-par-condition">Indexation par condition</a></li>
<li><a href="#pem_manipulation_indexation-et-assignation">Indexation et assignation</a></li>
</ul></li>
<li><a href="#pem_manipulation_sous-populations">Sous-populations</a><ul>
<li><a href="#pem_manipulation_par-indexation">Par indexation</a></li>
<li><a href="#pem_manipulation_subset">Fonction subset</a></li>
<li><a href="#pem_manipulation_tapply">Fonction tapply</a></li>
</ul></li>
<li><a href="#pem_manipulation_recodages">Recodages</a><ul>
<li><a href="#pem_manipulation_convertir-une-variable">Convertir une variable</a></li>
<li><a href="#pem_manipulation_decouper-une-variable-numerique-en-classes">DÃ©couper une variable numÃ©rique en classes</a></li>
<li><a href="#pem_manipulation_regrouper-les-modalites-dune-variable">Regrouper les modalitÃ©s dâ€™une variable</a></li>
<li><a href="#pem_manipulation_variables-calculees">Variables calculÃ©es</a></li>
<li><a href="#pem_manipulation_combiner-plusieurs-variables">Combiner plusieurs variables</a></li>
<li><a href="#pem_manipulation_variables-scores">Variables scores</a></li>
<li><a href="#pem_manipulation_verification-des-recodages">VÃ©rification des recodages</a></li>
</ul></li>
<li><a href="#pem_manipulation_tri-de-tables">Tri de tables</a></li>
<li><a href="#pem_manipulation_fusion_tables">Fusion de tables</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Julien Barnier dans le cadre du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a>.
</div>
<div class="info">
Cette partie est un peu aride et pas forcÃ©ment trÃ¨s intuitive. Elle aborde cependant la base de tous les traitements et manipulation de donnÃ©es sous <strong>R</strong>, et mÃ©rite donc quâ€™on sâ€™y arrÃªte un moment, ou quâ€™on y revienne un peu plus tard en cas de saturationâ€¦
</div>
<div id="pem_manipulation_variables" class="section level2">
<h2>Variables</h2>
<p>Le type dâ€™objet utilisÃ© par <strong>R</strong> pour stocker des tableaux de donnÃ©es sâ€™appelle un <em>data frame</em>. Celui-ci comporte des observations en ligne et des variables en colonnes. On accÃ¨de aux variables dâ€™un <em>data frame</em> avec lâ€™opÃ©rateur <code>$</code>.</p>
<p>Dans ce qui suit on travaillera sur le jeu de donnÃ©es tirÃ© de lâ€™enquÃªte <em>Histoire de vie</em>, fourni avec lâ€™extension <strong class="package">questionr</strong>, mais aussi sur le jeu de donnÃ©es tirÃ© du recensement 1999 et disponible dans la mÃªme extension.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">data</span>(rp99)</code></pre>
<div id="pem_manipulation_types-de-variables" class="section level3">
<h3>Types de variables</h3>
<p>On peut considÃ©rer quâ€™il existe quatre type de variables dans <strong>R</strong>Â :</p>
<ul>
<li>les variables <em>numÃ©riques</em>, ou quantitativesÂ ;</li>
<li>les <em>facteurs</em>, qui prennent leurs valeurs dans un ensemble dÃ©fini de modalitÃ©s. Elles correspondent en gÃ©nÃ©ral aux questions fermÃ©es dâ€™un questionnaireÂ ;</li>
<li>les variables <em>caractÃ¨res</em> ou <em>texte</em>, qui contiennent des chaÃ®nes de caractÃ¨res plus ou moins longues. On les utilise pour les questions ouvertes ou les champs libresÂ ;</li>
<li>les variables <em>boolÃ©ennes</em>, qui ne peuvent prendre que la valeur vrai (<code>TRUE</code>) ou faux (<code>FALSE</code>). On les utilise dans <strong>R</strong> pour les calculs et les recodages.</li>
</ul>
<p>Pour connaÃ®tre le type dâ€™une variable donnÃ©e, on peut utiliser la fonction <code data-package="base">class</code>.</p>
<table>
<thead>
<tr class="header">
<th align="left">Classe R</th>
<th align="left">Type de variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">factor</td>
<td align="left">facteur</td>
</tr>
<tr class="even">
<td align="left">integer</td>
<td align="left">numÃ©rique</td>
</tr>
<tr class="odd">
<td align="left">double</td>
<td align="left">numÃ©rique</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">numÃ©rique</td>
</tr>
<tr class="odd">
<td align="left">character</td>
<td align="left">caractÃ¨re/texte</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">boolÃ©enne</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(d$age)</code></pre>
<pre><code>[1] "integer"</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(d$sexe)</code></pre>
<pre><code>[1] "factor"</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</code></pre>
<pre><code>[1] "logical"</code></pre>
<p>La fonction <code data-package="utils">str</code> permet Ã©galement dâ€™avoir un listing de toutes les variables dâ€™un tableau de donnÃ©es et indique le type de chacune dâ€™elle.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d)</code></pre>
<pre><code>'data.frame':   2000 obs. of  20 variables:
 $ id           : int  1 2 3 4 5 6 7 8 9 10 ...
 $ age          : int  28 23 59 34 71 35 60 47 20 28 ...
 $ sexe         : Factor w/ 2 levels "Homme","Femme": 2 2 1 1 2 2 2 1 2 1 ...
 $ nivetud      : Factor w/ 8 levels "N'a jamais fait d'etudes",..: 8 NA 3 8 3 6 3 6 NA 7 ...
 $ poids        : num  2634 9738 3994 5732 4329 ...
 $ occup        : Factor w/ 7 levels "Exerce une profession",..: 1 3 1 1 4 1 6 1 3 1 ...
 $ qualif       : Factor w/ 7 levels "Ouvrier specialise",..: 6 NA 3 3 6 6 2 2 NA 7 ...
 $ freres.soeurs: int  8 2 2 1 0 5 1 5 4 2 ...
 $ clso         : Factor w/ 3 levels "Oui","Non","Ne sait pas": 1 1 2 2 1 2 1 2 1 2 ...
 $ relig        : Factor w/ 6 levels "Pratiquant regulier",..: 4 4 4 3 1 4 3 4 3 2 ...
 $ trav.imp     : Factor w/ 4 levels "Le plus important",..: 4 NA 2 3 NA 1 NA 4 NA 3 ...
 $ trav.satisf  : Factor w/ 3 levels "Satisfaction",..: 2 NA 3 1 NA 3 NA 2 NA 1 ...
 $ hard.rock    : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ lecture.bd   : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 1 1 1 1 ...
 $ peche.chasse : Factor w/ 2 levels "Non","Oui": 1 1 1 1 1 1 2 2 1 1 ...
 $ cuisine      : Factor w/ 2 levels "Non","Oui": 2 1 1 2 1 1 2 2 1 1 ...
 $ bricol       : Factor w/ 2 levels "Non","Oui": 1 1 1 2 1 1 1 2 1 1 ...
 $ cinema       : Factor w/ 2 levels "Non","Oui": 1 2 1 2 1 2 1 1 2 2 ...
 $ sport        : Factor w/ 2 levels "Non","Oui": 1 2 2 2 1 2 1 1 1 2 ...
 $ heures.tv    : num  0 1 0 2 3 2 2.9 1 2 2 ...</code></pre>
</div>
<div id="pem_manipulation_renommer-des-variables" class="section level3">
<h3>Renommer des variables</h3>
<p>Une opÃ©ration courante lorsquâ€™on a importÃ© des variables depuis une source de donnÃ©es externe consiste Ã  renommer les variables importÃ©es. Sous <strong>R</strong> les noms de variables doivent Ãªtre Ã  la fois courts et explicites.</p>
<div class="important">
Les noms de variables peuvent contenir des lettres, des chiffres (mais ils ne peuvent pas commencer par un chiffre), les symboles <code>.</code> et <code>_</code> et doivent commencer par une lettre. <strong>R</strong> fait la diffÃ©rence entre les majuscules et les minuscules, ce qui signifie que <em>x</em> et <strong>X</strong> sont deux noms de variable diffÃ©rents. On Ã©vitera Ã©galement dâ€™utiliser des caractÃ¨res accentuÃ©s dans les noms de variable. Comme les espaces ne sont pas autorisÃ©s, on pourra les remplacer par un point ou un tiret bas.
</div>
<p>On peut lister les noms des variables dâ€™un tableau de donnÃ©es (<em>data.frame</em>) Ã  lâ€™aide de la fonction <code data-package="base">names</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(d)</code></pre>
<pre><code> [1] "id"            "age"          
 [3] "sexe"          "nivetud"      
 [5] "poids"         "occup"        
 [7] "qualif"        "freres.soeurs"
 [9] "clso"          "relig"        
[11] "trav.imp"      "trav.satisf"  
[13] "hard.rock"     "lecture.bd"   
[15] "peche.chasse"  "cuisine"      
[17] "bricol"        "cinema"       
[19] "sport"         "heures.tv"    </code></pre>
<p>Cette fonction peut Ã©galement Ãªtre utilisÃ©e pour renommer lâ€™ensemble des variables. Si par exemple on souhaitait passer les noms de toutes les variables en majuscules, on pourrait faireÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d.maj &lt;-<span class="st"> </span>d
<span class="kw">names</span>(d.maj) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"ID"</span>, <span class="st">"AGE"</span>, <span class="st">"SEXE"</span>, <span class="st">"NIVETUD"</span>, <span class="st">"POIDS"</span>, 
  <span class="st">"OCCUP"</span>, <span class="st">"QUALIF"</span>, <span class="st">"FRERES.SOEURS"</span>, <span class="st">"CLSO"</span>, <span class="st">"RELIG"</span>, 
  <span class="st">"TRAV.IMP"</span>, <span class="st">"TRAV.SATISF"</span>, <span class="st">"HARD.ROCK"</span>, <span class="st">"LECTURE.BD"</span>, 
  <span class="st">"PECHE.CHASSE"</span>, <span class="st">"CUISINE"</span>, <span class="st">"BRICOL"</span>, <span class="st">"CINEMA"</span>, 
  <span class="st">"SPORT"</span>, <span class="st">"HEURES.TV"</span>)
<span class="kw">summary</span>(d.maj$SEXE)</code></pre>
<pre><code>Homme Femme 
  899  1101 </code></pre>
<p>Ce type de renommage peut Ãªtre utile lorsquâ€™on souhaite passer en revue tous les noms de variables dâ€™un fichier importÃ© pour les corriger le cas Ã©chÃ©ant. Pour faciliter un peu ce travail pas forcÃ©ment passionant, on peut utiliser la fonction <code data-package="base">dput</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dput</span>(<span class="kw">names</span>(d))</code></pre>
<pre><code>c("id", "age", "sexe", "nivetud", "poids", "occup", "qualif", 
"freres.soeurs", "clso", "relig", "trav.imp", "trav.satisf", 
"hard.rock", "lecture.bd", "peche.chasse", "cuisine", "bricol", 
"cinema", "sport", "heures.tv")</code></pre>
<p>On obtient en rÃ©sultat la liste des variables sous forme de vecteur dÃ©clarÃ©. On nâ€™a plus alors quâ€™Ã  copier/coller cette chaÃ®ne, rajouter <code>names(d) &lt;-</code> devant et modifier un Ã  un les noms des variables.</p>
<p>Si on souhaite seulement modifier le nom dâ€™une variable, on peut utiliser la fonction <code data-package="questionr">rename.variable</code> de lâ€™extension <strong class="package">questionr</strong>. Celle-ci prend en argument le tableau de donnÃ©es, le nom actuel de la variable et le nouveau nom. Par exemple, si on veut renommer la variable <em>bricol</em> du tableau de donnÃ©es <code>d</code> en <em>bricolage</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">rename.variable</span>(d, <span class="st">"bricol"</span>, <span class="st">"bricolage"</span>)
<span class="kw">table</span>(d$bricolage)</code></pre>
<pre><code>
 Non  Oui 
1147  853 </code></pre>
</div>
<div id="pem_manipulation_facteurs" class="section level3">
<h3>Facteurs</h3>
<p>Parmi les diffÃ©rents types de variables, les facteurs (<em>factor</em>) sont Ã  la fois Ã  part et trÃ¨s utilisÃ©s, car ils vont correspondre Ã  la plupart des variables issues dâ€™une question fermÃ©e dans un questionnaire.</p>
<p>Les facteurs prennent leurs valeurs dans un ensemble de modalitÃ©s prÃ©dÃ©finies et ne peuvent en prendre dâ€™autres. La liste des valeurs possibles est donnÃ©e par la fonction <code data-package="base">levels</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(d$sexe)</code></pre>
<pre><code>[1] "Homme" "Femme"</code></pre>
<p>Si on veut modifier la valeur du sexe du premier individu de notre tableau de donnÃ©es avec une valeur non autorisÃ©e, on obient un message dâ€™erreur et une valeur manquante est utilisÃ©e Ã  la placeÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>] &lt;-<span class="st"> "Chihuahua"</span></code></pre>
<pre><code>Warning in `[&lt;-.factor`(`*tmp*`, 1, value =
structure(c(NA, 2L, 1L, 1L, : invalid factor
level, NA generated</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>]</code></pre>
<pre><code>[1] &lt;NA&gt;
Levels: Homme Femme</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe[<span class="dv">1</span>] &lt;-<span class="st"> "Homme"</span>
d$sexe[<span class="dv">1</span>]</code></pre>
<pre><code>[1] Homme
Levels: Homme Femme</code></pre>
<p>On peut trÃ¨s facilement crÃ©er un facteur Ã  partir dâ€™une variable de type caractÃ¨res avec la fonction <code data-package="base">factor</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>, <span class="st">"F"</span>, <span class="st">"H"</span>))
v</code></pre>
<pre><code>[1] H H F H
Levels: F H</code></pre>
<p>Par dÃ©faut, les niveaux dâ€™un facteur nouvellement crÃ©Ã©s sont lâ€™ensemble des valeurs de la variable caractÃ¨res, ordonnÃ©es par ordre alphabÃ©tique. Cette ordre des niveaux est utilisÃ© Ã  chaque fois quâ€™on utilise des fonctions comme <code data-package="base">table</code>, par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(v)</code></pre>
<pre><code>v
F H 
1 3 </code></pre>
<p>On peut modifier cet ordre au moment de la crÃ©ation du facteur en utilisant lâ€™option <code>levels</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">"H"</span>, <span class="st">"H"</span>, <span class="st">"F"</span>, <span class="st">"H"</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"H"</span>, 
  <span class="st">"F"</span>))
<span class="kw">table</span>(v)</code></pre>
<pre><code>v
H F 
3 1 </code></pre>
<p>On peut aussi modifier lâ€™ordre des niveaux dâ€™une variable dÃ©jÃ  existanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif &lt;-<span class="st"> </span><span class="kw">factor</span>(d$qualif, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"Ouvrier specialise"</span>, 
  <span class="st">"Ouvrier qualifie"</span>, <span class="st">"Employe"</span>, <span class="st">"Technicien"</span>, <span class="st">"Profession intermediaire"</span>, 
  <span class="st">"Cadre"</span>, <span class="st">"Autre"</span>))
<span class="kw">table</span>(d$qualif)</code></pre>
<pre><code>
      Ouvrier specialise         Ouvrier qualifie 
                     203                      292 
                 Employe               Technicien 
                     594                       86 
Profession intermediaire                    Cadre 
                     160                      260 
                   Autre 
                      58 </code></pre>
<div class="astuce">
<p>Lâ€™extension <strong class="package">questionr</strong> propose une <em>interface interactive</em> pour le rÃ©ordonnancement des niveaux dâ€™un facteur. Cette fonction, nommÃ©e <code data-package="questionr">iorder</code>, vous permet de rÃ©ordonner les modalitÃ©s de maniÃ¨re graphique et de gÃ©nÃ©rer le code <strong>R</strong> correspondant.</p>
<p>Dans lâ€™exemple prÃ©cÃ©dant, si vous exÃ©cutezÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">iorder</span>(d, <span class="st">"qualif"</span>)</code></pre>
<p><strong>RStudio</strong> devrait ouvrir une fenÃªtre semblable Ã  celle de la figure ci-dessous.</p>
<p><img src="images/capture_iorder.png" alt="Interface de la commande iorder"/></p>
Vous pouvez alors dÃ©placer les modalitÃ©s par glisser-dÃ©poser, vÃ©rifier le rÃ©sultat dans lâ€™onglet <em>VÃ©rification</em> et, une fois le rÃ©sultat satisfaisant, rÃ©cupÃ©rer le code gÃ©nÃ©rÃ© pour lâ€™inclure dans votre script.
</div>
<p>On peut Ã©galement modifier les niveaux eux-mÃªmes. Imaginons que lâ€™on souhaite crÃ©er une nouvelle variable <em>qualif.abr</em> contenant les noms abrÃ©gÃ©s des catÃ©gories socioprofessionnelles de <em>qualif</em>. On peut alors procÃ©der comme suitÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.abr &lt;-<span class="st"> </span><span class="kw">factor</span>(d$qualif, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"Ouvrier specialise"</span>, 
  <span class="st">"Ouvrier qualifie"</span>, <span class="st">"Employe"</span>, <span class="st">"Technicien"</span>, <span class="st">"Profession intermediaire"</span>, 
  <span class="st">"Cadre"</span>, <span class="st">"Autre"</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"OS"</span>, <span class="st">"OQ"</span>, <span class="st">"Empl"</span>, 
  <span class="st">"Tech"</span>, <span class="st">"Interm"</span>, <span class="st">"Cadre"</span>, <span class="st">"Autre"</span>))
<span class="kw">table</span>(d$qualif.abr)</code></pre>
<pre><code>
    OS     OQ   Empl   Tech Interm  Cadre  Autre 
   203    292    594     86    160    260     58 </code></pre>
<p>Dans ce qui prÃ©cÃ¨de, le paramÃ¨tre <code>levels</code> de <code data-package="base">factor</code> permet de spÃ©cifier quels sont les niveaux retenus dans le facteur rÃ©sultat, ainsi que leur ordre. Le paramÃ¨tre <code>labels</code>, lui, permet de modifier les noms de ces niveaux dans le facteur rÃ©sultat. Il est donc capital dâ€™indiquer les noms de <code>labels</code> exactement dans le mÃªme ordre que les niveaux de <code>levels</code>. Pour sâ€™assurer de ne pas avoir commis dâ€™erreur, il est recommandÃ© dâ€™effectuer un tableau croisÃ© entre lâ€™ancien et le nouveau facteurÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$qualif, d$qualif.abr)</code></pre>
<pre><code>                          
                            OS  OQ Empl Tech
  Ouvrier specialise       203   0    0    0
  Ouvrier qualifie           0 292    0    0
  Employe                    0   0  594    0
  Technicien                 0   0    0   86
  Profession intermediaire   0   0    0    0
  Cadre                      0   0    0    0
  Autre                      0   0    0    0
                          
                           Interm Cadre Autre
  Ouvrier specialise            0     0     0
  Ouvrier qualifie              0     0     0
  Employe                       0     0     0
  Technicien                    0     0     0
  Profession intermediaire    160     0     0
  Cadre                         0   260     0
  Autre                         0     0    58</code></pre>
<p>On a donc ici un premier moyen dâ€™effectuer un recodage des modalitÃ©s dâ€™une variable de type facteur. Dâ€™autres mÃ©thodes existent, voir chapitre (MAJ_LIEN).</p>
<p>Ã€ noter que par dÃ©faut, les valeurs manquantes ne sont pas considÃ©rÃ©es comme un niveau de facteur. On peut cependant les transformer en niveau en utilisant la fonction <code data-package="base" data-rdocumentation="factor">addNA</code>. Ceci signifie cependant quâ€™elle ne seront plus considÃ©rÃ©es comme manquantes par <strong>R</strong> mais comme une modalitÃ© Ã  part entiÃ¨reÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf)</code></pre>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          NA's 
           952 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">addNA</span>(d$trav.satisf))</code></pre>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          &lt;NA&gt; 
           952 </code></pre>
</div>
</div>
<div id="pem_manipulation_indexation" class="section level2">
<h2>Indexation</h2>
<p>Lâ€™indexation est lâ€™une des fonctionnalitÃ©s les plus puissantes mais aussi les plus difficiles Ã  maÃ®triser de <strong>R</strong>. Il sâ€™agit dâ€™opÃ©rations permettant de sÃ©lectionner des sous-ensembles dâ€™observations et/ou de variables en fonction de diffÃ©rents critÃ¨res. Lâ€™indexation peut porter sur des vecteurs, des matrices ou des tableaux de donnÃ©es.</p>
<p>Le principe est toujours le mÃªmeÂ : on indique, entre crochets et Ã  la suite du nom de lâ€™objet Ã  indexer, une sÃ©rie de conditions indiquant ce que lâ€™on garde ou non. Ces conditions peuvent Ãªtre de diffÃ©rents types.</p>
<div id="pem_manipulation_indexation-directe" class="section level3">
<h3>Indexation directe</h3>
<p>Le mode le plus simple dâ€™indexation consiste Ã  indiquer la position des Ã©lÃ©ments Ã  conserver. Dans le cas dâ€™un vecteur cela permet de sÃ©lectionner un ou plusieurs Ã©lÃ©ments de ce vecteur.</p>
<p>Soit le vecteur suivantÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"g"</span>)</code></pre>
<p>Si on souhaite le premier Ã©lÃ©ment du vecteur, on peut faireÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v[<span class="dv">1</span>]</code></pre>
<pre><code>[1] "a"</code></pre>
<p>Si on souhaite les trois premiers Ã©lÃ©ments ou les Ã©lÃ©ments 2, 6 et 7Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">v[<span class="dv">1</span>:<span class="dv">3</span>]</code></pre>
<pre><code>[1] "a" "b" "c"</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">v[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>)]</code></pre>
<pre><code>[1] "b" "f" "g"</code></pre>
<p>Si on veut le dernier Ã©lÃ©mentÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v[<span class="kw">length</span>(v)]</code></pre>
<pre><code>[1] "g"</code></pre>
<p>Dans le cas de matrices ou de tableaux de donnÃ©es, lâ€™indexation prend deux arguments sÃ©parÃ©s par une virguleÂ : le premier concerne les lignes et le second les colonnes. Ainsi, si on veut lâ€™Ã©lÃ©ment correspondant Ã  la troisiÃ¨me ligne et Ã  la cinquiÃ¨me colonne du tableau de donnÃ©es <code>d</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d[<span class="dv">3</span>, <span class="dv">5</span>]</code></pre>
<pre><code>[1] 3994.102</code></pre>
<p>On peut Ã©galement indiquer des vecteursÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d[<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">1</span>:<span class="dv">2</span>]</code></pre>
<pre><code>  id age
1  1  28
2  2  23
3  3  59</code></pre>
<p>Si on laisse lâ€™un des deux critÃ¨res vides, on sÃ©lectionne lâ€™intÃ©gralitÃ© des lignes ou des colonnes. Ainsi si lâ€™on veut seulement la cinquiÃ¨me colonne ou les deux premiÃ¨res lignesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d[, <span class="dv">5</span>])</code></pre>
<pre><code> num [1:2000] 2634 9738 3994 5732 4329 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d[<span class="dv">1</span>:<span class="dv">2</span>, ])</code></pre>
<pre><code>'data.frame':   2 obs. of  21 variables:
 $ id           : int  1 2
 $ age          : int  28 23
 $ sexe         : Factor w/ 2 levels "Homme","Femme": 1 2
 $ nivetud      : Factor w/ 8 levels "N'a jamais fait d'etudes",..: 8 NA
 $ poids        : num  2634 9738
 $ occup        : Factor w/ 7 levels "Exerce une profession",..: 1 3
 $ qualif       : Factor w/ 7 levels "Ouvrier specialise",..: 3 NA
 $ freres.soeurs: int  8 2
 $ clso         : Factor w/ 3 levels "Oui","Non","Ne sait pas": 1 1
 $ relig        : Factor w/ 6 levels "Pratiquant regulier",..: 4 4
 $ trav.imp     : Factor w/ 4 levels "Le plus important",..: 4 NA
 $ trav.satisf  : Factor w/ 3 levels "Satisfaction",..: 2 NA
 $ hard.rock    : Factor w/ 2 levels "Non","Oui": 1 1
 $ lecture.bd   : Factor w/ 2 levels "Non","Oui": 1 1
 $ peche.chasse : Factor w/ 2 levels "Non","Oui": 1 1
 $ cuisine      : Factor w/ 2 levels "Non","Oui": 2 1
 $ bricolage    : Factor w/ 2 levels "Non","Oui": 1 1
 $ cinema       : Factor w/ 2 levels "Non","Oui": 1 2
 $ sport        : Factor w/ 2 levels "Non","Oui": 1 2
 $ heures.tv    : num  0 1
 $ qualif.abr   : Factor w/ 7 levels "OS","OQ","Empl",..: 3 NA</code></pre>
<p>Enfin, si on prÃ©fixe les arguments avec le signe <kbd>-</kbd>, ceci signifie Â«Â tous les Ã©lÃ©ments sauf ceux indiquÃ©sÂ Â». Si par exemple on veut tous les Ã©lÃ©ments de <code>v</code> sauf le premierÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v[-<span class="dv">1</span>]</code></pre>
<pre><code>[1] "b" "c" "d" "e" "f" "g"</code></pre>
<p>Bien sÃ»r, tous ces critÃ¨res se combinent et on peut stocker le rÃ©sultat dans un nouvel objet. Dans cet exemple <code>d2</code> contiendra les trois premiÃ¨res lignes de <code>d</code> ainsi que la 50<sup>e</sup> ligne mais sans les colonnes 2 et 5 Ã  14.</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span>d[<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">50</span>), -<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>:<span class="dv">13</span>)]
<span class="kw">str</span>(d2)</code></pre>
<pre><code>'data.frame':   4 obs. of  11 variables:
 $ id          : int  1 2 3 50
 $ sexe        : Factor w/ 2 levels "Homme","Femme": 1 2 1 2
 $ nivetud     : Factor w/ 8 levels "N'a jamais fait d'etudes",..: 8 NA 3 8
 $ lecture.bd  : Factor w/ 2 levels "Non","Oui": 1 1 1 1
 $ peche.chasse: Factor w/ 2 levels "Non","Oui": 1 1 1 1
 $ cuisine     : Factor w/ 2 levels "Non","Oui": 2 1 1 1
 $ bricolage   : Factor w/ 2 levels "Non","Oui": 1 1 1 1
 $ cinema      : Factor w/ 2 levels "Non","Oui": 1 2 1 1
 $ sport       : Factor w/ 2 levels "Non","Oui": 1 2 2 1
 $ heures.tv   : num  0 1 0 0
 $ qualif.abr  : Factor w/ 7 levels "OS","OQ","Empl",..: 3 NA 4 6</code></pre>
</div>
<div id="pem_manipulation_indexation-par-nom" class="section level3">
<h3>Indexation par nom</h3>
<p>Un autre mode dâ€™indexation consiste Ã  fournir non pas un numÃ©ro mais un nom sous forme de chaÃ®ne de caractÃ¨res. On lâ€™utilise couramment pour sÃ©lectionner les variables dâ€™un tableau de donnÃ©es. Ainsi, les deux Ã©critures suivantes sont Ã©quivalentes<a href="#pem_manipulation_fn1" class="footnoteRef" id="pem_manipulation_fnref1"><sup>1</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$clso
d[, <span class="st">"clso"</span>]</code></pre>
<p>LÃ  aussi on peut utiliser un vecteur pour sÃ©lectionner plusieurs noms et rÃ©cupÃ©rer un Â«Â sous-tableauÂ Â» de donnÃ©esÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span>d[, <span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"sexe"</span>, <span class="st">"age"</span>)]</code></pre>
<p>Les noms peuvent Ã©galement Ãªtre utilisÃ©s pour les observations (lignes) dâ€™un tableau de donnÃ©es si celles-ci ont Ã©tÃ© munies dâ€™un nom avec la fonction <code data-package="base">row.names</code>. Par dÃ©faut les noms de ligne sont leur numÃ©ro dâ€™ordre, mais on peut leur assigner comme nom la valeur dâ€™une variable dâ€™identifiant. Ainsi, on peut assigner aux lignes du jeu de donnÃ©es <code>rp99</code> le nom des communes correspondantesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(rp99)
<span class="kw">row.names</span>(rp99) &lt;-<span class="st"> </span>rp99$nom</code></pre>
<p>On peut alors accÃ©der directement aux communes en donnant leur nomÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">rp99[<span class="kw">c</span>(<span class="st">"VILLEURBANNE"</span>, <span class="st">"OULLINS"</span>), ]</code></pre>
<p>Par contre il nâ€™est pas possible dâ€™utiliser directement lâ€™opÃ©rateur <code>-</code> comme pour lâ€™indexation directe. Pour exclure une colonne en fonction de son nom, on doit uiliser une autre forme dâ€™indexation, lâ€™<em>indexation par condition</em>, expliquÃ©e dans la section suivante. On peut ainsi faireâ€¦</p>
<pre class="sourceCode r"><code class="sourceCode r">d[, <span class="kw">names</span>(d) !=<span class="st"> "qualif"</span>]</code></pre>
<p>â€¦ pour sÃ©lectionner toutes les colonnes sauf celle qui sâ€™appelle <em>qualif</em>.</p>
</div>
<div id="pem_manipulation_indexation-par-condition" class="section level3">
<h3>Indexation par condition</h3>
<div id="pem_manipulation_tests-et-conditions" class="section level4">
<h4>Tests et conditions</h4>
<p>Une condition est une expression logique dont le rÃ©sultat est soit <code>TRUE</code> (vrai) soit <code>FALSE</code> (faux).</p>
<p>Une condition comprend la plupart du temps un opÃ©rateur de comparaison. Les plus courants sont les suivantsÂ :</p>
<table>
<thead>
<tr class="header">
<th align="center">OpÃ©rateur</th>
<th align="left">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>==</code></td>
<td align="left">Ã©gal Ã </td>
</tr>
<tr class="even">
<td align="center"><code>!=</code></td>
<td align="left">diffÃ©rent de</td>
</tr>
<tr class="odd">
<td align="center"><code>&gt;</code></td>
<td align="left">strictement supÃ©rieur Ã </td>
</tr>
<tr class="even">
<td align="center"><code>&lt;</code></td>
<td align="left">strictement infÃ©rieur Ã </td>
</tr>
<tr class="odd">
<td align="center"><code>&gt;=</code></td>
<td align="left">supÃ©rieur ou Ã©gal Ã </td>
</tr>
<tr class="even">
<td align="center"><code>&lt;=</code></td>
<td align="left">infÃ©rieur ou Ã©gal Ã </td>
</tr>
</tbody>
</table>
<p>Voyons tout de suite un exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d$sexe ==<span class="st"> "Homme"</span>)</code></pre>
<pre><code> logi [1:2000] TRUE FALSE TRUE TRUE FALSE FALSE ...</code></pre>
<p>Que sâ€™est-il passÃ©Â ? Nous avons fourni Ã  <strong>R</strong> une condition qui signifie Â«Â la valeur de la variable <em>sexe</em> vaut â€œHommeâ€Â Â». Et il nous a renvoyÃ© un vecteur avec autant dâ€™Ã©lÃ©ments quâ€™il yâ€™a dâ€™observations dans <code>d</code>, et dont la valeur est <code>TRUE</code> si lâ€™observation correspond Ã  un homme et <code>FALSE</code> dans les autres cas.</p>
<p>Prenons un autre exemple. On nâ€™affichera cette fois que les premiers Ã©lÃ©ments de notre variable dâ€™intÃ©rÃªt Ã  lâ€™aide de la fonction <code data-package="utils">head</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d$age)</code></pre>
<pre><code>[1] 28 23 59 34 71 35</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d$age &gt;<span class="st"> </span><span class="dv">40</span>)</code></pre>
<pre><code>[1] FALSE FALSE  TRUE FALSE  TRUE FALSE</code></pre>
<p>On voit bien ici quâ€™Ã  chaque Ã©lÃ©ment du vecteur <code>d$age</code> dont la valeur est supÃ©rieure Ã  40 correspond un Ã©lÃ©ment <code>TRUE</code> dans le rÃ©sultat de la condition.</p>
<p>On peut combiner ou modifier des conditions Ã  lâ€™aide des opÃ©rateurs logiques habituelsÂ :</p>
<table>
<thead>
<tr class="header">
<th align="center">OpÃ©rateur</th>
<th align="left">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>&amp;</code></td>
<td align="left">et logique</td>
</tr>
<tr class="even">
<td align="center"><code>|</code></td>
<td align="left">ou logique</td>
</tr>
<tr class="odd">
<td align="center"><code>!</code></td>
<td align="left">nÃ©gation logique</td>
</tr>
</tbody>
</table>
<p>Comment les utilise-t-onÂ ? Voyons tout de suite des exemples. Supposons que je veuille dÃ©terminer quels sont dans mon Ã©chantillon les hommes ouvriers spÃ©cialisÃ©sÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe ==<span class="st"> "Homme"</span> &amp;<span class="st"> </span>d$qualif ==<span class="st"> "Ouvrier specialise"</span></code></pre>
<p>Si je souhaite identifier les personnes qui bricolent ou qui font la cuisineÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$bricol ==<span class="st"> "Oui"</span> |<span class="st"> </span>d$cuisine ==<span class="st"> "Oui"</span></code></pre>
<p>Si je souhaite isoler les femmes qui ont entre 20 et 34 ansÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>d$age &gt;=<span class="st"> </span><span class="dv">20</span> &amp;<span class="st"> </span>d$age &lt;=<span class="st"> </span><span class="dv">34</span></code></pre>
<p>Si je souhaite rÃ©cupÃ©rer les enquÃªtÃ©s qui ne sont pas cadres, on peut utiliser lâ€™une des deux formes suivantes :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif !=<span class="st"> "Cadre"</span>
!(d$qualif ==<span class="st"> "Cadre"</span>)</code></pre>
<p>Lorsquâ€™on mÃ©lange Â«Â etÂ Â» et Â«Â ouÂ Â» il est nÃ©cessaire dâ€™utiliser des parenthÃ¨ses pour diffÃ©rencier les blocs. La condition suivante identifie les femmes qui sont soit cadre, soit employÃ©eÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>(d$qualif ==<span class="st"> "Employe"</span> |<span class="st"> </span>d$qualif ==<span class="st"> </span>
<span class="st">  "Cadre"</span>)</code></pre>
<p>Lâ€™opÃ©rateur <code data-package="base" data-rdocumentation="match">%in%</code> peut Ãªtre trÃ¨s utileÂ : il teste si une valeur fait partie des Ã©lÃ©ments dâ€™un vecteur. Ainsi on pourrait remplacer la condition prÃ©cÃ©dente parÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>d$qualif %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Employe"</span>, <span class="st">"Cadre"</span>)</code></pre>
<p>Enfin, signalons quâ€™on peut utiliser les fonctions <code data-package="base">table</code> ou <code data-package="base">summary</code> pour avoir une idÃ©e du rÃ©sultat de notre conditionÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sexe)</code></pre>
<pre><code>
Homme Femme 
  900  1100 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sexe ==<span class="st"> "Homme"</span>)</code></pre>
<pre><code>
FALSE  TRUE 
 1100   900 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$sexe ==<span class="st"> "Homme"</span>)</code></pre>
<pre><code>   Mode   FALSE    TRUE    NA's 
logical    1100     900       0 </code></pre>
</div>
<div id="pem_manipulation_utilisation-pour-lindexation" class="section level4">
<h4>Utilisation pour lâ€™indexation</h4>
<p>Lâ€™utilisation des conditions pour lâ€™indexation est assez simpleÂ : si on indexe un vecteur avec un vecteur boolÃ©en, seuls les Ã©lÃ©ments correspondant Ã  TRUE seront conservÃ©s.</p>
<p>Ainsi, si on faitÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">dh &lt;-<span class="st"> </span>d[d$sexe ==<span class="st"> "Homme"</span>, ]</code></pre>
<p>On obtiendra un nouveau tableau de donnÃ©es comportant lâ€™ensemble des variables de <code>d</code>, mais seulement les observations pour lesquelles la variable <em>sexe</em> vaut Â«Â HommeÂ Â».</p>
<p>La plupart du temps ce type dâ€™indexation sâ€™applique aux lignes, mais on peut aussi lâ€™utiliser sur les colonnes dâ€™un tableau de donnÃ©es. Lâ€™exemple suivant, un peu compliquÃ©, sÃ©lectionne uniquement les variables dont le nom commence par <em>a</em> ou <em>s</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span>d[, <span class="kw">substr</span>(<span class="kw">names</span>(d), <span class="dv">0</span>, <span class="dv">1</span>) %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"a"</span>, <span class="st">"s"</span>)]</code></pre>
<p>On peut Ã©videmment combiner les diffÃ©rents type dâ€™indexation. Lâ€™exemple suivant sÃ©lectionne les femmes de plus de 40 ans et ne conserve que les variables <em>qualif</em> et <em>relig</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span>d[d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>d$age &gt;<span class="st"> </span><span class="dv">40</span>, <span class="kw">c</span>(<span class="st">"qualif"</span>, 
  <span class="st">"relig"</span>)]</code></pre>
</div>
<div id="pem_manipulation_valeurs-manquantes-dans-les-conditions" class="section level4">
<h4>Valeurs manquantes dans les conditions</h4>
<p>Une remarque importanteÂ : quand lâ€™un des termes dâ€™une condition comporte une valeur manquante (<code>NA</code>), le rÃ©sultat de cette condition nâ€™est pas toujours <code>TRUE</code> ou <code>FALSE</code>, il peut aussi Ãªtre Ã  son tour une valeur manquante.</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">5</span>, <span class="ot">NA</span>)
v</code></pre>
<pre><code>[1]  1  2  3  4  5 NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">v &gt;<span class="st"> </span><span class="dv">3</span></code></pre>
<pre><code>[1] FALSE FALSE FALSE  TRUE  TRUE    NA</code></pre>
<p>On voit que le test <code>NA &gt; 3</code> ne renvoie ni vrai ni faux, mais <code>NA</code>.</p>
<p>Le rÃ©sultat dâ€™une condition peut donc comporter un grand nombre de valeurs manquantesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf ==<span class="st"> "Satisfaction"</span>)</code></pre>
<pre><code>   Mode   FALSE    TRUE    NA's 
logical     568     480     952 </code></pre>
<p>Une autre consÃ©quence importante de ce comportement est quâ€™on ne peut pas utiliser lâ€™opÃ©rateur lâ€™expression <code>== NA</code> pour tester la prÃ©sence de valeurs manquantes. On utilisera Ã  la place la fonction <em>ad hoc</em> <code data-package="base" data-rdocumentation="NA">is.na</code>.</p>
<p>On comprendra mieux le problÃ¨me avec lâ€™exemple suivantÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>)
v</code></pre>
<pre><code>[1]  1 NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">v ==<span class="st"> </span><span class="ot">NA</span></code></pre>
<pre><code>[1] NA NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.na</span>(v)</code></pre>
<pre><code>[1] FALSE  TRUE</code></pre>
<p>Pour compliquer encore un peu le tout, lorsquâ€™on utilise une condition pour lâ€™indexation, si la condition renvoie <code>NA</code>, <strong>R</strong> ne sÃ©lectionne pas lâ€™Ã©lÃ©ment mais retourne quand mÃªme la valeur <code>NA</code>. Ceci aura donc des consÃ©quences pour lâ€™extraction de sous-populations (voir section ci-aprÃ¨s MAJ LIEN)<a href="#pem_manipulation_fn2" class="footnoteRef" id="pem_manipulation_fnref2"><sup>2</sup></a>.</p>
</div>
</div>
<div id="pem_manipulation_indexation-et-assignation" class="section level3">
<h3>Indexation et assignation</h3>
<p>Dans tous les exemples prÃ©cÃ©dents, on a utilisÃ© lâ€™indexation pour extraire une partie dâ€™un vecteur ou dâ€™un tableau de donnÃ©es, en plaÃ§ant lâ€™opÃ©ration dâ€™indexation Ã  droite de lâ€™opÃ©rateur <code>&lt;-</code>.</p>
<p>Mais lâ€™indexation peut Ã©galement Ãªtre placÃ©e Ã  gauche de cet opÃ©rateur. Dans ce cas, les Ã©lÃ©ments sÃ©lectionnÃ©s par lâ€™indexation sont alors remplacÃ©s par les valeurs indiquÃ©es Ã  droite de lâ€™opÃ©rateur <code>&lt;-</code>.</p>
<p>Prenons donc un exemple simpleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span>
v</code></pre>
<pre><code>[1] 1 2 3 4 5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">v[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">3</span>
v</code></pre>
<pre><code>[1] 3 2 3 4 5</code></pre>
<p>Cette fois, au lieu dâ€™utiliser quelque chose comme <code>x &lt;- v[1]</code>, qui aurait placÃ© la valeur du premier Ã©lÃ©ment de <code>v</code> dans <code>x</code>, on a utilisÃ© <code>v[1] &lt;- 3</code>, ce qui a mis Ã  jour le premier Ã©lÃ©ment de <code>v</code> avec la valeur 3. Ceci fonctionne Ã©galement pour les tableaux de donnÃ©es et pour les diffÃ©rents types dâ€™indexation Ã©voquÃ©s prÃ©cÃ©demmentÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d[<span class="dv">257</span>, <span class="st">"sexe"</span>] &lt;-<span class="st"> "Homme"</span></code></pre>
<p>Enfin on peut modifier plusieurs Ã©lÃ©ments dâ€™un seul coup soit en fournissant un vecteur, soit en profitant du mÃ©canisme de recyclage. Les deux commandes suivantes sont ainsi rigoureusement Ã©quivalentesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d[<span class="kw">c</span>(<span class="dv">257</span>, <span class="dv">438</span>, <span class="dv">889</span>), <span class="st">"sexe"</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Homme"</span>, <span class="st">"Homme"</span>, 
  <span class="st">"Homme"</span>)
d[<span class="kw">c</span>(<span class="dv">257</span>, <span class="dv">438</span>, <span class="dv">889</span>), <span class="st">"sexe"</span>] &lt;-<span class="st"> "Homme"</span></code></pre>
<p>On commence Ã  voir comment lâ€™utilisation de lâ€™indexation par conditions et de lâ€™assignation va nous permettre de faire des recodages.</p>
<pre class="sourceCode r"><code class="sourceCode r">d$gr.age[d$age &gt;=<span class="st"> </span><span class="dv">20</span> &amp;<span class="st"> </span>d$age &lt;=<span class="st"> </span><span class="dv">30</span>] &lt;-<span class="st"> "20-30 ans"</span>
d$gr.age[<span class="kw">is.na</span>(d$age)] &lt;-<span class="st"> "Inconnu"</span></code></pre>
</div>
</div>
<div id="pem_manipulation_sous-populations" class="section level2">
<h2>Sous-populations</h2>
<div id="pem_manipulation_par-indexation" class="section level3">
<h3>Par indexation</h3>
<p>La premiÃ¨re maniÃ¨re de construire des sous-populations est dâ€™utiliser lâ€™indexation par conditions. On peut ainsi facilement sÃ©lectionner une partie des observations suivant un ou plusieurs critÃ¨res et placer le rÃ©sultat dans un nouveau tableau de donnÃ©es.</p>
<p>Par exemple si on souhaite isoler les hommes et les femmesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">dh &lt;-<span class="st"> </span>d[d$sexe ==<span class="st"> "Homme"</span>, ]
df &lt;-<span class="st"> </span>d[d$sexe ==<span class="st"> "Femme"</span>, ]
<span class="kw">table</span>(d$sexe)</code></pre>
<pre><code>
Homme Femme 
  901  1099 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(dh)</code></pre>
<pre><code>[1] 901  22</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(df)</code></pre>
<pre><code>[1] 1099   22</code></pre>
<p>On a Ã  partir de lÃ  trois tableaux de donnÃ©es, <code>d</code> comportant la population totale, <code>dh</code> seulement les hommes et <code>df</code> seulement les femmes.</p>
<p>On peut Ã©videmment combiner plusieurs critÃ¨resÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">dh<span class="fl">.25</span> &lt;-<span class="st"> </span>d[d$sexe ==<span class="st"> "Homme"</span> &amp;<span class="st"> </span>d$age &lt;=<span class="st"> </span><span class="dv">25</span>, ]
<span class="kw">dim</span>(dh<span class="fl">.25</span>)</code></pre>
<pre><code>[1] 87 22</code></pre>
<p>Si on utilise directement lâ€™indexation, il convient cependant dâ€™Ãªtre extrÃªmement prudent avec les valeurs manquantes. Comme indiquÃ© prÃ©cÃ©demment, la prÃ©sence dâ€™une valeur manquante dans une condition fait que celle-ci est Ã©valuÃ©e en <code>NA</code> et quâ€™au final la ligne correspondante est conservÃ©e par lâ€™indexationÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf)</code></pre>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          NA's 
           952 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d.satisf &lt;-<span class="st"> </span>d[d$trav.satisf ==<span class="st"> "Satisfaction"</span>, ]
<span class="kw">dim</span>(d.satisf)</code></pre>
<pre><code>[1] 1432   22</code></pre>
<p>Comme on le voit, ici <code>d.satisf</code> contient les individus ayant la modalitÃ© <em>Satisfaction</em> mais aussi ceux ayant une valeur manquante <code>NA</code>. Câ€™est pourquoi il faut toujours soit vÃ©rifier au prÃ©alable quâ€™on nâ€™a pas de valeurs manquantes dans les variables de la condition, soit exclure explicitement les <code>NA</code> de la maniÃ¨re suivanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d.satisf &lt;-<span class="st"> </span>d[d$trav.satisf ==<span class="st"> "Satisfaction"</span> &amp;<span class="st"> </span>!<span class="kw">is.na</span>(d$trav.satisf), 
  ]
<span class="kw">dim</span>(d.satisf)</code></pre>
<pre><code>[1] 480  22</code></pre>
<p>Câ€™est notamment pour cette raison quâ€™on prÃ©fÃ¨rera le plus souvent utiliser la fonction <code data-package="base">subset</code>.</p>
</div>
<div id="pem_manipulation_subset" class="section level3">
<h3>Fonction subset</h3>
<p>La fonction <code data-package="base">subset</code> permet dâ€™extraire des sous-populations de maniÃ¨re plus simple et un peu plus intuitive que lâ€™indexation directe.</p>
<p>Celle-ci prend trois arguments principauxÂ : * le nom de lâ€™objet de dÃ©partÂ ; * une condition sur les observations (<code>subset</code>)Â ; * Ã©ventuellement une condition sur les colonnes (<code>select</code>).</p>
<p>Reprenons tout de suite un exemple dÃ©jÃ  vuÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">dh &lt;-<span class="st"> </span><span class="kw">subset</span>(d, sexe ==<span class="st"> "Homme"</span>)
df &lt;-<span class="st"> </span><span class="kw">subset</span>(d, sexe ==<span class="st"> "Femme"</span>)</code></pre>
<p>Lâ€™utilisation de <code data-package="base">subset</code> prÃ©sente plusieurs avantages. Le premier est dâ€™Ã©conomiser quelques touches. On nâ€™est en effet pas obligÃ© de saisir le nom du tableau de donnÃ©es dans la condition sur les lignes. Ainsi les deux commandes suivantes sont Ã©quivalentesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">dh &lt;-<span class="st"> </span><span class="kw">subset</span>(d, d$sexe ==<span class="st"> "Homme"</span>)
dh &lt;-<span class="st"> </span><span class="kw">subset</span>(d, sexe ==<span class="st"> "Homme"</span>)</code></pre>
<p>Le second avantage est que <code data-package="base">subset</code> sâ€™occupe du problÃ¨me des valeurs manquantes Ã©voquÃ©es prÃ©cÃ©demment et les exclut de lui-mÃªme, contrairement au comportement par dÃ©fautÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(d$trav.satisf)</code></pre>
<pre><code>  Satisfaction Insatisfaction      Equilibre 
           480            117            451 
          NA's 
           952 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d.satisf &lt;-<span class="st"> </span>d[d$trav.satisf ==<span class="st"> "Satisfaction"</span>, ]
<span class="kw">dim</span>(d.satisf)</code></pre>
<pre><code>[1] 1432   22</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d.satisf &lt;-<span class="st"> </span><span class="kw">subset</span>(d, trav.satisf ==<span class="st"> "Satisfaction"</span>)
<span class="kw">dim</span>(d.satisf)</code></pre>
<pre><code>[1] 480  22</code></pre>
<p>Enfin, lâ€™utilisation de lâ€™argument <code>select</code> est simplifiÃ© pour lâ€™expression de condition sur les colonnes. On peut ainsi spÃ©cifier les noms de variable sans guillemets et leur appliquer directement lâ€™opÃ©rateur dâ€™exclusion <code>-</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, <span class="dt">select =</span> <span class="kw">c</span>(sexe, sport))
d2 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, age &gt;<span class="st"> </span><span class="dv">25</span>, <span class="dt">select =</span> -<span class="kw">c</span>(id, age, cinema))</code></pre>
</div>
<div id="pem_manipulation_tapply" class="section level3">
<h3>Fonction tapply</h3>
<div class="note">
Cette section documente une fonction qui peut Ãªtre trÃ¨s utile, mais pas forcÃ©ment indispensable au dÃ©part.
</div>
<p>La fonction <code data-package="base">tapply</code> nâ€™est quâ€™indirectement liÃ©e Ã  la notion de sous-population, mais peut permettre dâ€™Ã©viter dâ€™avoir Ã  crÃ©er ces sous-populations dans certains cas.</p>
<p>Son fonctionnement est assez simple, mais pas forcÃ©ment intuitif. La fonction prend trois argumentsÂ : un vecteur, un facteur et une fonction. Elle applique ensuite la fonction aux Ã©lÃ©ments du vecteur correspondant Ã  un mÃªme niveau du facteur. Vite, un exempleÂ !</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$age, d$sexe, mean)</code></pre>
<pre><code>   Homme    Femme 
48.10655 48.19836 </code></pre>
<p>Quâ€™est-ce que Ã§a signifieÂ ? Ici <code data-package="base">tapply</code> a sÃ©lectionnÃ© toutes les observations correspondant Ã  Â«Â HommeÂ Â», puis appliquÃ© la fonction <code data-package="base">mean</code> aux valeurs de <em>age</em> correspondantes. Puis elle a fait de mÃªme pour les observations correspondant Ã  Â«Â FemmeÂ Â». On a donc ici la moyenne dâ€™Ã¢ge chez les hommes et chez les femmes.</p>
<p>On peut fournir Ã  peu prÃ¨s nâ€™importe quelle fonction Ã  <code data-package="base">tapply</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$bricol, d$sexe, freq)</code></pre>
<pre><code>$Homme
      n    % val%
Non 386 42.8 42.8
Oui 515 57.2 57.2
NA    0  0.0   NA

$Femme
      n    % val%
Non 761 69.2 69.2
Oui 338 30.8 30.8
NA    0  0.0   NA</code></pre>
<p>Les arguments supplÃ©mentaires fournis Ã  <code data-package="base">tapply</code> sont en fait fournis directement Ã  la fonction appelÃ©e.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$bricol, d$sexe, freq, <span class="dt">total =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>$Homme
        n     %  val%
Non   386  42.8  42.8
Oui   515  57.2  57.2
NA      0   0.0    NA
Total 901 100.0 100.0

$Femme
         n     %  val%
Non    761  69.2  69.2
Oui    338  30.8  30.8
NA       0   0.0    NA
Total 1099 100.0 100.0</code></pre>
<div class="note">
<p>La fonction <code data-package="base">by</code> est un Ã©quivalent (pour les tableaux de donnÃ©es) de <code data-package="base">tapply</code>. La prÃ©sentation des rÃ©sultats diffÃ¨re lÃ©gÃ¨rement.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$age, d$sexe, mean)</code></pre>
<pre><code>   Homme    Femme 
48.10655 48.19836 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">by</span>(d$age, d$sexe, mean)</code></pre>
<pre><code>d$sexe: Homme
[1] 48.10655
------------------------------------- 
d$sexe: Femme
[1] 48.19836</code></pre>
</div>
</div>
</div>
<div id="pem_manipulation_recodages" class="section level2">
<h2>Recodages</h2>
<p>Le recodage de variables est une opÃ©ration extrÃªmement frÃ©quente lors du traitement dâ€™enquÃªte. Celuici utilise soit lâ€™une des formes dâ€™indexation dÃ©crites prÃ©cÃ©demment, soit des fonctions <em>ad hoc</em> de <strong>R</strong>.</p>
<p>On passe ici en revue diffÃ©rents types de recodage parmi les plus courants. Les exemples sâ€™appuient, comme prÃ©cÃ©demment, sur lâ€™extrait de lâ€™enquÃªte <em>Histoire de vie</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003</code></pre>
<div id="pem_manipulation_convertir-une-variable" class="section level3">
<h3>Convertir une variable</h3>
<p>Il peut arriver quâ€™on veuille transformer une variable dâ€™un type dans un autre.</p>
<p>Par exemple, on peut considÃ©rer que la variable numÃ©rique <em>freres.soeurs</em> est une Â«Â fausseÂ Â» variable numÃ©rique et quâ€™une reprÃ©sentation sous forme de facteur serait plus adÃ©quate. Dans ce cas il suffit de faire appel Ã  la fonction <code data-package="base">factor</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$fs.fac &lt;-<span class="st"> </span><span class="kw">factor</span>(d$freres.soeurs)
<span class="kw">levels</span>(d$fs.fac)</code></pre>
<pre><code> [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8" 
[10] "9"  "10" "11" "12" "13" "14" "15" "16" "18"
[19] "22"</code></pre>
<p>La conversion dâ€™une variable caractÃ¨res en facteur se fait de la mÃªme maniÃ¨re.</p>
<p>La conversion dâ€™un facteur ou dâ€™une variable numÃ©rique en variable caractÃ¨res peut se faire Ã  lâ€™aide de la fonction <code data-package="base" data-rdocumentation="character">as.character</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$fs.char &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$freres.soeurs)
d$qualif.char &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)</code></pre>
<p>La conversion dâ€™un facteur en caractÃ¨res est frÃ©quemment utilisÃ© lors des recodages du fait quâ€™il est impossible dâ€™ajouter de nouvelles modalitÃ©s Ã  un facteur de cette maniÃ¨re. Par exemple, la premiÃ¨re des commandes suivantes gÃ©nÃ¨re un message dâ€™avertissement, tandis que les deux autres fonctionnentÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d.temp &lt;-<span class="st"> </span>d
d.temp$qualif[d.temp$qualif ==<span class="st"> "Ouvrier specialise"</span>] &lt;-<span class="st"> "Ouvrier"</span></code></pre>
<pre><code>Warning in `[&lt;-.factor`(`*tmp*`, d.temp$qualif ==
"Ouvrier specialise", : invalid factor level, NA
generated</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.char &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)
d$qualif.char[d$qualif.char ==<span class="st"> "Ouvrier specialise"</span>] &lt;-<span class="st"> "Ouvrier"</span></code></pre>
<p>Dans le premier cas, le message dâ€™avertissement indique que toutes les modalitÃ©s Â«Â Ouvrier specialiseÂ Â» de notre variable <em>qualif</em> ont Ã©tÃ© remplacÃ©es par des valeurs manquantes <code>NA</code>.</p>
<p>Enfin, une variable de type caractÃ¨res dont les valeurs seraient des nombres peut Ãªtre convertie en variable numÃ©rique avec la fonction <code data-package="base" data-rdocumentation="numeric">as.numeric</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"3.1415"</span>, <span class="st">"4"</span>, <span class="st">"5.6"</span>, <span class="st">"1"</span>, <span class="st">"4"</span>)
v</code></pre>
<pre><code>[1] "1"      "3.1415" "4"      "5.6"    "1"     
[6] "4"     </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(v)</code></pre>
<pre><code>[1] 1.0000 3.1415 4.0000 5.6000 1.0000 4.0000</code></pre>
<div class="attention">
<p>Lorsque lâ€™on convertit un facteur avec <code data-package="base" data-rdocumentation="numeric">as.numeric</code>, on obtient le numÃ©ro de chaque facteur (premiÃ¨re modalitÃ©, seconde modalitÃ©, etc.). Si la valeur numÃ©rique qui nous intÃ©resse est en fait contenu dans le nom des modalitÃ©s, il faut connvertir au prÃ©alable notre facteur en variable textuelle.</p>
<pre class="sourceCode r"><code class="sourceCode r">vf &lt;-<span class="st"> </span><span class="kw">factor</span>(v)
vf</code></pre>
<pre><code>[1] 1      3.1415 4      5.6    1      4     
Levels: 1 3.1415 4 5.6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(vf)</code></pre>
<pre><code>[1] 1 2 3 4 1 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(vf))</code></pre>
<pre><code>[1] 1.0000 3.1415 4.0000 5.6000 1.0000 4.0000</code></pre>
</div>
</div>
<div id="pem_manipulation_decouper-une-variable-numerique-en-classes" class="section level3">
<h3>DÃ©couper une variable numÃ©rique en classes</h3>
<p>Le premier type de recodage consiste Ã  dÃ©couper une variable de type numÃ©rique en un certain nombre de classes. On utilise pour cela la fonction <code data-package="base">cut</code>.</p>
<p>Celle-ci prend, outre la variable Ã  dÃ©couper, un certain nombre dâ€™argumentsÂ :</p>
<ul>
<li><code>breaks</code> indique soit le nombre de classes souhaitÃ©, soit, si on lui fournit un vecteur, les limites des classesÂ ;</li>
<li><code>labels</code> permet de modifier les noms de modalitÃ©s attribuÃ©s aux classesÂ ;</li>
<li><code>include.lowest</code> et <code>right</code> influent sur la maniÃ¨re dont les valeurs situÃ©es Ã  la frontiÃ¨re des classes seront inclues ou excluesÂ ;</li>
<li><code>dig.lab</code> indique le nombre de chiffres aprÃ¨s la virgule Ã  conserver dans les noms de modalitÃ©s.</li>
</ul>
<p>Prenons tout de suite un exemple et tentons de dÃ©couper notre variable <em>age</em> en cinq classes et de placer le rÃ©sultat dans une nouvelle variable nommÃ©e <em>age5cl</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age5cl &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="dv">5</span>)
<span class="kw">table</span>(d$age5cl)</code></pre>
<pre><code>
(17.9,33.8] (33.8,49.6] (49.6,65.4] (65.4,81.2] 
        454         628         556         319 
(81.2,97.1] 
         43 </code></pre>
<p>Par dÃ©faut <strong>R</strong> nous a bien crÃ©Ã© cinq classes dâ€™amplitudes Ã©gales. La premiÃ¨re classe va de 16,9 Ã  32,2 ans (en fait de 17 Ã  32), etc.</p>
<p>Les frontiÃ¨res de classe seraient plus prÃ©sentables si elles utilisaient des nombres ronds. On va donc spÃ©cifier manuellement le dÃ©coupage souhaitÃ©, par tranches de 20 ansÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>))
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
  (0,20]  (20,40]  (40,60]  (60,80] (80,100] 
      72      660      780      436       52 </code></pre>
<p>On aurait pu tenir compte des Ã¢ges extrÃªmes pour la premiÃ¨re et la derniÃ¨re valeurÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(d$age)</code></pre>
<pre><code>[1] 18 97</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">93</span>))
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
(17,20] (20,40] (40,60] (60,80] (80,93] 
     72     660     780     436      50 </code></pre>
<p>Les symboles dans les noms attribuÃ©s aux classes ont leur importanceÂ : <code>(</code> signifie que la frontiÃ¨re de la classe est exclue, tandis que <code>[</code> signifie quâ€™elle est incluse. Ainsi, <code>(20,40]</code> signifie Â«Â strictement supÃ©rieur Ã  20 et infÃ©rieur ou Ã©gal Ã  40Â Â».</p>
<p>On remarque que du coup, dans notre exemple prÃ©cÃ©dent, la valeur minimale, 17, est exclue de notre premiÃ¨re classe, et quâ€™une observation est donc absente de ce dÃ©coupage. Pour rÃ©soudre ce problÃ¨me on peut soit faire commencer la premiÃ¨re classe Ã  16, soit utiliser lâ€™option <code>include.lowest=TRUE</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">93</span>))
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
(16,20] (20,40] (40,60] (60,80] (80,93] 
     72     660     780     436      50 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">93</span>), <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
[17,20] (20,40] (40,60] (60,80] (80,93] 
     72     660     780     436      50 </code></pre>
<p>On peut Ã©galement modifier le sens des intervalles avec lâ€™option <code>right=FALSE</code>, et indiquer manuellement les noms des modalitÃ©s avec <code>labels</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">93</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, 
  <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
[16,20) [20,40) [40,60) [60,80) [80,93] 
     48     643     793     454      60 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$age20 &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">93</span>), <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>, 
  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"&lt;20ans"</span>, <span class="st">"21-40 ans"</span>, <span class="st">"41-60ans"</span>, <span class="st">"61-80ans"</span>, 
    <span class="st">"&gt;80ans"</span>))
<span class="kw">table</span>(d$age20)</code></pre>
<pre><code>
   &lt;20ans 21-40 ans  41-60ans  61-80ans    &gt;80ans 
       72       660       780       436        50 </code></pre>
<div class="astuce">
<p>Lâ€™extension <strong class="package">questionr</strong> propose une interface interactive Ã  la fonction <code data-package="base">cut</code>, nommÃ©e <code data-package="questionr">icut</code>. Elle sâ€™utilise de la maniÃ¨re suivanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">icut</span>(d, age)</code></pre>
<p><strong>RStudio</strong> devrait ouvrir une fenÃªtre semblable Ã  lâ€™image ci-dessous.</p>
<p><img src="images/capture_icut.png" alt="Capture dâ€™Ã©cran dâ€™icut"/></p>
<p>Vous pouvez alors indiquer les limites de vos classes ainsi que quelques options complÃ©mentaires. Ces limites sont reprÃ©sentÃ©es graphiquement sur lâ€™histogramme de la variable dâ€™origine.</p>
<p>Lâ€™onglet <em>VÃ©rification</em> affiche un tri Ã  plat et un graphique en barres de la nouvelle variable. Une fois le rÃ©sultat satisfaisant, vous pouvez rÃ©cupÃ©rer le code gÃ©nÃ©rÃ© pour lâ€™inclure dans votre script.</p>
<p>Lâ€™extension <strong class="package">questionr</strong> propose aussi une fonction <code data-package="questionr">quant.cut</code> permettant de dÃ©couper une variable numÃ©rique en un nombre de classes donnÃ© ayant des efffectifs semblables. Il suffit de lui passer le nombre de classes en argumentÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age6cl &lt;-<span class="st"> </span><span class="kw">quant.cut</span>(d$age, <span class="dv">6</span>)
<span class="kw">table</span>(d$age6cl)</code></pre>
<pre><code>
    [18,30)     [30,39)     [39,48) [48,55.667) 
        302         337         350         344 
[55.667,66)     [66,97] 
        305         362 </code></pre>
<code data-package="questionr">quant.cut</code> admet les mÃªmes autres options que <code data-package="base">cut</code> (<code>include.lowest</code>, <code>right</code>, <code>labels</code>. . . ).
</div>
</div>
<div id="pem_manipulation_regrouper-les-modalites-dune-variable" class="section level3">
<h3>Regrouper les modalitÃ©s dâ€™une variable</h3>
<p>Pour regrouper les modalitÃ©s dâ€™une variable qualitative (dâ€™un facteur le plus souvent), on peut utiliser directement lâ€™indexation.</p>
<p>Ainsi, si on veut recoder la variable qualif dans une variable qualif.reg plus Â« compacte Â», on peut utiliserÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$qualif)</code></pre>
<pre><code>
      Ouvrier specialise         Ouvrier qualifie 
                     203                      292 
              Technicien Profession intermediaire 
                      86                      160 
                   Cadre                  Employe 
                     260                      594 
                   Autre 
                      58 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.reg[d$qualif ==<span class="st"> "Ouvrier specialise"</span>] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Ouvrier qualifie"</span>] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Employe"</span>] &lt;-<span class="st"> "Employe"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Profession intermediaire"</span>] &lt;-<span class="st"> "Intermediaire"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Technicien"</span>] &lt;-<span class="st"> "Intermediaire"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Cadre"</span>] &lt;-<span class="st"> "Cadre"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Autre"</span>] &lt;-<span class="st"> "Autre"</span>
<span class="kw">table</span>(d$qualif.reg)</code></pre>
<pre><code>
        Autre         Cadre       Employe 
           58           260           594 
Intermediaire       Ouvrier 
          246           495 </code></pre>
<p>On aurait pu reprÃ©senter ce recodage de maniÃ¨re plus compacte, notamment en commenÃ§ant par copier le contenu de <em>qualif</em> dans <em>qualif.reg</em>, ce qui permet de ne pas sâ€™occuper de ce qui ne change pas.</p>
<p>Il est cependant nÃ©cessaire de ne pas copier <em>qualif</em> sous forme de facteur, sinon on ne pourrait ajouter de nouvelles modalitÃ©s. On copie donc la version caractÃ¨res de qualif grÃ¢ce Ã  la fonction <code data-package="base" data-rdocumentation="character">as.character</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.reg &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)
d$qualif.reg[d$qualif ==<span class="st"> "Ouvrier specialise"</span>] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Ouvrier qualifie"</span>] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Profession intermediaire"</span>] &lt;-<span class="st"> "Intermediaire"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Technicien"</span>] &lt;-<span class="st"> "Intermediaire"</span>
<span class="kw">table</span>(d$qualif.reg)</code></pre>
<pre><code>
        Autre         Cadre       Employe 
           58           260           594 
Intermediaire       Ouvrier 
          246           495 </code></pre>
<p>On peut faire une version encore plus compacte en utilisant lâ€™opÃ©rateur logique <em>ou</em> (<code>|</code>)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.reg &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)
d$qualif.reg[d$qualif ==<span class="st"> "Ouvrier specialise"</span> |<span class="st"> </span>d$qualif ==<span class="st"> </span>
<span class="st">  "Ouvrier qualifie"</span>] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif ==<span class="st"> "Profession intermediaire"</span> |<span class="st"> </span>
<span class="st">  </span>d$qualif ==<span class="st"> "Technicien"</span>] &lt;-<span class="st"> "Intermediaire"</span>
<span class="kw">table</span>(d$qualif.reg)</code></pre>
<pre><code>
        Autre         Cadre       Employe 
           58           260           594 
Intermediaire       Ouvrier 
          246           495 </code></pre>
<p>Enfin, pour terminer ce petit tour dâ€™horizon, on peut Ã©galement remplacer lâ€™opÃ©rateur <code>|</code> par <code>%in%</code>, qui peut parfois Ãªtre plus lisibleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.reg &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)
d$qualif.reg[d$qualif %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Ouvrier specialise"</span>, 
  <span class="st">"Ouvrier qualifie"</span>)] &lt;-<span class="st"> "Ouvrier"</span>
d$qualif.reg[d$qualif %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Profession intermediaire"</span>, 
  <span class="st">"Technicien"</span>)] &lt;-<span class="st"> "Intermediaire"</span>
<span class="kw">table</span>(d$qualif.reg)</code></pre>
<pre><code>
        Autre         Cadre       Employe 
           58           260           594 
Intermediaire       Ouvrier 
          246           495 </code></pre>
<p>Dans tous les cas le rÃ©sultat obtenu est une variable de type caractÃ¨re. On pourra la convertir en facteur par un simpleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualif.reg &lt;-<span class="st"> </span><span class="kw">factor</span>(d$qualif.reg)</code></pre>
<p>Si on souhaite recoder les valeurs manquantes, il suffit de faire appel Ã  la fonction <code data-package="base" data-rdocumentation="NA">is.na</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$trav.satisf)</code></pre>
<pre><code>
  Satisfaction Insatisfaction      Equilibre 
           480            117            451 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$trav.satisf.reg &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$trav.satisf)
d$trav.satisf.reg[<span class="kw">is.na</span>(d$trav.satisf)] &lt;-<span class="st"> "Manquant"</span>
<span class="kw">table</span>(d$trav.satisf.reg)</code></pre>
<pre><code>
     Equilibre Insatisfaction       Manquant 
           451            117            952 
  Satisfaction 
           480 </code></pre>
<div class="astuce">
<p><strong class="package">questionr</strong> propose une interface interactive pour le recodage dâ€™une variable qualitative (renommage et regroupement de modalitÃ©s). Cette fonction, nommÃ©e <code data-package="questionr">irec</code>, sâ€™utilise de la maniÃ¨re suivanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">irec</span>(d, qualif)</code></pre>
<p><strong>RStudio</strong> va alors ouvrir une fenÃªtre semblable Ã  lâ€™image ci-dessousÂ :</p>
<p><img src="images/capture_irec.png" alt="Capture de irec"/></p>
<p>Vous pouvez alors sÃ©lectionner diffÃ©rentes options, et pour chaque ancienne modalitÃ©, indiquer la nouvelle valeur correspondante. Pour regrouper des modalitÃ©s, il suffit de leur assigner des nouvelles valeurs identiques. Dans tous les cas nâ€™hÃ©sitez pas Ã  expÃ©rimenter, lâ€™interface se contente de gÃ©nÃ©rer du code R Ã  copier/coller dans votre script mais ne lâ€™exÃ©cute pas, et ne modifie donc jamais vos donnÃ©es !</p>
Lâ€™onglet <em>VÃ©rification</em> affiche un tri croisÃ© de lâ€™ancienne et de la nouvelle variable pour vÃ©rifier que le recodage est correct. Une fois le rÃ©sultat satisfaisant, vous pouvez rÃ©cupÃ©rer le code gÃ©nÃ©rÃ© dans lâ€™onglet <em>Code</em> pour lâ€™inclure dans votre script.
</div>
</div>
<div id="pem_manipulation_variables-calculees" class="section level3">
<h3>Variables calculÃ©es</h3>
<p>La crÃ©ation dâ€™une variable numÃ©rique Ã  partir de calculs sur une ou plusieurs autres variables numÃ©riques se fait trÃ¨s simplement.</p>
<p>Supposons que lâ€™on souhaite calculer une variable indiquant lâ€™Ã©cart entre le nombre dâ€™heures passÃ©es Ã  regarder la tÃ©lÃ©vision et la moyenne globale de cette variable. On pourrait alors faireÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1]  0 12</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 2.246566</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$ecart.heures.tv &lt;-<span class="st"> </span>d$heures.tv -<span class="st"> </span><span class="kw">mean</span>(d$heures.tv, 
  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">range</span>(d$ecart.heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] -2.246566  9.753434</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$ecart.heures.tv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 4.714578e-17</code></pre>
<p>Autre exemple tirÃ© du jeu de donnÃ©es <code>rp99</code>Â : si on souhaite calculer le pourcentage dâ€™actifs dans chaque commune, on peut diviser la population active <em>pop.act</em> par la population totale <em>pop.tot</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r">rp99$part.actifs &lt;-<span class="st"> </span>rp99$pop.act/rp99$pop.tot *<span class="st"> </span><span class="dv">100</span></code></pre>
</div>
<div id="pem_manipulation_combiner-plusieurs-variables" class="section level3">
<h3>Combiner plusieurs variables</h3>
<p>La combinaison de plusieurs variables se fait Ã  lâ€™aide des techniques dâ€™indexation dÃ©jÃ  dÃ©crites prÃ©cÃ©demment. Le plus compliquÃ© est dâ€™arriver Ã  formuler des conditions parfois complexes de maniÃ¨re rigoureuse.</p>
<p>On peut ainsi vouloir combiner plusieurs variables qualitatives en une seuleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$act.manuelles &lt;-<span class="st"> </span><span class="ot">NA</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Oui"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> "Cuisine et Bricolage"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Oui"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Non"</span>] &lt;-<span class="st"> "Cuisine seulement"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Non"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> "Bricolage seulement"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Non"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Non"</span>] &lt;-<span class="st"> "Ni cuisine ni bricolage"</span>
<span class="kw">table</span>(d$act.manuelles)</code></pre>
<pre><code>
    Bricolage seulement    Cuisine et Bricolage 
                    437                     416 
      Cuisine seulement Ni cuisine ni bricolage 
                    465                     682 </code></pre>
<p>On peut Ã©galement combiner variables qualitatives et variables quantitativesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$age.sexe &lt;-<span class="st"> </span><span class="ot">NA</span>
d$age.sexe[d$sexe ==<span class="st"> "Homme"</span> &amp;<span class="st"> </span>d$age &lt;<span class="st"> </span><span class="dv">40</span>] &lt;-<span class="st"> "Homme moins de 40 ans"</span>
d$age.sexe[d$sexe ==<span class="st"> "Homme"</span> &amp;<span class="st"> </span>d$age &gt;=<span class="st"> </span><span class="dv">40</span>] &lt;-<span class="st"> "Homme plus de 40 ans"</span>
d$age.sexe[d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>d$age &lt;<span class="st"> </span><span class="dv">40</span>] &lt;-<span class="st"> "Femme moins de 40 ans"</span>
d$age.sexe[d$sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>d$age &gt;=<span class="st"> </span><span class="dv">40</span>] &lt;-<span class="st"> "Femme plus de 40 ans"</span>
<span class="kw">table</span>(d$age.sexe)</code></pre>
<pre><code>
Femme moins de 40 ans  Femme plus de 40 ans 
                  376                   725 
Homme moins de 40 ans  Homme plus de 40 ans 
                  315                   584 </code></pre>
<p>Les combinaisons de variables un peu complexes nÃ©cessitent parfois un petit travail de rÃ©flexion. En particulier, lâ€™ordre des commandes de recodage a parfois une influence dans le rÃ©sultat final.</p>
</div>
<div id="pem_manipulation_variables-scores" class="section level3">
<h3>Variables scores</h3>
<p>Une variable score est une variable calculÃ©e en additionnant des poids accordÃ©s aux modalitÃ©s dâ€™une sÃ©rie de variables qualitatives.</p>
<p>Pour prendre un exemple tout Ã  fait arbitraire, imaginons que nous souhaitons calculer un score dâ€™activitÃ©s extÃ©rieures. Dans ce score on considÃ¨re que le fait dâ€™aller au cinÃ©ma Â«Â pÃ¨seÂ Â» 10, celui de pÃªcher ou chasser vaut 30 et celui de faire du sport vaut 20. On pourrait alors calculer notre score de la maniÃ¨re suivanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$score.ext &lt;-<span class="st"> </span><span class="dv">0</span>
d$score.ext[d$cinema ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> </span>d$score.ext[d$cinema ==<span class="st"> </span>
<span class="st">  "Oui"</span>] +<span class="st"> </span><span class="dv">10</span>
d$score.ext[d$peche.chasse ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> </span>d$score.ext[d$peche.chasse ==<span class="st"> </span>
<span class="st">  "Oui"</span>] +<span class="st"> </span><span class="dv">30</span>
d$score.ext[d$sport ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> </span>d$score.ext[d$sport ==<span class="st"> </span>
<span class="st">  "Oui"</span>] +<span class="st"> </span><span class="dv">20</span>
<span class="kw">table</span>(d$score.ext)</code></pre>
<pre><code>
  0  10  20  30  40  50  60 
800 342 229 509  31  41  48 </code></pre>
<p>Cette notation Ã©tant un peu lourde, on peut lâ€™allÃ©ger un peu en utilisant la fonction <code data-package="ifelse">ifelse</code>. Celle-ci prend en argument une condition et deux valeurs. Si la condition est vraie elle retourne la premiÃ¨re valeur, sinon elle retourne la seconde.</p>
<pre class="sourceCode r"><code class="sourceCode r">d$score.ext &lt;-<span class="st"> </span><span class="dv">0</span>
d$score.ext &lt;-<span class="st"> </span><span class="kw">ifelse</span>(d$cinema ==<span class="st"> "Oui"</span>, <span class="dv">10</span>, <span class="dv">0</span>) +<span class="st"> </span><span class="kw">ifelse</span>(d$peche.chasse ==<span class="st"> </span>
<span class="st">  "Oui"</span>, <span class="dv">30</span>, <span class="dv">0</span>) +<span class="st"> </span><span class="kw">ifelse</span>(d$sport ==<span class="st"> "Oui"</span>, <span class="dv">20</span>, <span class="dv">0</span>)
<span class="kw">table</span>(d$score.ext)</code></pre>
<pre><code>
  0  10  20  30  40  50  60 
800 342 229 509  31  41  48 </code></pre>
</div>
<div id="pem_manipulation_verification-des-recodages" class="section level3">
<h3>VÃ©rification des recodages</h3>
<p>Il est trÃ¨s important de vÃ©rifier, notamment aprÃ¨s les recodages les plus complexes, quâ€™on a bien obtenu le rÃ©sultat escomptÃ©. Les deux points les plus sensibles Ã©tant les valeurs manquantes et les erreurs dans les conditions.</p>
<p>Pour vÃ©rifier tout cela le plus simple est sans doute de faire des tableaux croisÃ©s entre la variable recodÃ©e et celles ayant servi au recodage, Ã  lâ€™aide de la fonction <code data-package="base">table</code>, et de vÃ©rifier le nombre de valeurs manquantes dans la variable recodÃ©e avec <code data-package="base">summary</code>, <code data-package="questionr">freq</code> ou <code data-package="base">table</code>.</p>
<p>Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$act.manuelles &lt;-<span class="st"> </span><span class="ot">NA</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Oui"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> "Cuisine et Bricolage"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Oui"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Non"</span>] &lt;-<span class="st"> "Cuisine seulement"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Non"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> "Bricolage seulement"</span>
d$act.manuelles[d$cuisine ==<span class="st"> "Non"</span> &amp;<span class="st"> </span>d$bricol ==<span class="st"> "Non"</span>] &lt;-<span class="st"> "Ni cuisine ni bricolage"</span>
<span class="kw">table</span>(d$act.manuelles, d$cuisine)</code></pre>
<pre><code>                         
                          Non Oui
  Bricolage seulement     437   0
  Cuisine et Bricolage      0 416
  Cuisine seulement         0 465
  Ni cuisine ni bricolage 682   0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$act.manuelles, d$bricol)</code></pre>
<pre><code>                         
                          Non Oui
  Bricolage seulement       0 437
  Cuisine et Bricolage      0 416
  Cuisine seulement       465   0
  Ni cuisine ni bricolage 682   0</code></pre>
</div>
</div>
<div id="pem_manipulation_tri-de-tables" class="section level2">
<h2>Tri de tables</h2>
<p>La fonction <code data-package="base">sort</code> permet de trier les Ã©lÃ©ments dâ€™un vecteur.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">8</span>))</code></pre>
<pre><code>[1] 1 2 5 6 8</code></pre>
<p>On peut appliquer cette fonction Ã  une variable, mais celle-ci ne permet que dâ€™ordonner les valeurs de cette variable, et pas lâ€™ensemble du tableau de donnÃ©es dont elle fait partie. Pour cela nous avons besoin dâ€™une autre fonction, nommÃ©e <code data-package="base">order</code>. Celle-ci ne renvoie pas les valeurs du vecteur triÃ©es, mais les emplacements de ces valeurs.</p>
<p>Un exemple pour comprendreÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">order</span>(<span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">10</span>))</code></pre>
<pre><code>[1] 3 1 2</code></pre>
<p>Le rÃ©sultat renvoyÃ© signifie que la plus petite valeur est la valeur situÃ©e en 3<sup>e</sup> position, suivie de celle en 1<sup>Ã¨re</sup> position et de celle en 2<sup>e</sup> position. Tout cela ne paraÃ®t pas passionnant Ã  premiÃ¨re vue, mais si on mÃ©lange ce rÃ©sultat avec un peu dâ€™indexation directe, Ã§a devient intÃ©ressant. . .</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">order</span>(d$age))</code></pre>
<pre><code>[1] 162 215 346 377 511 646</code></pre>
<p>Ce que cette fonction renvoie, câ€™est lâ€™ordre dans lequel on doit placer les Ã©lÃ©ments de age, et donc par extension les lignes de <code>d</code>, pour que la variable soit triÃ©e par ordre croissant. Par consÃ©quent, si on faitÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d.tri &lt;-<span class="st"> </span>d[<span class="kw">order</span>(d$age), ]</code></pre>
<p>Alors on a triÃ© les lignes de d par ordre dâ€™Ã¢ge croissantÂ ! Et si on fait un petitÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d.tri, <span class="dv">3</span>)</code></pre>
<pre><code>     id age  sexe nivetud    poids
162 162  18 Homme    &lt;NA&gt; 4982.964
215 215  18 Homme    &lt;NA&gt; 4631.188
346 346  18 Femme    &lt;NA&gt; 1725.410
              occup qualif freres.soeurs clso
162 Etudiant, eleve   &lt;NA&gt;             2  Non
215 Etudiant, eleve   &lt;NA&gt;             2  Oui
346 Etudiant, eleve   &lt;NA&gt;             9  Non
                          relig trav.imp
162  Appartenance sans pratique     &lt;NA&gt;
215 Ni croyance ni appartenance     &lt;NA&gt;
346         Pratiquant regulier     &lt;NA&gt;
    trav.satisf hard.rock lecture.bd peche.chasse
162        &lt;NA&gt;       Non        Non          Non
215        &lt;NA&gt;       Non        Non          Non
346        &lt;NA&gt;       Non        Non          Non
    cuisine bricol cinema sport heures.tv fs.fac
162     Non    Non    Non   Oui         3      2
215     Oui    Non    Oui   Oui         2      2
346     Non    Non    Oui   Non         2      9
    fs.char qualif.char      age5cl  age20
162       2        &lt;NA&gt; (17.9,33.8] &lt;20ans
215       2        &lt;NA&gt; (17.9,33.8] &lt;20ans
346       9        &lt;NA&gt; (17.9,33.8] &lt;20ans
     age6cl qualif.reg trav.satisf.reg
162 [18,30)       &lt;NA&gt;        Manquant
215 [18,30)       &lt;NA&gt;        Manquant
346 [18,30)       &lt;NA&gt;        Manquant
    ecart.heures.tv           act.manuelles
162       0.7534336 Ni cuisine ni bricolage
215      -0.2465664       Cuisine seulement
346      -0.2465664 Ni cuisine ni bricolage
                 age.sexe score.ext
162 Homme moins de 40 ans        20
215 Homme moins de 40 ans        30
346 Femme moins de 40 ans        10</code></pre>
<p>On a les caractÃ©ristiques des trois enquÃªtÃ©s les plus jeunes.</p>
<p>On peut Ã©videmment trier par ordre dÃ©croissant en utilisant lâ€™option <code>decreasing=TRUE</code>. On peut donc afficher les caractÃ©ristiques des trois individus les plus Ã¢gÃ©s avecÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d[<span class="kw">order</span>(d$age, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>), ], <span class="dv">3</span>)</code></pre>
<pre><code>       id age  sexe
1916 1916  97 Femme
270   270  96 Femme
1542 1542  93 Femme
                               nivetud    poids
1916 Derniere annee d'etudes primaires 2162.835
270  Derniere annee d'etudes primaires 9993.020
1542 Derniere annee d'etudes primaires 7107.841
                   occup qualif freres.soeurs
1916       Autre inactif  Autre             5
270             Retraite   &lt;NA&gt;             1
1542 Retire des affaires   &lt;NA&gt;             7
     clso                       relig trav.imp
1916  Non      Pratiquant occasionnel     &lt;NA&gt;
270   Oui Ni croyance ni appartenance     &lt;NA&gt;
1542  Non      Pratiquant occasionnel     &lt;NA&gt;
     trav.satisf hard.rock lecture.bd
1916        &lt;NA&gt;       Non        Non
270         &lt;NA&gt;       Non        Non
1542        &lt;NA&gt;       Non        Non
     peche.chasse cuisine bricol cinema sport
1916          Non     Non    Non    Non   Non
270           Non     Non    Non    Non   Non
1542          Non     Non    Non    Oui   Non
     heures.tv fs.fac fs.char qualif.char
1916         3      5       5       Autre
270          6      1       1        &lt;NA&gt;
1542         3      7       7        &lt;NA&gt;
          age5cl  age20  age6cl qualif.reg
1916 (81.2,97.1]   &lt;NA&gt; [66,97]      Autre
270  (81.2,97.1]   &lt;NA&gt; [66,97]       &lt;NA&gt;
1542 (81.2,97.1] &gt;80ans [66,97]       &lt;NA&gt;
     trav.satisf.reg ecart.heures.tv
1916        Manquant       0.7534336
270         Manquant       3.7534336
1542        Manquant       0.7534336
               act.manuelles             age.sexe
1916 Ni cuisine ni bricolage Femme plus de 40 ans
270  Ni cuisine ni bricolage Femme plus de 40 ans
1542 Ni cuisine ni bricolage Femme plus de 40 ans
     score.ext
1916         0
270          0
1542        10</code></pre>
</div>
<div id="pem_manipulation_fusion_tables" class="section level2">
<h2>Fusion de tables</h2>
<p>Lorsquâ€™on traite de grosses enquÃªtes, notamment les enquÃªtes de lâ€™INSEE, on a souvent Ã  gÃ©rer des donnÃ©es rÃ©parties dans plusieurs tables, soit du fait de la construction du questionnaire, soit du fait de contraintes techniques (fichiers <strong>dbf</strong> ou <strong>Excel</strong> limitÃ©s Ã  256 colonnes, par exemple).</p>
<p>Une opÃ©ration relativement courante consiste Ã  fusionner plusieurs tables pour regrouper tout ou partie des donnÃ©es dans un unique tableau.</p>
<p>Nous allons simuler artificiellement une telle situation en crÃ©ant deux tables Ã  partir de lâ€™extrait de lâ€™enquÃªte <em>Histoire de vie</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">dim</span>(d)</code></pre>
<pre><code>[1] 2000   20</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"sexe"</span>))
<span class="kw">dim</span>(d1)</code></pre>
<pre><code>[1] 2000    3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span><span class="kw">subset</span>(d, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"clso"</span>))
<span class="kw">dim</span>(d2)</code></pre>
<pre><code>[1] 2000    2</code></pre>
<p>On a donc deux tableaux de donnÃ©es, <code>d1</code> et <code>d2</code>, comportant chacun 2000 lignes et respectivement 3 et 2 colonnes. Comment les rassembler pour nâ€™en former quâ€™unÂ ?</p>
<p>Intuitivement, cela paraÃ®t simple. Il suffit de Â«Â collerÂ Â» <code>d2</code> Ã  la droite de <code>d1</code>, comme dans lâ€™exemple suivant.</p>
<style media="screen" type="text/css"><![CDATA[
table.exemple_df td, 
table.exemple_df th {
  text-align: center;
  padding: 3px 10px;
}
table.exemple_df th {
  border-bottom: solid 1px #999;
}

table.exemple_df td + td,
table.exemple_df th + th {
  border-left: solid 1px #999;
}

table.exemple_operateur td {
  font-size: 3em;
  padding: 20px;
}
]]></style>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
12
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
17
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
41
</td>
</tr>
<tr>
<td>
4
</td>
<td>
F
</td>
<td>
9
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
â€¦
</td>
<td>
â€¦
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v3
</th>
</tr>
<tr>
<td>
1
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
2
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
3
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
4
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
â€¦
</td>
<td>
â€¦
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
<th>
v3
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
12
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
17
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
41
</td>
<td>
bleu
</td>
</tr>
<tr>
<td>
4
</td>
<td>
F
</td>
<td>
9
</td>
<td>
rouge
</td>
</tr>
<tr>
<td>
â€¦
</td>
<td>
â€¦
</td>
<td>
â€¦
</td>
<td>
â€¦
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Cela semble fonctionner. La fonction qui permet dâ€™effectuer cette opÃ©ration sous <strong>R</strong> sâ€™appelle <code data-package="base">cbind</code>, elle Â«Â colleÂ Â» des tableaux cÃ´te Ã  cÃ´te en regroupant leurs colonnes<a href="#pem_manipulation_fn3" class="footnoteRef" id="pem_manipulation_fnref3"><sup>3</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">cbind</span>(d1, d2))</code></pre>
<pre><code>  id age  sexe id clso
1  1  28 Femme  1  Oui
2  2  23 Femme  2  Oui
3  3  59 Homme  3  Non
4  4  34 Homme  4  Non
5  5  71 Femme  5  Oui
6  6  35 Femme  6  Non</code></pre>
<p>Ã€ part le fait quâ€™on a une colonne <em>id</em> en double, le rÃ©sultat semble satisfaisant. Ã€ premiÃ¨re vue seulement. Imaginons maintenant que nous avons travaillÃ© sur <code>d1</code> et <code>d2</code>, et que nous avons ordonnÃ© les lignes de d1 selon lâ€™Ã¢ge des enquÃªtÃ©sÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d1 &lt;-<span class="st"> </span>d1[<span class="kw">order</span>(d1$age), ]</code></pre>
<p>RÃ©pÃ©tons lâ€™opÃ©ration de collageÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">cbind</span>(d1, d2))</code></pre>
<pre><code>     id age  sexe id clso
162 162  18 Homme  1  Oui
215 215  18 Homme  2  Oui
346 346  18 Femme  3  Non
377 377  18 Homme  4  Non
511 511  18 Homme  5  Oui
646 646  18 Homme  6  Non</code></pre>
<p>Que constate-t-onÂ ? La prÃ©sence de la variable <em>id</em> en double nous permet de voir que les identifiants ne coÃ¯ncident plusÂ ! En regroupant nos colonnes nous avons donc attribuÃ© Ã  des individus les rÃ©ponses dâ€™autres individus.</p>
<p>La commande <code data-package="base">cbind</code> ne peut en effet fonctionner que si les deux tableaux ont exactement le mÃªme nombre de lignes, et dans le mÃªme ordre, ce qui nâ€™est pas le cas ici.</p>
<p>On va donc Ãªtre obligÃ© de pocÃ©der Ã  une <em>fusion</em> des deux tableaux, qui va permettre de rendre Ã  chaque ligne ce qui lui appartient. Pour cela nous avons besoin dâ€™un identifiant qui permet dâ€™identifier chaque ligne de maniÃ¨re unique et qui doit Ãªtre prÃ©sent dans tous les tableaux. Dans notre cas, câ€™est plutÃ´t rapide, il sâ€™agit de la variable <em>id</em>.</p>
<p>Une fois lâ€™identifiant identifiÃ©<a href="#pem_manipulation_fn4" class="footnoteRef" id="pem_manipulation_fnref4"><sup>4</sup></a>, on peut utiliser la commande <code data-package="base">merge</code>. Celle-ci va fusionner les deux tableaux en supprimant les colonnes en double et en regroupant les lignes selon leurs identifiantsÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d.complet &lt;-<span class="st"> </span><span class="kw">merge</span>(d1, d2, <span class="dt">by =</span> <span class="st">"id"</span>)
<span class="kw">head</span>(d.complet)</code></pre>
<pre><code>  id age  sexe clso
1  1  28 Femme  Oui
2  2  23 Femme  Oui
3  3  59 Homme  Non
4  4  34 Homme  Non
5  5  71 Femme  Oui
6  6  35 Femme  Non</code></pre>
<p>Ici lâ€™utilisation de la fonction est plutÃ´t simple car nous sommes dans le cas de figure idÃ©alÂ : les lignes correspondent parfaitement et lâ€™identifiant est clairement identifiÃ©. Parfois les choses peuvent Ãªtre un peu plus compliquÃ©esÂ :</p>
<ul>
<li>parfois les identifiants nâ€™ont pas le mÃªme nom dans les deux tableaux. On peut alors les spÃ©cifier par les options <code>by.x</code> et <code>by.y</code>Â ;</li>
<li>parfois les deux tableaux comportent des colonnes (hors identifiants) ayant le mÃªme nom. <code data-package="base">merge</code> conserve dans ce cas ces deux colonnes mais les renomme en les suffixant par <em>.x</em> pour celles provenant du premier tableau et <em>.y</em> pour celles du secondÂ ;</li>
<li>parfois on nâ€™a pas dâ€™identifiant unique prÃ©Ã©tabli, mais on en construit un Ã  partir de plusieurs variables. On peut alors donner un vecteur en paramÃ¨tres de lâ€™option <code>by</code>, par exemple <code>by=c("nom","prenom","date.naissance")</code>.</li>
</ul>
<p>Une subtilitÃ© supplÃ©mentaire intervient lorsque les deux tableaux fusionnÃ©s nâ€™ont pas exactement les mÃªmes lignes. Par dÃ©faut, <code data-package="base">merge</code> ne conserve que les lignes prÃ©sentes dans les deux tableauxÂ :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>On peut cependant modifier ce comportement avec les options <code>all.x</code> et <code>all.y</code>.</p>
<p>Ainsi, <code>all.x=TRUE</code> indique de conserver toutes les lignes du premier tableau. Dans ce cas <code data-package="base">merge</code> donne une valeur <code>NA</code> pour ces lignes aux colonnes provenant du second tableau. Ce qui donneraitÂ :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
<code>NA</code>
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Lâ€™option <code>all.y=TRUE</code> fait la mÃªme chose en conservant toutes les lignes du second tableau.</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
<code>NA</code>
</td>
<td>
31
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Enfin, on peut dÃ©cider de conserver toutes les lignes des deux tableaux en utilisant Ã  la fois <code>all.x=TRUE</code> et <code>all.y=TRUE</code>, ce qui donneÂ :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
5
</td>
<td>
31
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
<code>NA</code>
</td>
</tr>
<tr>
<td>
5
</td>
<td>
<code>NA</code>
</td>
<td>
31
</td>
</tr>
</table>
</td>
</tr>
</table>
<p>Parfois, lâ€™un des identifiants est prÃ©sent Ã  plusieurs reprises dans lâ€™un des tableaux (par exemple lorsque lâ€™une des tables est un ensemble de mÃ©nages et que lâ€™autre dÃ©crit lâ€™ensemble des individus de ces mÃ©nages). Dans ce cas les lignes de lâ€™autre table sont dupliquÃ©es autant de fois que nÃ©cessairesÂ :</p>
<table style="margin: 11px auto;">
<tr>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
+
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
10
</td>
</tr>
<tr>
<td>
1
</td>
<td>
18
</td>
</tr>
<tr>
<td>
1
</td>
<td>
21
</td>
</tr>
<tr>
<td>
2
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
42
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_operateur">
<tr>
<td>
=
</td>
</tr>
</table>
</td>
<td>
<table class="exemple_df">
<tr>
<th>
id
</th>
<th>
v1
</th>
<th>
v2
</th>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
10
</td>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
18
</td>
</tr>
<tr>
<td>
1
</td>
<td>
H
</td>
<td>
21
</td>
</tr>
<tr>
<td>
2
</td>
<td>
H
</td>
<td>
15
</td>
</tr>
<tr>
<td>
3
</td>
<td>
F
</td>
<td>
42
</td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="pem_manipulation_fn1"><p>Une diffÃ©rence entre les deux est que <code>$</code> admet une correspondance partielle du nom de variable, si celle-ci est unique. Ainsi, <code>d$cls</code> renverra bien la variable <em>clso</em>, tandis que <code>d$c</code> renverra <code>NULL</code>, du fait que plusieurs variables de <em>d</em> commencent par la lettre <em>c</em>.<a href="#pem_manipulation_fnref1">â†©</a></p></li>
<li id="pem_manipulation_fn2"><p>Si vous utilisez lâ€™extenstion <strong class="package">data.table</strong>, la gestion des valeurs manquantes est quelque peu diffÃ©rente. Voir chapitre MAJ_LIEN.<a href="#pem_manipulation_fnref2">â†©</a></p></li>
<li id="pem_manipulation_fn3"><p>Lâ€™Ã©quivalent de <code data-package="base">cbind</code> pour les lignes sâ€™appelle <code data-package="base" data-rdocumentation="cbind">rbind</code>.<a href="#pem_manipulation_fnref3">â†©</a></p></li>
<li id="pem_manipulation_fn4"><p>Si vous me passez lâ€™expression. . .<a href="#pem_manipulation_fnref4">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_stat_biv">

<div id="analyses_stat_biv_header">
<h1 class="title">Statistique bivariÃ©e</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_stat_biv_deux-variables-quantitatives">Deux variables quantitatives</a></li>
<li><a href="#analyses_stat_biv_une-variable-quantitative-et-une-variable-qualitative">Une variable quantitative et une variable qualitative</a><ul>
<li><a href="#analyses_stat_biv_representations-graphiques">ReprÃ©sentations graphiques</a></li>
<li><a href="#analyses_stat_biv_comp_moyennes">Comparaison de moyennes</a></li>
</ul></li>
<li><a href="#analyses_stat_biv_deux-variables-qualitatives">Deux variables qualitatives</a><ul>
<li><a href="#analyses_stat_biv_tableau-croise">Tableau croisÃ©</a></li>
<li><a href="#analyses_stat_biv_-et-derives">Ï‡Â² et dÃ©rivÃ©s</a></li>
<li><a href="#analyses_stat_biv_representation-graphique">ReprÃ©sentation graphique</a></li>
<li><a href="#analyses_stat_biv_comparaison-de-proportions">Comparaison de proportions</a></li>
</ul></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Julien Barnier dans le cadre du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a>.
</div>
<p>On entend par <em>statistique bivariÃ©e</em> lâ€™Ã©tude des relations entre deux variables, celles-ci pouvant Ãªtre quantitatives ou qualitatives.</p>
<p>La <em>statistique univariÃ©e</em> a quant Ã  elle dÃ©jÃ  Ã©tÃ© abordÃ©e dans un <a href="#pem_stat_univ">chapitre dÃ©diÃ©</a>.</p>
<p>Comme dans la partie prÃ©cÃ©dente, on travaillera sur les jeux de donnÃ©es fournis avec lâ€™extension <strong class="package">questionr</strong> et tirÃ© de lâ€™enquÃªte <em>Histoire de vie</em> et du recensement 1999Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">data</span>(rp99)</code></pre>
<div id="analyses_stat_biv_deux-variables-quantitatives" class="section level2">
<h2>Deux variables quantitatives</h2>
<p>La comparaison de deux variables quantitatives se fait en premier lieu graphiquement, en reprÃ©sentant lâ€™ensemble des couples de valeurs. On peut ainsi reprÃ©senter les valeurs du nombre dâ€™heures passÃ©es devant la tÃ©lÃ©vision selon lâ€™Ã¢ge.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(d$age, d$heures.tv)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-2-1.png" title="" alt="" width="1050"/>
<figcaption>
Nombre dâ€™heures de tÃ©lÃ©vision selon lâ€™Ã¢ge
</figcaption>
</figure>
<p>Le fait que des points sont superposÃ©s ne facilite pas la lecture du graphique. On peut utiliser une reprÃ©sentation avec des points semi-transparents.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(d$age, d$heures.tv, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, 
  <span class="dv">0</span>, <span class="fl">0.1</span>))</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-3-1.png" title="" alt="" width="1050"/>
<figcaption>
Nombre dâ€™heures de tÃ©lÃ©vision selon lâ€™Ã¢ge avec semi-transparence
</figcaption>
</figure>
<p>Plus sophistiquÃ©, on peut faire une estimation locale de densitÃ© et reprÃ©senter le rÃ©sultat sous forme de Â«Â carteÂ Â». Pour cela on commence par isoler les deux variables, supprimer les observations ayant au moins une valeur manquante Ã  lâ€™aide de la fonction <code data-package="stats">complete.cases</code>, estimer la densitÃ© locale Ã  lâ€™aide de la fonction <code data-package="MASS">kde2d</code> de lâ€™extension <strong class="package">MASS</strong><a href="#analyses_stat_biv_fn1" class="footnoteRef" id="analyses_stat_biv_fnref1"><sup>1</sup></a> et reprÃ©senter le tout Ã  lâ€™aide dâ€™une des fonctions <code data-package="graphics">image</code>, <code data-package="graphics">contour</code> ou <code data-package="graphics">filled.contour</code>. . .</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS)
tmp &lt;-<span class="st"> </span>d[, <span class="kw">c</span>(<span class="st">"age"</span>, <span class="st">"heures.tv"</span>)]
tmp &lt;-<span class="st"> </span>tmp[<span class="kw">complete.cases</span>(tmp), ]
<span class="kw">filled.contour</span>(<span class="kw">kde2d</span>(tmp$age, tmp$heures.tv), <span class="dt">color =</span> terrain.colors)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-4-1.png" title="" alt="" width="1050"/>
<figcaption>
ReprÃ©sentation de lâ€™estimation de densitÃ© locale
</figcaption>
</figure>
<p>Dans tous les cas, il nâ€™y a pas de structure trÃ¨s nette qui semble se dÃ©gager. On peut tester ceci mathÃ©matiquement en calculant le coefficient de corrÃ©lation entre les deux variables Ã  lâ€™aide de la fonction <code data-package="stats">cor</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(d$age, d$heures.tv, <span class="dt">use =</span> <span class="st">"complete.obs"</span>)</code></pre>
<pre><code>[1] 0.1776249</code></pre>
<p>Lâ€™option <code>use</code> permet dâ€™Ã©liminer les observations pour lesquelles lâ€™une des deux valeurs est manquante. Le coefficient de corrÃ©lation est trÃ¨s faible.</p>
<p>On va donc sâ€™intÃ©resser plutÃ´t Ã  deux variables prÃ©sentes dans le jeu de donnÃ©es <code>rp99</code>, la part de diplÃ´mÃ©s du supÃ©rieur et la proportion de cadres dans les communes du RhÃ´ne en 1999.</p>
<p>Ã€ nouveau, commenÃ§ons par reprÃ©senter les deux variables.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rp99$dipl.sup, rp99$cadres, <span class="dt">ylab =</span> <span class="st">"Part des cadres"</span>, 
  <span class="dt">xlab =</span> <span class="st">"Part des diplomÃªs du supÃ©rieur"</span>)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-6-1.png" title="" alt="" width="1050"/>
<figcaption>
Proportion de cadres et proportion de diplÃ´mÃ©s du supÃ©rieur
</figcaption>
</figure>
<p>Ã‡a ressemble dÃ©jÃ  beaucoup plus Ã  une relation de type linÃ©aire.</p>
<p>Calculons le coefficient de corrÃ©lationÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(rp99$dipl.sup, rp99$cadres)</code></pre>
<pre><code>[1] 0.8975282</code></pre>
<p>Câ€™est beaucoup plus proche de 1. On peut alors effectuer une rÃ©gression linÃ©aire complÃ¨te en utilisant la fonction <code data-package="stats">lm</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">reg &lt;-<span class="st"> </span><span class="kw">lm</span>(cadres ~<span class="st"> </span>dipl.sup, <span class="dt">data =</span> rp99)
<span class="kw">summary</span>(reg)</code></pre>
<pre><code>
Call:
lm(formula = cadres ~ dipl.sup, data = rp99)

Residuals:
    Min      1Q  Median      3Q     Max 
-9.6905 -1.9010 -0.1823  1.4913 17.0866 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  1.24088    0.32988   3.762 0.000203
dipl.sup     1.38352    0.03931  35.196  &lt; 2e-16
               
(Intercept) ***
dipl.sup    ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.281 on 299 degrees of freedom
Multiple R-squared:  0.8056,    Adjusted R-squared:  0.8049 
F-statistic:  1239 on 1 and 299 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Le rÃ©sultat montre que les coefficients sont significativement diffÃ©rents de 0. La part de cadres augmente donc avec celle de diplÃ´mÃ©s du supÃ©rieur (Ã´ surprise). On peut trÃ¨s facilement reprÃ©senter la droite de rÃ©gression Ã  lâ€™aide de la fonction <code data-package="graphics">abline</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rp99$dipl.sup, rp99$cadres, <span class="dt">ylab =</span> <span class="st">"Part des cadres"</span>, 
  <span class="dt">xlab =</span> <span class="st">"Part des diplÃ´mÃ©s du supÃ©rieur"</span>)
<span class="kw">abline</span>(reg, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-9-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©gression de la proportion de cadres par celle de diplÃ´mÃ©s du supÃ©rieur
</figcaption>
</figure>
<div class="info">
<p>On remarquera que le premier argument passÃ© Ã  la fonction <code data-package="stats">lm</code> a une syntaxe un peu particuliÃ¨re. Il sâ€™agit dâ€™une <em>formule</em>, utilisÃ©e de maniÃ¨re gÃ©nÃ©rale dans les modÃ¨les statistiques. On indique la variable dâ€™intÃ©rÃªt Ã  gauche et la variable explicative Ã  droite, les deux Ã©tant sÃ©parÃ©es par un tilde <code>Â˜</code> (obtenu sous <strong>Windows</strong> en appuyant simultanÃ©ment sur les touches <kbd>Alt Gr</kbd> et <kbd>2</kbd>). On remarquera que les noms des colonnes de notre tableau de donnÃ©es ont Ã©tÃ© Ã©crites sans guillemets.</p>
<p>Dans le cas prÃ©sent, nous avons calculÃ© une rÃ©gression linÃ©aire simple entre deux variables, dâ€™oÃ¹ lâ€™Ã©criture <code>cadres Â˜ dipl.sup</code>. Si nous avions voulu expliquer une variable <em>z</em> par deux variables <em>x</em> et <em>y</em>, nous aurions Ã©crit <code>z Â˜ x + y</code>. Il est possible de spÃ©cifier des modÃ¨les encore plus complexes.</p>
Pour un aperÃ§u de la syntaxe des formules sous <strong>R</strong>, voir <a href="http://ww2.coastal.edu/kingw/statistics/R-tutorials/formulae.html" class="uri">http://ww2.coastal.edu/kingw/statistics/R-tutorials/formulae.html</a>.
</div>
</div>
<div id="analyses_stat_biv_une-variable-quantitative-et-une-variable-qualitative" class="section level2">
<h2>Une variable quantitative et une variable qualitative</h2>
<div id="analyses_stat_biv_representations-graphiques" class="section level3">
<h3>ReprÃ©sentations graphiques</h3>
<p>Quand on parle de comparaison entre une variable quantitative et une variable qualitative, on veut en gÃ©nÃ©ral savoir si la distribution des valeurs de la variable quantitative est la mÃªme selon les modalitÃ©s de la variable qualitative. En clairÂ : est ce que lâ€™Ã¢ge de ceux qui Ã©coutent du hard rock est diffÃ©rent de lâ€™Ã¢ge de ceux qui nâ€™en Ã©coutent pasÂ ?</p>
<p>LÃ  encore, lâ€™idÃ©al est de commencer par une reprÃ©sentation graphique. Les boÃ®tes Ã  moustaches sont parfaitement adaptÃ©es pour cela.</p>
<p>Si on a construit des sous-populations dâ€™individus Ã©coutant ou non du hard rock, on peut utiliser la fonction <code data-package="graphics">boxplot</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r">d.hard &lt;-<span class="st"> </span><span class="kw">subset</span>(d, hard.rock ==<span class="st"> "Oui"</span>)
d.non.hard &lt;-<span class="st"> </span><span class="kw">subset</span>(d, hard.rock ==<span class="st"> "Non"</span>)
<span class="kw">boxplot</span>(d.hard$age, d.non.hard$age)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-10-1.png" title="" alt="" width="1050"/>
<figcaption>
Boxplot de la rÃ©partition des Ã¢ges (sous-populations)
</figcaption>
</figure>
<p>Mais construire les sous-populations nâ€™est pas nÃ©cessaire. On peut utiliser directement la version de <code data-package="graphics">boxplot</code> prenant une formule en argument.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(age ~<span class="st"> </span>hard.rock, <span class="dt">data =</span> d)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-11-1.png" title="" alt="" width="1050"/>
<figcaption>
Boxplot de la rÃ©partition des Ã¢ges (formule)
</figcaption>
</figure>
<p>Ã€ premiÃ¨re vue, Ã´ surprise, la population Ã©coutant du hard rock a lâ€™air sensiblement plus jeune. Peut-on le tester mathÃ©matiquementÂ ?</p>
</div>
<div id="analyses_stat_biv_comp_moyennes" class="section level3">
<h3>Comparaison de moyennes</h3>
<p>On peut calculer la moyenne dâ€™Ã¢ge des deux groupes en utilisant la fonction <code data-package="base">tapply</code><a href="#analyses_stat_biv_fn2" class="footnoteRef" id="analyses_stat_biv_fnref2"><sup>2</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$age, d$hard.rock, mean)</code></pre>
<pre><code>     Non      Oui 
48.30211 27.57143 </code></pre>
<p>Lâ€™Ã©cart est important. Est-il statistiquement significatifÂ ? Pour cela on peut faire un test <em>t</em> de comparaison de moyennes Ã  lâ€™aide de la fonction <code data-package="stats">t.test</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t.test</span>(d$age ~<span class="st"> </span>d$hard.rock)</code></pre>
<pre><code>
    Welch Two Sample t-test

data:  d$age by d$hard.rock
t = 9.6404, df = 13.848, p-value = 1.611e-07
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 16.11379 25.34758
sample estimates:
mean in group Non mean in group Oui 
         48.30211          27.57143 </code></pre>
<p>Le test est extrÃªmement significatif. Lâ€™intervalle de confiance Ã  95Â % de la diffÃ©rence entre les deux moyennes va de 14,5 ans Ã  21,8 ans.</p>
<div class="info">
<p>La valeur affichÃ©e pour <em>p</em> est de <code>1.611e-07</code>. Cette valeur peut paraÃ®tre Ã©trange pour les non avertis. Cela signifie tout simplement 1,611 multipliÃ© par 10 Ã  la puissance -7, autrement dit 0,0000001611. Cette maniÃ¨re de reprÃ©senter un nombre est couramment appelÃ©e <em>notation scientifique</em>.</p>
Pour plus de dÃ©tails, voir <a href="http://fr.wikipedia.org/wiki/Notation_scientifique" class="uri">http://fr.wikipedia.org/wiki/Notation_scientifique</a>.
</div>
<p>Nous sommes cependant allÃ©s un peu vite en besogne, car nous avons nÃ©gligÃ© une hypothÃ¨se fondamentale du test <em>t</em>Â : les ensembles de valeur comparÃ©s doivent suivre approximativement une loi normale et Ãªtre de mÃªme variance<a href="#analyses_stat_biv_fn3" class="footnoteRef" id="analyses_stat_biv_fnref3"><sup>3</sup></a>. Comment le vÃ©rifierÂ ?</p>
<p>Dâ€™abord avec un petit graphiqueÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">hist</span>(d$age[d$hard.rock ==<span class="st"> "Oui"</span>], <span class="dt">main =</span> <span class="st">"Hard rock"</span>, 
  <span class="dt">col =</span> <span class="st">"red"</span>)
<span class="kw">hist</span>(d$age[d$hard.rock ==<span class="st"> "Non"</span>], <span class="dt">main =</span> <span class="st">"Sans hard rock"</span>, 
  <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-14-1.png" title="" alt="" width="1050"/>
<figcaption>
Distribution des Ã¢ges pour apprÃ©ciation de la normalitÃ©
</figcaption>
</figure>
<div class="note">
La fonction <code data-package="graphics">par</code> permet de modifier de nombreux paramÃ¨tres graphiques. <code>par(mfrow = c(1, 2))</code> sert Ã  indiquer que lâ€™on souhaite afficher deux graphiques sur une mÃªme fenÃªtre, plus prÃ©cisÃ©ment que la fenÃªtre doit comporter une ligne et deux colonnes.
</div>
<p>Ã‡a a lâ€™air Ã  peu prÃ¨s bon pour les Â«Â Sans hard rockÂ Â», mais un peu plus limite pour les fans de <em>Metallica</em>, dont les effectifs sont dâ€™ailleurs assez faibles. Si on veut en avoir le coeur net on peut utiliser le test de normalitÃ© de <em>Shapiro-Wilk</em> avec la fonction <code data-package="stats">shapiro.test</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(d$age[d$hard.rock ==<span class="st"> "Oui"</span>])</code></pre>
<pre><code>
    Shapiro-Wilk normality test

data:  d$age[d$hard.rock == "Oui"]
W = 0.86931, p-value = 0.04104</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(d$age[d$hard.rock ==<span class="st"> "Non"</span>])</code></pre>
<pre><code>
    Shapiro-Wilk normality test

data:  d$age[d$hard.rock == "Non"]
W = 0.98141, p-value = 2.079e-15</code></pre>
<p>Visiblement, le test estime que les distributions ne sont pas suffisamment proches de la normalitÃ© dans les deux cas.</p>
<p>Et concernant lâ€™Ã©galitÃ© des variancesÂ ?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(d$age, d$hard.rock, var)</code></pre>
<pre><code>      Non       Oui 
285.62858  62.72527 </code></pre>
<p>Lâ€™Ã©cart nâ€™a pas lâ€™air nÃ©gligeable. On peut le vÃ©rifier avec le test fourni par la fonction <code data-package="stats">var.test</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var.test</span>(d$age ~<span class="st"> </span>d$hard.rock)</code></pre>
<pre><code>
    F test to compare two variances

data:  d$age by d$hard.rock
F = 4.5536, num df = 1985, denom df = 13,
p-value = 0.003217
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 1.751826 8.694405
sample estimates:
ratio of variances 
          4.553644 </code></pre>
<p>La diffÃ©rence est trÃ¨s significative. En toute rigueur le test <em>t</em> nâ€™aurait donc pas pu Ãªtre utilisÃ©.</p>
<p><em lang="en">Damned</em>Â ! Ces maudits tests statistiques vont-ils nous empÃªcher de faire connaÃ®tre au monde entier notre fabuleuse dÃ©couverte sur lâ€™Ã¢ge des fans de <em>Sepultura</em>Â ? NonÂ ! Car voici quâ€™approche Ã  lâ€™horizon un nouveau test, connu sous le nom de <em>Wilcoxon/Mann-Whitney</em>. Celui-ci a lâ€™avantage dâ€™Ãªtre non-paramÃ©trique, câ€™est Ã  dire de ne faire aucune hypothÃ¨se sur la distribution des Ã©chantillons comparÃ©s. Par contre il ne compare pas des diffÃ©rences de moyennes mais des diffÃ©rences de mÃ©dianesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wilcox.test</span>(d$age ~<span class="st"> </span>d$hard.rock)</code></pre>
<pre><code>
    Wilcoxon rank sum test with continuity
    correction

data:  d$age by d$hard.rock
W = 23980, p-value = 2.856e-06
alternative hypothesis: true location shift is not equal to 0</code></pre>
<p>OufÂ ! La diffÃ©rence est hautement significative<a href="#analyses_stat_biv_fn4" class="footnoteRef" id="analyses_stat_biv_fnref4"><sup>4</sup></a>. Nous allons donc pouvoir entamer la rÃ©daction de notre article pour la <em>Revue franÃ§aise de sociologie</em>.</p>
</div>
</div>
<div id="analyses_stat_biv_deux-variables-qualitatives" class="section level2">
<h2>Deux variables qualitatives</h2>
<p>La comparaison de deux variables qualitatives sâ€™appelle en gÃ©nÃ©ral un <em>tableau croisÃ©</em>. Câ€™est sans doute lâ€™une des analyses les plus frÃ©quentes lors du traitement dâ€™enquÃªtes en sciences sociales.</p>
<div id="analyses_stat_biv_tableau-croise" class="section level3">
<h3>Tableau croisÃ©</h3>
<p>La maniÃ¨re la plus simple dâ€™obtenir un tableau croisÃ© est dâ€™utiliser la fonction <code data-package="base">table</code> en lui donnant en paramÃ¨tres les deux variables Ã  croiser. En lâ€™occurrence nous allons croiser un recodage du niveau de qualification regroupÃ© avec le fait de pratiquer un sport.</p>
<p>On commence par calculer la variable recodÃ©e et par afficher le tri Ã  plat des deux variablesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$qualreg &lt;-<span class="st"> </span><span class="kw">as.character</span>(d$qualif)
d$qualreg[d$qualif %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Ouvrier specialise"</span>, <span class="st">"Ouvrier qualifie"</span>)] &lt;-<span class="st"> "Ouvrier"</span>
d$qualreg[d$qualif %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Profession intermediaire"</span>, 
  <span class="st">"Technicien"</span>)] &lt;-<span class="st"> "Intermediaire"</span>
<span class="kw">table</span>(d$qualreg)</code></pre>
<pre><code>
        Autre         Cadre       Employe 
           58           260           594 
Intermediaire       Ouvrier 
          246           495 </code></pre>
<p>Le tableau croisÃ© des deux variables sâ€™obtient de la maniÃ¨re suivanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sport, d$qualreg)</code></pre>
<pre><code>     
      Autre Cadre Employe Intermediaire Ouvrier
  Non    38   117     401           127     381
  Oui    20   143     193           119     114</code></pre>
<div class="info">
<p>Il est tout Ã  fait possible de croiser trois variables ou plus. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$sport, d$cuisine, d$sexe)</code></pre>
<pre><code>, ,  = Homme

     
      Non Oui
  Non 401 129
  Oui 228 141

, ,  = Femme

     
      Non Oui
  Non 358 389
  Oui 132 222</code></pre>
</div>
<p>On nâ€™a cependant que les effectifs, ce qui rend difficile les comparaisons. Lâ€™extension <strong class="package">questionr</strong> fournit des fonctions permettant de calculer facilement les pourcentages lignes, colonnes et totaux dâ€™un tableau croisÃ©.</p>
<p>Les pourcentages lignes sâ€™obtiennent avec la fonction <code data-package="questionr" data-rdocumentation="rprop">lprop</code><a href="#analyses_stat_biv_fn5" class="footnoteRef" id="analyses_stat_biv_fnref5"><sup>5</sup></a>. Celle-ci sâ€™applique au tableau croisÃ© gÃ©nÃ©rÃ© par <code data-package="base" data-rdocumentation="rprop">table</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">table</span>(d$sport, d$qualreg)
<span class="kw">lprop</span>(tab)</code></pre>
<pre><code>          
           Autre Cadre Employe Intermediaire
  Non        3.6  11.0  37.7    11.9        
  Oui        3.4  24.3  32.8    20.2        
  Ensemble   3.5  15.7  35.9    14.9        
          
           Ouvrier Total
  Non       35.8   100.0
  Oui       19.4   100.0
  Ensemble  29.9   100.0</code></pre>
<p>Les pourcentages ligne ne nous intÃ©ressent guÃ¨re ici. On ne cherche pas Ã  voir quelle est la proportion de cadres parmi ceux qui pratiquent un sport, mais plutÃ´t quelle est la proportion de sportifs chez les cadres. Il nous faut donc des pourcentages colonnes, que lâ€™on obtient avec la fonction <code data-package="questionr">cprop</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cprop</span>(tab)</code></pre>
<pre><code>       
        Autre Cadre Employe Intermediaire Ouvrier
  Non    65.5  45.0  67.5    51.6          77.0  
  Oui    34.5  55.0  32.5    48.4          23.0  
  Total 100.0 100.0 100.0   100.0         100.0  
       
        Ensemble
  Non    64.4   
  Oui    35.6   
  Total 100.0   </code></pre>
<p>Dans lâ€™ensemble, le pourcentage de personnes ayant pratiquÃ© un sport est de 35,6 %. Mais cette proportion varie fortement dâ€™une catÃ©gorie professionnelle Ã  lâ€™autreÂ : 55,0 % chez les cadres contre 23,0 % chez les ouvriers.</p>
<p>Enfin, les pourcentage totaux sâ€™obtiennent avec la fonction <code data-package="questionr">prop</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop</span>(tab)</code></pre>
<pre><code>       
        Autre Cadre Employe Intermediaire Ouvrier
  Non     2.3   7.1  24.3     7.7          23.0  
  Oui     1.2   8.7  11.7     7.2           6.9  
  Total   3.5  15.7  35.9    14.9          29.9  
       
        Total
  Non    64.4
  Oui    35.6
  Total 100.0</code></pre>
<p>Ã€ noter quâ€™on peut personnaliser lâ€™affichage de ces tableaux de pourcentages Ã  lâ€™aide de diffÃ©rentes options, dont <code>digits</code> qui rÃ¨gle le nombre de dÃ©cimales Ã  afficher et <code>percent</code> qui indique si on souhaite ou non rajouter un symbole <code>%</code> dans chaque case du tableau. Cette personnalisation peut se faire directement au moment de la gÃ©nÃ©ration du tableau et dans ce cas elle sera utilisÃ©e par dÃ©fautÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">ctab &lt;-<span class="st"> </span><span class="kw">cprop</span>(tab, <span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">percent =</span> <span class="ot">TRUE</span>)
ctab</code></pre>
<pre><code>       
        Autre   Cadre   Employe Intermediaire
  Non    65.52%  45.00%  67.51%  51.63%      
  Oui    34.48%  55.00%  32.49%  48.37%      
  Total 100.00% 100.00% 100.00% 100.00%      
       
        Ouvrier Ensemble
  Non    76.97%  64.37% 
  Oui    23.03%  35.63% 
  Total 100.00% 100.00% </code></pre>
<p>Ou bien ponctuellement en passant les mÃªmes arguments Ã  la fonction <code data-package="questionr" data-rdocumentation="print.proptab">print</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">ctab &lt;-<span class="st"> </span><span class="kw">cprop</span>(tab)
<span class="kw">print</span>(ctab, <span class="dt">percent =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>       
        Autre  Cadre  Employe Intermediaire
  Non    65.5%  45.0%  67.5%   51.6%       
  Oui    34.5%  55.0%  32.5%   48.4%       
  Total 100.0% 100.0% 100.0%  100.0%       
       
        Ouvrier Ensemble
  Non    77.0%   64.4%  
  Oui    23.0%   35.6%  
  Total 100.0%  100.0%  </code></pre>
</div>
<div id="analyses_stat_biv_-et-derives" class="section level3">
<h3>Ï‡Â² et dÃ©rivÃ©s</h3>
<p>Pour tester lâ€™existence dâ€™un lien entre les modalitÃ©s des deux variables, on va utiliser le trÃ¨s classique test du Ï‡Â²<a href="#analyses_stat_biv_fn6" class="footnoteRef" id="analyses_stat_biv_fnref6"><sup>6</sup></a>. Celui-ci sâ€™obtient grÃ¢ce Ã  la fonction <code data-package="stats">chisq.test</code>, appliquÃ©e au tableau croisÃ© obtenu avec <code data-package="base">table</code><a href="#analyses_stat_biv_fn7" class="footnoteRef" id="analyses_stat_biv_fnref7"><sup>7</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">chisq.test</span>(tab)</code></pre>
<pre><code>
    Pearson's Chi-squared test

data:  tab
X-squared = 96.798, df = 4, p-value &lt;
2.2e-16</code></pre>
<p>Le test est hautement significatif, on ne peut pas considÃ©rer quâ€™il y a indÃ©pendance entre les lignes et les colonnes du tableau.</p>
<p>On peut affiner lâ€™interprÃ©tation du test en dÃ©terminant dans quelle case lâ€™Ã©cart Ã  lâ€™indÃ©pendance est le plus significatif en utilisant les <em>rÃ©sidus</em> du test. Ceux-ci sont notamment affichables avec la fonction <code data-package="questionr">chisq.residuals</code> de <strong class="package">questionr</strong>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">chisq.residuals</span>(tab)</code></pre>
<pre><code>     
      Autre Cadre Employe Intermediaire Ouvrier
  Non  0.11 -3.89    0.95         -2.49    3.49
  Oui -0.15  5.23   -1.28          3.35   -4.70</code></pre>
<p>Les cases pour lesquelles lâ€™Ã©cart Ã  lâ€™indÃ©pendance est significatif ont un rÃ©sidu dont la valeur est supÃ©rieure Ã  2 ou infÃ©rieure Ã  -2. Ici on constate que la pratique dâ€™un sport est sur-reprÃ©sentÃ©e parmi les cadres et, Ã  un niveau un peu moindre, parmi les professions intermÃ©diaires, tandis quâ€™elle est sousreprÃ©sentÃ©e chez les ouvriers.</p>
<p>Enfin, on peut calculer le coefficient de contingence de Cramer du tableau, qui peut nous permettre de le comparer par la suite Ã  dâ€™autres tableaux croisÃ©s. On peut pour cela utiliser la fonction <code data-package="questionr">cramer.v</code> de <strong class="package">questionr</strong>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cramer.v</span>(tab)</code></pre>
<pre><code>[1] 0.24199</code></pre>
<div class="info">
<p>Pour un tableau Ã  2Ã—2 entrÃ©es, il est possible de calculer le test exact de Fisher avec la fonction <code data-package="stats">fisher.test</code>. On peut soit lui passer le rÃ©sultat de <code data-package="base">table</code>, soit directement les deux variables Ã  croiser.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lprop</span>(<span class="kw">table</span>(d$sexe, d$cuisine))</code></pre>
<pre><code>          
           Non   Oui   Total
  Homme     70.0  30.0 100.0
  Femme     44.5  55.5 100.0
  Ensemble  56.0  44.0 100.0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fisher.test</span>(<span class="kw">table</span>(d$sexe, d$cuisine))</code></pre>
<pre><code>
    Fisher's Exact Test for Count Data

data:  table(d$sexe, d$cuisine)
p-value &lt; 2.2e-16
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
 2.402598 3.513723
sample estimates:
odds ratio 
  2.903253 </code></pre>
</div>
</div>
<div id="analyses_stat_biv_representation-graphique" class="section level3">
<h3>ReprÃ©sentation graphique</h3>
<p>Enfin, on peut obtenir une reprÃ©sentation graphique synthÃ©tisant lâ€™ensemble des rÃ©sultats obtenus sous la forme dâ€™un graphique en mosaÃ¯que, grÃ¢ce Ã  la fonction <code data-package="graphics">mosaicplot</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mosaicplot</span>(qualreg ~<span class="st"> </span>sport, <span class="dt">data =</span> d, <span class="dt">shade =</span> <span class="ot">TRUE</span>, 
  <span class="dt">main =</span> <span class="st">"Graphe en mosaÃ¯que"</span>)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-31-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de graphe en mosaÃ¯que
</figcaption>
</figure>
<p>Comment interprÃ©ter ce graphique haut en couleurs<a href="#analyses_stat_biv_fn8" class="footnoteRef" id="analyses_stat_biv_fnref8"><sup>8</sup></a>Â ? Chaque rectangle reprÃ©sente une case de tableau. Sa largeur correspond aux pourcentages en colonnes (il yâ€™a beaucoup dâ€™employÃ©s et dâ€™ouvriers et trÃ¨s peu dâ€™Â«Â AutreÂ Â»). Sa hauteur correspond aux pourcentages en lignesÂ : la proportion de sportifs chez les cadres est plus Ã©levÃ©e que chez les employÃ©s. Enfin, la couleur de la case correspond au rÃ©sidu du test du Ï‡Â² correspondantÂ : les cases en rouge sont sous-reprÃ©sentÃ©es, les cases en bleu sur-reprÃ©sentÃ©es, et les cases blanches sont statistiquement proches de lâ€™hypothÃ¨se dâ€™indÃ©pendance.</p>
<p>Lorsque lâ€™on sâ€™intÃ©resse principalement aux variations dâ€™une variable selon une autre, par exemple ici Ã  la pratique du sport selon le niveau de qualification, il peut Ãªtre intÃ©ressant de prÃ©senter les pourcentages en colonne sous la forme de barres cumulÃ©es.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">cprop</span>(tab, <span class="dt">total =</span> <span class="ot">FALSE</span>), <span class="dt">main =</span> <span class="st">"Pratique du sport selon le niveau de qualification"</span>)</code></pre>
<img src="images/analyses_stat_biv/unnamed-chunk-32-1.png" title="" alt="" width="1050"/>
<figcaption>
Exemple de barres cumulÃ©es
</figcaption>
</figure>
</div>
<div id="analyses_stat_biv_comparaison-de-proportions" class="section level3">
<h3>Comparaison de proportions</h3>
<p>La fonction <code data-package="stats">prop.test</code>, que nous avons dÃ©jÃ  rencontrer pour calculer lâ€™interface de confiance dâ€™une proportion (MAJ_LIEN) permets Ã©galement de comparer deux proportions.</p>
<p>Supposons que lâ€™on souhaite comparer la proportion de personnes faisant du sport entre ceux qui lisent des bandes dessinÃ©es et les autresÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lprop</span>(<span class="kw">table</span>(d$lecture.bd, d$sport))</code></pre>
<pre><code>          
           Non   Oui   Total
  Non       64.2  35.8 100.0
  Oui       48.9  51.1 100.0
  Ensemble  63.8  36.1 100.0</code></pre>
<p>Il suffit de transmettre notre tableau croisÃ© (Ã  2Ã—2 dimensions) Ã  <code data-package="stats">prop.test</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="kw">table</span>(d$lecture.bd, d$sport))</code></pre>
<pre><code>
    2-sample test for equality of proportions
    with continuity correction

data:  table(d$lecture.bd, d$sport)
X-squared = 4, df = 1, p-value = 0.0455
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.002652453  0.308107236
sample estimates:
   prop 1    prop 2 
0.6420891 0.4893617 </code></pre>
</div>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_stat_biv_fn1"><p><strong class="package">MASS</strong> est installÃ©e par dÃ©faut avec la version de base de <strong>R</strong>.<a href="#analyses_stat_biv_fnref1">â†©</a></p></li>
<li id="analyses_stat_biv_fn2"><p>La fonction <code data-package="base">tapply</code> est prÃ©sentÃ©e plus en dÃ©tails dans le chapitre <a href="#pem_manipulation_tapply">Manipulation de donnÃ©es</a>.<a href="#analyses_stat_biv_fnref2">â†©</a></p></li>
<li id="analyses_stat_biv_fn3"><p>Concernant cette seconde condition, <code data-package="stats">t.test</code> propose une option nommÃ©e <code>var.equal</code> qui permet dâ€™utiliser une approximation dans le cas oÃ¹ les variances ne sont pas Ã©gales<a href="#analyses_stat_biv_fnref3">â†©</a></p></li>
<li id="analyses_stat_biv_fn4"><p>Ce test peut Ã©galement fournir un intervalle de confiance avec lâ€™option <code>conf.int=TRUE</code>.<a href="#analyses_stat_biv_fnref4">â†©</a></p></li>
<li id="analyses_stat_biv_fn5"><p>Il sâ€™agit en fait dâ€™un alias pour les francophones de la fonction <code data-package="questionr">rprop</code><a href="#analyses_stat_biv_fnref5">â†©</a></p></li>
<li id="analyses_stat_biv_fn6"><p>On ne donnera pas plus dâ€™indications sur le test du Ï‡Â² ici. Les personnes dÃ©sirant une prÃ©sentation plus dÃ©taillÃ©e pourront se reporter (attention, sÃ©ance dâ€™autopromotionÂ !) Ã  la page suivanteÂ : <a href="http://alea.fr.eu.org/pages/khi2" class="uri">http://alea.fr.eu.org/pages/khi2</a>.<a href="#analyses_stat_biv_fnref6">â†©</a></p></li>
<li id="analyses_stat_biv_fn7"><p>On peut aussi appliquer directement le test en spÃ©cifiant les deux variables Ã  croiser via <code>chisq.test(d$qualreg, d$sport)</code>.<a href="#analyses_stat_biv_fnref7">â†©</a></p></li>
<li id="analyses_stat_biv_fn8"><p>Sauf sâ€™il est imprimÃ© en noir et blanc. . .<a href="#analyses_stat_biv_fnref8">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_reglog">

<div id="analyses_reglog_header">
<h1 class="title">RÃ©gression logistique</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_reglog_preparation-des-donnees">PrÃ©paration des donnÃ©es</a></li>
<li><a href="#analyses_reglog_regression-logistique-binaire">RÃ©gression logistique binaire</a></li>
<li><a href="#analyses_reglog_selection-de-modeles">SÃ©lection de modÃ¨les</a></li>
<li><a href="#analyses_reglog_regression-logistique-multinomiale">RÃ©gression logistique multinomiale</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Joseph Larmarange dans le cadre du support de cours <a href="https://github.com/larmarange/intro-r/tree/CoursM2">Introduction Ã  lâ€™analyse dâ€™enquÃªtes avec R</a>.
</div>
<p>La rÃ©gression logistique est frÃ©quemment utilisÃ©e en sciences sociales car elle permet dâ€™effectuer un raisonnement dit <em>toutes choses Ã©tant Ã©gales par ailleurs</em>. Plus prÃ©cisÃ©ment, la rÃ©gression logistique a pour but dâ€™isoler les effets de chaque variable, câ€™est-Ã -dire dâ€™identifier les effets rÃ©siduels dâ€™une <em>variable explicative</em> sur une <em>variable dâ€™intÃ©rÃªt</em>, une fois pris en compte les autres variables explicatives introduites dans le modÃ¨le. La rÃ©gression logistique est ainsi prisÃ©e en Ã©pidÃ©miologie pour identifier les facteurs associÃ©s Ã  telle ou telle pathologie.</p>
<p>La rÃ©gression logistique ordinaire ou rÃ©gression logistique binaire vise Ã  expliquer une variable dâ€™intÃ©rÃªt binaire (câ€™est-Ã -dire de type Â«Â Oui/NonÂ Â»). Les variables explicatives qui seront introduites dans le modÃ¨le peuvent Ãªtre quantitatives ou qualitatives.</p>
<div id="analyses_reglog_preparation-des-donnees" class="section level2">
<h2>PrÃ©paration des donnÃ©es</h2>
<p>Dans ce chapite, nous allons encore une fois utiliser les donnÃ©es de lâ€™enquÃªte <em>Histoire de vie</em>, fournies avec lâ€™extension <strong class="package">questionr</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003</code></pre>
<p>Ã€ titre dâ€™exemple, nous allons Ã©tudier lâ€™effet de lâ€™Ã¢ge, du sexe, du niveau dâ€™Ã©tude, de la pratique religieuse et du nombre moyen dâ€™heures passÃ©es Ã  regarder la tÃ©lÃ©vision par jour.</p>
<p>En premier lieu, il importe de vÃ©rifier que notre variable dâ€™intÃ©rÃªt (ici <em>sport</em>) est correctement codÃ©e. Une possibilitÃ© consiste Ã  crÃ©er une variable boolÃ©enne (vrai / faux) selon que lâ€™individu a pratiquÃ© du sport ou nonÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sport2 &lt;-<span class="st"> </span><span class="ot">FALSE</span>
d$sport2[d$sport ==<span class="st"> "Oui"</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span></code></pre>
<p>Dans le cas prÃ©sent, cette variable nâ€™a pas de valeur manquante. Mais le cas Ã©chÃ©ant il faut bien renseigner <code>NA</code> pour les valeurs manquantes, les individus en question Ã©tant alors exclu de lâ€™analyse.</p>
<p>Il nâ€™est pas forcÃ©ment nÃ©cessaire de transformer notre variable dâ€™intÃ©rÃªt en variable boolÃ©enne. En effet, <strong>R</strong> accepte sans problÃ¨me une variable de type facteur. Cependant, lâ€™ordre des valeurs dâ€™un facteur a de lâ€™importance. En effet, <strong>R</strong> considÃ¨re toujours la premiÃ¨re modalitÃ© comme Ã©tant la modalitÃ© de rÃ©fÃ©rence. Dans le cas de la variable dâ€™intÃ©rÃªt, la modalitÃ© de rÃ©fÃ©rence correspond au fait de ne pas remplir le critÃ¨re Ã©tudiÃ©, dans notre exemple au fait de ne pas avoir eu dâ€™activitÃ© sportive au cours des douze derniers mois.</p>
<p>Pour connaÃ®tre lâ€™ordre des modalitÃ©s dâ€™une variable de type facteur, on peut utiliser la fonction <code data-package="base">levels</code> ou bien encore tout simplement la fonction <code data-package="questionr">freq</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(d$sport)</code></pre>
<pre><code>[1] "Non" "Oui"</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$sport)</code></pre>
<pre><code>       n    % val%
Non 1277 63.8 63.8
Oui  723 36.1 36.1
NA     0  0.0   NA</code></pre>
<p>Dans notre exemple, la modalitÃ© Â«Â NonÂ Â» est dÃ©jÃ  la premiÃ¨re modalitÃ©. Il nâ€™y a donc pas besoin de modifier notre variable. Si ce nâ€™est pas le cas, il faudra modifier la modalitÃ© de rÃ©fÃ©rence avec la fonction <code data-package="stats">relevel</code> comme nous allons le voir un peu plus loin.</p>
<div class="important">
Il est possible dâ€™indiquer un facteur Ã  plus de deux modalitÃ©s. Dans une telle situation, <strong>R</strong> considÃ©rera que tous les modalitÃ©s, sauf la modalitÃ© de rÃ©fÃ©rence, est une rÃ©alisation de la variable dâ€™intÃ©rÃªt. Cela serait correct, par exemple, si notre variable <em>sport</em> Ã©tait codÃ©e ainsiÂ : Â«Â NonÂ Â», Â«Â Oui, toutes les semainesÂ Â», Â«Â Oui, au moins une fois par moisÂ Â», Â«Â Oui, moins dâ€™une fois par moisÂ Â». Cependant, afin dâ€™Ã©viter tout risque dâ€™erreur ou de mauvaise interprÃ©tation, il est vivement conseillÃ© de recoder au prÃ©alable sa variable dâ€™intÃ©rÃªt en un facteur Ã  deux modalitÃ©s.
</div>
<p>La notion de modalitÃ© de rÃ©fÃ©rence sâ€™applique Ã©galement aux variables explicatives qualitatives. En effet, dans un modÃ¨le, tous les coefficients sont calculÃ©s par rapport Ã  la modalitÃ© de rÃ©fÃ©rence. Il importe de choisir une modalitÃ© de rÃ©fÃ©rence qui fasse sens afin de faciliter lâ€™interprÃ©tation. Par ailleurs, ce choix peut Ã©galement dÃ©pendre de la maniÃ¨re dont on souhaite prÃ©senter les rÃ©sultats. De maniÃ¨re gÃ©nÃ©rale on Ã©vitera de choisir comme rÃ©fÃ©rence une modalitÃ© peu reprÃ©sentÃ©e dans lâ€™Ã©chantillon ou bien une modalitÃ© correspondant Ã  une situation atypique.</p>
<p>Prenons lâ€™exemple de la variable <em>sexe</em>. Souhaite-t-on connaitre lâ€™effet dâ€™Ãªtre une femme par rapport au fait dâ€™Ãªtre un homme ou bien lâ€™effet dâ€™Ãªtre un homme par rapport au fait dâ€™Ãªtre une femmeÂ ? Si lâ€™on opte pour le second, alors notre modalitÃ© de rÃ©fÃ©rence sera le sexe fÃ©minin. Comme est codÃ©e cette variableÂ ?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$sexe)</code></pre>
<pre><code>         n  % val%
Homme  899 45   45
Femme 1101 55   55
NA       0  0   NA</code></pre>
<p>La modalitÃ© Â«Â FemmeÂ Â» sâ€™avÃ¨re ne pas Ãªtre la premiÃ¨re modalitÃ©. Nous devons appliquer la fonction <code data-package="stats">relevel</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$sexe &lt;-<span class="st"> </span><span class="kw">relevel</span>(d$sexe, <span class="st">"Femme"</span>)
<span class="kw">freq</span>(d$sexe)</code></pre>
<pre><code>         n  % val%
Femme 1101 55   55
Homme  899 45   45
NA       0  0   NA</code></pre>
<p>Les variables <em>age</em> et <em>heures.tv</em> sont des variables quantitatives. Il importe de vÃ©rifier quâ€™elles sont bien enregistrÃ©es en tant que variables numÃ©riques. En effet, il arrive parfois que dans le fichier source les variables quantitatives soient renseignÃ©es sous forme de valeur textuelle et non sous forme numÃ©rique.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d$age)</code></pre>
<pre><code> int [1:2000] 28 23 59 34 71 35 60 47 20 28 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(d$heures.tv)</code></pre>
<pre><code> num [1:2000] 0 1 0 2 3 2 2.9 1 2 2 ...</code></pre>
<p>Nos deux variables sont bien renseignÃ©es sous forme numÃ©rique.</p>
<p>Cependant, lâ€™effet de lâ€™Ã¢ge est rarement linÃ©aire. Un exemple trivial est par exemple le fait dâ€™occuper un emploi qui sera moins frÃ©quent aux jeunes Ã¢ges et aux Ã¢ges Ã©levÃ©s. DÃ¨s lors, on pourra transformer la variable <em>age</em> en groupe dâ€™Ã¢ges (voir MAJ_LIEN)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$grpage &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">65</span>, <span class="dv">93</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, 
  <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
<span class="kw">freq</span>(d$grpage)</code></pre>
<pre><code>          n    % val%
[16,25) 169  8.5  8.5
[25,45) 706 35.3 35.3
[45,65) 745 37.2 37.3
[65,93] 378 18.9 18.9
NA        2  0.1   NA</code></pre>
<p>Jetons maintenant un oeil Ã  la variable <em>nivetud</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$nivetud)</code></pre>
<pre><code>                                                                  n
N'a jamais fait d'etudes                                         39
A arrete ses etudes, avant la derniere annee d'etudes primaires  86
Derniere annee d'etudes primaires                               341
1er cycle                                                       204
2eme cycle                                                      183
Enseignement technique ou professionnel court                   463
Enseignement technique ou professionnel long                    131
Enseignement superieur y compris technique superieur            441
NA                                                              112
                                                                   %
N'a jamais fait d'etudes                                         2.0
A arrete ses etudes, avant la derniere annee d'etudes primaires  4.3
Derniere annee d'etudes primaires                               17.1
1er cycle                                                       10.2
2eme cycle                                                       9.2
Enseignement technique ou professionnel court                   23.2
Enseignement technique ou professionnel long                     6.6
Enseignement superieur y compris technique superieur            22.1
NA                                                               5.6
                                                                val%
N'a jamais fait d'etudes                                         2.1
A arrete ses etudes, avant la derniere annee d'etudes primaires  4.6
Derniere annee d'etudes primaires                               18.1
1er cycle                                                       10.8
2eme cycle                                                       9.7
Enseignement technique ou professionnel court                   24.5
Enseignement technique ou professionnel long                     6.9
Enseignement superieur y compris technique superieur            23.4
NA                                                                NA</code></pre>
<p>En premier lieu, cette variable est dÃ©taillÃ©e en pas moins de huit modalitÃ©s dont certaines sont peu reprÃ©sentÃ©es (seulement 39 individus soit 2Â % nâ€™ont jamais fait dâ€™Ã©tudes par exemple). Afin dâ€™amÃ©liorier notre modÃ¨le logistique, il peut Ãªtre pertinent de regrouper certaines modalitÃ©s (voir MAJ_LIEN)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">d$etud &lt;-<span class="st"> </span>d$nivetud
<span class="kw">levels</span>(d$etud) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, 
  <span class="st">"Secondaire"</span>, <span class="st">"Secondaire"</span>, <span class="st">"Technique/Professionnel"</span>, 
  <span class="st">"Technique/Professionnel"</span>, <span class="st">"SupÃ©rieur"</span>)
<span class="kw">freq</span>(d$etud)</code></pre>
<pre><code>                          n    % val%
Primaire                466 23.3 24.7
Secondaire              387 19.4 20.5
Technique/Professionnel 594 29.7 31.5
SupÃ©rieur               441 22.1 23.4
NA                      112  5.6   NA</code></pre>
<p>Notre variable comporte Ã©galement 112 individus avec une valeur manquante. Si nous conservons cette valeur manquante, ces 112 individus seront, par dÃ©faut, exclus de lâ€™analyse. Ces valeurs manquantes nâ€™Ã©tant pas nÃ©gligeable (5,6Â %), nous pouvons Ã©galement faire le choix de considÃ©rer ces valeurs manquantes comme une modalitÃ© supplÃ©mentaire. Auquel cas, nous utiliserons la fonction <code data-package="base">add.NA</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(d$etud)</code></pre>
<pre><code>[1] "Primaire"               
[2] "Secondaire"             
[3] "Technique/Professionnel"
[4] "SupÃ©rieur"              </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">d$etud &lt;-<span class="st"> </span><span class="kw">addNA</span>(d$etud)
<span class="kw">levels</span>(d$etud)</code></pre>
<pre><code>[1] "Primaire"               
[2] "Secondaire"             
[3] "Technique/Professionnel"
[4] "SupÃ©rieur"              
[5] NA                       </code></pre>
</div>
<div id="analyses_reglog_regression-logistique-binaire" class="section level2">
<h2>RÃ©gression logistique binaire</h2>
<p>La fonction <code data-package="stats">glm</code> (pour <em lang="en">generalized linear models</em>) permet de calculer une grande variÃ©tÃ© de modÃ¨les statistiques. La rÃ©gression logistique ordinaire correspond au modÃ¨le <em>logit</em> de la famille des modÃ¨les binomiaux, ce que lâ€™on indique Ã  <code data-package="stats">glm</code> avec lâ€™argument <code>family=binomial(logit)</code>.</p>
<p>Le modÃ¨le proprement dit sera renseignÃ© sous la forme dâ€™une formule (MAJ_LIEN). On indiquera dâ€™abord la variable dâ€™intÃ©rÃªt, suivie du signe <kbd>~</kbd> puis de la liste des variables explicatives sÃ©parÃ©es par un signe <kbd>+</kbd>. Enfin, lâ€™argument <code>data</code> permettra dâ€™indiquer notre tableau de donnÃ©es.</p>
<pre class="sourceCode r"><code class="sourceCode r">reg &lt;-<span class="st"> </span><span class="kw">glm</span>(sport ~<span class="st"> </span>sexe +<span class="st"> </span>grpage +<span class="st"> </span>etud +<span class="st"> </span>relig +<span class="st"> </span>heures.tv, 
  <span class="dt">data =</span> d, <span class="dt">family =</span> <span class="kw">binomial</span>(logit))
reg</code></pre>
<pre><code>
Call:  glm(formula = sport ~ sexe + grpage + etud + relig + heures.tv, 
    family = binomial(logit), data = d)

Coefficients:
                     (Intercept)  
                       -0.797364  
                       sexeHomme  
                        0.439002  
                   grpage[25,45)  
                       -0.420306  
                   grpage[45,65)  
                       -1.085463  
                   grpage[65,93]  
                       -1.379274  
                  etudSecondaire  
                        0.948312  
     etudTechnique/Professionnel  
                        1.047156  
                   etudSupÃ©rieur  
                        1.889621  
                          etudNA  
                        2.148545  
     religPratiquant occasionnel  
                       -0.020597  
 religAppartenance sans pratique  
                       -0.006176  
religNi croyance ni appartenance  
                       -0.214067  
                      religRejet  
                       -0.382744  
                religNSP ou NVPR  
                       -0.083361  
                       heures.tv  
                       -0.120724  

Degrees of Freedom: 1992 Total (i.e. Null);  1978 Residual
  (7 observations deleted due to missingness)
Null Deviance:      2607 
Residual Deviance: 2206     AIC: 2236</code></pre>
<div class="info">
Il est possible de spÃ©cifier des modÃ¨les plus complexes. Par exemple, <code>x:y</code> permet dâ€™indiquer lâ€™interaction entre les variables <em>x</em> et <em>y</em>. <code>x * y</code> sera Ã©quivalent Ã  <code>x + y + x:y</code>. Pour aller plus loin, voir <a href="http://ww2.coastal.edu/kingw/statistics/R-tutorials/formulae.html" class="uri">http://ww2.coastal.edu/kingw/statistics/R-tutorials/formulae.html</a>.
</div>
<p>Une prÃ©sentation plus complÃ¨te des rÃ©sultats est obtenue avec la mÃ©thode <code data-package="stats" data-rdocumentation="summary.glm">summary</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(reg)</code></pre>
<pre><code>
Call:
glm(formula = sport ~ sexe + grpage + etud + relig + heures.tv, 
    family = binomial(logit), data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8783  -0.8864  -0.4814   1.0033   2.4202  

Coefficients:
                                  Estimate
(Intercept)                      -0.797364
sexeHomme                         0.439002
grpage[25,45)                    -0.420306
grpage[45,65)                    -1.085463
grpage[65,93]                    -1.379274
etudSecondaire                    0.948312
etudTechnique/Professionnel       1.047156
etudSupÃ©rieur                     1.889621
etudNA                            2.148545
religPratiquant occasionnel      -0.020597
religAppartenance sans pratique  -0.006176
religNi croyance ni appartenance -0.214067
religRejet                       -0.382744
religNSP ou NVPR                 -0.083361
heures.tv                        -0.120724
                                 Std. Error
(Intercept)                        0.323833
sexeHomme                          0.106063
grpage[25,45)                      0.228042
grpage[45,65)                      0.237704
grpage[65,93]                      0.273794
etudSecondaire                     0.197427
etudTechnique/Professionnel        0.189777
etudSupÃ©rieur                      0.195190
etudNA                             0.330198
religPratiquant occasionnel        0.189203
religAppartenance sans pratique    0.174709
religNi croyance ni appartenance   0.193096
religRejet                         0.285878
religNSP ou NVPR                   0.410968
heures.tv                          0.033589
                                 z value Pr(&gt;|z|)
(Intercept)                       -2.462 0.013806
sexeHomme                          4.139 3.49e-05
grpage[25,45)                     -1.843 0.065313
grpage[45,65)                     -4.566 4.96e-06
grpage[65,93]                     -5.038 4.71e-07
etudSecondaire                     4.803 1.56e-06
etudTechnique/Professionnel        5.518 3.43e-08
etudSupÃ©rieur                      9.681  &lt; 2e-16
etudNA                             6.507 7.67e-11
religPratiquant occasionnel       -0.109 0.913311
religAppartenance sans pratique   -0.035 0.971801
religNi croyance ni appartenance  -1.109 0.267600
religRejet                        -1.339 0.180624
religNSP ou NVPR                  -0.203 0.839260
heures.tv                         -3.594 0.000325
                                    
(Intercept)                      *  
sexeHomme                        ***
grpage[25,45)                    .  
grpage[45,65)                    ***
grpage[65,93]                    ***
etudSecondaire                   ***
etudTechnique/Professionnel      ***
etudSupÃ©rieur                    ***
etudNA                           ***
religPratiquant occasionnel         
religAppartenance sans pratique     
religNi croyance ni appartenance    
religRejet                          
religNSP ou NVPR                    
heures.tv                        ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2607.4  on 1992  degrees of freedom
Residual deviance: 2205.9  on 1978  degrees of freedom
  (7 observations deleted due to missingness)
AIC: 2235.9

Number of Fisher Scoring iterations: 4</code></pre>
<p>Dans le cadre dâ€™un modÃ¨le logistique, gÃ©nÃ©ralement on ne prÃ©sente pas les coefficients du modÃ¨le mais leur valeur exponentielle, cette derniÃ¨re correspondant en effet Ã  des <em>odds ratio</em>, Ã©galement appelÃ©s <em>rapports des cotes</em>. Lâ€™odds ratio diffÃ¨re du <em>risque relatif</em>. Cependent son interprÃ©tation est similaire. Un odds ratio de 1 signifie lâ€™absence dâ€™effet. Un odds ratio largement supÃ©rieur Ã  1 correspond Ã  une augmentation du phÃ©nomÃ¨ne Ã©tudiÃ© et un odds ratio largement infÃ©ieur Ã  1 correspond Ã  une diminution du phÃ©nomÃ¨ne Ã©tudiÃ©<a href="#analyses_reglog_fn1" class="footnoteRef" id="analyses_reglog_fnref1"><sup>1</sup></a>.</p>
<p>La fonction <code data-package="stats">coef</code> permet dâ€™obtenir les coefficients dâ€™un modÃ¨le, <code data-package="stats">confint</code> leurs intervalles de confiance et <code data-package="base" data-rdocumentation="log">exp</code> de calculer lâ€™exponentiel. Les odds ratio et leurs intervalles de confiance sâ€™obtiennent ainsiÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(reg))</code></pre>
<pre><code>                     (Intercept) 
                       0.4505151 
                       sexeHomme 
                       1.5511577 
                   grpage[25,45) 
                       0.6568456 
                   grpage[45,65) 
                       0.3377455 
                   grpage[65,93] 
                       0.2517614 
                  etudSecondaire 
                       2.5813476 
     etudTechnique/Professionnel 
                       2.8495358 
                   etudSupÃ©rieur 
                       6.6168632 
                          etudNA 
                       8.5723745 
     religPratiquant occasionnel 
                       0.9796133 
 religAppartenance sans pratique 
                       0.9938431 
religNi croyance ni appartenance 
                       0.8072940 
                      religRejet 
                       0.6819874 
                religNSP ou NVPR 
                       0.9200190 
                       heures.tv 
                       0.8862785 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">confint</span>(reg))</code></pre>
<pre><code>Waiting for profiling to be done...</code></pre>
<pre><code>                                     2.5 %
(Intercept)                      0.2379725
sexeHomme                        1.2605519
grpage[25,45)                    0.4195082
grpage[45,65)                    0.2115297
grpage[65,93]                    0.1466915
etudSecondaire                   1.7613423
etudTechnique/Professionnel      1.9764492
etudSupÃ©rieur                    4.5427464
etudNA                           4.5265421
religPratiquant occasionnel      0.6767575
religAppartenance sans pratique  0.7067055
religNi croyance ni appartenance 0.5531366
religRejet                       0.3872078
religNSP ou NVPR                 0.3998878
heures.tv                        0.8291800
                                     97.5 %
(Intercept)                       0.8480538
sexeHomme                         1.9106855
grpage[25,45)                     1.0275786
grpage[45,65)                     0.5380619
grpage[65,93]                     0.4296919
etudSecondaire                    3.8240276
etudTechnique/Professionnel       4.1639745
etudSupÃ©rieur                     9.7745023
etudNA                           16.5563346
religPratiquant occasionnel       1.4217179
religAppartenance sans pratique   1.4026763
religNi croyance ni appartenance  1.1798422
religRejet                        1.1898605
religNSP ou NVPR                  2.0221544
heures.tv                         0.9459484</code></pre>
<p>On pourra faciliter la lecture en combinant les deuxÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">cbind</span>(<span class="kw">coef</span>(reg), <span class="kw">confint</span>(reg)))</code></pre>
<pre><code>Waiting for profiling to be done...</code></pre>
<pre><code>                                          
(Intercept)                      0.4505151
sexeHomme                        1.5511577
grpage[25,45)                    0.6568456
grpage[45,65)                    0.3377455
grpage[65,93]                    0.2517614
etudSecondaire                   2.5813476
etudTechnique/Professionnel      2.8495358
etudSupÃ©rieur                    6.6168632
etudNA                           8.5723745
religPratiquant occasionnel      0.9796133
religAppartenance sans pratique  0.9938431
religNi croyance ni appartenance 0.8072940
religRejet                       0.6819874
religNSP ou NVPR                 0.9200190
heures.tv                        0.8862785
                                     2.5 %
(Intercept)                      0.2379725
sexeHomme                        1.2605519
grpage[25,45)                    0.4195082
grpage[45,65)                    0.2115297
grpage[65,93]                    0.1466915
etudSecondaire                   1.7613423
etudTechnique/Professionnel      1.9764492
etudSupÃ©rieur                    4.5427464
etudNA                           4.5265421
religPratiquant occasionnel      0.6767575
religAppartenance sans pratique  0.7067055
religNi croyance ni appartenance 0.5531366
religRejet                       0.3872078
religNSP ou NVPR                 0.3998878
heures.tv                        0.8291800
                                     97.5 %
(Intercept)                       0.8480538
sexeHomme                         1.9106855
grpage[25,45)                     1.0275786
grpage[45,65)                     0.5380619
grpage[65,93]                     0.4296919
etudSecondaire                    3.8240276
etudTechnique/Professionnel       4.1639745
etudSupÃ©rieur                     9.7745023
etudNA                           16.5563346
religPratiquant occasionnel       1.4217179
religAppartenance sans pratique   1.4026763
religNi croyance ni appartenance  1.1798422
religRejet                        1.1898605
religNSP ou NVPR                  2.0221544
heures.tv                         0.9459484</code></pre>
<p>Pour savoir si un odds ratio diffÃ¨re significativement de 1 (ce qui est identique au fait que le coefficient soit diffÃ©rent de 0), on pourra se rÃ©fÃ©rer Ã  la colonne <em>Pr(&gt;|z|)</em> obtenue avec <code data-package="stats" data-rdocumentation="summary.glm">summary</code>.</p>
<p>Si vous disposez de lâ€™extension <strong class="package">questionr</strong>, la fonction <code data-pacakge="questionr">odds.ratio</code> permet de calculer directement les odds ratio, leur intervalles de confiance et les p-valueÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">odds.ratio</span>(reg)</code></pre>
<pre><code>Waiting for profiling to be done...</code></pre>
<pre><code>                                    OR 2.5 %
(Intercept)                      0.451 0.238
sexeHomme                        1.551 1.261
grpage[25,45)                    0.657 0.420
grpage[45,65)                    0.338 0.212
grpage[65,93]                    0.252 0.147
etudSecondaire                   2.581 1.761
etudTechnique/Professionnel      2.850 1.976
etudSupÃ©rieur                    6.617 4.543
etudNA                           8.572 4.527
religPratiquant occasionnel      0.980 0.677
religAppartenance sans pratique  0.994 0.707
religNi croyance ni appartenance 0.807 0.553
religRejet                       0.682 0.387
religNSP ou NVPR                 0.920 0.400
heures.tv                        0.886 0.829
                                 97.5 %         p
(Intercept)                       0.848 0.0138062
sexeHomme                         1.911 3.488e-05
grpage[25,45)                     1.028 0.0653132
grpage[45,65)                     0.538 4.961e-06
grpage[65,93]                     0.430 4.713e-07
etudSecondaire                    3.824 1.560e-06
etudTechnique/Professionnel       4.164 3.432e-08
etudSupÃ©rieur                     9.775 &lt; 2.2e-16
etudNA                           16.556 7.674e-11
religPratiquant occasionnel       1.422 0.9133105
religAppartenance sans pratique   1.403 0.9718010
religNi croyance ni appartenance  1.180 0.2675998
religRejet                        1.190 0.1806239
religNSP ou NVPR                  2.022 0.8392596
heures.tv                         0.946 0.0003255
                                    
(Intercept)                      *  
sexeHomme                        ***
grpage[25,45)                    .  
grpage[45,65)                    ***
grpage[65,93]                    ***
etudSecondaire                   ***
etudTechnique/Professionnel      ***
etudSupÃ©rieur                    ***
etudNA                           ***
religPratiquant occasionnel         
religAppartenance sans pratique     
religNi croyance ni appartenance    
religRejet                          
religNSP ou NVPR                    
heures.tv                        ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Lâ€™extension <strong class="package">effects</strong> propose une reprÃ©sentation graphique rÃ©sumant les effets de chaque variable du modÃ¨le. Pour cela, il suffit dâ€™appliquer la mÃ©thode <code data-package="effects" data-rdocumentation="summary.effect">plot</code> au rÃ©sultat de la fonction <code data-package="effects" data-rdocumentation="effect">allEffects</code>. Nous obtenons alors la <a href="#analyses_reglog_reglog_alleffects">figure ci-dessous</a>.</p>
<figure id="analyses_reglog_reglog_alleffects">
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(effects)
<span class="kw">plot</span>(<span class="kw">allEffects</span>(reg))</code></pre>
<img src="images/analyses_reglog/plot_allEffects-1.png" title="" alt="" width="1050"/>
<figcaption>
ReprÃ©sentation graphique de lâ€™effet de chaque variable du modÃ¨le logistique
</figcaption>
</figure>
<p>Une maniÃ¨re de tester la qualitÃ© dâ€™un modÃ¨le est le calcul dâ€™une <em>matrice de confusion</em>, câ€™est-Ã -dire le tableau croisÃ© des valeurs observÃ©es et celles des valeurs prÃ©dites en appliquant le modÃ¨le aux donnÃ©es dâ€™origine.</p>
<p>La mÃ©thode <code data-package="stats" data-rdocumentation="predict.glm">predict</code> avec lâ€™argument <code>type="response"</code> permet dâ€™appliquer notre modÃ¨le logistique Ã  un tableau de donnÃ©es et renvoie pour chaque individu la probabilitÃ© quâ€™il ait vÃ©cu le phÃ©nomÃ¨ne Ã©tudiÃ©.</p>
<pre class="sourceCode r"><code class="sourceCode r">sport.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(reg, <span class="dt">type =</span> <span class="st">"response"</span>, <span class="dt">newdata =</span> d)
<span class="kw">head</span>(sport.pred)</code></pre>
<pre><code>         1          2          3          4 
0.61251214 0.73426878 0.16004519 0.70335574 
         5          6 
0.07318189 0.34841147 </code></pre>
<p>Or notre variable Ã©tudiÃ©e est de type binaire. Nous devons donc transformer nos probabilitÃ©s prÃ©dites en une variable du type Â«Â oui / nonÂ Â». Usuellement, les probabilitÃ©s prÃ©dites seront rÃ©unies en deux groupes selon quâ€™elles soient supÃ©rieures ou infÃ©rieures Ã  la moitiÃ©. La matrice de confusion est alors Ã©gale Ã Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(sport.pred &gt;<span class="st"> </span><span class="fl">0.5</span>, d$sport)</code></pre>
<pre><code>       
         Non  Oui
  FALSE 1074  384
  TRUE   199  336</code></pre>
<p>Nous avons donc 583 (384+199) prÃ©dictions incorrectes sur un total de 1993, soit un taux de mauvais classement de 29,3Â %.</p>
</div>
<div id="analyses_reglog_selection-de-modeles" class="section level2">
<h2>SÃ©lection de modÃ¨les</h2>
<p>Il est toujours tentant lorsque lâ€™on recherche les facteurs associÃ©s Ã  un phÃ©nomÃ¨ne dâ€™inclure un nombre important de variables explicatives potentielles dans un mmodÃ¨le logistique. Cependant, un tel modÃ¨le nâ€™est pas forcÃ©ment le plus efficace et certaines variables nâ€™auront probablement pas dâ€™effet significatif sur la variable dâ€™intÃ©rÃªt.</p>
<p>La technique de <em>sÃ©lection descendante pas Ã  pas</em> est une approche visant Ã  amÃ©liorer son modÃ¨le explicatif<a href="#analyses_reglog_fn2" class="footnoteRef" id="analyses_reglog_fnref2"><sup>2</sup></a>. On rÃ©alise un premier modÃ¨le avec toutes les variables spÃ©cifiÃ©es, puis on regarde sâ€™il est possible dâ€™amÃ©liorer le modÃ¨le en supprimant une des variables du modÃ¨le. Si plusieurs variables permettent dâ€™amÃ©liorer le modÃ¨le, on supprimera la variable dont la suppression amÃ©liorera le plus le modÃ¨le. Puis on recommence le mÃªme procÃ©dÃ© pour voir si la suppression dâ€™une seconde variable peut encore amÃ©liorer le modÃ¨le et ainsi de suite. Lorsque le modÃ¨le ne peut plus Ãªtre amÃ©liorer par la suppresion dâ€™une variable, on sâ€™arrÃªte.</p>
<p>Il faut Ã©galement dÃ©finir un critÃ¨re pour dÃ©terminer la qualitÃ© dâ€™un modÃ¨le. Lâ€™un des plus utilisÃ©s est le <em>Akaike Information Criterion</em> ou AIC. Plus lâ€™AIC sera faible, meilleure sera le modÃ¨le.</p>
<p>La fonction <code data-package="stats">step</code> permet justement de sÃ©lectionner le meilleur modÃ¨le par une procÃ©dure pas Ã  pas descendante basÃ©e sur la minimisation de lâ€™AIC. La fonction affiche Ã  lâ€™Ã©cran les diffÃ©rentes Ã©tapes de la sÃ©lection et renvoie le modÃ¨le final.</p>
<pre class="sourceCode r"><code class="sourceCode r">reg2 &lt;-<span class="st"> </span><span class="kw">step</span>(reg)</code></pre>
<pre><code>Start:  AIC=2235.94
sport ~ sexe + grpage + etud + relig + heures.tv

            Df Deviance    AIC
- relig      5   2210.2 2230.2
&lt;none&gt;           2205.9 2235.9
- heures.tv  1   2219.3 2247.3
- sexe       1   2223.2 2251.2
- grpage     3   2258.7 2282.7
- etud       4   2329.6 2351.6

Step:  AIC=2230.15
sport ~ sexe + grpage + etud + heures.tv

            Df Deviance    AIC
&lt;none&gt;           2210.2 2230.2
- heures.tv  1   2223.7 2241.7
- sexe       1   2226.1 2244.1
- grpage     3   2260.3 2274.3
- etud       4   2333.8 2345.8</code></pre>
<p>Le modÃ¨le initial a un AIC de 2114,8. Ã€ la premiÃ¨re Ã©tape, il apparait que la suppression de la variable religion permet diminuer lâ€™AIC Ã  2109,1. Lors de la seconde Ã©tape, toute suppression dâ€™une autre variable ferait augmenter lâ€™AIC. La procÃ©dure sâ€™arrÃªte donc.</p>
</div>
<div id="analyses_reglog_regression-logistique-multinomiale" class="section level2">
<h2>RÃ©gression logistique multinomiale</h2>
<p>La rÃ©gression logistique multinomiale est une extension de la rÃ©gression logistique aux variables qualitatives Ã  trois modalitÃ©s ou plus. Dans ce cas de figure, chaque modalitÃ© de la variable dâ€™intÃ©rÃªt sera comparÃ©e Ã  la modalitÃ© de rÃ©ference. Les odds ratio seront donc exprimÃ©s par rapport Ã  cette derniÃ¨re.</p>
<p>Nous allons prendre pour exemple la variable <em>trav.satisf</em>, Ã  savoir la satisfaction ou lâ€™insatisfaction au travail.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(d$trav.satisf)</code></pre>
<pre><code>                 n    % val%
Satisfaction   480 24.0 45.8
Insatisfaction 117  5.9 11.2
Equilibre      451 22.6 43.0
NA             952 47.6   NA</code></pre>
<p>Nous allons choisir comme modalitÃ© de rÃ©fÃ©rence la position intermÃ©diaire, Ã  savoir lâ€™Â« Ã©quilibre Â».</p>
<pre class="sourceCode r"><code class="sourceCode r">d$trav.satisf &lt;-<span class="st"> </span><span class="kw">relevel</span>(d$trav.satisf, <span class="st">"Equilibre"</span>)</code></pre>
<p>Enfin, nous allons aussi en profiter pour raccourcir les Ã©tiquettes de la variable <em>trav.imp</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(d$trav.imp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Le plus"</span>, <span class="st">"Aussi"</span>, <span class="st">"Moins"</span>, 
  <span class="st">"Peu"</span>)</code></pre>
<p>Pour calculer un modÃ¨le logistique multinomial, nous allons utiliser la fonction <code data-package="nnet">multinom</code> de lâ€™extension <strong class="package">nnet</strong><a href="#analyses_reglog_fn3" class="footnoteRef" id="analyses_reglog_fnref3"><sup>3</sup></a>. La syntaxe de <code data-package="nnet">multinom</code> est similaire Ã  celle de <code data-package="stats">glm</code>, le paramÃ¨tre <code>family</code> en moins.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nnet)
regm &lt;-<span class="st"> </span><span class="kw">multinom</span>(trav.satisf ~<span class="st"> </span>sexe +<span class="st"> </span>etud +<span class="st"> </span>grpage +<span class="st"> </span>
<span class="st">  </span>trav.imp, <span class="dt">data =</span> d)</code></pre>
<pre><code># weights:  39 (24 variable)
initial  value 1151.345679 
iter  10 value 977.348901
iter  20 value 969.849189
iter  30 value 969.522965
final  value 969.521855 
converged</code></pre>
<p>Comme pour la rÃ©gression logistique, il est possible de rÃ©aliser une sÃ©lection pas Ã  pas descendanteÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">regm2 &lt;-<span class="st"> </span><span class="kw">step</span>(regm)</code></pre>
<pre><code>Start:  AIC=1987.04
trav.satisf ~ sexe + etud + grpage + trav.imp

trying - sexe 
# weights:  36 (22 variable)
initial  value 1151.345679 
iter  10 value 978.538886
iter  20 value 970.453555
iter  30 value 970.294459
final  value 970.293988 
converged
trying - etud 
# weights:  27 (16 variable)
initial  value 1151.345679 
iter  10 value 987.907714
iter  20 value 981.785467
iter  30 value 981.762800
final  value 981.762781 
converged
trying - grpage 
# weights:  30 (18 variable)
initial  value 1151.345679 
iter  10 value 979.485430
iter  20 value 973.175923
final  value 973.172389 
converged
trying - trav.imp 
# weights:  30 (18 variable)
initial  value 1151.345679 
iter  10 value 998.803976
iter  20 value 994.417973
iter  30 value 994.378914
final  value 994.378869 
converged
           Df      AIC
- grpage   18 1982.345
- sexe     22 1984.588
&lt;none&gt;     24 1987.044
- etud     16 1995.526
- trav.imp 18 2024.758
# weights:  30 (18 variable)
initial  value 1151.345679 
iter  10 value 979.485430
iter  20 value 973.175923
final  value 973.172389 
converged

Step:  AIC=1982.34
trav.satisf ~ sexe + etud + trav.imp

trying - sexe 
# weights:  27 (16 variable)
initial  value 1151.345679 
iter  10 value 976.669670
iter  20 value 973.928385
iter  20 value 973.928377
iter  20 value 973.928377
final  value 973.928377 
converged
trying - etud 
# weights:  18 (10 variable)
initial  value 1151.345679 
iter  10 value 988.413720
final  value 985.085797 
converged
trying - trav.imp 
# weights:  21 (12 variable)
initial  value 1151.345679 
iter  10 value 1001.517287
final  value 998.204280 
converged
           Df      AIC
- sexe     16 1979.857
&lt;none&gt;     18 1982.345
- etud     10 1990.172
- trav.imp 12 2020.409
# weights:  27 (16 variable)
initial  value 1151.345679 
iter  10 value 976.669670
iter  20 value 973.928385
iter  20 value 973.928377
iter  20 value 973.928377
final  value 973.928377 
converged

Step:  AIC=1979.86
trav.satisf ~ etud + trav.imp

trying - etud 
# weights:  15 (8 variable)
initial  value 1151.345679 
iter  10 value 986.124104
final  value 986.034023 
converged
trying - trav.imp 
# weights:  18 (10 variable)
initial  value 1151.345679 
iter  10 value 1000.225356
final  value 998.395273 
converged
           Df      AIC
&lt;none&gt;     16 1979.857
- etud      8 1988.068
- trav.imp 10 2016.791</code></pre>
<p>La plupart des fonctions vues prÃ©cÃ©demment fonctionnentÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(regm2)</code></pre>
<pre><code>Call:
multinom(formula = trav.satisf ~ etud + trav.imp, data = d)

Coefficients:
               (Intercept) etudSecondaire
Satisfaction    -0.1110996     0.04916210
Insatisfaction  -1.1213760    -0.09737523
               etudTechnique/Professionnel
Satisfaction                    0.07793241
Insatisfaction                  0.08392603
               etudSupÃ©rieur      etudNA
Satisfaction      0.69950061 -0.53841577
Insatisfaction    0.07755307 -0.04364055
               trav.impAussi trav.impMoins
Satisfaction       0.2578973    -0.1756206
Insatisfaction    -0.2279774    -0.5330349
               trav.impPeu
Satisfaction    -0.5995051
Insatisfaction   1.3401509

Std. Errors:
               (Intercept) etudSecondaire
Satisfaction     0.4520902      0.2635573
Insatisfaction   0.6516992      0.3999875
               etudTechnique/Professionnel
Satisfaction                     0.2408483
Insatisfaction                   0.3579684
               etudSupÃ©rieur    etudNA
Satisfaction       0.2472571 0.5910993
Insatisfaction     0.3831110 0.8407592
               trav.impAussi trav.impMoins
Satisfaction       0.4260623     0.4115818
Insatisfaction     0.6213781     0.5941721
               trav.impPeu
Satisfaction     0.5580115
Insatisfaction   0.6587383

Residual Deviance: 1947.857 
AIC: 1979.857 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">odds.ratio</span>(regm2)</code></pre>
<pre><code>                                              OR
Satisfaction/(Intercept)                   0.895
Satisfaction/etudSecondaire                1.050
Satisfaction/etudTechnique/Professionnel   1.081
Satisfaction/etudSupÃ©rieur                 2.013
Satisfaction/etudNA                        0.584
Satisfaction/trav.impAussi                 1.294
Satisfaction/trav.impMoins                 0.839
Satisfaction/trav.impPeu                   0.549
Insatisfaction/(Intercept)                 0.326
Insatisfaction/etudSecondaire              0.907
Insatisfaction/etudTechnique/Professionnel 1.088
Insatisfaction/etudSupÃ©rieur               1.081
Insatisfaction/etudNA                      0.957
Insatisfaction/trav.impAussi               0.796
Insatisfaction/trav.impMoins               0.587
Insatisfaction/trav.impPeu                 3.820
                                           2.5 %
Satisfaction/(Intercept)                   0.369
Satisfaction/etudSecondaire                0.627
Satisfaction/etudTechnique/Professionnel   0.674
Satisfaction/etudSupÃ©rieur                 1.240
Satisfaction/etudNA                        0.183
Satisfaction/trav.impAussi                 0.561
Satisfaction/trav.impMoins                 0.374
Satisfaction/trav.impPeu                   0.184
Insatisfaction/(Intercept)                 0.091
Insatisfaction/etudSecondaire              0.414
Insatisfaction/etudTechnique/Professionnel 0.539
Insatisfaction/etudSupÃ©rieur               0.510
Insatisfaction/etudNA                      0.184
Insatisfaction/trav.impAussi               0.236
Insatisfaction/trav.impMoins               0.183
Insatisfaction/trav.impPeu                 1.050
                                           97.5 %
Satisfaction/(Intercept)                    2.171
Satisfaction/etudSecondaire                 1.761
Satisfaction/etudTechnique/Professionnel    1.733
Satisfaction/etudSupÃ©rieur                  3.268
Satisfaction/etudNA                         1.859
Satisfaction/trav.impAussi                  2.983
Satisfaction/trav.impMoins                  1.880
Satisfaction/trav.impPeu                    1.639
Insatisfaction/(Intercept)                  1.169
Insatisfaction/etudSecondaire               1.987
Insatisfaction/etudTechnique/Professionnel  2.194
Insatisfaction/etudSupÃ©rieur                2.290
Insatisfaction/etudNA                       4.974
Insatisfaction/trav.impAussi                2.691
Insatisfaction/trav.impMoins                1.880
Insatisfaction/trav.impPeu                 13.891
                                                  p
Satisfaction/(Intercept)                   0.805878
Satisfaction/etudSecondaire                0.852027
Satisfaction/etudTechnique/Professionnel   0.746260
Satisfaction/etudSupÃ©rieur                 0.004669
Satisfaction/etudNA                        0.362363
Satisfaction/trav.impAussi                 0.544977
Satisfaction/trav.impMoins                 0.669600
Satisfaction/trav.impPeu                   0.282661
Insatisfaction/(Intercept)                 0.085306
Insatisfaction/etudSecondaire              0.807660
Insatisfaction/etudTechnique/Professionnel 0.814635
Insatisfaction/etudSupÃ©rieur               0.839581
Insatisfaction/etudNA                      0.958603
Insatisfaction/trav.impAussi               0.713701
Insatisfaction/trav.impMoins               0.369663
Insatisfaction/trav.impPeu                 0.041909
                                             
Satisfaction/(Intercept)                     
Satisfaction/etudSecondaire                  
Satisfaction/etudTechnique/Professionnel     
Satisfaction/etudSupÃ©rieur                 **
Satisfaction/etudNA                          
Satisfaction/trav.impAussi                   
Satisfaction/trav.impMoins                   
Satisfaction/trav.impPeu                     
Insatisfaction/(Intercept)                 . 
Insatisfaction/etudSecondaire                
Insatisfaction/etudTechnique/Professionnel   
Insatisfaction/etudSupÃ©rieur                 
Insatisfaction/etudNA                        
Insatisfaction/trav.impAussi                 
Insatisfaction/trav.impMoins                 
Insatisfaction/trav.impPeu                 * 
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>De mÃªme, il est possible de calculer la matrice de confusionÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(<span class="kw">predict</span>(regm2, <span class="dt">newdata =</span> d), d$trav.satisf)</code></pre>
<pre><code>                
                 Equilibre Satisfaction
  Equilibre            262          211
  Satisfaction         171          258
  Insatisfaction        18           11
                
                 Insatisfaction
  Equilibre                  49
  Satisfaction               45
  Insatisfaction             23</code></pre>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_reglog_fn1"><p>Pour plus de dÃ©tails, voir <a href="http://www.spc.univ-lyon1.fr/polycop/odds%20ratio.htm">http://www.spc.univ-lyon1.fr/polycop/odds%20ratio.htm</a>.<a href="#analyses_reglog_fnref1">â†©</a></p></li>
<li id="analyses_reglog_fn2"><p>Il existe Ã©galement des mÃ©thodes de <em>sÃ©lection ascendante pas Ã  pas</em>, mais nous les aborderons pas ici.<a href="#analyses_reglog_fnref2">â†©</a></p></li>
<li id="analyses_reglog_fn3"><p>Une alternative est dâ€™avoir recours Ã  lâ€™extension <strong class="" package="">mlogit</strong> que nous nâ€™aborderons pas ici. Voir <a href="http://www.ats.ucla.edu/stat/r/dae/mlogit.htm" class="uri">http://www.ats.ucla.edu/stat/r/dae/mlogit.htm</a> (en anglais) pour plus de dÃ©tails.<a href="#analyses_reglog_fnref3">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_donnees_pond">

<div id="analyses_donnees_pond_header">
<h1 class="title">DonnÃ©es pondÃ©rÃ©es</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_donnees_pond_options-de-certaines-fonctions">Options de certaines fonctions</a></li>
<li><a href="#analyses_donnees_pond_fonctions-de-lextension-questionr">Fonctions de lâ€™extension questionr</a></li>
<li><a href="#analyses_donnees_pond_donnees-ponderees-avec-lextension-survey">DonnÃ©es pondÃ©rÃ©es avec lâ€™extension survey</a></li>
<li><a href="#analyses_donnees_pond_definir-un-plan-dechantillonage-complexe-avec-survey">DÃ©finir un plan dâ€™Ã©chantillonage complexe avec survey</a><ul>
<li><a href="#analyses_donnees_pond_differents-types-dechantillonnage">DiffÃ©rents types dâ€™Ã©chantillonnage</a></li>
<li><a href="#analyses_donnees_pond_les-options-de-svydesign">Les options de svydesign</a></li>
<li><a href="#analyses_donnees_pond_extraire-un-sous-echantillon">Extraire un sous-Ã©chantillon</a></li>
</ul></li>
<li><a href="#analyses_donnees_pond_conclusion">Conclusion</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Julien Barnier dans le cadre du support de cours <a href="https://github.com/juba/intro-r">Introduction Ã  R</a>, complÃ©tÃ©e par Joseph Larmarange dans <a href="https://github.com/larmarange/intro-r/tree/CoursM2">Introduction Ã  lâ€™analyse dâ€™enquÃªtes avec R</a>.
</div>
<p>Sâ€™il est tout Ã  fait possible de travailler avec des donnÃ©es pondÃ©rÃ©es sous R, cette fonctionnalitÃ© nâ€™est pas aussi bien intÃ©grÃ©e que dans la plupart des autres logiciels de traitement statistique. En particulier, il y a plusieurs maniÃ¨res possibles de gÃ©rer la pondÃ©ration.</p>
<p>Dans ce qui suit, on utilisera le jeu de donnÃ©es tirÃ© de lâ€™enquÃªte <em>Histoire de vie</em> et notamment sa variable de pondÃ©ration <em>poids</em><a href="#analyses_donnees_pond_fn1" class="footnoteRef" id="analyses_donnees_pond_fnref1"><sup>1</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
<span class="kw">range</span>(d$poids)</code></pre>
<pre><code>[1]    78.07834 31092.14132</code></pre>
<div id="analyses_donnees_pond_options-de-certaines-fonctions" class="section level2">
<h2>Options de certaines fonctions</h2>
<p>Tout dâ€™abord, certaines fonctions de <strong>R</strong> acceptent en argument un vecteur permettant de pondÃ©rer les observations (lâ€™option est en gÃ©nÃ©ral nommÃ©e <code>weights</code> ou <code>row.w</code>). Câ€™est le cas par exemple des mÃ©thodes dâ€™estimation de modÃ¨les linÃ©aires (<code data-package="stats">lm</code>) ou de modÃ¨les linÃ©aires gÃ©nÃ©ralisÃ©s (<code data-package="stats">glm</code>), ou dans les analyses de correspondances<a href="#analyses_donnees_pond_fn2" class="footnoteRef" id="analyses_donnees_pond_fnref2"><sup>2</sup></a> des extensions <strong class="package">ade4</strong> ou <strong class="package">FactoMineR</strong>.</p>
<p>Par contre cette option nâ€™est pas prÃ©sente dans les fonctions de base comme <code data-package="base">mean</code>, <code data-package="base" data-rdocumentation="cor">var</code>, <code data-package="base">table</code> ou <code data-package="stats">chisq.test</code>.</p>
</div>
<div id="analyses_donnees_pond_fonctions-de-lextension-questionr" class="section level2">
<h2>Fonctions de lâ€™extension questionr</h2>
<p>Lâ€™extension <strong class="package">questionr</strong> propose quelques fonctions permettant de calculer des statistiques simples pondÃ©rÃ©es<a href="#analyses_donnees_pond_fn3" class="footnoteRef" id="analyses_donnees_pond_fnref3"><sup>3</sup></a>Â :</p>
<ul>
<li><code data-package="questionr">wtd.mean</code>Â : moyenne pondÃ©rÃ©e</li>
<li><code data-package="questionr" data-rdocumentation="wtd.mean">wtd.var</code>Â : variance pondÃ©rÃ©e</li>
<li><code data-package="questionr">wtd.table</code>Â : tris Ã  plat et tris croisÃ©s pondÃ©rÃ©s</li>
</ul>
<p>On les utilise de la maniÃ¨re suivanteÂ :</p>
<p>library(questionr) mean(d<span class="math"><em>a</em><em>g</em><em>e</em>)<em>w</em><em>t</em><em>d</em>.<em>m</em><em>e</em><em>a</em><em>n</em>(<em>d</em></span>age, weights = d<span class="math"><em>p</em><em>o</em><em>i</em><em>d</em><em>s</em>)<em>w</em><em>t</em><em>d</em>.<em>v</em><em>a</em><em>r</em>(<em>d</em></span>age, weights = d$poids)</p>
<p>Pour les tris Ã  plat, on utilise la fonction wtd.table Ã  laquelle on passe la variable en paramÃ¨treÂ :</p>
<p>wtd.table(d<span class="math"><em>s</em><em>e</em><em>x</em><em>e</em>,â€†<em>w</em><em>e</em><em>i</em><em>g</em><em>h</em><em>t</em><em>s</em>â€„=â€„<em>d</em></span>poids)</p>
<p>Pour un tri croisÃ©, il suffit de passer deux variables en paramÃ¨tresÂ :</p>
<p>wtd.table(d<span class="math"><em>s</em><em>e</em><em>x</em><em>e</em>,â€†<em>d</em></span>hard.rock, weights = d$poids)</p>
<p>Ces fonctions admettent notamment les deux options suivantesÂ :</p>
<ul>
<li><code>na.rm</code>Â : si <code>TRUE</code>, on ne conserve que les observations sans valeur manquante.</li>
<li><code>normwt</code>Â : si <code>TRUE</code>, on normalise les poids pour que les effectifs totaux pondÃ©rÃ©s soient les mÃªmes que les effectifs initiaux. Il faut utiliser cette option, notamment si on souhaite appliquer un test sensible aux effectifs comme le Ï‡Â².</li>
</ul>
<p>Ces fonctions rendent possibles lâ€™utilisation des statistiques descriptives les plus simples et le traitement des tableaux croisÃ©s (les fonctions <code data-package="questionr" data-rdocumentation="rprop">lprop</code>, <code data-package="questionr">cprop</code> ou <code data-package="stats">chisq.test</code> peuvent Ãªtre appliquÃ©es au rÃ©sultat dâ€™un <code data-package="questionr">wtd.table</code>) mais restent limitÃ©es en termes de tests statistiques ou de graphiques. . .</p>
</div>
<div id="analyses_donnees_pond_donnees-ponderees-avec-lextension-survey" class="section level2">
<h2>DonnÃ©es pondÃ©rÃ©es avec lâ€™extension survey</h2>
<p>Lâ€™extension <strong class="package">survey</strong> est spÃ©cialement dÃ©diÃ©e au traitement dâ€™enquÃªtes ayant des techniques dâ€™Ã©chantillonnage et de pondÃ©ration potentiellement trÃ¨s complexes.</p>
<p>Lâ€™extension sâ€™installe comme la plupart des autresÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"survey"</span>)</code></pre>
<p>Le site officiel (en anglais) comporte beaucoup dâ€™informations, mais pas forcÃ©ment trÃ¨s accessiblesÂ : <a href="http://faculty.washington.edu/tlumley/survey/" class="uri">http://faculty.washington.edu/tlumley/survey/</a>.</p>
<p>Pour utiliser les fonctionnalitÃ©s de lâ€™extension, on doit dâ€™abord dÃ©finir le <em>plan dâ€™Ã©chantillonnage</em> ou <em>design</em> de notre enquÃªte. Câ€™est-Ã -dire indiquer quel type de pondÃ©ration nous souhaitons lui appliquer.</p>
<p>Dans notre cas nous utilisons plan dâ€™Ã©chantillonnage le plus simple, avec une variable de pondÃ©ration dÃ©jÃ  calculÃ©e. Ceci se fait Ã  lâ€™aide de la fonction <code data-package="survey">svydesign</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survey)
dw &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~<span class="dv">1</span>, <span class="dt">data =</span> d, <span class="dt">weights =</span> ~d$poids)</code></pre>
<p>Cette fonction crÃ©e un nouvel objet, que nous avons nommÃ© <code>dw</code>. Cet objet nâ€™est pas Ã  proprement parler un tableau de donnÃ©es, mais plutÃ´t un tableau de donnÃ©es plus une mÃ©thode de pondÃ©ration. <code>dw</code> et <code>d</code> sont des objets distincts, les opÃ©rations effectuÃ©es sur lâ€™un nâ€™ont pas dâ€™influence sur lâ€™autre. On peut cependant retrouver le contenu de <code>d</code> depuis <code>dw</code> en utilisant <code>dw$variables</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(d$age)</code></pre>
<pre><code>[1] 48.157</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(dw$variables$age)</code></pre>
<pre><code>[1] 48.157</code></pre>
<p>Lorsque notre plan dâ€™Ã©chantillonnage est dÃ©clarÃ©, on peut lui appliquer une sÃ©rie de fonctions permettant dâ€™effectuer diverses opÃ©rations statistiques en tenant compte de la pondÃ©ration. On citera notammentÂ :</p>
<ul>
<li><code data-package="survey" data-rdocumentation="surveysummary">svymean</code>, <code data-package="survey" data-rdocumentation="surveysummary">svyvar</code>, <code data-package="survey" data-rdocumentation="surveysummary">svytotal</code>, <code data-package="survey">svyquantile</code>Â : statistiques univariÃ©es</li>
<li><code data-package="survey">svytable</code>Â : tableaux croisÃ©s</li>
<li><code data-pacakge="survey" data-rdocumentation="svytable">svychisq</code>Â : test du Ï‡Â²</li>
<li><code data-package="survey">svyby</code>Â : statistiques selon un facteur</li>
<li><code data-package="survey">svyttest</code>Â : test <em>t</em> de comparaison de moyennes</li>
<li><code data-pacakge="survey">svyglm</code>Â : modÃ¨les linÃ©aires gÃ©nÃ©ralisÃ©s (dont rÃ©gression logistique)</li>
<li><code data-package="survey">svyplot</code>, <code data-package="survey">svyhist</code>, <code data-package="survey" data-rdocumentation="svyhist">svyboxplot</code>Â : fonctions graphiques</li>
</ul>
<p>Dâ€™autres fonctions sont disponibles, comme <code data-package="survey">svyratio</code>, mais elles ne seront pas abordÃ©es ici.</p>
<p>Pour ne rien arranger, ces fonctions prennent leurs arguments sous forme de formules, câ€™est-Ã -dire pas de la maniÃ¨re habituelle. En gÃ©nÃ©ral lâ€™appel de fonction se fait en spÃ©cifiant dâ€™abord les variables dâ€™intÃ©rÃªt sous forme de formule, puis lâ€™objet <em>survey.design</em>.</p>
<p>Lâ€™intervalle de confiance dâ€™une moyenne sâ€™obtient avec <code data-package="survey" data-rdocumentation="surveysummary">confint</code> et celui dâ€™une proportion avec <code data-package="survey">svyciprop</code>.</p>
<p>Voyons tout de suite quelques exemples<a href="#analyses_donnees_pond_fn4" class="footnoteRef" id="analyses_donnees_pond_fnref4"><sup>4</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svymean</span>(~age, dw)</code></pre>
<pre><code>      mean     SE
age 46.347 0.5284</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(<span class="kw">svymean</span>(~age, dw))  <span class="co"># Intervalle de confiance</span></code></pre>
<pre><code>      2.5 %   97.5 %
age 45.3117 47.38282</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyquantile</span>(~age, dw, <span class="dt">quantile =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>), 
  <span class="dt">ci =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>$quantiles
    0.25 0.5 0.75
age   31  45   60

$CIs
, , age

       0.25 0.5 0.75
(lower   30  43   58
upper)   32  47   62</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyvar</span>(~heures.tv, dw, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>          variance     SE
heures.tv   2.9886 0.1836</code></pre>
<p>Pour comparer deux moyennes Ã  lâ€™aide dâ€™un test <em>t</em> on aura recours Ã  <code data-package="survey">svyttest</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyttest</span>(age ~<span class="st"> </span>sexe, dw)</code></pre>
<pre><code>
    Design-based t-test

data:  age ~ sexe
t = 2.0404, df = 1998, p-value = 0.04144
alternative hypothesis: true difference in mean is not equal to 0
sample estimates:
difference in mean 
          2.141129 </code></pre>
<p>Les tris Ã  plat se dÃ©clarent en passant comme argument le nom de la variable prÃ©cÃ©dÃ© dâ€™un tilde (<code>Â˜</code>), tandis que les tableaux croisÃ©s utilisent les noms des deux variables sÃ©parÃ©s par un signe plus (<code>+</code>) et prÃ©cÃ©dÃ©s par un tilde (<code>Â˜</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svytable</span>(~sexe, dw)</code></pre>
<pre><code>sexe
  Homme   Femme 
5149382 5921844 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyciprop</span>(~sexe, dw)  <span class="co"># Intervalle de confiance</span></code></pre>
<pre><code>            2.5% 97.5%
sexe 0.535 0.507  0.56</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svytable</span>(~sexe +<span class="st"> </span>clso, dw)</code></pre>
<pre><code>       clso
sexe           Oui        Non Ne sait pas
  Homme 2658744.04 2418187.64    72450.75
  Femme 2602031.76 3242389.36    77422.79</code></pre>
<p>On peut rÃ©cupÃ©rer le tableau issu de <code data-package="survey">svytable</code> dans un objet et le rÃ©utiliser ensuite comme nâ€™importe quel tableau croisÃ©Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">svytable</span>(~sexe +<span class="st"> </span>clso, dw)
tab</code></pre>
<pre><code>       clso
sexe           Oui        Non Ne sait pas
  Homme 2658744.04 2418187.64    72450.75
  Femme 2602031.76 3242389.36    77422.79</code></pre>
<p>Les fonctions <code data-package="questionr" data-rdocumentation="rprop">lprop</code> et <code data-package="questionr">cprop</code> de <strong class="package">questionr</strong> sont donc tout Ã  fait compatibles avec lâ€™utilisation de <strong class="package">survey</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lprop</span>(tab)</code></pre>
<pre><code>          clso
sexe       Oui   Non   Ne sait pas Total
  Homme     51.6  47.0   1.4       100.0
  Femme     43.9  54.8   1.3       100.0
  Ensemble  47.5  51.1   1.4       100.0</code></pre>
<p>La fonction <code data-package="questionr">freq</code> peut Ã©galement Ãªtre utilisÃ©e si on lui passe en argument non pas la variable elle-mÃªme, mais son tri Ã  plat obtenu avec <code data-package="survey">svytable</code>svychisq(~sexe + clso, dw):</p>
<pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">svytable</span>(~peche.chasse, dw)
<span class="kw">freq</span>(tab, <span class="dt">total =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>             n     %  val%
Non    9716683  87.8  87.8
Oui    1354544  12.2  12.2
Total 11071226 100.0 100.0</code></pre>
<p>Par contre, il ne faut pas utiliser <code data-package="stats">chisq.test</code> sur un tableau gÃ©nÃ©rÃ© par <code>svytable</code>{data-package=â€œsurveyâ€&gt;. Les effectifs Ã©tant extrapolÃ©s Ã  partir de la pondÃ©ration, les rÃ©sultats du test seraient complÃ¨tement faussÃ©s. Si on veut faire un test du Ï‡Â² sur un tableau croisÃ© pondÃ©rÃ©, il faut utiliser <code data-package="survey" data-rdocumentation="svytable">svychisq</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svychisq</span>(~sexe +<span class="st"> </span>clso, dw)</code></pre>
<pre><code>
    Pearson's X^2: Rao &amp; Scott adjustment

data:  svychisq(~sexe + clso, dw)
F = 3.3331, ndf = 1.9734, ddf = 3944.9000,
p-value = 0.03641</code></pre>
<p>Le principe de la fonction <code data-pacakge="survey">svyby</code> est similaire Ã  celui de <code data-package="base">tapply</code><a href="#analyses_donnees_pond_fn5" class="footnoteRef" id="analyses_donnees_pond_fnref5"><sup>5</sup></a>. Elle permet de calculer des statistiques selon plusieurs sous-groupes dÃ©finis par un facteur. Par exempleÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyby</span>(~age, ~sexe, dw, svymean)</code></pre>
<pre><code>       sexe      age        se
Homme Homme 45.20200 0.7419450
Femme Femme 47.34313 0.7420836</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(<span class="kw">svyby</span>(~age, ~sexe, dw, svymean))  <span class="co"># Intervalles de confiance</span></code></pre>
<pre><code>         2.5 %   97.5 %
Homme 43.74781 46.65618
Femme 45.88867 48.79758</code></pre>
<p><strong class="package">survey</strong> est Ã©galement capable de produire des graphiques Ã  partir des donnÃ©es pondÃ©rÃ©es. Quelques exemplesÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">svyplot</span>(~age +<span class="st"> </span>heures.tv, dw, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">main =</span> <span class="st">"Bubble plot"</span>)
<span class="kw">svyhist</span>(~heures.tv, dw, <span class="dt">col =</span> <span class="st">"peachpuff"</span>, <span class="dt">main =</span> <span class="st">"Histogramme"</span>)
<span class="kw">svyboxplot</span>(age ~<span class="st"> </span><span class="dv">1</span>, dw, <span class="dt">main =</span> <span class="st">"Boxplot simple"</span>, <span class="dt">ylab =</span> <span class="st">"Ã‚ge"</span>)
<span class="kw">svyboxplot</span>(age ~<span class="st"> </span>sexe, dw, <span class="dt">main =</span> <span class="st">"Boxplot double"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Ã‚ge"</span>, <span class="dt">xlab =</span> <span class="st">"Sexe"</span>)</code></pre>
<img src="images/analyses_donnees_pond/unnamed-chunk-13-1.png" title="" alt="" width="1050"/>
<figcaption>
Fonctions graphiques de lâ€™extension survey
</figcaption>
</figure>
<p>Enfin, <strong class="package">survey</strong> fournit une fonction <code data-package="survey">svyglm</code> permettant de calculer un modÃ¨le statistique tout en prenant en compte le plan dâ€™Ã©chantillonnage spÃ©cifiÃ©. La syntaxe de <code data-package="survey">svyglm</code> est proche de celle de <code data-package="stats">glm</code>. Cependant, le cadre dâ€™une rÃ©gression logistique, il est nÃ©cessaire dâ€™utiliser <code>family = quasibinomial()</code> afin dâ€™Ã©viter un message dâ€™erreur indiquant un nombre non entier de succÃ¨sÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">reg &lt;-<span class="st"> </span><span class="kw">svyglm</span>(sport ~<span class="st"> </span>sexe +<span class="st"> </span>age +<span class="st"> </span>relig +<span class="st"> </span>heures.tv, 
  dw, <span class="dt">family =</span> <span class="kw">binomial</span>())</code></pre>
<pre><code>Warning: non-integer #successes in a binomial glm!</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">reg &lt;-<span class="st"> </span><span class="kw">svyglm</span>(sport ~<span class="st"> </span>sexe +<span class="st"> </span>age +<span class="st"> </span>relig +<span class="st"> </span>heures.tv, 
  dw, <span class="dt">family =</span> <span class="kw">quasibinomial</span>())
reg</code></pre>
<pre><code>Independent Sampling design (with replacement)
svydesign(ids = ~1, data = d, weights = ~d$poids)

Call:  svyglm(formula = sport ~ sexe + age + relig + heures.tv, dw, 
    family = quasibinomial())

Coefficients:
                     (Intercept)  
                         1.90117  
                       sexeFemme  
                        -0.36526  
                             age  
                        -0.04127  
     religPratiquant occasionnel  
                         0.05577  
 religAppartenance sans pratique  
                         0.16367  
religNi croyance ni appartenance  
                         0.03988  
                      religRejet  
                        -0.14862  
                religNSP ou NVPR  
                        -0.22682  
                       heures.tv  
                        -0.18204  

Degrees of Freedom: 1994 Total (i.e. Null);  1986 Residual
  (5 observations deleted due to missingness)
Null Deviance:      2672 
Residual Deviance: 2378     AIC: NA</code></pre>
<p>Le rÃ©sultat obtenu est similaire Ã  celui de <code data-package="stats">glm</code> et lâ€™on peut utiliser sans problÃ¨me les fonctions <code data-package="survey" data-rdocumentation="svyglm">coef</code>, <code data-package="survey" data-rdocumentation="confint.glm">confint</code>, <code data-package="questionr">odds.ratio</code> ou <code data-package="survey" data-rdocumentation="svyglm">predict</code> abordÃ©es dans le chapitre sur la <a href="#analyses_reglog">rÃ©gression logistique</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">odds.ratio</span>(reg)</code></pre>
<pre><code>                                    OR 2.5 %
(Intercept)                      6.694 3.670
sexeFemme                        0.694 0.540
age                              0.960 0.952
religPratiquant occasionnel      1.057 0.659
religAppartenance sans pratique  1.178 0.759
religNi croyance ni appartenance 1.041 0.646
religRejet                       0.862 0.428
religNSP ou NVPR                 0.797 0.325
heures.tv                        0.834 0.770
                                 97.5 %         p
(Intercept)                      12.209 6.848e-10
sexeFemme                         0.892  0.004325
age                               0.967 &lt; 2.2e-16
religPratiquant occasionnel       1.696  0.817180
religAppartenance sans pratique   1.827  0.465321
religNi croyance ni appartenance  1.676  0.869658
religRejet                        1.738  0.677858
religNSP ou NVPR                  1.956  0.620504
heures.tv                         0.902 6.786e-06
                                    
(Intercept)                      ***
sexeFemme                        ** 
age                              ***
religPratiquant occasionnel         
religAppartenance sans pratique     
religNi croyance ni appartenance    
religRejet                          
religNSP ou NVPR                    
heures.tv                        ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Dans ses derniÃ¨res versions, <strong class="package">survey</strong> fournit une mÃ©thode <code data-package="survey" data-rdocumentation="anova.svyglm">AIC.svyglm</code> permettant dâ€™estimer un AIC sur un modÃ¨le calculÃ© avec <code data-package="survey">svyglm</code>. Il est dÃ¨s lors possible dâ€™utiliser la fonction <code data-package="stats">step</code> pour rÃ©aliser une <em>sÃ©lection descendante pas Ã  pas</em>.</p>
<p>Lâ€™extension <strong class="package">effects</strong> nâ€™est quant Ã  elle pas compatible avec <code data-package="survey">svyglm</code><a href="#analyses_donnees_pond_fn6" class="footnoteRef" id="analyses_donnees_pond_fnref6"><sup>6</sup></a>.</p>
</div>
<div id="analyses_donnees_pond_definir-un-plan-dechantillonage-complexe-avec-survey" class="section level2">
<h2>DÃ©finir un plan dâ€™Ã©chantillonage complexe avec survey</h2>
<p>Lâ€™extension <strong class="package">survey</strong> ne permet pas seulement dâ€™indiquer une variable de pondÃ©ration mais Ã©galement de prendre les spÃ©cificitÃ©s du plan dâ€™Ã©chantillonnage (strates, grappes, â€¦). Le plan dâ€™Ã©chantillonnage ne joue pas seulement sur la pondÃ©ration des donnÃ©es, mais influence le calcul des variances et par ricochet tous les tests statistiques. Deux Ã©chantillons identiques avec la mÃªme variable de pondÃ©ration mais des designs diffÃ©rents produiront les mÃªmes moyennes et proportions mais des intervalles de confiance diffÃ©rents.</p>
<div id="analyses_donnees_pond_differents-types-dechantillonnage" class="section level3">
<h3>DiffÃ©rents types dâ€™Ã©chantillonnage</h3>
<p>Lâ€™<em>Ã©chantillonnage alÃ©atoire simple</em> ou <em>Ã©chantillonnage Ã©quiprobable</em> est une mÃ©thode pour laquelle tous les Ã©chantillons possibles (de mÃªme taille) ont la mÃªme probabilitÃ© dâ€™Ãªtre choisis et tous les Ã©lÃ©ments de la population ont une chance Ã©gale de faire partie de lâ€™Ã©chantillon. Câ€™est lâ€™Ã©chantillonnage le plus simpleÂ : chaque individu Ã  la mÃªme probabilitÃ© dâ€™Ãªtre sÃ©lectionnÃ©.</p>
<p>Lâ€™<em>Ã©chantillonnage stratifiÃ©</em> est une mÃ©thode qui consiste dâ€™abord Ã  subdiviser la population en groupes homogÃ¨nes (strates) pour ensuite extraire un Ã©chantillon alÃ©atoire de chaque strate. Cette mÃ©thode suppose la connaissance de la structure de la population. Pour estimer les paramÃ¨tres, les rÃ©sultats doivent Ãªtre pondÃ©rÃ©s par lâ€™importance relative de chaque strate dans la population.</p>
<p>Lâ€™<em>Ã©chantillonnage par grappes</em> est une mÃ©thode qui consiste Ã  choisir un Ã©chantillon alÃ©atoire dâ€™unitÃ©s qui sont elles-mÃªmes des sous-ensembles de la population (Â«Â grappesÂ Â»). Cette mÃ©thode suppose que les unitÃ©s de chaque grappe sont reprÃ©sentatives. Elle possÃ¨de lâ€™avantage dâ€™Ãªtre souvent plus Ã©conomique.</p>
<p>Il est possible de combiner plusieurs de ces approches. Par exemple, les *EnquÃªtes DÃ©mographiques et de SantÃ©<a href="#analyses_donnees_pond_fn7" class="footnoteRef" id="analyses_donnees_pond_fnref7"><sup>7</sup></a> (EDS) sont des enquÃªtes stratifiÃ©es en grappes Ã  deux degrÃ©s. Dans un premier temps, la population est divisÃ©e en strates par rÃ©gion et milieu de rÃ©sidence. Dans chaque strate, des zones dâ€™enquÃªtes, correspondant Ã  des unitÃ©s de recensement, sont tirÃ©es au sort avec une probabilitÃ© proportionnelle au nombre de mÃ©nages de chaque zone au dernier recensement de population. Enfin, au sein de chaque zone dâ€™enquÃªte sÃ©lectionnÃ©e, un recensement de lâ€™ensemble des mÃ©nages est effectuÃ© puis un nombre identique de mÃ©nages par zone dâ€™enquÃªte est tirÃ© au sort de maniÃ¨re alÃ©toire simple.</p>
</div>
<div id="analyses_donnees_pond_les-options-de-svydesign" class="section level3">
<h3>Les options de svydesign</h3>
<p>La fonction <code data-package="survey">svydesign</code> accepte plusieus arguments dÃ©crits sur sa page dâ€™aide (obtenue avec la commande <code>?svydesign</code>).</p>
<p>Lâ€™agument <code>data</code> permet de spÃ©cifier le tableau de donnÃ©es contenant les observations.</p>
<p>Lâ€™argument <code>ids</code> est obligatoire et spÃ©cifie sous la forme dâ€™une formule les identifiants des diffÃ©rents niveaux dâ€™un tirage en grappe. Sâ€™il sâ€™agit dâ€™un Ã©chantillon alÃ©atoire simple, on entrera <code>ids=Â˜1</code>. Autre situationÂ : supposons une Ã©tude portant sur la population franÃ§aise. Dans un premier temps, on a tirÃ© au sort un certain nombre de dÃ©partements franÃ§ais. Dans un second temps, on tire au sort dans chaque dÃ©partement des communes. Dans chaque commune sÃ©lectionnÃ©e, on tire au sort des quartiers. Enfin, on interroge de maniÃ¨re exhaustive toutes les personnes habitant les quartiers enquÃªtÃ©s. Notre fichier de donnÃ©es devra donc comporter pour chaque observation les variables <em>id_departement</em>, <em>id_commune</em> et <em>id_quartier</em>. On Ã©crira alors pour lâ€™argument <code>ids</code> la valeur suivanteÂ : <code>ids=Â˜id_departement+id_commune+id_quartier</code>.</p>
<p>Si lâ€™Ã©chantillon est stratifiÃ©, on spÃ©cifiera les strates Ã  lâ€™aide de lâ€™argument <code>strata</code> en spÃ©cifiant la variable contenant lâ€™identifiant des strates. Par exempleÂ : <code>strata=Â˜id_strate</code>.</p>
<p>Il faut encore spÃ©cifier les probabilitÃ©s de tirage de chaque cluster ou bien la pondÃ©ration des individus. Si lâ€™on dispose de la probabilitÃ© de chaque observation dâ€™Ãªtre sÃ©lectionnÃ©e, on utilisera lâ€™argument <code>probs</code>. Si, par contre, on connaÃ®t la pondÃ©ration de chaque observation (qui doit Ãªtre proportionnelle Ã  lâ€™inverse de cette probabilitÃ©), on utilisera lâ€™argument <code>weights</code>.</p>
<p>Si lâ€™Ã©chantillon est stratifiÃ©, quâ€™au sein de chaque strate les individus ont Ã©tÃ© tirÃ©s au sort de maniÃ¨re alÃ©atoire et que lâ€™on connaÃ®t la taille de chaque strate, il est possible de ne pas avoir Ã  spÃ©cifier la probabilitÃ© de tirage ou la pondÃ©ration de chaque observation. Il est prÃ©fÃ©rable de fournir une variable contenant la taille de chaque strate Ã  lâ€™argument <code>fpc</code>. De plus, dans ce cas-lÃ , une petite correction sera appliquÃ©e au modÃ¨le pour prendre en compte la taille finie de chaque strate.</p>
<p>Quelques exemplesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Ã‰chantillonnage alÃ©atoire simple</span>
plan &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~<span class="dv">1</span>, <span class="dt">data =</span> donnees)

<span class="co"># Ã‰chantillonnage stratifiÃ© Ã  un seul niveau (la</span>
<span class="co"># taille de chaque strate est connue)</span>
plan &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~<span class="dv">1</span>, <span class="dt">data =</span> donnees, <span class="dt">fpc =</span> ~taille)

<span class="co"># Ã‰chantillonnage en grappes avec tirages Ã  quatre</span>
<span class="co"># degrÃ©s (departement, commune, quartier,</span>
<span class="co"># individus). La probabilitÃ© de tirage de chaque</span>
<span class="co"># niveau de cluster est connue.</span>
plan &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~id_departement +<span class="st"> </span>id_commune +<span class="st"> </span>
<span class="st">  </span>id_quartier, <span class="dt">data =</span> donnees, <span class="dt">Probs =</span> ~proba_departement +<span class="st"> </span>
<span class="st">  </span>proba_commune +<span class="st"> </span>proba_quartier)

<span class="co"># Ã‰chantillonnage stratifiÃ© avec tirage Ã  deux</span>
<span class="co"># degrÃ©s (clusters et individus). Le poids</span>
<span class="co"># statistiques de chaque observation est connu.</span>
plan &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~id_cluster, <span class="dt">data =</span> donnees, 
  <span class="dt">strata =</span> ~id_strate, <span class="dt">weights =</span> ~poids)</code></pre>
<p>Prenons lâ€™exemple dâ€™une enquÃªte dÃ©mographique et de santÃ©. Le nom des diffÃ©rentes variables est standardisÃ© et commun quelle que soit lâ€™enquÃªte. Nous supposerons que vous avez importÃ© le fichier <em>individus</em> dans un tableau de donnÃ©es nommÃ©s <code>eds</code>. Le poids statistique de chaque individu est fourni par la variable <em>V005</em> qui doit au prÃ©alable Ãªtre divisÃ©e par un million. Les grappes dâ€™Ã©chantillonnage au premier degrÃ© sont fournies par la variable <em>V021 (primary sample unit)</em>. Si elle nâ€™est pas renseignÃ©e, on pourra utilisier le numÃ©ro de grappe <em>V001</em>. Enfin, le milieu de rÃ©sidence (urbain / rural) est fourni par <em>V025</em> et la rÃ©gion par <em>V024</em>. Pour rappel, lâ€™Ã©chantillon a Ã©tÃ© stratifiÃ© Ã  la fois par rÃ©gion et par mileu de rÃ©sidence. Certaines enquÃªtes fournissent directement un numÃ©ro de strate via <em>V022</em>. Si tel est le cas, on pourra prÃ©ciser le plan dâ€™Ã©chantillonnage ainsiÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">eds$poids &lt;-<span class="st"> </span>eds$V005/<span class="fl">1e+06</span>
design.eds &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~V021, <span class="dt">data =</span> eds, <span class="dt">strata =</span> ~V022, 
  <span class="dt">weights =</span> ~poids)</code></pre>
<p>Si V022 nâ€™est pas fourni mais que lâ€™enquÃªte a bien Ã©tÃ© stratifiÃ© par rÃ©gion et milieu de rÃ©sidence (vÃ©rifiez toujours le premier chapitre du rapport dâ€™enquÃªte), on pourra crÃ©er une variable strate ainsi <a href="#analyses_donnees_pond_fn8" class="footnoteRef" id="analyses_donnees_pond_fnref8"><sup>8</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">eds$strate &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">as.integer</span>(eds$V024) *<span class="st"> </span><span class="dv">10</span> +<span class="st"> </span>
<span class="st">  </span><span class="kw">as.integer</span>(eds$V025))
<span class="kw">levels</span>(eds$strate) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste</span>(<span class="kw">levels</span>(eds$V024), <span class="st">"Urbain"</span>), 
  <span class="kw">paste</span>(<span class="kw">levels</span>(eds$V024), <span class="st">"Rural"</span>))
design.eds &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~V021, <span class="dt">data =</span> eds, <span class="dt">strata =</span> ~strate, 
  <span class="dt">weights =</span> ~poids)</code></pre>
</div>
<div id="analyses_donnees_pond_extraire-un-sous-echantillon" class="section level3">
<h3>Extraire un sous-Ã©chantillon</h3>
<p>Si lâ€™on souhaite travailler sur un sous-Ã©chantillon tout en gardant les informations dâ€™Ã©chantillonnage, on utilisera la fonction <code data-package="survey" data-rdocumentation="subset.survey.design">subset</code> prÃ©sentÃ©e en dÃ©tail dans le chapitre <a href="#pem_manipulation_subset">Manipulation de donnÃ©es</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">sous &lt;-<span class="st"> </span><span class="kw">subset</span>(dw, sexe ==<span class="st"> "Femme"</span> &amp;<span class="st"> </span>age &gt;=<span class="st"> </span><span class="dv">40</span>)</code></pre>
</div>
</div>
<div id="analyses_donnees_pond_conclusion" class="section level2">
<h2>Conclusion</h2>
<p>En attendant mieux, la gestion de la pondÃ©ration sous <strong>R</strong> nâ€™est sans doute pas ce qui se fait de plus pratique et de plus simple. On pourra quand mÃªme donner les conseils suivantsÂ :</p>
<ul>
<li>utiliser les options de pondÃ©ration des fonctions usuelles ou les fonctions dâ€™extensions comme <strong class="package">questionr</strong> pour les cas les plus simplesÂ ;</li>
<li>si on utilise <strong class="package">survey</strong>, effectuer autant que possible tous les recodages et manipulations sur les donnÃ©es non pondÃ©rÃ©esÂ ;</li>
<li>une fois les recodages effectuÃ©s, on dÃ©clare le design et on fait les analyses en tenant compte de la pondÃ©rationÂ ;</li>
<li>surtout ne jamais modifier les variables du design. Toujours effectuer recodages et manipulations sur les donnÃ©es non pondÃ©rÃ©es, puis redÃ©clarer le design pour que les mises Ã  jour effectuÃ©es soient disponibles pour lâ€™analyse.</li>
</ul>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_donnees_pond_fn1"><p>On notera que cette variable est utilisÃ©e Ã  titre purement illustratif. Le jeu de donnÃ©es Ã©tant un extrait dâ€™enquÃªte et la variable de pondÃ©ration nâ€™ayant pas Ã©tÃ© recalculÃ©e, elle nâ€™a ici Ã  proprement parler aucun sens.<a href="#analyses_donnees_pond_fnref1">â†©</a></p></li>
<li id="analyses_donnees_pond_fn2"><p>Voir le chapitre dÃ©diÃ© Ã  lâ€™analyse des correspondances, MAJ LIEN.<a href="#analyses_donnees_pond_fnref2">â†©</a></p></li>
<li id="analyses_donnees_pond_fn3"><p>Les fonctions <code data-package="questionr">wtd.mean</code> et <code data-package="questionr" data-rdocumentation="wtd.mean">wtd.var</code> sont des copies conformes des fonctions du mÃªme nom de lâ€™extension <strong class="package">Hmisc</strong> de Frank Harrel. <strong class="package">Hmisc</strong> Ã©tant une extension Â«Â de tailleÂ Â», on a prÃ©fÃ©rÃ© recopiÃ© les fonctions pour limiter le poids des dÃ©pendances.<a href="#analyses_donnees_pond_fnref3">â†©</a></p></li>
<li id="analyses_donnees_pond_fn4"><p>Pour dâ€™autres exemples, voir <a href="http://www.ats.ucla.edu/stat/r/faq/svy_r_oscluster.htm" class="uri">http://www.ats.ucla.edu/stat/r/faq/svy_r_oscluster.htm</a> (en anglais).<a href="#analyses_donnees_pond_fnref4">â†©</a></p></li>
<li id="analyses_donnees_pond_fn5"><p>La fonction <code data-package="base">tapply</code> est prÃ©sentÃ©e plus en dÃ©tails dans le chapitre <a href="#pem_manipulation_tapply">Manipulation de donnÃ©es</a>.<a href="#analyses_donnees_pond_fnref5">â†©</a></p></li>
<li id="analyses_donnees_pond_fn6"><p>CompatibilitÃ© qui pourra Ã©ventuellement Ãªtre introduite dans une future version de lâ€™extension.<a href="#analyses_donnees_pond_fnref6">â†©</a></p></li>
<li id="analyses_donnees_pond_fn7"><p>Vaste programme dâ€™enquÃªtes rÃ©alisÃ©es Ã  intervalles rÃ©guliers dans les pays en dÃ©velopâ€™ent, disponibles sur <a href="http://www.dhsprogram.com/" class="uri">http://www.dhsprogram.com/</a>.<a href="#analyses_donnees_pond_fnref7">â†©</a></p></li>
<li id="analyses_donnees_pond_fn8"><p>Lâ€™astuce consiste Ã  utiliser as.integer pour obetnir le code des facteurs et non leur valeur textuelle. Lâ€™addition des deux valeurs aprÃ¨s multiplication du code de la rÃ©gion par 10 permet dâ€™obtenir une valeur unique pour chaque combinaison des deux variables. On retransforme le rÃ©sultat en facteurs puis on modifie les Ã©tiquettes des modalitÃ©s.<a href="#analyses_donnees_pond_fnref8">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_acm">

<div id="analyses_acm_header">
<h1 class="title">Analyse des correspondances multiples (ACM)</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_acm_principe-general">Principe gÃ©nÃ©ral</a></li>
<li><a href="#analyses_acm_acm-avec-ade4">ACM avec ade4</a></li>
<li><a href="#analyses_acm_factominer">ACM avec FactoMineR</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Joseph Larmarange dans le cadre du support de cours <a href="https://github.com/larmarange/intro-r/tree/CoursM2">Introduction Ã  lâ€™analyse dâ€™enquÃªtes avec R</a>.
</div>
<p>Il existe plusieurs techniques dâ€™analyse factorielle dont les plus courantes sont lâ€™<em>analyse en composante principale</em> (ACP) portant sur des variables quantitatives, lâ€™<em>analyse factorielle des correspondances</em> (AFC) portant sur deux variables qualitatives et lâ€™<em>analyse des correspondances multiples</em> (ACM) portant sur plusieurs variables qualitatives (il sâ€™agit dâ€™une extension de lâ€™AFC). Pour combiner des variables Ã  la fois quantitatives et qualitatives, on pourra avoir recours Ã  lâ€™<em>analyse mixte de Hill et Smith</em>.</p>
<p>Bien que ces techniques soient disponibles dans les extensions standards de <strong>R</strong>, il est souvent prÃ©fÃ©rable dâ€™avoir recours Ã  deux autres extensions plus complÃ¨tes, <strong class="package">ade4</strong> et <strong class="package">FactoMineR</strong>, chacune ayant ses avantages et des possibilitÃ©s diffÃ©rentes. Voici les fonctions les plus frÃ©quentesÂ :</p>
<table>
<thead>
<tr class="header">
<th align="left">Analyse</th>
<th align="left">Variables</th>
<th align="center">Fonction standard</th>
<th align="center">Fonction <strong class="package">ade4</strong></th>
<th align="center">Fonctions <strong class="package">FactoMineR</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ACP</td>
<td align="left">plusieurs variables quantitatives</td>
<td align="center"><code data-package="stats">princomp</code></td>
<td align="center"><code data-package="ade4">dudi.pca</code></td>
<td align="center"><code data-package="FactoMineR">PCA</code></td>
</tr>
<tr class="even">
<td align="left">AFC</td>
<td align="left">deux variables qualitatives</td>
<td align="center"><code data-package="MASS">corresp</code></td>
<td align="center"><code data-package="ade4">dudi.coa</code></td>
<td align="center"><code data-package="FactoMineR">CA</code></td>
</tr>
<tr class="odd">
<td align="left">ACM</td>
<td align="left">plusieurs variables qualitatives</td>
<td align="center"><code data-package="MASS">mca</code></td>
<td align="center"><code data-package="ade4">dudi.acm</code></td>
<td align="center"><code data-package="FactoMineR">MCA</code></td>
</tr>
<tr class="even">
<td align="left">Analyse mixte de Hill et Smith</td>
<td align="left">plusieurs variables quantitatives et/ou qualitatives</td>
<td align="center">â€”</td>
<td align="center"><code data-package="ade4">dudi.mix</code></td>
<td align="center">â€”</td>
</tr>
</tbody>
</table>
<p>Dans la suite de ce chapitre, nous nâ€™arboderons que lâ€™analyse des correspondances multiples (ACM).</p>
<div class="info">
On trouvera Ã©galement de nombreux supports de cours en franÃ§ais sur lâ€™analyse factorielle sur le site de FranÃ§ois Gilles CarpentierÂ : <a href="http://geai.univ-brest.fr/~carpenti/" class="uri">http://geai.univ-brest.fr/~carpenti/</a>.
</div>
<div id="analyses_acm_principe-general" class="section level2">
<h2>Principe gÃ©nÃ©ral</h2>
<p>Lâ€™analyse des correspondances multiples est une technique descriptive visant Ã  rÃ©sumer lâ€™information contenu dans un grand nombre de variables afin de faciliter lâ€™interprÃ©tention des corrÃ©lations existantes entre ces diffÃ©rentes variables. On cherche Ã  savoir quelles sont les modalitÃ©s corrÃ©lÃ©es entre elles.</p>
<p>Lâ€™idÃ©e gÃ©nÃ©rale est la suivante<a href="#analyses_acm_fn1" class="footnoteRef" id="analyses_acm_fnref1"><sup>1</sup></a>. Lâ€™ensemble des individus peut Ãªtre reprÃ©sentÃ© dans un espace Ã  plusieurs dimensions oÃ¹ chaque axe reprÃ©sente les diffÃ©rentes variables utilisÃ©es pour dÃ©crire chaque individu. Plus prÃ©cisÃ©ment, pour chaque variable qualitative, il y a autant dâ€™axes que de modalitÃ©s moins un. Ainsi il faut trois axes pour dÃ©crire une variable Ã  quatre modalitÃ©s. Un tel nuage de points est aussi difficile Ã  interprÃ©ter que de lire directement le fichier de donnÃ©es. On ne voit pas es corrÃ©lations quâ€™il peut y avoir entre modalitÃ©s, par exemple quâ€™aller au cinÃ©ma est plus frÃ©quent chez les personnes habitant en milieu urbain. Afin de mieux reprÃ©senter ce nuage de points, on va procÃ©der Ã  un changement de systÃ¨mes de coordonnÃ©es. Les individus seront dÃ¨s lors projetÃ©s et reprÃ©sentÃ©s sur un nouveau systÃ¨me dâ€™axe. Ce nouveau systÃ¨me dâ€™axes est choisis de telle maniÃ¨re que la majoritÃ© des variations soit concentrÃ©es sur les premiers axes. Les deux-trois premiers axes permettront dâ€™expliquer la majoritÃ© des diffÃ©rences observÃ©es dans lâ€™Ã©chantillon, les autres axes nâ€™apportant quâ€™une faible part additionnelle dâ€™information. DÃ¨s lors, lâ€™analyse pourra se concentrer sur ses premiers axes qui constitueront un bon rÃ©sumÃ© des variations observables dans lâ€™Ã©chantillon.</p>
<p>Avant toute ACM, il est indispensable de rÃ©aliser une analyse prÃ©liminaire de chaque variable, afin de voir si toutes les classes sont aussi bien reprÃ©sentÃ©es ou sâ€™il existe un dÃ©sÃ©quilibre. Lâ€™ACM est sensible aux effectifs faibles, aussi regrouper les classes quand cela est nÃ©cessaire.</p>
</div>
<div id="analyses_acm_acm-avec-ade4" class="section level2">
<h2>ACM avec ade4</h2>
<p>Si lâ€™extension <strong class="package">ade4</strong> nâ€™est pas prÃ©sente sur votre PC, il vous faut lâ€™installerÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"ade4"</span>, <span class="dt">dep =</span> <span class="ot">TRUE</span>)</code></pre>
<p>Dans tous les cas, il faut penser Ã  la charger en mÃ©moireÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ade4)</code></pre>
<p>Comme prÃ©cÃ©demment, nous utiliserons le fichier de donnÃ©es <code>hdv2003</code> fourni avec lâ€™extension <strong class="package">questionr</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003</code></pre>
<p>En premier lieu, comme dans le <a href="#analyses_reglog">chapitre sur la rÃ©gression logistique</a>, nous allons crÃ©er une variable groupe dâ€™Ã¢ges et regrouper les modalitÃ©s de la variable Â«Â niveau dâ€™Ã©tudeÂ Â».</p>
<pre class="sourceCode r"><code class="sourceCode r">d$grpage &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">65</span>, <span class="dv">93</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, 
  <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
d$etud &lt;-<span class="st"> </span>d$nivetud
<span class="kw">levels</span>(d$etud) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, 
  <span class="st">"Secondaire"</span>, <span class="st">"Secondaire"</span>, <span class="st">"Technique/Professionnel"</span>, 
  <span class="st">"Technique/Professionnel"</span>, <span class="st">"SupÃ©rieur"</span>)</code></pre>
<p>Ensuite, nous allons crÃ©er un tableau de donnÃ©es ne contenant que les variables que nous souhaitons prendre en compte pour notre analyse factorielle.</p>
<pre class="sourceCode r"><code class="sourceCode r">d2 &lt;-<span class="st"> </span>d[, <span class="kw">c</span>(<span class="st">"grpage"</span>, <span class="st">"sexe"</span>, <span class="st">"etud"</span>, <span class="st">"peche.chasse"</span>, 
  <span class="st">"cinema"</span>, <span class="st">"cuisine"</span>, <span class="st">"bricol"</span>, <span class="st">"sport"</span>, <span class="st">"lecture.bd"</span>)]</code></pre>
<p>Le calcul de lâ€™ACM se fait tout simplement avec la fonction <code>dudi.acm</code>{data-package=â€œade4â€&gt;.</p>
<pre class="sourceCode r"><code class="sourceCode r">acm &lt;-<span class="st"> </span><span class="kw">dudi.acm</span>(d2)</code></pre>
<p>Par dÃ©faut, la fonction affichera le graphique des valeurs propres de chaque axe (nous y reviendrons) et vous demandera le nombre dâ€™axes que vous souhaitez conserver dans les rÃ©sultats. Le plus souvent, cinq axes seront largement plus que suffisants. Vous pouvez Ã©galement Ã©viter cette Ã©tape en indiquant directement Ã  dudi.acm de vous renvoyer les cinq premiers axes ainsiÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">acm &lt;-<span class="st"> </span><span class="kw">dudi.acm</span>(d2, <span class="dt">scannf =</span> <span class="ot">FALSE</span>, <span class="dt">nf =</span> <span class="dv">5</span>)</code></pre>
<p>Le graphique des valeurs propres peut Ãªtre reproduit avec <code data-package="ade4" data-rdocumentation="scatter">screeplot</code>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">screeplot</span>(acm)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-8-1.png" title="" alt="" width="1050"/>
<figcaption>
Valeurs propres ou inerties de chaque axe
</figcaption>
</figure>
<p>Les mÃªmes valeurs pour les premiers axes sâ€™obtiennent Ã©galement avec <code data-package="ade4" data-rdocumentation="dudi">summary</code><a href="#analyses_acm_fn2" class="footnoteRef" id="analyses_acm_fnref2"><sup>2</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(acm)</code></pre>
<pre><code>Class: acm dudi
Call: dudi.acm(df = d2, scannf = FALSE, nf = 5)

Total inertia: 1.451

Eigenvalues:
    Ax1     Ax2     Ax3     Ax4     Ax5 
 0.2474  0.1672  0.1309  0.1263  0.1176 

Projected inertia (%):
    Ax1     Ax2     Ax3     Ax4     Ax5 
 17.055  11.525   9.022   8.705   8.109 

Cumulative projected inertia (%):
    Ax1   Ax1:2   Ax1:3   Ax1:4   Ax1:5 
  17.06   28.58   37.60   46.31   54.42 

(Only 5 dimensions (out of 15) are shown)</code></pre>
<p>Lâ€™inertie totale est de 1,451 et lâ€™axe 1 en explique 0,1474 soit 17Â %. Lâ€™inertie projetÃ©e cumulÃ©e nous indique que les deux premiers axes expliquent Ã  eux seuls 29Â % des variations observÃ©es dans notre Ã©chantillon.</p>
<p>Pour comprendre la signification des diffÃ©rents axes, il importe dâ€™identifier quelles sont les variables/ modalitÃ©s qui contribuent le plus Ã  chaque axe. Une premiÃ¨re reprÃ©sentation graphique est le cercle de corrÃ©lation des modalitÃ©s. Pour cela, on aura recours Ã  <code data-package="ade4">s.corcicle</code>. On indiquera dâ€™abord <code>acm$co</code> si lâ€™on souhaite reprÃ©senter les modalitÃ©s ou <code>acm$li</code> si lâ€™on souhaite reprÃ©senter les individus. Les deux chiffres suivant indiquent les deux axes que lâ€™on souhaite afficher (dans le cas prÃ©sent les deux premiers axes). Enfin, le paramÃ¨tre <code>clabel</code> permet de modifier la taille des Ã©tiquettes.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.corcircle</span>(acm$co, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">clabel =</span> <span class="fl">0.7</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-10-1.png" title="" alt="" width="1050"/>
<figcaption>
Cercle de corrÃ©lations des modalitÃ©s sur les deux premiers axes
</figcaption>
</figure>
<p>On pourra avoir Ã©galement recours Ã  <code data-package="ade4" data-rdocumentation="dudi.acm">boxplot</code> pour visualiser comment se rÃ©partissent les modalitÃ©s de chaque variable sur un axe donnÃ©<a href="#analyses_acm_fn3" class="footnoteRef" id="analyses_acm_fnref3"><sup>3</sup></a>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(acm)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-11-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des modalitÃ©s selon le premier axe
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(acm, <span class="dv">2</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-12-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des modalitÃ©s selon le second axe
</figcaption>
</figure>
<p>Le tableau <code>acm$cr</code> contient les rapports de corrÃ©lation (variant de 0 Ã  1) entre les variables et les axes choisis au dÃ©part de lâ€™ACM. Pour reprÃ©senter graphiquement ces rapports, utiliser la fonction <code data-package="graphics">barplot</code> ainsiÂ : <code>barplot(acm$cr[,num],names.arg=row.names( acm$cr),las=2)</code> oÃ¹ <code>num</code> est le numÃ©ro de lâ€™axe Ã  reprÃ©senter. Pour lâ€™interprÃ©tation des axes, se concentrer sur les variables les plus structurantes, câ€™est-Ã -dire dont le rapport de corrÃ©lation est le plus proche de 1.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
for (i in <span class="dv">1</span>:<span class="dv">4</span>) <span class="kw">barplot</span>(acm$cr[, i], <span class="dt">names.arg =</span> <span class="kw">row.names</span>(acm$cr), 
  <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">"Axe"</span>, i))</code></pre>
<p><img src="images/analyses_acm/unnamed-chunk-13-1.png" title="" alt="" width="1050"/></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</code></pre>
<figcaption>
Rapports de corrÃ©lation des variables sur les 4 premiers axes
</figcaption>
</figure>
<div class="astuce">
<p>Le paramÃ¨tre <code>mfrow</code> de la fonction <code data-package="graphics">par</code> permet dâ€™indiquer Ã  <strong>R</strong> que lâ€™on souhaite afficher plusieurs graphiques sur une seule et mÃªme fenÃªtre, plus prÃ©cisÃ©ment que lâ€™on souhaite diviser la fenÃªtre en deux lignes et deux colonnes.</p>
Dans lâ€™exemple prÃ©cÃ©dent, aprÃ¨s avoir produit notre graphique, nous avons rÃ©initilisÃ© cette valeur Ã  <code>c(1, 1)</code> (un seul graphique par fenÃªtre) pour ne pas affecter les prochains graphiques que nous allons produire.
</div>
<p>Pour reprÃ©senter, les modalitÃ©s dans le plan factoriel, on utilisera la fonction <code data-package="ade4">s.label</code>. Par dÃ©faut, les deux premiers axes sont reprÃ©sentÃ©s.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.label</span>(acm$co, <span class="dt">clabel =</span> <span class="fl">0.7</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-14-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des modalitÃ©s selon les deux premiers axes
</figcaption>
</figure>
<p>Il est bien sur possible de prÃ©ciser les axes Ã  reprÃ©senter. Lâ€™argument <code>boxes</code> permet quant Ã  lui dâ€™indiquer si lâ€™on souhaite tracer une boÃ®te pour chaque modalitÃ©.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.label</span>(acm$co, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">clabel =</span> <span class="fl">0.7</span>, <span class="dt">boxes =</span> <span class="ot">FALSE</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-15-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des modalitÃ©s selon les axes 3 et 4
</figcaption>
</figure>
<p>Bien entendu, on peut Ã©galement reprÃ©senter les individus. En indiquant <code>clabel=0</code> (une taille nulle pour les Ã©tiquettes), <code data-package="ade4">s.label</code> remplace chaque observation par un symbole qui peut Ãªtre spÃ©cifiÃ© avec <code>pch</code><a href="#analyses_acm_fn4" class="footnoteRef" id="analyses_acm_fnref4"><sup>4</sup></a>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.label</span>(acm$li, <span class="dt">clabel =</span> <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-16-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des individus selon les deux premiers axes
</figcaption>
</figure>
<div class="astuce">
<p>Lorsque lâ€™on rÃ©alise une ACM, il nâ€™est pas rare que plusieurs observations soient identiques, câ€™est-Ã -dire correspondent Ã  la mÃªme combinaison de modalitÃ©s. DÃ¨s lors, ces observations seront projetÃ©es sur le mÃªme point dans le plan factoriel. Une reprÃ©sentation classique des observations avec <code data-package="ade4">s.label</code> ne permettra pas de rendre compte les effectifs de chaque point.</p>
<p>Le package <strong class="package">JLutils</strong>, disponible seulement sur <a href="https://github.com/larmarange/JLutils">GitHub</a>, propose une petite fonction <code data-package="JLutils">s.freq</code> reprÃ©sentant chaque point par un carrÃ© proportionnel au nombre dâ€™individus.</p>
<p>Pour installer <strong class="package">JLutils</strong>, on aura recours au package <strong class="package">devtools</strong> et Ã  sa fonction <code data-package="devtools">install_github</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"larmarange/JLutils"</span>)</code></pre>
<p>La fonction <code data-package="JLutils">s.freq</code> sâ€™emploie de maniÃ¨re similaire aux autres fonctions graphiques de <strong class="package">ade4</strong>. Le paramÃ¨tre <code>csize</code> permet dâ€™ajuster la taille des carrÃ©s.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(JLutils)
<span class="kw">s.freq</span>(acm$li)</code></pre>
<p><img src="images/analyses_acm/unnamed-chunk-18-1.png" title="" alt="" width="1050"/></p>
Lâ€™interprÃ©tation est tout autre, nonÂ ?
</div>
<div class="astuce">
Gaston Sanchez propose un graphique amÃ©liorÃ© des modalitÃ©s dans le plan factoriel Ã  cette adresseÂ : <a href="http://rpubs.com/gaston/MCA" class="uri">http://rpubs.com/gaston/MCA</a>.
</div>
<p>La fonction <code data-package="ade4">s.value</code> permet notamment de reprÃ©senter un troisiÃ¨me axe factoriel. Dans lâ€™exemple ci-aprÃ¨s, nous projettons les individus selon les deux premiers axes factoriels. La taille et la couleur des carrÃ©s dÃ©pendent pour leur part de la coordonnÃ©e des individus sur le troisiÃ¨me axe factoriel. Le paramÃ¨tre <code>csi</code> permet dâ€™ajuster la taille des carrÃ©s.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.value</span>(acm$li, acm$li[, <span class="dv">3</span>], <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">csi =</span> <span class="fl">0.5</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-19-1.png" title="" alt="" width="1050"/>
<figcaption>
RÃ©partition des individus selon les trois premiers axes
</figcaption>
</figure>
<p><code data-package="ade4">s.arrow</code> permet de reprÃ©senter les vecteurs variables ou les vecteurs individus sous la forme dâ€™une flÃ¨che allant de lâ€™origine du plan factoriel aux coordonnÃ©es des variables/individusÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.arrow</span>(acm$co, <span class="dt">clabel =</span> <span class="fl">0.7</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-20-1.png" title="" alt="" width="1050"/>
<figcaption>
Vecteurs des modalitÃ©s selon les deux premiers axes
</figcaption>
</figure>
<p><code data-package="s.hist">s.hist</code> permet de reprÃ©senter des individus (ou des modalitÃ©s) sur le plan factoriel et dâ€™afficher leur distribution sur chaque axeÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.hist</span>(acm$li, <span class="dt">clabel =</span> <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">15</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-21-1.png" title="" alt="" width="1050"/>
<figcaption>
Distribution des individus dans le plan factoriel
</figcaption>
</figure>
<p><code data-package="ade4">s.class</code> et <code data-package="ade4">s.chull</code> permettent de reprÃ©senter les diffÃ©rentes observations classÃ©es en plusieurs catÃ©gories. Cela permet notamment de projeter certaines variables.</p>
<p><code data-package="ade4">s.class</code> reprÃ©sente les observations par des points, lie chaque observation au barycentre de la modalitÃ© Ã  laquelle elle appartient et dessine une ellipse reprÃ©sentant la forme gÃ©nÃ©rale du nuage de pointsÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RColorBrewer)
<span class="kw">s.class</span>(acm$li, d2$sexe, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">"Set1"</span>))</code></pre>
<img src="images/analyses_acm/unnamed-chunk-22-1.png" title="" alt="" width="1050"/>
<figcaption>
Individus dans le plan factoriel selon le sexe (s.class)
</figcaption>
</figure>
<p><code data-package="ade4">s.chull</code> reprÃ©sente les barycentres de chaque catÃ©gorie et dessine des lignes de niveaux reprÃ©sentant la distribution des individus de cette catÃ©gorie. Les individus ne sont pas directement reprÃ©sentÃ©sÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.chull</span>(acm$li, d2$sexe, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">"Set1"</span>))</code></pre>
<img src="images/analyses_acm/unnamed-chunk-23-1.png" title="" alt="" width="1050"/>
<figcaption>
Individus dans le plan factoriel selon le sexe (s.chull)
</figcaption>
</figure>
<div class="astuce">
<p>Il est prÃ©fÃ©rable de fournir une liste de couleurs (via le paramÃ¨tre <code>col</code>) pour rendre le graphique plus lisible. Si vous avez installÃ© lâ€™extension <strong class="package">RColorBrewer</strong>, vous pouvez utiliser les diffÃ©rentes palettes de couleurs proposÃ©es. Pour afficher les palettes disponibles, utilisez <code data-package="RColorBrewer" data-rdocumentation="RColorsBrewer">display.brewer.all</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RColorBrewer)
<span class="kw">display.brewer.all</span>(<span class="dv">8</span>)</code></pre>
<p><img src="images/analyses_acm/unnamed-chunk-24-1.png" title="" alt="" width="1050"/></p>
<p>Pour obtenir une palette de couleurs, utilisez la fonction <code data-package="RColorBrewer" data-rdocumentation="RColorsBrewer">brewer.pal</code> avec les arguments <code>n</code> (nombre de couleurs demandÃ©es) et <code>pal</code>(nom de la palette de couleurs dÃ©sirÃ©e).</p>
Pour plus dâ€™informations sur les palettes <em>Color Brewer</em>, voir <a href="http://colorbrewer2.org/" class="uri">http://colorbrewer2.org/</a>.
</div>
<p>La variable catÃ©gorielle transmise Ã  <code data-package="ade4">s.class</code> ou <code data-package="ade4">s.chull</code> nâ€™est pas obligatoirement une des variables retenues pour lâ€™ACM. Il est tout Ã  fait possible dâ€™utiliser une autre variable. Par exempleÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">s.class</span>(acm$li, d$trav.imp, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">"Set1"</span>))</code></pre>
<img src="images/analyses_acm/unnamed-chunk-25-1.png" title="" alt="" width="1050"/>
<figcaption>
Individus dans le plan factoriel selon lâ€™importance donnÃ©e au travail
</figcaption>
</figure>
<p>Les fonctions <code data-package="ade4">scatter</code> et <code data-package="ade4" data-rdocumentation="scatter">biplot</code> sont Ã©quivalentesÂ : elles appliquent <code data-package="ade4">s.class</code> Ã  chaque variable utilisÃ©e pour lâ€™ACM.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scatter</span>(acm, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">"Set1"</span>))</code></pre>
<img src="images/analyses_acm/unnamed-chunk-26-1.png" title="" alt="" width="1050"/>
<figcaption>
La fonction scatter appliquÃ©e au rÃ©sultat dâ€™une ACM
</figcaption>
</figure>
</div>
<div id="analyses_acm_factominer" class="section level2">
<h2>ACM avec FactoMineR</h2>
<p>Comme avec <strong class="package">ade4</strong>, il est nÃ©cessaire de prÃ©parer les donnÃ©es au prÃ©alable (voir section prÃ©cÃ©dente).</p>
<p>Lâ€™ACM se calcule avec la fonction <code data-package="FactoMineR">MCA</code>, lâ€™argument <code>ncp</code> permettant de choisir le nombre dâ€™axes Ã  retenirÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FactoMineR)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">acm2 &lt;-<span class="st"> </span><span class="kw">MCA</span>(d2, <span class="dt">ncp =</span> <span class="dv">5</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)
acm2</code></pre>
<pre><code>**Results of the Multiple Correspondence Analysis (MCA)**
The analysis was performed on 2000 individuals, described by 9 variables
*The results are available in the following objects:

   name             
1  "$eig"           
2  "$var"           
3  "$var$coord"     
4  "$var$cos2"      
5  "$var$contrib"   
6  "$var$v.test"    
7  "$ind"           
8  "$ind$coord"     
9  "$ind$cos2"      
10 "$ind$contrib"   
11 "$call"          
12 "$call$marge.col"
13 "$call$marge.li" 
   description                       
1  "eigenvalues"                     
2  "results for the variables"       
3  "coord. of the categories"        
4  "cos2 for the categories"         
5  "contributions of the categories" 
6  "v-test for the categories"       
7  "results for the individuals"     
8  "coord. for the individuals"      
9  "cos2 for the individuals"        
10 "contributions of the individuals"
11 "intermediate results"            
12 "weights of columns"              
13 "weights of rows"                 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">acm2$eig</code></pre>
<pre><code>       eigenvalue percentage of variance
dim 1  0.25757489              15.454493
dim 2  0.18363502              11.018101
dim 3  0.16164626               9.698776
dim 4  0.12871623               7.722974
dim 5  0.12135737               7.281442
dim 6  0.11213331               6.727999
dim 7  0.10959377               6.575626
dim 8  0.10340564               6.204338
dim 9  0.09867478               5.920487
dim 10 0.09192693               5.515616
dim 11 0.07501208               4.500725
dim 12 0.06679676               4.007805
dim 13 0.06002063               3.601238
dim 14 0.05832024               3.499215
dim 15 0.03785276               2.271166
       cumulative percentage of variance
dim 1                           15.45449
dim 2                           26.47259
dim 3                           36.17137
dim 4                           43.89434
dim 5                           51.17579
dim 6                           57.90378
dim 7                           64.47941
dim 8                           70.68375
dim 9                           76.60424
dim 10                          82.11985
dim 11                          86.62058
dim 12                          90.62838
dim 13                          94.22962
dim 14                          97.72883
dim 15                         100.00000</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(acm2$eig$eigenvalue)</code></pre>
<pre><code>[1] 1.666667</code></pre>
<p>En premier lieu, il apparait que lâ€™inertie totale obtenue avec <code data-package="FactoMineR">MCA</code> est diffÃ©rente de celle observÃ©e avec <code>dudi.acm</code>{data-package=â€œade4â€&gt;. Cela est dÃ» Ã  un traitement diffÃ©rents des valeurs manquantes. Alors que <code data-package="ade4">dudi.acm</code> exclu les valeurs manquantes, <code data-package="FactoMineR">MCA</code> les considÃ¨rent, par dÃ©faut, comme une modalitÃ© additionnelle. Pour calculer lâ€™ACM uniquement sur les individus nâ€™ayant pas de valeur manquante, on aura recours Ã  <code data-package="stats">complete.cases</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">acm2 &lt;-<span class="st"> </span><span class="kw">MCA</span>(d2[<span class="kw">complete.cases</span>(d2), ], <span class="dt">ncp =</span> <span class="dv">5</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)
acm2$eig</code></pre>
<pre><code>       eigenvalue percentage of variance
dim 1  0.24790700              17.162792
dim 2  0.16758465              11.602014
dim 3  0.13042357               9.029324
dim 4  0.12595105               8.719688
dim 5  0.11338629               7.849820
dim 6  0.10976674               7.599236
dim 7  0.10060204               6.964757
dim 8  0.09802387               6.786268
dim 9  0.09283131               6.426783
dim 10 0.07673502               5.312425
dim 11 0.06609694               4.575942
dim 12 0.05950655               4.119684
dim 13 0.05562942               3.851267
       cumulative percentage of variance
dim 1                           17.16279
dim 2                           28.76481
dim 3                           37.79413
dim 4                           46.51382
dim 5                           54.36364
dim 6                           61.96287
dim 7                           68.92763
dim 8                           75.71390
dim 9                           82.14068
dim 10                          87.45311
dim 11                          92.02905
dim 12                          96.14873
dim 13                         100.00000</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(acm2$eig$eigenvalue)</code></pre>
<pre><code>[1] 1.444444</code></pre>
<p>Les possibilitÃ©s graphiques de <strong class="package">FactoMineR</strong> sont diffÃ©rentes de celles de <strong class="package">ade4</strong>. Un recours Ã  la fonction <code data-package="FactoMineR" data-rdocumentation="plot.MCA">plot</code> affichera par dÃ©faut les individus, les modalitÃ©s et les variables. La commande <code>?plot.MCA</code> permet dâ€™accÃ©der au fichier dâ€™aide de cette fonction (i.e.Â de la mÃ©thode gÃ©nÃ©rique <code>plot</code> appliquÃ©e aux objets de type <code>MCA</code>) et de voir toutes les options graphiques. Lâ€™argument <code>choix</code> permet de spÃ©cifier ce que lâ€™on souhaite afficher (Â«Â indÂ Â» pour les individus et les catÃ©gories, Â«Â varÂ Â» pour les variables). Lâ€™argument <code>invisible</code> quant Ã  lui permet de spÃ©cifier ce que lâ€™on souhaite masquer. Les axes Ã  afficher se prÃ©cisent avec <code>axes</code>. Voir les exemples ci-dessous.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(acm2)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-30-1.png" title="" alt="" width="1050"/>
<figcaption>
Plan factoriel (deux premiers axes)
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(acm2, <span class="dt">axes =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</code></pre>
<img src="images/analyses_acm/unnamed-chunk-31-1.png" title="" alt="" width="1050"/>
<figcaption>
Plan factoriel (axes 3 et 4)
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(acm2, <span class="dt">choix =</span> <span class="st">"ind"</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-32-1.png" title="" alt="" width="1050"/>
<figcaption>
Plan factoriel (seulement les individus et les catÃ©gories)
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(acm2, <span class="dt">choix =</span> <span class="st">"ind"</span>, <span class="dt">invisible =</span> <span class="st">"ind"</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-33-1.png" title="" alt="" width="1050"/>
<figcaption>
Plan factoriel (seulement les catÃ©gories)
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(acm2, <span class="dt">choix =</span> <span class="st">"var"</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-34-1.png" title="" alt="" width="1050"/>
<figcaption>
Plan factoriel (seulement les variables)
</figcaption>
</figure>
<p>La fonction <code data-package="FactoMineR">plotellipses</code> trace des ellipses de confiance atour des modalitÃ©s de variables qualitatives. Lâ€™objectif est de voir si les modalitÃ©s dâ€™une variable qualitative sont significativement diffÃ©rentes les unes des autres.</p>
<p>Par dÃ©faut (<code>means=TRUE</code>), les ellipses de confiance sont calculÃ©es pour les coordonnÃ©es moyennes de chaque catÃ©gorie.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotellipses</span>(acm2)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-35-1.png" title="" alt="" width="1050"/>
<figcaption>
Ellipses de confiance (means=TRUE) dans le plan factoriel
</figcaption>
</figure>
<p>Lâ€™option <code>means=FALSE</code> calculera les ellipses de confiance pour lâ€™ensemble des coordonnÃ©es des observations relevant de chaque catÃ©gorie.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotellipses</span>(acm2, <span class="dt">means =</span> <span class="ot">FALSE</span>)</code></pre>
<img src="images/analyses_acm/unnamed-chunk-36-1.png" title="" alt="" width="1050"/>
<figcaption>
Ellipses de confiance (means=FALSE) dans le plan factoriel
</figcaption>
</figure>
<p>La fonction <code data-package="FactoMineR">dimdesc</code> aide Ã  dÃ©crire et interprÃ©ter les dimensions de lâ€™ACM. Cette fonction est trÃ¨s utile quand le nombre de variables est Ã©levÃ©. Elle permet de voir Ã  quelles variables les axes sont le plus liÃ©sÂ : quelles variables et quelles modalitÃ©s dÃ©crivent le mieux chaque axeÂ ?</p>
<blockquote>
<p>Pour les variables qualitatives, un modÃ¨le dâ€™analyse de variance Ã  un facteur est rÃ©alisÃ© pour chaque dimensionÂ ; les variables Ã  expliquer sont les coordonnÃ©es des individus et la variable explicative est une des variables qualitatives. Un test F permet de voir si la variable a un effet significatif sur la dimension et des tests T sont rÃ©alisÃ©s modalitÃ© par modalitÃ© (avec le contraste somme des alpha_i=0). Cela montre si les coordonnÃ©es des individus de la sous-population dÃ©finie par une modalitÃ© sont significativement diffÃ©rentes de celles de lâ€™ensemble de la population (<em>i.e.</em> diffÃ©rentes de 0). Les variables et modalitÃ©s sont triÃ©es par probabilitÃ© critique et seules celles qui sont significatives sont gardÃ©es dans le rÃ©sultat.</p>
<footer>
SourceÂ : <a href="http://factominer.free.fr/factosbest/description-des-dimensions.html" class="uri">http://factominer.free.fr/factosbest/description-des-dimensions.html</a>
</footer>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dimdesc</span>(acm2, <span class="dt">axes =</span> <span class="dv">1</span>:<span class="dv">2</span>)</code></pre>
<pre><code>$`Dim 1`
$`Dim 1`$quali
                      R2       p.value
etud         0.586058164  0.000000e+00
grpage       0.512231318 1.008479e-292
cinema       0.471002163 8.339548e-263
sport        0.398103140 5.940105e-210
bricol       0.179188677  7.142716e-83
cuisine      0.048233515  4.941749e-22
lecture.bd   0.017667936  6.856650e-09
sexe         0.013670717  3.546801e-07
peche.chasse 0.005007337  2.105728e-03

$`Dim 1`$category
                           Estimate       p.value
cinema_Oui               0.35033716 8.339548e-263
sport_Oui                0.33199860 5.940105e-210
[25,45)                  0.33895697 1.959716e-159
SupÃ©rieur                0.45630756 1.376719e-118
bricol_Oui               0.21255190  7.142716e-83
Technique/Professionnel  0.17291856  4.703868e-23
cuisine_Oui              0.11015793  4.941749e-22
[16,25)                  0.39553122  3.635181e-15
lecture.bd_Oui           0.22169306  6.856650e-09
Homme                    0.05853263  3.546801e-07
peche.chasse_Oui         0.05543091  2.105728e-03
peche.chasse_Non        -0.05543091  2.105728e-03
Femme                   -0.05853263  3.546801e-07
lecture.bd_Non          -0.22169306  6.856650e-09
[45,65)                 -0.13173232  2.477610e-12
cuisine_Non             -0.11015793  4.941749e-22
bricol_Non              -0.21255190  7.142716e-83
[65,93]                 -0.60275587 2.906563e-165
sport_Non               -0.33199860 5.940105e-210
cinema_Non              -0.35033716 8.339548e-263
Primaire                -0.59465967 5.269497e-268


$`Dim 2`
$`Dim 2`$quali
                     R2       p.value
sexe         0.62723828  0.000000e+00
peche.chasse 0.31109226 1.161746e-154
bricol       0.20276579  8.014713e-95
etud         0.13925513  6.754592e-61
cuisine      0.12908453  1.461380e-58
cinema       0.04039994  1.215838e-18
grpage       0.03776900  1.257795e-15
lecture.bd   0.01995653  7.190474e-10

$`Dim 2`$category
                           Estimate       p.value
Homme                    0.32598031  0.000000e+00
peche.chasse_Oui         0.35922450 1.161746e-154
bricol_Oui               0.18590016  8.014713e-95
cuisine_Non              0.14816688  1.461380e-58
Technique/Professionnel  0.23013181  5.919911e-54
cinema_Non               0.08436024  1.215838e-18
[45,65)                  0.11638978  3.028836e-17
lecture.bd_Non           0.19371997  7.190474e-10
[65,93]                 -0.02872480  1.229757e-02
[25,45)                 -0.05570792  2.294799e-09
lecture.bd_Oui          -0.19371997  7.190474e-10
Secondaire              -0.09715846  1.240732e-10
cinema_Oui              -0.08436024  1.215838e-18
SupÃ©rieur               -0.14813997  6.942611e-24
cuisine_Oui             -0.14816688  1.461380e-58
bricol_Non              -0.18590016  8.014713e-95
peche.chasse_Non        -0.35922450 1.161746e-154
Femme                   -0.32598031  0.000000e+00</code></pre>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_acm_fn1"><p>Pour une prÃ©sentation plus dÃ©taillÃ©e, voir <a href="http://www.math.univ-toulouse.fr/~baccini/zpedago/asdm.pdf" class="uri">http://www.math.univ-toulouse.fr/~baccini/zpedago/asdm.pdf</a>.<a href="#analyses_acm_fnref1">â†©</a></p></li>
<li id="analyses_acm_fn2"><p>On pourra Ã©galement avoir recours Ã  la fonction <code data-package="ade4">inertia.dudi</code> pour lâ€™ensemble des axes.<a href="#analyses_acm_fnref2">â†©</a></p></li>
<li id="analyses_acm_fn3"><p>La fonction <code data-package="ade4" data-rdocumentation="score.acm">score</code> constituera Ã©galement une aide Ã  lâ€™interprÃ©tation des axes.<a href="#analyses_acm_fnref3">â†©</a></p></li>
<li id="analyses_acm_fn4"><p>Voir le chapitre sur les graphiques pour la liste des diffÃ©rents symboles utilisables. (MAJ LIEN)<a href="#analyses_acm_fnref4">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_cah">

<div id="analyses_cah_header">
<h1 class="title">Classification ascendante hiÃ©rarchique (CAH)</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_cah_calculer-une-matrice-des-distances">Calculer une matrice des distances</a><ul>
<li><a href="#analyses_cah_distance-de-gower">Distance de Gower</a></li>
<li><a href="#analyses_cah_distance-du-">Distance du Î¦Â²</a></li>
<li><a href="#analyses_cah_exemple">Exemple</a></li>
</ul></li>
<li><a href="#analyses_cah_calcul-du-dendrogramme">Calcul du dendrogramme</a></li>
<li><a href="#analyses_cah_decouper-le-dendrogramme">DÃ©couper le dendrogramme</a></li>
<li><a href="#analyses_cah_factominer">CAH avec lâ€™extension FactoMineR</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre a Ã©tÃ© Ã©crite par Joseph Larmarange dans le cadre du support de cours <a href="https://github.com/larmarange/intro-r/tree/CoursM2">Introduction Ã  lâ€™analyse dâ€™enquÃªtes avec R</a>.
</div>
<p>Il existe de nombreuses techniques statistiques visant Ã  partinionner une population en diffÃ©rentes classes ou sous-groupes. La <em>classification ascendante hiÃ©rarchique</em> (CAH) est lâ€™une dâ€™entre elles. On cherche Ã  ce que les individus regroupÃ©s au sein dâ€™une mÃªme classe (homogÃ©nÃ©itÃ© intra-classe) soient le plus semblables possibles tandis que les classes soient le plus dissemblables (hÃ©tÃ©rogÃ©nÃ©itÃ© inter-classe).</p>
<p>Le principe de la CAH est de rassembler des individus selon un critÃ¨re de ressemblance dÃ©fini au prÃ©alable qui sâ€™exprimera sous la forme dâ€™une <em>matrice de distances</em>, exprimant la distance existant entre chaque individu pris deux Ã  deux. Deux observations identiques auront une distance nulle. Plus les deux observations seront dissemblables, plus la distance sera importante. La CAH va ensuite rassembler les individus de maniÃ¨re itÃ©rative afin de produire un <em>dendrogramme</em> ou <em>arbre de classification</em>. La classification est <em>ascendante</em> car elle part des observations individuellesÂ ; elle est <em>hiÃ©rarchique</em> car elle produit des classes ou groupes de plus en plus vastes, incluant des sous-groupes en leur sein. En dÃ©coupant cet arbre Ã  une certaine hauteur choisie, on produira la partition dÃ©sirÃ©e.</p>
<div class="info">
On trouvera Ã©galement de nombreux supports de cours en franÃ§ais sur la CAH sur le site de FranÃ§ois Gilles CarpentierÂ : <a href="http://geai.univ-brest.fr/~carpenti/" class="uri">http://geai.univ-brest.fr/~carpenti/</a>.
</div>
<div id="analyses_cah_calculer-une-matrice-des-distances" class="section level2">
<h2>Calculer une matrice des distances</h2>
<p>La notion de <em>ressemblance</em> entre observations est Ã©valuÃ©e par une distance entre individus. Plusieurs type de ditances existent selon les donnÃ©es utilisÃ©es.</p>
<p>Il existe de nombreuses distances mathÃ©matiques pour les variables quantitatives (euclidiennes, Manhattanâ€¦) que nous nâ€™aborderons pas ici<a href="#analyses_cah_fn1" class="footnoteRef" id="analyses_cah_fnref1"><sup>1</sup></a>. La plupart peuvent Ãªtre calculÃ©es avec la fonction <code data-package="stats">dist</code>.</p>
<p>Usuellement, pour un ensemble de variables qualitatives, on aura recours Ã  la distance du Î¦Â² qui est celle utilisÃ©e pour lâ€™analyse des correspondances multiples (voir le <a href="#analyses_acm">chapitre dÃ©diÃ©</a>). Avec lâ€™extension <strong class="package">ade4</strong>, la distance du Î¦Â² sâ€™obtient avec la fonction <code data-package="ade4">dist.dudi</code><a href="#analyses_cah_fn2" class="footnoteRef" id="analyses_cah_fnref2"><sup>2</sup></a>. Le cas particulier de la CAH avec lâ€™extension <strong class="package">FactoMineR</strong> sera abordÃ©e dans une section spÃ©cifique (MAJ LIEN). Nous Ã©voquerons Ã©galement la <em>distance de Gower</em> qui peut sâ€™appliquer Ã  un ensemble de variables Ã  la fois qualitatives et quantitatives et qui se calcule avec la fonction <code data-package="cluster">daisy</code> de lâ€™extension <strong class="package">cluster</strong>. Enfin, dans le chapitre sur lâ€™analyse de sÃ©quences (MAJ LIEN), nous verrons Ã©galement la fonction <code data-package="TraMineR">seqdist</code> (extension <strong class="package">TraMineR</strong>) permettant de calculer une distance entre sÃ©quences.</p>
<div id="analyses_cah_distance-de-gower" class="section level3">
<h3>Distance de Gower</h3>
<p>En 1971, Gower a proposÃ© un indice de similaritÃ© qui porte son nom. Lâ€™objectif de cet indice consiste Ã  mesurer dans quelle mesure deux individus sont semblables. Lâ€™indice de Gower varie entre 0 et 1. Si lâ€™indice vaut 1, les deux individus sont identiques. Ã€ lâ€™opposÃ©, sâ€™il vaut 0, les deux individus considÃ©rÃ©s nâ€™ont pas de point commun. Si lâ€™on note <em>S<sub>g</sub></em> lâ€™indice de similaritÃ© de Gower, la distance de Gower <em>D<sub>g</sub></em> sâ€™obtient simplement de la maniÃ¨re suivante : <em>D<sub>g</sub></em> = 1-<em>S<sub>g</sub></em>. Ainsi, la distance sera nulle entre deux individus identiques et elle sera Ã©gale Ã  1 entre deux individus totalement diffÃ©rents. Cette distance sâ€™obtient sous <strong>R</strong> avec la fonction <code data-package="cluster">daisy</code> du package <strong class="package">cluster</strong>.</p>
<p>Lâ€™indice de similaritÃ© de Gower entre deux individus <em>x<sub>1</sub></em> et <em>x<sub>2</sub></em> se calcule de la maniÃ¨re suivanteÂ :</p>
<!-- 
$$ S_{g}(x_{1},x_{2})=\frac{1}{p}\sum_{j=1}^{p}s_{12j} $$
converted on http://www2.ph.ed.ac.uk/snuggletex/MathInputDemo
-->
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"> <semantics> <mrow> <msub> <mi>S</mi> <mi>g</mi> </msub> <mfenced close=")" open="("> <msub> <mi>x</mi> <mn>1</mn> </msub> <msub> <mi>x</mi> <mn>2</mn> </msub> </mfenced> <mo>=</mo> <mfrac> <mn>1</mn> <mi>p</mi> </mfrac> <munderover> <mo>âˆ‘</mo> <mrow> <mi>j</mi> <mo>=</mo> <mn>1</mn> </mrow> <mi>p</mi> </munderover> <msub> <mi>s</mi> <mrow> <mn>12</mn> <mi>j</mi> </mrow> </msub> </mrow> </semantics> </math></p>
<p><em>p</em> reprÃ©sente le nombre total de caractÃ¨res (ou de variables) descriptifs utilisÃ©s pour comparer les deux individus. <em>s</em><sub>12<em>j</em></sub> reprÃ©sente la similaritÃ© partielle entre les individus 1 et 2 concernant le descripteur <em>j</em>. Cette similaritÃ© partielle se calcule diffÃ©remment sâ€™il sâ€™agit dâ€™une variable qualitative ou quantitativeÂ :</p>
<ul>
<li><strong>variable qualitativeÂ :</strong> <em>s</em><sub>12<em>j</em></sub> vaut 1 si la variable <em>j</em> prend la mÃªme valeur pour les individus 1 et 2, et vaut 0 sinon. Par exemple, si 1 et 2 sont tous les deux Â«Â grandÂ Â», alors <em>s</em><sub>12<em>j</em></sub> vaudra 1. Si 1 est Â«Â grandÂ Â» et 2 Â«Â petitÂ Â», <em>s</em><sub>12<em>j</em></sub> vaudra 0.</li>
<li><strong>variable quantitativeÂ :</strong> la diffÃ©rence absolue entre les valeurs des deux variables est tout dâ€™abord calculÃ©e, soit |<em>y</em><sub>1<em>j</em></sub>Â -Â <em>y</em><sub>2<em>j</em></sub>|. Puis lâ€™Ã©cart maximum observÃ© sur lâ€™ensemble du fichier est dÃ©terminÃ© et notÃ© <em>R</em><sub><em>j</em></sub>. DÃ¨s lors, la similaritÃ© partielle vaut <em>S</em><sub>12<em>j</em></sub>Â =Â |<em>y</em><sub>1<em>j</em></sub>Â -Â <em>y</em><sub>2<em>j</em></sub>|Â /Â <em>R</em><sub><em>j</em></sub>.</li>
</ul>
<p>Dans le cas oÃ¹ lâ€™on nâ€™a que des variables qualitatives, la valeur de lâ€™indice de Gower correspond Ã  la proportion de caractÃ¨res en commun. Supposons des individus 1 et 2 dÃ©cris ainsiÂ :</p>
<ol style="list-style-type: decimal">
<li>homme / grand / blond / Ã©tudiant / urbain</li>
<li>femme / grande / brune / Ã©tudiante / rurale</li>
</ol>
<p>Sur les 5 variables utilisÃ©es pour les dÃ©crire, 1 et 2 ont deux caractÃ©ristiques communesÂ : ils sont grand(e)s et Ã©tudiant(e)s. DÃ¨s lors, lâ€™indice de similaritÃ© de Gower entre 1 et 2 vaut 2/5Â =Â 0,4 (soit une distance de 1Â -Â 0,4Â =Â 0,6).</p>
<p>Plusieurs approches peuvent Ãªtre retenues pour traiter les valeurs manquantesÂ :</p>
<ul>
<li>supprimer tout individu nâ€™Ã©tant pas renseignÃ© pour toutes les variables de lâ€™analyseÂ ;</li>
<li>considÃ©rer les valeurs manquantes comme une modalitÃ© en tant que telleÂ ;</li>
<li>garder les valeurs manquantes en tant que valeurs manquantes.</li>
</ul>
<p>Le choix retenu modifiera les distances de Gower calculÃ©es. Supposons que lâ€™on aitÂ :</p>
<ol style="list-style-type: decimal">
<li>homme / grand / blond / Ã©tudiant / urbain</li>
<li>femme / grande / brune / Ã©tudiante / manquant</li>
</ol>
<p>Si lâ€™on supprime individus ayant des valeurs manquantes, 2 est retirÃ©e du fichier dâ€™observations et aucune distance nâ€™est calculÃ©e.</p>
<p>Si lâ€™on traite les valeurs manquantes comme une modalitÃ© particuliÃ¨re, 1 et 2 partagent alors 2 caractÃ¨res sur les 5 analysÃ©s, la distance de Gower entre eux est alors de 1Â -Â 2/5Â =1Â -Â 0,4Â =Â 0,6.</p>
<p>Si on garde les valeurs manquantes, lâ€™indice de Gower est dÃ¨s lors calculÃ© sur les seuls descripteurs renseignÃ©s Ã  la fois pour 1 et 2. La distance de Gower sera calculÃ©e dans le cas prÃ©sent uniquement sur les 4 caractÃ¨res renseignÃ©s et vaudra 1Â -Â 2/4Â =Â 0,5.</p>
</div>
<div id="analyses_cah_distance-du-" class="section level3">
<h3>Distance du Î¦Â²</h3>
<p>Il sâ€™agit de la distance utilisÃ©e dans les analyses de correspondance multiples (ACM). Câ€™est une variante de la distance du Ï‡Â². Nous considÃ©rons ici que nous avons <em>Q</em> questions (soit <em>Q</em> variables initiales de type facteur). Ã€ chaque individu est associÃ© un <em>patron</em> câ€™est-Ã -dire une certaine combinaison de rÃ©ponses aux <em>Q</em> questions. La distance entre deux individus correspond Ã  la distance entre leurs deux patrons. Si les deux individus prÃ©sentent le mÃªme patron, leur distance sera nulle. La distance du Î¦Â² peut sâ€™exprimer ainsiÂ :</p>
<!-- 
$$ d_{\Phi^2}^2(L_i,L_j)=\frac{1}{Q}\sum_{k}\frac{(\delta_{ik}-\delta_{jk})^2}{f_k} $$ 
converted on http://www2.ph.ed.ac.uk/snuggletex/MathInputDemo
-->
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"> <semantics> <mrow> <msubsup> <mi>d</mi> <msup> <mi>Î¦</mi> <mn>2</mn> </msup> <mn>2</mn> </msubsup> <mfenced close=")" open="("> <msub> <mi>L</mi> <mi>i</mi> </msub> <msub> <mi>L</mi> <mi>j</mi> </msub> </mfenced> <mo>=</mo> <mfrac> <mn>1</mn> <mi>Q</mi> </mfrac> <munder> <mo>âˆ‘</mo> <mi>k</mi> </munder> <mfrac> <msup> <mfenced close=")" open="("> <mrow> <msub> <mi>Î´</mi> <mrow> <mi>i</mi> <mi>k</mi> </mrow> </msub> <mo>-</mo> <msub> <mi>Î´</mi> <mrow> <mi>j</mi> <mi>k</mi> </mrow> </msub> </mrow> </mfenced> <mn>2</mn> </msup> <msub> <mi>f</mi> <mi>k</mi> </msub> </mfrac> </mrow> </semantics> </math></p>
<p>oÃ¹ <em>L<sub>i</sub></em> et <em>L<sub>j</sub></em> sont deux patrons, <em>Q</em> le nombre total de questions. <em>Î´<sub>ik</sub></em> vaut 1 si la modalitÃ© <em>k</em> est prÃ©sente dans le patron <em>L<sub>i</sub></em>, 0 sinon. <em>f<sub>k</sub></em> est la frÃ©quence de la modalitÃ© <em>k</em> dans lâ€™ensemble de la population.</p>
<p>ExprimÃ© plus simplement, on fait la somme de lâ€™inverse des modalitÃ©s non communes aux deux patrons, puis on divise par le nombre total de question. Si nous reprenons notre exemple prÃ©cÃ©dentÂ :</p>
<ol style="list-style-type: decimal">
<li>homme / grand / blond / Ã©tudiant / urbain</li>
<li>femme / grande / brune / Ã©tudiante / rurale</li>
</ol>
<p>Pour calculer la distance entre 1 et 2, il nous faut connaÃ®tre la proportion des diffÃ©rentes modalitÃ©s dans lâ€™ensemble de la population Ã©tudiÃ©e. En lâ€™occurrenceÂ :</p>
<ul>
<li>hommesÂ : 52Â % / femmesÂ : 48Â %</li>
<li>grandÂ : 30Â % / moyenÂ : 45Â % / petitÂ : 25Â %</li>
<li>blondÂ : 15Â % / chÃ¢tainÂ : 45Â % / brunÂ : 30Â % / blancÂ : 10Â %</li>
<li>Ã©tudiantÂ : 20 % / salariÃ©sÂ : 65Â % / retraitÃ©sÂ : 15Â %</li>
<li>urbainÂ : 80 % / ruralÂ : 20Â %</li>
</ul>
<p>Les modalitÃ©s non communes entre les profils de 1 et 2 sontÂ : homme, femme, blond, brun, urbain et rural. La distance du Î¦Â² entre 1 et 2 est donc la suivanteÂ :</p>
<!-- 
$$ d_{\Phi^2}^2(L_1,L_2)=\frac{1}{5}(\frac{1}{0,52}+\frac{1}{0,48}+\frac{1}{0,15}+\frac{1}{0,30}+\frac{1}{0,80}+\frac{1}{0,20})=4,05 $$
converted on http://www2.ph.ed.ac.uk/snuggletex/MathInputDemo
-->
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"> <semantics> <mrow> <msubsup> <mi>d</mi> <msup> <mi>Î¦</mi> <mn>2</mn> </msup> <mn>2</mn> </msubsup> <mfenced close=")" open="("> <msub> <mi>L</mi> <mn>1</mn> </msub> <msub> <mi>L</mi> <mn>2</mn> </msub> </mfenced> <mo>=</mo> <mfrac> <mn>1</mn> <mn>5</mn> </mfrac> <mfenced close=")" open="("> <mrow> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>52</mn> </mrow> </mfrac> <mo>+</mo> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>48</mn> </mrow> </mfrac> <mo>+</mo> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>15</mn> </mrow> </mfrac> <mo>+</mo> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>30</mn> </mrow> </mfrac> <mo>+</mo> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>80</mn> </mrow> </mfrac> <mo>+</mo> <mfrac> <mn>1</mn> <mrow> <mn>0</mn> <mo>,</mo> <mn>20</mn> </mrow> </mfrac> </mrow> </mfenced> <mo>=</mo> <mn>4</mn> <mo>,</mo> <mn>05</mn> </mrow> </semantics> </math></p>
<p>Cette distance, bien que moins intuitive que la distance de Gower Ã©voquÃ©e prÃ©cÃ©demment, est la plus employÃ©e pour lâ€™analyse dâ€™enquÃªtes en sciences sociales. Il faut retenir que la distance entre deux profils est dÃ©pendante de la distribution globale de chaque modalitÃ© dans la population Ã©tudiÃ©e. Ainsi, si lâ€™on recalcule les distances entre individus Ã  partir dâ€™un sous-Ã©chantillon, le rÃ©sultat obtenu sera diffÃ©rent. De maniÃ¨re gÃ©nÃ©rale, les individus prÃ©sentant des caractÃ©ristiques rares dans la population vont se retrouver Ã©loignÃ©s des individus prÃ©sentant des caractÃ©ristiques fortement reprÃ©sentÃ©es.</p>
</div>
<div id="analyses_cah_exemple" class="section level3">
<h3>Exemple</h3>
<p>Nous allons reprendre lâ€™ACM calculÃ©e avec <code data-package="ade4">dudi.acm</code> (<strong class="package">ade4</strong>) dans le <a href="#analyses_acm">chapitre consacrÃ© Ã  lâ€™ACM</a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">data</span>(hdv2003)
d &lt;-<span class="st"> </span>hdv2003
d$grpage &lt;-<span class="st"> </span><span class="kw">cut</span>(d$age, <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">65</span>, <span class="dv">93</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, 
  <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
d$etud &lt;-<span class="st"> </span>d$nivetud
<span class="kw">levels</span>(d$etud) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, <span class="st">"Primaire"</span>, 
  <span class="st">"Secondaire"</span>, <span class="st">"Secondaire"</span>, <span class="st">"Technique/Professionnel"</span>, 
  <span class="st">"Technique/Professionnel"</span>, <span class="st">"SupÃ©rieur"</span>)
d2 &lt;-<span class="st"> </span>d[, <span class="kw">c</span>(<span class="st">"grpage"</span>, <span class="st">"sexe"</span>, <span class="st">"etud"</span>, <span class="st">"peche.chasse"</span>, 
  <span class="st">"cinema"</span>, <span class="st">"cuisine"</span>, <span class="st">"bricol"</span>, <span class="st">"sport"</span>, <span class="st">"lecture.bd"</span>)]
<span class="kw">library</span>(ade4)
acm &lt;-<span class="st"> </span><span class="kw">dudi.acm</span>(d2, <span class="dt">scannf =</span> <span class="ot">FALSE</span>, <span class="dt">nf =</span> <span class="dv">5</span>)</code></pre>
<p>La matrice des distances sâ€™obtient dÃ¨s lors avec la fonction <code data-package="ade4">dist.dudi</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">md &lt;-<span class="st"> </span><span class="kw">dist.dudi</span>(acm)</code></pre>
</div>
</div>
<div id="analyses_cah_calcul-du-dendrogramme" class="section level2">
<h2>Calcul du dendrogramme</h2>
<p>Il faut ensuite choisir une mÃ©thode dâ€™agrÃ©gation pour construire le dendrogramme. De nombreuses solutions existent (saut minimum, distance maximum, moyenne, Wardâ€¦). Chacune dâ€™elle produira un dendrogramme diffÃ©rent. Nous ne dÃ©taillerons pas ici ces diffÃ©rentes techniques<a href="#analyses_cah_fn3" class="footnoteRef" id="analyses_cah_fnref3"><sup>3</sup></a>. Cependant, Ã  lâ€™usage, on privilÃ©giera le plus souvent la <em>mÃ©thode de Ward</em>. Cette mÃ©thode se distingue de toutes les autres en ce sens quâ€™elle utilise une analyse de la variance approchÃ©e afin dâ€™Ã©valuer les distances entre groupes. La mÃ©thode de Ward se justifie bien lorsque lorsque lâ€™on utilise le carrÃ© de la distance. Choisir de regrouper les deux individus les plus proches revient alors Ã  choisir la paire de points dont lâ€™agrÃ©gation entraÃ®ne la diminution minimale de lâ€™inertie du nuage. En rÃ©sumÃ©, cette mÃ©thode cherche Ã  minimiser lâ€™inertie intra-classe et Ã  maximiser lâ€™inertie inter-classe afin dâ€™obtenir des classes les plus homogÃ¨nes possibles.</p>
<p>En raison de la variÃ©tÃ© des distances possibles et de la variÃ©tÃ© des techniques dâ€™agrÃ©gation, on pourra Ãªtre amenÃ© Ã  rÃ©aliser plusieurs dendrogrammes diffÃ©rents sur un mÃªme jeu de donnÃ©es jusquâ€™Ã  obtenir une classification qui fait Â«Â sensÂ Â».</p>
<p>La fonction de base pour le calcul dâ€™un dendrogramme est <code data-package="stats">hclust</code> en prÃ©cisant le critÃ¨re dâ€™aggrÃ©gation avec <code>method</code>. Dans notre cas, nous allons opter pour la mÃ©thode de Ward appliquÃ©e au carrÃ© des distances (ce quâ€™on indique avec <code>mdÂˆ2</code>)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">arbre &lt;-<span class="st"> </span><span class="kw">hclust</span>(md^<span class="dv">2</span>, <span class="dt">method =</span> <span class="st">"ward"</span>)</code></pre>
<pre><code>The "ward" method has been renamed to "ward.D"; note new "ward.D2"</code></pre>
<div class="astuce">
<p>Le temps de calcul dâ€™un dendrogramme peut Ãªtre particuliÃ¨rement important sur un gros fichier de donnÃ©es. Lâ€™extension <strong class="package">flashClust</strong> permet de rÃ©duire significativement le temps de calcul. Il suffit dâ€™installer puis dâ€™appeler cette extension. La fonction <code data-package="flashClust" data-rdocumentation="flashClust">hclust</code> sera automatiquement remplacÃ©e par cette version optimisÃ©eÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(flashClust)
arbre &lt;-<span class="st"> </span><span class="kw">hclust</span>(md^<span class="dv">2</span>, <span class="dt">method =</span> <span class="st">"ward"</span>)</code></pre>
</div>
<p>Le dendrogramme obtenu peut Ãªtre affichÃ© simplement avec <code data-package="stats" data-rdocumentation="hclust">plot</code>. Lorsque le nombre dâ€™individus est important, il peut Ãªtre utile de ne pas afficher les Ã©tiquettes des individus avec <code>labels=FALSE</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(arbre, <span class="dt">labels =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"Dendrogramme"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-5-1.png" title="" alt="" width="1050"/>
<figcaption>
Dendrogramme obtenu avec hclust
</figcaption>
</figure>
<p>La fonction <code data-package="cluster">agnes</code> de lâ€™extension <strong class="package">cluster</strong> peut Ã©galement Ãªtre utilisÃ©e pour calculer le dendrogramme. Cependant, Ã  lâ€™usage, elle semble Ãªtre un peu plus lente que <code data-package="stats">hclust</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cluster)
arbre2 &lt;-<span class="st"> </span><span class="kw">agnes</span>(md^<span class="dv">2</span>, <span class="dt">method =</span> <span class="st">"ward"</span>)</code></pre>
<p>Le rÃ©sultat obtenu nâ€™est pas au mÃªme format que celui de <code data-package="stats">hclust</code>. Il est possible de transformer un objet <code data-package="cluster" data-rdocumentation="agnes.object">agnes</code> au format <code data-package="stats">hclust</code> avec <code data-package="cluster" data-rdocumentation="agnes.object">as.hclust</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.hclust</span>(arbre2)</code></pre>
<div class="info">
De nombreuses possibilitÃ©s graphiques sont possibles avec les dendrogrammes. Des exemples documentÃ©s sont disponibles Ã  cette adresseÂ : <a href="http://rpubs.com/gaston/dendrograms" class="uri">http://rpubs.com/gaston/dendrograms</a>.
</div>
</div>
<div id="analyses_cah_decouper-le-dendrogramme" class="section level2">
<h2>DÃ©couper le dendrogramme</h2>
<p>Pour obtenir une partition de la population, il suffit de dÃ©couper le dendrogramme obtenu Ã  une certaine hauteur. En premier lieu, une analyse de la forme du dendrogramme pourra nous donner une indication sur le nombre de classes Ã  retenir. Dans notre exemple, deux branches bien distinctes apparaissent sur lâ€™arbre.</p>
<p>Pour nous aider, nous pouvons reprÃ©senter les sauts dâ€™inertie du dendrogramme selon le nombre de classes retenues.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r">inertie &lt;-<span class="st"> </span><span class="kw">sort</span>(arbre$height, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(inertie[<span class="dv">1</span>:<span class="dv">20</span>], <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">xlab =</span> <span class="st">"Nombre de classes"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Inertie"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-8-1.png" title="" alt="" width="1050"/>
<figcaption>
Inertie du dendrogramme
</figcaption>
</figure>
<p>On voit trois sauts assez nets, Ã  2, 5 et 8 classes, que nous avons reprÃ©sentÃ©s ci-dessous respectivement en vert, en rouge et en bleu.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(inertie[<span class="dv">1</span>:<span class="dv">20</span>], <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">xlab =</span> <span class="st">"Nombre de classes"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Inertie"</span>)
<span class="kw">points</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>), inertie[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>)], <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"green3"</span>, 
  <span class="st">"red3"</span>, <span class="st">"blue3"</span>), <span class="dt">cex =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-9-1.png" title="" alt="" width="1050"/>
<figcaption>
Sauts dâ€™inertie du dendrogramme
</figcaption>
</figure>
<p>La fonction <code data-package="stats">rect.hclust</code> permet de visualiser les diffÃ©rentes partitions directement sur le dendrogramme.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(arbre, <span class="dt">labels =</span> <span class="ot">FALSE</span>, <span class="dt">main =</span> <span class="st">"Partition en 2, 5 ou 8 classes"</span>, 
  <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">sub =</span> <span class="st">""</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">hang =</span> -<span class="dv">1</span>)
<span class="kw">rect.hclust</span>(arbre, <span class="dv">2</span>, <span class="dt">border =</span> <span class="st">"green3"</span>)
<span class="kw">rect.hclust</span>(arbre, <span class="dv">5</span>, <span class="dt">border =</span> <span class="st">"red3"</span>)
<span class="kw">rect.hclust</span>(arbre, <span class="dv">8</span>, <span class="dt">border =</span> <span class="st">"blue3"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-10-1.png" title="" alt="" width="1050"/>
<figcaption>
DiffÃ©rentes partitions du dendrogramme
</figcaption>
</figure>
<p>Lâ€™extension <strong class="package">FactoMineR</strong> (que nous aborderons <a href="#analyses_cah_factominer">dans une section dÃ©diÃ©e ci-aprÃ¨s</a>) suggÃ¨re dâ€™utiliser la partition ayant la plus grande perte relative dâ€™inertie.</p>
<p>Dans lâ€™extension <strong class="package">JLutils</strong> (disponible sur <a href="https://github.com/larmarange/JLutils">GitHub</a>), nous avons dÃ©velopper une fonction <code data-package="JLutils">best.cutree</code> qui permet de calculer cette indicateur Ã  partir de nâ€™importe quel dendrogramme calculÃ© avec <code data-package="stats">hclust</code> ou <code data-package="cluster">agnes</code>.</p>
<p>Pour installer <strong class="package">JLutils</strong>, on aura recours au package <strong class="package">devtools</strong> et Ã  sa fonction <code data-package="devtools">install_github</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"larmarange/JLutils"</span>)</code></pre>
<p>Par dÃ©faut, <code data-package="JLutils">best.cutree</code> regarde quelle serait la meilleure partition entre 3 et 20 classes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(JLutils)
<span class="kw">best.cutree</span>(arbre)</code></pre>
<pre><code>[1] 5</code></pre>
<p>En lâ€™occurence il sâ€™agirait dâ€™une partition en 5 classes. Il est possible de modifier le minimum et le maximum des partitions recherchÃ©es avec <code>min</code> et <code>max</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">best.cutree</span>(arbre, <span class="dt">min =</span> <span class="dv">2</span>)</code></pre>
<pre><code>[1] 2</code></pre>
<p>On peut Ã©galement reprÃ©senter le graphique des pertes relatives dâ€™inertie avec <code>graph=TRUE</code>. La meilleure partition selon ce critÃ¨re est reprÃ©sentÃ©e par un point noir et la seconde par un point gris.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">best.cutree</span>(arbre, <span class="dt">min =</span> <span class="dv">2</span>, <span class="dt">graph =</span> <span class="ot">TRUE</span>, <span class="dt">xlab =</span> <span class="st">"Nombre de classes"</span>, 
  <span class="dt">ylab =</span> <span class="st">"Perte relative d'inertie"</span>)</code></pre>
<p><img src="images/analyses_cah/unnamed-chunk-14-1.png" title="" alt="" width="1050"/></p>
<pre><code>[1] 2</code></pre>
<figcaption>
Perte relative dâ€™inertie selon le nombre de classes
</figcaption>
</figure>
<p>Un dÃ©coupage en deux classes minimise ce critÃ¨re. Cependant, si lâ€™on souhaite rÃ©aliser une analyse un peu plus fine, un nombre de classes plus Ã©levÃ© serait pertinent. Nous allons donc retenir un dÃ©coupage en cinq classes. Le dÃ©coupage sâ€™effectue avec la fonction <code>cutree</code>{stats}.</p>
<pre class="sourceCode r"><code class="sourceCode r">typo &lt;-<span class="st"> </span><span class="kw">cutree</span>(arbre, <span class="dv">5</span>)
<span class="kw">freq</span>(typo)</code></pre>
<pre><code>      n    % val%
1  1031 51.5 51.5
2   164  8.2  8.2
3   553 27.7 27.7
4   205 10.2 10.2
5    47  2.4  2.4
NA    0  0.0   NA</code></pre>
<p>La typologie obtenue peut Ãªtre reprÃ©sentÃ©e dans le plan factoriel avec <code data-package="ade4">s.class</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">library</span>(RColorBrewer)
<span class="kw">s.class</span>(acm$li, <span class="kw">as.factor</span>(typo), <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">5</span>, 
  <span class="st">"Set1"</span>), <span class="dt">sub =</span> <span class="st">"Axes 1 et 2"</span>)
<span class="kw">s.class</span>(acm$li, <span class="kw">as.factor</span>(typo), <span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">5</span>, 
  <span class="st">"Set1"</span>), <span class="dt">sub =</span> <span class="st">"Axes 3 et 4"</span>)</code></pre>
<p><img src="images/analyses_cah/unnamed-chunk-16-1.png" title="" alt="" width="1050"/></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</code></pre>
<figcaption>
Projection de la typologie obtenue par CAH selon les 4 premiers axes
</figcaption>
</figure>
<p>Romain FranÃ§ois a developpÃ© une fonction <code data-package="JLutils">A2Rplot</code> permettant de rÃ©aliser facilement un dendrogramme avec les branches colorÃ©es<a href="#analyses_cah_fn4" class="footnoteRef" id="analyses_cah_fnref4"><sup>4</sup></a>. Par commoditÃ©, cette fonction est disponible directement au sein de lâ€™extension <strong class="package">JLutils</strong>.</p>
<p>Pour rÃ©aliser le graphique, on indiquera le nombre de classes et les couleurs Ã  utiliser pour chaque branche de lâ€™arbreÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">A2Rplot</span>(arbre, <span class="dt">k =</span> <span class="dv">5</span>, <span class="dt">boxes =</span> <span class="ot">FALSE</span>, <span class="dt">col.up =</span> <span class="st">"gray50"</span>, 
  <span class="dt">col.down =</span> <span class="kw">brewer.pal</span>(<span class="dv">5</span>, <span class="st">"Dark2"</span>), <span class="dt">show.labels =</span> <span class="ot">FALSE</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-17-1.png" title="" alt="" width="1050"/>
<figcaption>
Un dendrogramme colorÃ©
</figcaption>
</figure>
</div>
<div id="analyses_cah_factominer" class="section level2">
<h2>CAH avec lâ€™extension FactoMineR</h2>
<p>Lâ€™extension <strong class="package">FactoMineR</strong> fournit une fonction <code data-package="FactoMineR">HCPC</code> permettant de rÃ©aliser une classification hiÃ©rarchique Ã  partir du rÃ©sultats dâ€™une analyse factorielle rÃ©alisÃ©e avec la mÃªme extension (voir la <a href="#analyses_acm_factominer">section dÃ©diÃ©e du chapitre sur lâ€™ACM</a>).</p>
<p><code data-package="FactoMineR">HCPC</code> rÃ©alise Ã  la fois le calcul de la matrice des distances, du dendrogramme et le partitionnement de la population en classes. Par dÃ©faut, <code data-package="FactoMineR">HCPC</code> calcule le dendrogramme Ã  partir du carrÃ© des distances du Î¦Â² et avec la mÃ©thode de Ward.</p>
<p>Par dÃ©faut, lâ€™arbre est affichÃ© Ã  lâ€™Ã©cran et lâ€™arbre sera coupÃ© selon la partition ayant la plus grande perte relative dâ€™inertie (comme avec <code data-package="JLutils">best.cutree</code>). Utilisez <code>graph=FALSE</code> pour ne pas afficher le graphique et lâ€™argument <code>nb.clust</code> pour indiquer le nombre de classes dÃ©sirÃ©es.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FactoMineR)
acm2 &lt;-<span class="st"> </span><span class="kw">MCA</span>(d2[<span class="kw">complete.cases</span>(d2), ], <span class="dt">ncp =</span> <span class="dv">5</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)
cah &lt;-<span class="st"> </span><span class="kw">HCPC</span>(acm2)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-18-1.png" title="" alt="" width="1050"/>
<figcaption>
Graphique produit par HCPC
</figcaption>
</figure>
<p>On pourra reprÃ©senter le dendrogramme avec <code data-package="FactoMineR" data-rdocumentation="plot.HCPC">plot</code> et lâ€™argument <code>choice="tree"</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cah, <span class="dt">choice =</span> <span class="st">"tree"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-19-1.png" title="" alt="" width="1050"/>
<figcaption>
Dendrogramme obtenu avec HCPC (5 axes)
</figcaption>
</figure>
<p>Il apparait que le dendrogramme obtenu avec <code data-pacakge="FactoMineR">HCPC</code> diffÃ¨re de celui que nous avons calculÃ© prÃ©cÃ©demment en utilisant la matrice des distances fournies par <code data-package="ade4">dist.dudi</code>. Cela est dÃ» au fait que <code data-package="FactoMineR">HCPC</code> procÃ¨de diffÃ©rement pour calculer la matrice des distances en ne prenant en compte que les axes retenus dans le cadre de lâ€™ACM. Pour rappel, nous avions retenu que 5 axes dans le cadre de notre ACMÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">acm2 &lt;-<span class="st"> </span><span class="kw">MCA</span>(d2[<span class="kw">complete.cases</span>(d2), ], <span class="dt">ncp =</span> <span class="dv">5</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)</code></pre>
<p><code data-package="FactoMineR">HCPC</code> nâ€™a donc pris en compte que ces 5 premiers axes pour calculer les distances entre les individus, considÃ©rant que les autres axes nâ€™apportent que du Â«Â bruitÂ Â» rendant la classification instable. Cependant, comme le montre <code>summary(acm2)</code>, nos cinq premiers axes nâ€™expliquent que 54Â % de la variance. Il usuellement prÃ©fÃ©rable de garder un plus grande nombre dâ€™axes afin de couvrir au moins 80 Ã  90Â % de la variance<a href="#analyses_cah_fn5" class="footnoteRef" id="analyses_cah_fnref5"><sup>5</sup></a>. De son cÃ´tÃ©, <code data-package="ade4">dist.dudi</code> prends en compte lâ€™ensemble des axes pour calculer la matrice des distances. On peut reproduire cela avec <strong class="package">FactoMineR</strong> en indiquant <code>ncp=Inf</code> lors du calcul de lâ€™ACM.</p>
<pre class="sourceCode r"><code class="sourceCode r">acm2 &lt;-<span class="st"> </span><span class="kw">MCA</span>(d2[<span class="kw">complete.cases</span>(d2), ], <span class="dt">ncp =</span> <span class="ot">Inf</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)
cah &lt;-<span class="st"> </span><span class="kw">HCPC</span>(acm2, <span class="dt">nb.clust =</span> -<span class="dv">1</span>, <span class="dt">graph =</span> <span class="ot">FALSE</span>)</code></pre>
<p>On obtient bien cette fois-ci le mÃªme rÃ©sultat.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cah, <span class="dt">choice =</span> <span class="st">"tree"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-22-1.png" title="" alt="" width="1050"/>
<figcaption>
Dendrogramme obtenu avec HCPC (tous les axes)
</figcaption>
</figure>
<p>Dâ€™autres graphiques sont disponibles, en faisant varier la valeur de lâ€™argument <code>choice</code>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cah, <span class="dt">choice =</span> <span class="st">"3D.map"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-23-1.png" title="" alt="" width="1050"/>
<figcaption>
ReprÃ©sentation en 3 dimensions du dendrogramme
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cah, <span class="dt">choice =</span> <span class="st">"bar"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-24-1.png" title="" alt="" width="1050"/>
<figcaption>
Gains dâ€™inertie
</figcaption>
</figure>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cah, <span class="dt">choice =</span> <span class="st">"map"</span>)</code></pre>
<img src="images/analyses_cah/unnamed-chunk-25-1.png" title="" alt="" width="1050"/>
<figcaption>
Projection des catÃ©gories sur le plan factoriel
</figcaption>
</figure>
<p>Lâ€™objet renvoyÃ© par <code data-package="FactoMineR">HCPC</code> contient de nombreuses informations. La partition peut notamment Ãªtre rÃ©cupÃ©rÃ©e avec <code>cah$data.clust$clust</code>. Il y a Ã©galement diverses statistiques pour dÃ©crire les catÃ©gories.</p>
<pre class="sourceCode r"><code class="sourceCode r">cah</code></pre>
<pre><code>**Results for the Hierarchical Clustering on Principal Components**
   name                   
1  "$data.clust"          
2  "$desc.var"            
3  "$desc.var$test.chi2"  
4  "$desc.axes$category"  
5  "$desc.axes"           
6  "$desc.axes$quanti.var"
7  "$desc.axes$quanti"    
8  "$desc.ind"            
9  "$desc.ind$para"       
10 "$desc.ind$dist"       
11 "$call"                
12 "$call$t"              
   description                                              
1  "dataset with the cluster of the individuals"            
2  "description of the clusters by the variables"           
3  "description of the cluster var. by the categorical var."
4  "description of the clusters by the categories."         
5  "description of the clusters by the dimensions"          
6  "description of the cluster var. by the axes"            
7  "description of the clusters by the axes"                
8  "description of the clusters by the individuals"         
9  "parangons of each clusters"                             
10 "specific individuals"                                   
11 "summary statistics"                                     
12 "description of the tree"                                </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">freq</span>(cah$data.clust$clust)</code></pre>
<pre><code>      n    % val%
1   513 27.2 27.2
2   201 10.7 10.7
3  1051 55.7 55.7
4    78  4.1  4.1
5    43  2.3  2.3
NA    0  0.0   NA</code></pre>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_cah_fn1"><p>Pour une prÃ©sentation de ces diffÃ©rentes distances, on pourra se rÃ©fÃ©rer Ã  <a href="http://old.biodiversite.wallonie.be/outils/methodo/similarite_distance.htm" class="uri">http://old.biodiversite.wallonie.be/outils/methodo/similarite_distance.htm</a> ou encore Ã  ce support de cours par D. Chessel, J. Thioulouse et A.B. Dufour disponible Ã  <a href="http://pbil.univ-lyon1.fr/R/pdf/stage7.pdf" class="uri">http://pbil.univ-lyon1.fr/R/pdf/stage7.pdf</a>.<a href="#analyses_cah_fnref1">â†©</a></p></li>
<li id="analyses_cah_fn2"><p>Cette mÃªme fonction peut aussi Ãªtre utilisÃ©e pour calculer une distance aprÃ¨s une analyse en composantes principales ou une analyse mixte de Hill et Smith.<a href="#analyses_cah_fnref2">â†©</a></p></li>
<li id="analyses_cah_fn3"><p>On pourra consulter le cours de FG Carpentier dÃ©jÃ  citÃ© ou bien des ouvrages dâ€™analyse statistique.<a href="#analyses_cah_fnref3">â†©</a></p></li>
<li id="analyses_cah_fn4"><p>Voir <a href="http://addicted2or.free.fr/packages/A2R/lastVersion/R/code.R" class="uri">http://addicted2or.free.fr/packages/A2R/lastVersion/R/code.R</a>.<a href="#analyses_cah_fnref4">â†©</a></p></li>
<li id="analyses_cah_fn5"><p>Voir <a href="http://factominer.free.fr/classical-methods/classification-hierarchique-sur-composantes-principales.html" class="uri">http://factominer.free.fr/classical-methods/classification-hierarchique-sur-composantes-principales.html</a><a href="#analyses_cah_fnref5">â†©</a></p></li>
</ol>
</div>

</article>
<article id="analyses_seq">

<div id="analyses_seq_header">
<h1 class="title">Analyse de sÃ©quences</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#analyses_seq_lanalyse-de-sequences">Lâ€™analyse de sÃ©quences</a></li>
<li><a href="#analyses_seq_installer-traminer-et-recuperer-les-donnees">Installer TraMineR et rÃ©cupÃ©rer les donnÃ©es</a></li>
<li><a href="#analyses_seq_appariement-optimal-et-classification">Appariement optimal et classification</a></li>
<li><a href="#analyses_seq_representations-graphiques">ReprÃ©sentations graphiques</a></li>
<li><a href="#analyses_seq_bibliographie">Bibliographie</a></li>
</ul>
</div>

<div class="note">
La version originale de ce chapitre est une reprise, avec lâ€™aimable autorisation de son auteur, dâ€™un article de Nicolas Robette intitulÃ© <em>Lâ€™analyse de sÃ©quencesÂ : une introduction avec le logiciel R et le package TraMineR</em> et publiÃ© sur le blog Quanti (<a href="http://quanti.hypotheses.org/686/" class="uri">http://quanti.hypotheses.org/686/</a>).
</div>
<p>Depuis les annÃ©es 1980, lâ€™Ã©tude quantitative des trajectoires biographiques (<em>life course analysis</em>) a pris une ampleur considÃ©rable dans le champ des sciences sociales. Les collectes de donnÃ©es micro-individuelles longitudinales se sont dÃ©veloppÃ©es, principalement sous la forme de panels ou dâ€™enquÃªtes rÃ©trospectives. ParallÃ¨lement Ã  cette multiplication des donnÃ©es disponibles, la mÃ©thodologie statistique a connu de profondes Ã©volutions. Lâ€™analyse des biographies (<em>event history analysis</em>) â€” qui ajoute une dimension diachronique aux modÃ¨les Ã©conomÃ©triques mainstream â€” sâ€™est rapidement imposÃ©e comme lâ€™approche dominanteÂ : il sâ€™agit de modÃ©liser la durÃ©e des situations ou le risque dâ€™occurrence des Ã©vÃ©nements.</p>
<div id="analyses_seq_lanalyse-de-sequences" class="section level2">
<h2>Lâ€™analyse de sÃ©quences</h2>
<p>Cependant, ces derniÃ¨res annÃ©es ont vu la diffusion dâ€™un large corpus de mÃ©thodes descriptives dâ€™analyse de sÃ©quences, au sein desquelles lâ€™appariement optimal (<em>optimal matching</em>) occupe une place centrale<a href="#analyses_seq_fn1" class="footnoteRef" id="analyses_seq_fnref1"><sup>1</sup></a>. Lâ€™objectif principal de ces mÃ©thodes est dâ€™identifier â€” dans la diversitÃ© dâ€™un corpus de sÃ©quences constituÃ©es de sÃ©ries dâ€™Ã©tats successifs â€” les rÃ©gularitÃ©s, les ressemblances, puis le plus souvent de construire des typologies de Â«Â sÃ©quences-typesÂ Â». Lâ€™analyse de sÃ©quences constitue donc un moyen de dÃ©crire mais aussi de mieux comprendre le dÃ©roulement de divers processus.</p>
<p>La majeure partie des applications de lâ€™analyse de sÃ©quences traite de trajectoires biographiques ou de carriÃ¨res professionnelles. Dans ces cas, chaque trajectoire ou chaque carriÃ¨re est dÃ©crite par une sÃ©quence, autrement dit par une suite chronologiquement ordonnÃ©e de Â«Â momentsÂ Â» Ã©lÃ©mentaires, chaque moment correspondant Ã  un Â«Â Ã©tatÂ Â» dÃ©terminÃ© de la trajectoire (par exemple, pour les carriÃ¨res professionnellesÂ : Ãªtre en emploi, au chÃ´mage ou en inactivitÃ©). Mais on peut bien sÃ»r imaginer des types de sÃ©quences plus originauxÂ : Andrew Abbott<a href="#analyses_seq_fn2" class="footnoteRef" id="analyses_seq_fnref2"><sup>2</sup></a>, le sociologue amÃ©ricain qui a introduit lâ€™<em>optimal matching</em> dans les sciences scientifiques ou des sÃ©quences de pas de danses traditionnelles.</p>
<p>En France, les premiers travaux utilisant lâ€™appariement optimal sont ceux de Claire Lemercier<a href="#analyses_seq_fn3" class="footnoteRef" id="analyses_seq_fnref3"><sup>3</sup></a> sur les carriÃ¨res des membres des institutions consulaires parisiennes au <span style="font-variant: small-caps;">xix</span><sup>e</sup> siÃ¨cle (Lemercier, 2005), et de Laurent Lesnard<a href="#analyses_seq_fn4" class="footnoteRef" id="analyses_seq_fnref4"><sup>4</sup></a> sur les emplois du temps (Lesnard, 2008). Mais dÃ¨s les annÃ©es 1980, les chercheurs du CÃ©req construisaient des typologies de trajectoires dâ€™insertion Ã  lâ€™aide des mÃ©thodes dâ€™analyse des donnÃ©es Â«Â Ã  la franÃ§aiseÂ Â» (analyse des correspondances, etc.)<a href="#analyses_seq_fn5" class="footnoteRef" id="analyses_seq_fnref5"><sup>5</sup></a>. Au final, on dÃ©nombre maintenant plus dâ€™une centaine dâ€™articles de sciences sociales contenant ou discutant des techniques empruntÃ©es Ã  lâ€™analyse de sÃ©quences.</p>
<p>Pour une prÃ©sentation des diffÃ©rentes mÃ©thodes dâ€™analyse de sÃ©quences disponibles et de leur mise en oeuvre pratique, il existe un petit manuel en franÃ§ais, publiÃ© en 2011 derniÃ¨re aux Ã©ditions du Ceped (collection Â«Â Les clefs pourÂ Â»<a href="#analyses_seq_fn6" class="footnoteRef" id="analyses_seq_fnref6"><sup>6</sup></a>) et disponible en pdf<a href="#analyses_seq_fn7" class="footnoteRef" id="analyses_seq_fnref7"><sup>7</sup></a> (Robette, 2011). De plus, un article rÃ©cemment publiÃ© dans le <em>Bulletin de MÃ©thodologie Sociologique</em> compare de maniÃ¨re systÃ©matique les rÃ©sultats obtenus par les principales mÃ©thodes dâ€™analyse de sÃ©quences (Robette &amp; Bry, 2012). La conclusion en est quâ€™avec des donnÃ©es empiriques aussi structurÃ©es que celles que lâ€™on utilise en sciences sociales, lâ€™approche est robuste, câ€™est-Ã -dire quâ€™un changement de mÃ©thode aura peu dâ€™influence sur les principaux rÃ©sultats. Cependant, lâ€™article tente aussi de dÃ©crire les spÃ©cificitÃ©s de chaque mÃ©thode et les diffÃ©rences marginales quâ€™elles font apparaÃ®tre, afin de permettre aux chercheurs de mieux adapter leurs choix mÃ©thodologiques Ã  leur question de recherche.</p>
<p>Afin dâ€™illustrer la dÃ©marche de lâ€™analyse de sÃ©quences, nous allons procÃ©der ici Ã  la description Â«Â pas Ã  pasÂ Â» dâ€™un corpus de carriÃ¨res professionnelles, issues de lâ€™enquÃªte <em>Biographies et entourage</em> (Ined, 2000)<a href="#analyses_seq_fn8" class="footnoteRef" id="analyses_seq_fnref8"><sup>8</sup></a>. Et pour ce faire, on va utiliser le logiciel <strong>R</strong>, qui propose la solution actuellement la plus complÃ¨te et la plus puissante en matiÃ¨re dâ€™analyse de sÃ©quences. Les mÃ©thodes dâ€™analyse de sÃ©quences par analyses factorielles ou de correspondances ne nÃ©cessitent pas de logiciel spÃ©cifiqueÂ : tous les logiciels de statistiques gÃ©nÃ©ralistes peuvent Ãªtre utilisÃ©s (<strong>SAS</strong>, <strong>SPSS</strong>, <strong>Stata</strong>, R, etc.). En revanche, il nâ€™existe pas de fonctions pour lâ€™appariement optimal dans <strong>SAS</strong> ou <strong>SPSS</strong>. Certains logiciels gratuits implÃ©mentent lâ€™appariement optimal (comme <strong>Chesa</strong><a href="#analyses_seq_fn9" class="footnoteRef" id="analyses_seq_fnref9"><sup>9</sup></a> ou <strong>TDA</strong><a href="#analyses_seq_fn10" class="footnoteRef" id="analyses_seq_fnref10"><sup>10</sup></a>) mais il faut alors recourir Ã  dâ€™autres programmes pour dÃ©rouler lâ€™ensemble de lâ€™analyse (classification, reprÃ©sentation graphique). <strong>Stata</strong> propose le module <strong>sq</strong><a href="#analyses_seq_fn11" class="footnoteRef" id="analyses_seq_fnref11"><sup>11</sup></a>, qui dispose dâ€™un Ã©ventail de fonctions intÃ©ressantes. Mais câ€™est <strong>R</strong> et le package <strong class="package">TraMineR</strong><a href="#analyses_seq_fn12" class="footnoteRef" id="analyses_seq_fnref12"><sup>12</sup></a>, dÃ©veloppÃ© par des collÃ¨gues de lâ€™UniversitÃ© de GenÃ¨ve (Gabadinho et al, 2011), qui fournit la solution la plus complÃ¨te et la plus puissante Ã  ce jourÂ : on y trouve lâ€™appariement optimal mais aussi dâ€™autres algorithmes alternatifs, ainsi que de nombreuses fonctions de description des sÃ©quences et de reprÃ©sentation graphique.</p>
</div>
<div id="analyses_seq_installer-traminer-et-recuperer-les-donnees" class="section level2">
<h2>Installer TraMineR et rÃ©cupÃ©rer les donnÃ©es</h2>
<p>Tout dâ€™abord, Ã  quoi ressemblent nos donnÃ©esÂ ? On a reconstruit Ã  partir de lâ€™enquÃªte les carriÃ¨res de 1000 hommes. Pour chacune, on connaÃ®t la position professionnelle chaque annÃ©e, de lâ€™Ã¢ge de 14 ans jusquâ€™Ã  50 ans. Cette position est codÃ©e de la maniÃ¨re suivanteÂ : les codes 1 Ã  6 correspondent aux groupes socioprofessionnels de la nomenclature des PCS de lâ€™INSEE 13 (agriculteurs exploitantsÂ ; artisans, commerÃ§ants et chefs dâ€™entrepriseÂ ; cadres et professions intellectuelles supÃ©rieuresÂ ; professions intermÃ©diairesÂ ; employÃ©sÂ ; ouvriers)Â ; on y a ajoutÃ© Â«Â Ã©tudesÂ Â» (code 7), Â«Â inactivitÃ©Â Â» (code 8) et Â«Â service militaireÂ Â» (code 9). Le fichier de donnÃ©es comporte une ligne par individu et une colonne par annÃ©eÂ : la variable <em>csp1</em> correspond Ã  la position Ã  14 ans, la variable <em>csp2</em> Ã  la position Ã  15 ans, etc. Par ailleurs, les enquÃªtÃ©s Ã©tant tous nÃ©s entre 1930 et 1950, on ajoute Ã  notre base une variable Â«Â gÃ©nÃ©rationÂ Â» Ã  trois modalitÃ©s, prenant les valeurs suivantesÂ : 1=â€œ1930-1938â€Â ; 2=â€œ1939-1945â€Â ; 3=â€œ1946-1950â€. Au final, la base est constituÃ©e de 500 lignes et de 37Â +Â 1Â =Â 38 colonnes et se prÃ©sente sous la forme dâ€™un fichier texte au format <strong>csv</strong> (tÃ©lÃ©chargeable Ã  <a href="http://larmarange.github.io/analyse-R/data/trajpro.csv" class="uri">http://larmarange.github.io/analyse-R/data/trajpro.csv</a>).</p>
<p>Une fois <strong>R</strong> ouvert, on commence par installer les extensions nÃ©cessaires Ã  ce programme (opÃ©ration Ã  ne rÃ©aliser que lors de leur premiÃ¨re utilisation) et par les charger en mÃ©moire. Lâ€™extension <strong class="package">TraMineR</strong> propose de nombreuses fonctions pour lâ€™analyse de sÃ©quences. Lâ€™extension <strong class="package">cluster</strong> comprend un certain nombre de mÃ©thodes de classification automatique<a href="#analyses_seq_fn13" class="footnoteRef" id="analyses_seq_fnref13"><sup>13</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">"TraMineR"</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(TraMineR)</code></pre>
<pre><code>
TraMineR stable version 1.8-9 (Built: 2015-05-07)
Website: http://mephisto.unige.ch/traminer
Please type 'citation("TraMineR")' for citation information.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cluster)</code></pre>
<p>On importe ensuite les donnÃ©es, on recode la variable Â«Â gÃ©nÃ©rationÂ Â» pour lui donner des Ã©tiquettes plus explicites. On jette Ã©galement un coup dâ€™oeil Ã  la structure du tableau de donnÃ©esÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">donnees &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"http://larmarange.github.io/analyse-R/data/trajpro.csv"</span>, 
  <span class="dt">header =</span> T)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">donnees$generation &lt;-<span class="st"> </span><span class="kw">factor</span>(donnees$generation, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"1930-38"</span>, 
  <span class="st">"1939-45"</span>, <span class="st">"1946-50"</span>))
<span class="kw">str</span>(donnees)</code></pre>
<pre><code>'data.frame':   1000 obs. of  38 variables:
 $ csp1      : int  1 7 6 7 7 6 7 7 7 6 ...
 $ csp2      : int  1 7 6 7 7 6 7 7 6 6 ...
 $ csp3      : int  1 7 6 6 7 6 7 7 6 6 ...
 $ csp4      : int  1 7 6 6 7 6 7 7 6 6 ...
 $ csp5      : int  1 7 6 6 7 6 7 7 6 6 ...
 $ csp6      : int  1 7 6 6 7 6 9 7 6 6 ...
 $ csp7      : int  6 9 6 6 7 6 9 7 9 6 ...
 $ csp8      : int  6 9 9 6 7 6 9 7 4 6 ...
 $ csp9      : int  6 6 9 6 7 6 9 3 4 9 ...
 $ csp10     : int  6 6 9 6 7 6 4 3 4 9 ...
 $ csp11     : int  6 6 6 6 3 6 4 3 4 6 ...
 $ csp12     : int  6 6 6 6 3 6 4 3 4 6 ...
 $ csp13     : int  6 6 6 6 3 6 4 3 4 6 ...
 $ csp14     : int  6 4 6 6 3 6 4 3 4 6 ...
 $ csp15     : int  6 4 6 6 3 6 4 3 4 6 ...
 $ csp16     : int  6 4 6 6 3 6 6 3 4 6 ...
 $ csp17     : int  6 4 6 6 3 6 6 3 4 6 ...
 $ csp18     : int  6 4 6 6 3 6 6 3 4 6 ...
 $ csp19     : int  6 4 6 6 3 6 6 3 4 6 ...
 $ csp20     : int  6 4 6 6 3 6 6 3 4 6 ...
 $ csp21     : int  6 4 6 6 6 6 6 3 4 6 ...
 $ csp22     : int  6 4 6 6 6 6 6 3 4 4 ...
 $ csp23     : int  6 4 6 6 6 6 6 3 4 4 ...
 $ csp24     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp25     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp26     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp27     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp28     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp29     : int  6 6 6 6 5 6 6 3 4 4 ...
 $ csp30     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp31     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp32     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp33     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp34     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp35     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp36     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ csp37     : int  4 6 6 6 5 6 6 3 4 4 ...
 $ generation: Factor w/ 3 levels "1930-38","1939-45",..: 2 1 1 3 2 3 1 1 2 1 ...</code></pre>
<p>On a bien 1000 observations et 38 variables. On dÃ©finit maintenant des <em>labels</em> pour les diffÃ©rents Ã©tats qui composent les sÃ©quences et on crÃ©e un objet Â«Â sÃ©quenceÂ Â» avec <code data-package="TraMineR">seqdef</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"agric"</span>, <span class="st">"acce"</span>, <span class="st">"cadr"</span>, <span class="st">"pint"</span>, <span class="st">"empl"</span>, 
  <span class="st">"ouvr"</span>, <span class="st">"etud"</span>, <span class="st">"inact"</span>, <span class="st">"smil"</span>)
seq &lt;-<span class="st"> </span><span class="kw">seqdef</span>(donnees[, <span class="dv">1</span>:<span class="dv">37</span>], <span class="dt">states =</span> labels)</code></pre>
<pre><code> [&gt;] state coding:
       [alphabet]  [label]  [long label] 
     1  1           agric    agric
     2  2           acce     acce
     3  3           cadr     cadr
     4  4           pint     pint
     5  5           empl     empl
     6  6           ouvr     ouvr
     7  7           etud     etud
     8  8           inact    inact
     9  9           smil     smil
 [&gt;] 1000 sequences in the data set
 [&gt;] min/max sequence length: 37/37</code></pre>
</div>
<div id="analyses_seq_appariement-optimal-et-classification" class="section level2">
<h2>Appariement optimal et classification</h2>
<p>Ces Ã©tapes prÃ©alables achevÃ©es, on peut comparer les sÃ©quences en calculant les dissimilaritÃ©s entre paires de sÃ©quences. On va ici utiliser la mÃ©thode la plus rÃ©pandue, lâ€™appariement optimal (<em>optimal matching</em>). Cette mÃ©thode consiste, pour chaque paire de sÃ©quences, Ã  compter le nombre minimal de modifications (substitutions, suppressions, insertions) quâ€™il faut faire subir Ã  lâ€™une des sÃ©quences pour obtenir lâ€™autre. On peut considÃ©rer que chaque modification est Ã©quivalente, mais il est aussi possible de prendre en compte le fait que les Â«Â distancesÂ Â» entre les diffÃ©rents Ã©tats nâ€™ont pas toutes la mÃªme Â«Â valeurÂ Â» (par exemple, la distance sociale entre emploi Ã  temps plein et chÃ´mage est plus grande quâ€™entre emploi Ã  temps plein et emploi Ã  temps partiel), en assignant aux diffÃ©rentes modifications des Â«Â coÃ»tsÂ Â» distincts. Dans notre exemple, on va crÃ©er avec <code data-package="TraMineR">seqsubm</code> une Â«Â matrice des coÃ»ts de substitutionÂ Â» dans laquelle tous les coÃ»ts sont constants et Ã©gaux Ã  2<a href="#analyses_seq_fn14" class="footnoteRef" id="analyses_seq_fnref14"><sup>14</sup></a>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">couts &lt;-<span class="st"> </span><span class="kw">seqsubm</span>(seq, <span class="dt">method =</span> <span class="st">"CONSTANT"</span>, <span class="dt">cval =</span> <span class="dv">2</span>)</code></pre>
<pre><code> [&gt;] creating 9x9 substitution-cost matrix using 2 as constant value</code></pre>
<p>Ensuite, on calcule la matrice de distance entre les sÃ©quences (i.e contenant les Â«Â dissimilaritÃ©sÂ Â» entre les sÃ©quences) avec <code data-package="TraMineR">seqdist</code>, avec un coÃ»t dâ€™insertion/suppression (<em>indel</em>) que lâ€™on fixe ici Ã  1,1Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">seq.om &lt;-<span class="st"> </span><span class="kw">seqdist</span>(seq, <span class="dt">method =</span> <span class="st">"OM"</span>, <span class="dt">indel =</span> <span class="fl">1.1</span>, 
  <span class="dt">sm =</span> couts)</code></pre>
<pre><code> [&gt;] 1000 sequences with 9 distinct events/states
 [&gt;] 818 distinct sequences
 [&gt;] min/max sequence length: 37/37
 [&gt;] computing distances using OM metric
 [&gt;] total time: 1.87 secs</code></pre>
<p>Cette matrice des distances ou des dissimilaritÃ©s entre sÃ©quences peut ensuite Ãªtre utilisÃ©e pour une classification ascendante hiÃ©rarchique (CAH), qui permet de regrouper les sÃ©quences en un certain nombre de Â«Â classesÂ Â» en fonction de leur proximitÃ©Â :</p>
<pre class="sourceCode r"><code class="sourceCode r">seq.agnes &lt;-<span class="st"> </span><span class="kw">agnes</span>(<span class="kw">as.dist</span>(seq.om), <span class="dt">method =</span> <span class="st">"ward"</span>, 
  <span class="dt">keep.diss =</span> <span class="ot">FALSE</span>)</code></pre>
<p>Avec la fonction <code data-package="stats" data-rdocumentation="dendrogram">plot</code>, il est possible de tracer lâ€™arbre de la classification (dendrogramme).</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">as.dendrogram</span>(seq.agnes), <span class="dt">leaflab =</span> <span class="st">"none"</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-10-1.png" title="" alt="" width="1050"/>
<figcaption>
Dendrogramme de la classification des sÃ©quences
</figcaption>
</figure>
<p>De mÃªme, on peut reprÃ©senter les sauts dâ€™inertie.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">sort</span>(seq.agnes$height, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span>:<span class="dv">20</span>], 
  <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">xlab =</span> <span class="st">"nb de classes"</span>, <span class="dt">ylab =</span> <span class="st">"inertie"</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-11-1.png" title="" alt="" width="1050"/>
<figcaption>
Sauts dâ€™inertie de la classification des sÃ©quences
</figcaption>
</figure>
<p>Lâ€™observation, sur ce dendogramme ou sur la courbe des sauts dâ€™inertie, des sauts dâ€™inertie des derniÃ¨res Ã©tapes de la classification peut servir de guide pour dÃ©terminer le nombre de classes que lâ€™on va retenir pour la suite des analyses. Une premiÃ¨re inflexion dans la courbe des sauts dâ€™inertie apparaÃ®t au niveau dâ€™une partition en 5 classes. On voit aussi une seconde inflexion assez nette Ã  7 classes. Mais il faut garder en tÃªte le fait que ces outils ne sont que des guides, le choix devant avant tout se faire aprÃ¨s diffÃ©rents essais, en fonction de lâ€™intÃ©rÃªt des rÃ©sultats par rapport Ã  la question de recherche et en arbitrant entre exhaustivitÃ© et parcimonie.</p>
<p>On fait ici le choix dâ€™une partition en 5 classesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r">nbcl &lt;-<span class="st"> </span><span class="dv">5</span>
seq.part &lt;-<span class="st"> </span><span class="kw">cutree</span>(seq.agnes, nbcl)
seq.part &lt;-<span class="st"> </span><span class="kw">factor</span>(seq.part, <span class="dt">labels =</span> <span class="kw">paste</span>(<span class="st">"classe"</span>, 
  <span class="dv">1</span>:nbcl, <span class="dt">sep =</span> <span class="st">"."</span>))</code></pre>
</div>
<div id="analyses_seq_representations-graphiques" class="section level2">
<h2>ReprÃ©sentations graphiques</h2>
<p>Pour se faire une premiÃ¨re idÃ©e de la nature des classes de la typologie, il existe un certain nombre de reprÃ©sentations graphiques. Les chronogrammes (<em>state distribution plots</em>) prÃ©sentent une sÃ©rie de coupes transversalesÂ : pour chaque Ã¢ge, on a les proportions dâ€™individus de la classe dans les diffÃ©rentes situations (agriculteur, Ã©tudiant, etc.). Ce graphique sâ€™obtient avec <code data-package="TraMineR" data-rdocumentation="seqplot">seqdplot</code>Â :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqdplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">xtlab =</span> <span class="dv">14</span>:<span class="dv">50</span>, <span class="dt">border =</span> <span class="ot">NA</span>, 
  <span class="dt">withlegend =</span> T)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-13-1.png" title="" alt="" width="1050"/>
<figcaption>
Chronogrammes
</figcaption>
</figure>
<p>Chacune des classes semble caractÃ©risÃ©e par un groupe professionnel principalÂ : profession intermÃ©diaire pour la classe 1, ouvrier pour la 2, employÃ© pour la 3, cadre pour la 4 et indÃ©pendant pour la 5. Cependant, on aperÃ§oit aussi des Â«Â couchesÂ Â» dâ€™autres couleurs, indiquant que lâ€™ensemble des carriÃ¨res ne sont probablement pas stables.</p>
<p>Les Â«Â tapisÂ Â» (<em>index plots</em>), obtenus avec <code data-package="TraMineR" data-rdocumentation="seqplot">seqiplot</code>, permettent de mieux visualiser la dimension individuelle des sÃ©quences. Chaque segment horizontal reprÃ©sente une sÃ©quence, dÃ©coupÃ©e en sous-segments correspondant aux aux diffÃ©rents Ã©tats successifs qui composent la sÃ©quence.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqiplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">xtlab =</span> <span class="dv">14</span>:<span class="dv">50</span>, <span class="dt">tlim =</span> <span class="dv">0</span>, 
  <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">withlegend =</span> T, <span class="dt">yaxis =</span> <span class="ot">FALSE</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-14-1.png" title="" alt="" width="1050"/>
<figcaption>
Tapis des sÃ©quences triÃ©s
</figcaption>
</figure>
<p>Il est possible de trier les sÃ©quences pour rendre les tapis plus lisibles (on trie ici par <em>multidimensional scaling</em> Ã  lâ€™aide de la fonction <code data-package="stats">cmdscale</code>).</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r">ordre &lt;-<span class="st"> </span><span class="kw">cmdscale</span>(<span class="kw">as.dist</span>(seq.om), <span class="dt">k =</span> <span class="dv">1</span>)
<span class="kw">seqiplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">sortv =</span> ordre, <span class="dt">xtlab =</span> <span class="dv">14</span>:<span class="dv">50</span>, 
  <span class="dt">tlim =</span> <span class="dv">0</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">withlegend =</span> T, 
  <span class="dt">yaxis =</span> <span class="ot">FALSE</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-15-1.png" title="" alt="" width="1050"/>
<figcaption>
Tapis des sÃ©quences triÃ©s par multidimensional scaling
</figcaption>
</figure>
<p>On voit mieux apparaÃ®tre ainsi lâ€™hÃ©tÃ©rogÃ©nÃ©itÃ© de certaines classes. Les classes 1, 3 et 4, par exemple, semblent regrouper des carriÃ¨res relativement stables (respectivement de professions intermÃ©diaires, dâ€™employÃ©s et de cadres) et des carriÃ¨res plus Â«Â mobilesÂ Â» commencÃ©es comme ouvrier (classes 1 et 3, en orange) ou comme profession intermÃ©diaire (classe 4, en rouge). De mÃªme, la majoritÃ© des membres de la derniÃ¨re classe commencent leur carriÃ¨re dans un groupe professionnel distinct de celui quâ€™ils occuperont par la suite (indÃ©pendants). Ces distinctions apparaissent dâ€™ailleurs si on relance le programme avec un nombre plus Ã©levÃ© de classes (en remplaÃ§ant le 5 de la ligne <code>nbcl &lt;- 5</code> par 7, seconde inflexion de la courbe des sauts dâ€™inertie, et en exÃ©cutant de nouveau le programme Ã  partir de cette ligne)Â : les stables et les mobiles se trouvent alors dans des classes distinctes.</p>
<p>Le package <strong class="package">JLutils</strong>, disponible seulement sur <a href="https://github.com/larmarange/JLutils">GitHub</a>, propose une fonction <code data-package="JLutils">seq_heatmap</code> permettant de reprÃ©senter le tapis de lâ€™ensemble des sÃ©quences selon lâ€™ordre du dendrogramme.</p>
<p>Pour installer <strong class="package">JLutils</strong>, on aura recours au package <strong class="package">devtools</strong> et Ã  sa fonction <code data-package="devtools">install_github</code>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"larmarange/JLutils"</span>)</code></pre>
<p>On peut ensuite gÃ©nÃ©rer le graphique ainsiÂ :</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(JLutils)
<span class="kw">seq_heatmap</span>(seq, seq.agnes, <span class="dt">labCol =</span> <span class="dv">14</span>:<span class="dv">50</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-17-1.png" title="" alt="" width="1050"/>
<figcaption>
Tapis des sÃ©quences triÃ© selon le dendrogramme
</figcaption>
</figure>
<p>La distance moyenne des sÃ©quences dâ€™une classe au centre de cette classe, obtenue avec <code data-package="TraMineR">disscenter</code>, permet de mesurer plus prÃ©cisÃ©ment lâ€™homogÃ©nÃ©itÃ© des classesÂ :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">aggregate</span>(<span class="kw">disscenter</span>(<span class="kw">as.dist</span>(seq.om), <span class="dt">group =</span> seq.part), 
  <span class="kw">list</span>(seq.part), mean)[, -<span class="dv">1</span>], <span class="dv">1</span>)</code></pre>
<pre><code>[1] 13.1  8.9 15.6  9.7 16.5</code></pre>
<p>Cela nous confirme que les classes 1, 3 et 5 sont nettement plus hÃ©tÃ©rogÃ¨nes que les autres, alors que la classe 2 est la plus homogÃ¨ne.</p>
<p>Dâ€™autres reprÃ©sentations graphiques existent pour poursuivre lâ€™examen de la typologie. On peut visualiser les 10 sÃ©quences les plus frÃ©quentes de chaque classe avec <code data-package="TraMineR" data-rdocumentation="seqplot">seqfplot</code>.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqfplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">withlegend =</span> T)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-19-1.png" title="" alt="" width="1050"/>
<figcaption>
SÃ©quences les plus frÃ©quentes de chaque classe
</figcaption>
</figure>
<p>On peut aussi visualiser avec <code data-package="TraMineR" data-rdocumentation="seqplot">seqmsplot</code> lâ€™Ã©tat modal (celui qui correspond au plus grand nombre de sÃ©quences de la classe) Ã  chaque Ã¢ge.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqmsplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">xtlab =</span> <span class="dv">14</span>:<span class="dv">50</span>, <span class="dt">withlegend =</span> T, 
  <span class="dt">title =</span> <span class="st">"classe"</span>)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-20-1.png" title="" alt="" width="1050"/>
<figcaption>
Statut modal Ã  chaque Ã¢ge
</figcaption>
</figure>
<p>On peut Ã©galement reprÃ©senter avec <code data-package="TraMineR" data-rdocumentation="seqplot">seqmtplot</code> les durÃ©es moyennes passÃ©es dans les diffÃ©rents Ã©tats.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqmtplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">withlegend =</span> T)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-21-1.png" title="" alt="" width="1050"/>
<figcaption>
DurÃ©e moyenne dans chaque statut
</figcaption>
</figure>
<p>Enfin, lâ€™entropie transversale dÃ©crit lâ€™Ã©volution de lâ€™homogÃ©nÃ©itÃ© de la classe. Pour un Ã¢ge donnÃ©, une entropie proche de 0 signifie que tous les individus de la classe (ou presque) sont dans la mÃªme situation. Ã€ lâ€™inverse, lâ€™entropie est de 1 si les individus sont dispersÃ©s dans toutes les situations. Ce type de graphique produit par <code data-package="TraMineR" data-rdocumentation="seqplot">seqHtplot</code> peut Ãªtre pratique pour localiser les moments de transition, lâ€™insertion professionnelle ou une mobilitÃ© sociale ascendante.</p>
<figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seqHtplot</span>(seq, <span class="dt">group =</span> seq.part, <span class="dt">xtlab =</span> <span class="dv">14</span>:<span class="dv">50</span>, <span class="dt">withlegend =</span> T)</code></pre>
<img src="images/analyses_seq/unnamed-chunk-22-1.png" title="" alt="" width="1050"/>
<figcaption>
Entropie transversale
</figcaption>
</figure>
<p>On souhaite maintenant connaÃ®tre la distribution de la typologie (en effectifs et en pourcentages)Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(questionr)
<span class="kw">freq</span>(seq.part)</code></pre>
<pre><code>           n    % val%
classe.1 280 28.0 28.0
classe.2 199 19.9 19.9
classe.3 114 11.4 11.4
classe.4 341 34.1 34.1
classe.5  66  6.6  6.6
NA         0  0.0   NA</code></pre>
<p>On poursuit ensuite la description des classes en croisant la typologie avec la variable <em>generation</em>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cprop</span>(<span class="kw">table</span>(seq.part, donnees$generation))</code></pre>
<pre><code>          
seq.part   1930-38 1939-45 1946-50 Ensemble
  classe.1  25.6    27.1    31.0    28.0   
  classe.2  20.9    20.0    18.9    19.9   
  classe.3   7.9    13.6    12.9    11.4   
  classe.4  38.2    31.9    32.1    34.1   
  classe.5   7.4     7.5     5.2     6.6   
  Total    100.0   100.0   100.0   100.0   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">chisq.test</span>(<span class="kw">table</span>(seq.part, donnees$generation))</code></pre>
<pre><code>
    Pearson's Chi-squared test

data:  table(seq.part, donnees$generation)
X-squared = 12.032, df = 8, p-value = 0.1498</code></pre>
<p>Le lien entre le fait dâ€™avoir un certain type de carriÃ¨res et la cohorte de naissance est significatif Ã  un seuil de 15Â %. On constate par exemple lâ€™augmentation continue de la proportion de carriÃ¨res de type Â«Â professions intermÃ©diairesÂ Â» (classe 1) et, entre les deux cohortes les plus anciennes, lâ€™augmentation de la part des carriÃ¨res de type Â«Â employÃ©sÂ Â» (classe 3) et la baisse de la part des carriÃ¨res de type Â«Â cadresÂ Â» (classe 4).</p>
<p>Bien dâ€™autres analyses sont envisageablesÂ : croiser la typologie avec dâ€™autres variables (origine sociale, etc.), construire lâ€™espace des carriÃ¨res possibles, Ã©tudier les interactions entre trajectoires familiales et professionnelles, analyser la variance des dissimilaritÃ©s entre sÃ©quences en fonction de plusieurs variables Â«Â explicatives<a href="#analyses_seq_fn15" class="footnoteRef" id="analyses_seq_fnref15"><sup>15</sup></a>Â Â»â€¦</p>
<p>Mais lâ€™exemple proposÃ© est sans doute bien suffisant pour une premiÃ¨re introductionÂ !</p>
</div>
<div id="analyses_seq_bibliographie" class="section level2">
<h2>Bibliographie</h2>
<ul>
<li>Abbott A., 2001, <em>Time matters. On theory and method</em>, The University of Chicago Press.</li>
<li>Abbott A., Hrycak A., 1990, Â«Â Measuring ressemblance in sequence data: an optimal matching analysis of musiciansâ€™ careersÂ», <em>American journal of sociology</em>, (96), p.144-185. <a href="http://www.jstor.org/stable/10.2307/2780695" class="uri">http://www.jstor.org/stable/10.2307/2780695</a></li>
<li>Abbott A., Tsay A., 2000, Â«Â Sequence analysis and optimal matching methods in sociology: Review and prospectÂ Â», <em>Sociological methods &amp; research</em>, 29(1), p.3-33. <a href="http://smr.sagepub.com/content/29/1/3.short" class="uri">http://smr.sagepub.com/content/29/1/3.short</a></li>
<li>Gabadinho, A., Ritschard, G., MÃ¼ller, N.S. &amp; Studer, M., 2011, Â«Â Analyzing and visualizing state sequences in R with TraMineRÂ Â», <em>Journal of Statistical Software</em>, 40(4), p.1-37. <a href="http://archive-ouverte.unige.ch/downloader/vital/pdf/tmp/4hff8pe6uhukqiavvgaluqmjq2/out.pdf" class="uri">http://archive-ouverte.unige.ch/downloader/vital/pdf/tmp/4hff8pe6uhukqiavvgaluqmjq2/out.pdf</a></li>
<li>Grelet Y., 2002, Â«Â Des typologies de parcours. MÃ©thodes et usagesÂ Â», <em>Document GÃ©nÃ©ration</em> 92, (20), 47 p. <a href="http://www.cmh.greco.ens.fr/programs/Grelet_typolparc.pdf" class="uri">http://www.cmh.greco.ens.fr/programs/Grelet_typolparc.pdf</a></li>
<li>LeliÃ¨vre Ã‰., Vivier G., 2001, Â«Â Ã‰valuation dâ€™une collecte Ã  la croisÃ©e du quantitatif et du qualitatifÂ : lâ€™enquÃªte Biographies et entourageÂ Â», <em>Population</em>, (6), p.1043-1073. <a href="http://www.persee.fr/web/revues/home/prescript/article/pop_0032-4663_2001_num_56_6_7217" class="uri">http://www.persee.fr/web/revues/home/prescript/article/pop_0032-4663_2001_num_56_6_7217</a></li>
<li>Lemercier C., 2005, Â«Â Les carriÃ¨res des membres des institutions consulaires parisiennes au XIX<sup>e</sup> siÃ¨cleÂ Â», <em>Histoire et mesure</em>, XX (1-2), p.59-95. <a href="http://histoiremesure.revues.org/786" class="uri">http://histoiremesure.revues.org/786</a></li>
<li>Lesnard L., 2008, Â«Â Off-Scheduling within Dual-Earner Couples: An Unequal and Negative Externality for Family TimeÂ Â», <em>American Journal of Sociology</em>, 114(2), p.447-490. <a href="http://laurent.lesnard.free.fr/IMG/pdf/lesnard_2008_off-scheduling_within_dual-earner_couples-2.pdf" class="uri">http://laurent.lesnard.free.fr/IMG/pdf/lesnard_2008_off-scheduling_within_dual-earner_couples-2.pdf</a></li>
<li>Lesnard L., Saint Pol T. (de), 2006, Â«Â Introduction aux MÃ©thodes dâ€™Appariement Optimal (Optimal Matching Analysis)Â Â», <em>Bulletin de MÃ©thodologie Sociologique</em>, 90, p.5-25. <a href="http://bms.revues.org/index638.html" class="uri">http://bms.revues.org/index638.html</a></li>
<li>Robette N., 2011, <em>Explorer et dÃ©crire les parcours de vieÂ : les typologies de trajectoires</em>, Ceped (Les Clefs pour), 86 p. <a href="http://nicolas.robette.free.fr/Docs/Robette2011_Manuel_TypoTraj.pdf" class="uri">http://nicolas.robette.free.fr/Docs/Robette2011_Manuel_TypoTraj.pdf</a></li>
<li>Robette N., 2012, Â«Â Du prosÃ©lytisme Ã  la sÃ©cularisation. Le processus de diffusion de lâ€™Optimal Matching AnalysisÂ Â», <em>document de travail</em>. <a href="http://nicolas.robette.free.fr/Docs/Proselytisme_secularisation_NRobette.pdf" class="uri">http://nicolas.robette.free.fr/Docs/Proselytisme_secularisation_NRobette.pdf</a></li>
<li>Robette N., Bry X., 2012, Â«Â Harpoon or bait? A comparison of various metrics to fish for life course patternsÂ Â», <em>Bulletin de MÃ©thodologie Sociologique</em>, 116, p.5-24. <a href="http://nicolas.robette.free.fr/Docs/Harpoon_maggot_RobetteBry.pdf" class="uri">http://nicolas.robette.free.fr/Docs/Harpoon_maggot_RobetteBry.pdf</a></li>
<li>Robette N., Thibault N., 2008, Â«Â Lâ€™analyse exploratoire de trajectoires professionnellesÂ : analyse harmonique qualitative ou appariement optimalÂ ? Â», <em>Population</em>, 64(3), p.621-646. <a href="http://www.cairn.info/revue-population-2008-4-p-621.htm" class="uri">http://www.cairn.info/revue-population-2008-4-p-621.htm</a></li>
<li>Savage M., 2009, Â«Â Contemporary Sociology and the Challenge of Descriptive AssemblageÂ Â», <em>European Journal of Social Theory</em>, 12(1), p.155-174. <a href="http://est.sagepub.com/content/12/1/155.short" class="uri">http://est.sagepub.com/content/12/1/155.short</a></li>
</ul>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="analyses_seq_fn1"><p>Pour une analyse des conditions sociales de la diffusion de lâ€™analyse de sÃ©quences dans le champ des sciences sociales, voir Robette, 2012.<a href="#analyses_seq_fnref1">â†©</a></p></li>
<li id="analyses_seq_fn2"><p><a href="http://home.uchicago.edu/~aabbott/" class="uri">http://home.uchicago.edu/~aabbott/</a><a href="#analyses_seq_fnref2">â†©</a></p></li>
<li id="analyses_seq_fn3"><p><a href="http://lemercier.ouvaton.org/document.php?id=62" class="uri">http://lemercier.ouvaton.org/document.php?id=62</a><a href="#analyses_seq_fnref3">â†©</a></p></li>
<li id="analyses_seq_fn4"><p><a href="http://laurent.lesnard.free.fr/article.php3?id_article=22" class="uri">http://laurent.lesnard.free.fr/article.php3?id_article=22</a><a href="#analyses_seq_fnref4">â†©</a></p></li>
<li id="analyses_seq_fn5"><p>Voir par exemple lâ€™article dâ€™Yvette Grelet (2002).<a href="#analyses_seq_fnref5">â†©</a></p></li>
<li id="analyses_seq_fn6"><p><a href="http://www.ceped.org/?rubrique57" class="uri">http://www.ceped.org/?rubrique57</a><a href="#analyses_seq_fnref6">â†©</a></p></li>
<li id="analyses_seq_fn7"><p><a href="http://nicolas.robette.free.fr/Docs/Robette2011_Manuel_TypoTraj.pdf" class="uri">http://nicolas.robette.free.fr/Docs/Robette2011_Manuel_TypoTraj.pdf</a><a href="#analyses_seq_fnref7">â†©</a></p></li>
<li id="analyses_seq_fn8"><p>Pour une analyse plus poussÃ©e de ces donnÃ©es, avec deux mÃ©thodes diffÃ©rentes, voir Robette &amp; Thibault, 2008. Pour une prÃ©sentation de lâ€™enquÃªte, voir LeliÃ¨vre &amp; Vivier, 2001.<a href="#analyses_seq_fnref8">â†©</a></p></li>
<li id="analyses_seq_fn9"><p><a href="http://home.fsw.vu.nl/ch.elzinga/" class="uri">http://home.fsw.vu.nl/ch.elzinga/</a><a href="#analyses_seq_fnref9">â†©</a></p></li>
<li id="analyses_seq_fn10"><p><a href="http://steinhaus.stat.ruhr-uni-bochum.de/tda.html" class="uri">http://steinhaus.stat.ruhr-uni-bochum.de/tda.html</a><a href="#analyses_seq_fnref10">â†©</a></p></li>
<li id="analyses_seq_fn11"><p><a href="http://www.stata-journal.com/article.html?article=st0111" class="uri">http://www.stata-journal.com/article.html?article=st0111</a><a href="#analyses_seq_fnref11">â†©</a></p></li>
<li id="analyses_seq_fn12"><p><a href="http://mephisto.unige.ch/traminer/" class="uri">http://mephisto.unige.ch/traminer/</a><a href="#analyses_seq_fnref12">â†©</a></p></li>
<li id="analyses_seq_fn13"><p>Pour une prÃ©sentation plus dÃ©taillÃ©e, voir le chapitre sur la <a href="#analyses_cah">classification ascendante hiÃ©rarchique (CAH)</a>.<a href="#analyses_seq_fnref13">â†©</a></p></li>
<li id="analyses_seq_fn14"><p>Le fonctionnement de lâ€™algorithme dâ€™appariement optimal â€” et notamment le choix des coÃ»ts â€” est dÃ©crit dans le chapitre 9 du manuel de <strong class="package">TraMineR</strong> (<a href="http://mephisto.unige.ch/pub/TraMineR/doc/TraMineR-Users-Guide.pdf" class="uri">http://mephisto.unige.ch/pub/TraMineR/doc/TraMineR-Users-Guide.pdf</a>).<a href="#analyses_seq_fnref14">â†©</a></p></li>
<li id="analyses_seq_fn15"><p>Lâ€™articulation entre mÃ©thodes Â«Â descriptivesÂ Â» et mÃ©thodes Â«Â explicativesÂ Â» est un prolongement possible de lâ€™analyse de sÃ©quences. Cependant, lâ€™analyse de sÃ©quences Ã©tait envisagÃ©e par Abbott comme une alternative Ã  la sociologie quantitative <em>mainstream</em>, i.e le Â«Â paradigme des variablesÂ Â» et ses hypothÃ¨ses implicites souvent difficilement tenables (Abbott, 2001). Une bonne description solidement fondÃ©e thÃ©oriquement vaut bien des Â«Â modÃ¨les explicatifsÂ Â» (Savage, 2009).<a href="#analyses_seq_fnref15">â†©</a></p></li>
</ol>
</div>

</article>
<article id="avance_age">

<div id="avance_age_header">
<h1 class="title">Calculer un Ã¢ge</h1>
</div>

<div class="TOC">
<ul>
<li><a href="#avance_age_rappel-sur-les-ages">Rappel sur les Ã¢ges</a></li>
<li><a href="#avance_age_le-package-lubridate">Le package lubridate</a></li>
<li><a href="#avance_age_calcul-dun-age-exact">Calcul dâ€™un Ã¢ge exact</a><ul>
<li><a href="#avance_age_cas-particulier-des-personnes-nees-un-29-fevrier">Cas particulier des personnes nÃ©es un 29 fÃ©vrier</a></li>
</ul></li>
<li><a href="#avance_age_age-revolu-ou-age-au-dernier-anniversaire">Ã‚ge rÃ©volu ou Ã¢ge au dernier anniversaire</a></li>
<li><a href="#avance_age_age-par-difference-de-millesimes">Ã‚ge par diffÃ©rence de millÃ©simes</a></li>
</ul>
</div>

<div class="note">
La version originale de cette astuce a Ã©tÃ© publiÃ©e par Joseph Larmarange sur <a href="http://joseph.larmarange.net/?Calculer-proprement-un-age-sous-R" class="uri">http://joseph.larmarange.net/?Calculer-proprement-un-age-sous-R</a>.
</div>
<p>Le calcul dâ€™un Ã¢ge sous <strong>R</strong> nâ€™est pas forcÃ©ment aussi trivial quâ€™il nâ€™y parait.</p>
<div id="avance_age_rappel-sur-les-ages" class="section level2">
<h2>Rappel sur les Ã¢ges</h2>
<p>Il convient en premier lieu de rappeler les principaux Ã¢ges utilisÃ©s les dÃ©mographesÂ :</p>
<blockquote>
<p>Lâ€™Ã¢ge â€“ on prÃ©cise parfois Ã¢ge chronologique â€“ est une des caractÃ©ristiques fondamentales de la structure des populations. On lâ€™exprime gÃ©nÃ©ralement en annÃ©es, ou en annÃ©es et mois, voire en mois et jours, pour les enfants en bas Ã¢geÂ ; parfois en annÃ©es et fractions dÃ©cimales dâ€™annÃ©e. Les dÃ©mographes arrondissent dâ€™ordinaire lâ€™Ã¢ge Ã  lâ€™unitÃ© infÃ©rieure, lâ€™exprimant ainsi en annÃ©es rÃ©volues, ou annÃ©es accomplies, le cas Ã©chÃ©ant en mois rÃ©volus, ou mois accomplis. Cet Ã¢ge est aussi lâ€™Ã¢ge au dernier anniversaire. On trouve aussi, dans les statistiques, lâ€™Ã¢ge atteint dans lâ€™annÃ©e, qui est Ã©gal Ã  la diffÃ©rence de millÃ©simes entre lâ€™annÃ©e considÃ©rÃ©e et lâ€™annÃ©e de naissance. [â€¦] On est parfois conduit Ã  prÃ©ciser que lâ€™on considÃ¨re un Ã¢ge exact, pour Ã©viter toute confusion avec un Ã¢ge en annÃ©es rÃ©volues, qui reprÃ©sente en fait une classe dâ€™Ã¢ges exacts.</p>
<footer>
SourceÂ : <a href="http://fr-ii.demopaedia.org/wiki/32#322"><cite>DemopÃ¦dia</cite> (322)</a>
</footer>
</blockquote>
</div>
<div id="avance_age_le-package-lubridate" class="section level2">
<h2>Le package lubridate</h2>
<p>Le package <strong class="package">lubridate</strong> est spÃ©cialement dÃ©veloppÃ© pour faciliter la manipulation et le calcul autour des dates. La version de dÃ©veloppement intÃ¨gre depuis peu une fonction <code data-package="lubridate">time_length</code> adaptÃ©e au calcul des Ã¢ges exacts.</p>
<div class="info">
<p>La fonction <code data-package="lubridate">time_length</code> Ã©tant rÃ©cente, elle nâ€™est pas encore disponible dans la version stable du package. Pour installer la version de dÃ©veloppement de <strong class="package">lubridate</strong>, on aura recours au package <strong class="package">devtools</strong>Â :</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"hadley/lubridate"</span>)</code></pre>
</div>
<p>Nous noterons <code>naiss</code> la date de naissance et <code>evt</code> la date Ã  laquelle nous calculerons lâ€™Ã¢ge.</p>
</div>
<div id="avance_age_calcul-dun-age-exact" class="section level2">
<h2>Calcul dâ€™un Ã¢ge exact</h2>
<p>Une approche simple consiste Ã  calculer une diffÃ©rence en jours puis Ã  diviser par 365. Or, le souci câ€™est que toutes les annÃ©es nâ€™ont pas le mÃªme nombre de jours. Regardons par exemple ce qui se passe si lâ€™on calcule lâ€™Ã¢ge au 31 dÃ©cembre 1999 dâ€™une personne nÃ©e le 1<sup>er</sup> janvier 1900.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1900-01-01"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1999-12-31"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"days"</span>)</code></pre>
<pre><code>[1] 36523</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"days"</span>)/<span class="dv">365</span></code></pre>
<pre><code>[1] 100.063</code></pre>
<p>Or, au 31 dÃ©cembre 1999, cette personne nâ€™a pas encore fÃªtÃ© son centiÃ¨me anniversaire. Le calcul prÃ©cÃ©dent ne prend pas en compte les annÃ©es bissextiles. Une approche plus correcte serait de considÃ©rer que les annÃ©es durent en moyenne 365,25 jours.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"days"</span>)/<span class="fl">365.25</span></code></pre>
<pre><code>[1] 99.99452</code></pre>
<p>Si cette approche semble fonctionner avec cet exemple, ce nâ€™est plus le cas dans dâ€™autres situations.</p>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1903-01-01"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"days"</span>)/<span class="fl">365.25</span></code></pre>
<pre><code>[1] 2.997947</code></pre>
<p>Or, Ã  la date du premier janvier 1903, cette personne a bien fÃªtÃ© son troisiÃ¨me anniversaire.</p>
<p>Pour calculer proprement un Ã¢ge en annÃ©es (ou en mois), il est dÃ¨s lors nÃ©cessaire de prendre en compte la date anniversaire et le fait que la durÃ©e de chaque annÃ©e (ou mois) est variable. Câ€™est justement ce que fait la fonction <code data-package="lubridate">time_length</code> appliquÃ©e Ã  un objet de type <code data-package="lubridate" data-rdocumentation="Interval-class">Interval</code>. On dÃ©termine le dernier et le prochain anniversaire et lâ€™on rajoute, Ã  lâ€™Ã¢ge atteint au dernier anniversaire, le ratio entre le nombre de jours entre lâ€™Ã©vÃ©nement et le dernier anniversaire par le nombre de jours entre le prochain et le dernier anniversaire.</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1900-01-01"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1999-12-31"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 99.99726</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1903-01-01"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1918-11-11"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 18.86027</code></pre>
<p>Attention, cela nâ€™est valable que si lâ€™on prÃ©sente Ã  la fonction <code data-package="lubridate">time_length</code> un objet de type <code data-package="lubridate" data-rdocumentation="Interval-class">Interval</code> (pour lequel on connait dÃ¨s lors la date de dÃ©but et la date de fin). Si lâ€™on passe une durÃ©e (objet de type <code data-package="lubridate" data-rdocumentation="Duration-class">Duration</code>) Ã  la fonction <code data-package="lubridate">time_length</code>, le calcul sâ€™effectuera alors en prenant en compte la durÃ©e moyenne dâ€™une annÃ©e (plus prÃ©cisÃ©ment 365 jours).</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1900-01-01"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1999-12-31"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 99.99726</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">time_length</span>(evt -<span class="st"> </span>naiss, <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 100.063</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">time_length</span>(<span class="kw">as.duration</span>(<span class="kw">interval</span>(naiss, evt)), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 100.063</code></pre>
<div id="avance_age_cas-particulier-des-personnes-nees-un-29-fevrier" class="section level3">
<h3>Cas particulier des personnes nÃ©es un 29 fÃ©vrier</h3>
<p>Pour les personnes nÃ©es un 29 fÃ©vrier, il existe un certain flou concernant leur date dâ€™anniversaire pour les annÃ©es non bissextiles. Doit-on considÃ©rer quâ€™il sâ€™agit du 28 fÃ©vrier ou du 1<sup>er</sup> marsÂ ?</p>
<p>Au sens strict, on peut considÃ©rer que leur anniversaire a lieu entre le 28 fÃ©vrier soir Ã  minuit et le 1<sup>er</sup> mars Ã  0 heure du matin, autrement dit que le 28 fÃ©vrier ils nâ€™ont pas encore fÃªtÃ© leur anniversaire. Câ€™est la position adoptÃ©e par la fonction <code data-package="lubridate">time_length</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1992-02-29"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"2014-02-28"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 21.99726</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"2014-03-01"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 22</code></pre>
<p>Cette approche permets Ã©galement dâ€™Ãªtre cohÃ©rent avec la maniÃ¨re dont les dates sont prises en compte informatiquement. On considÃ¨re en effet que lorsque seule la date est prÃ©cisÃ©e (sans mention de lâ€™heure), lâ€™heure correspondante est <code>0:00</code>. Autrement dit, <code>"2014-03-01"</code> est Ã©quivalent Ã  <code>"2014-03-01 00:00:00"</code>. Lâ€™approche adoptÃ©e permet donc dâ€™Ãªtre cohÃ©rent lorsque lâ€™anniversaire est calculÃ© en tenant compte des heures.</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1992-02-29"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">"2014-02-28 23:00:00"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 21.99989</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">"2014-03-01 00:00:00"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 22</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">evt &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">"2014-03-01 01:00:00"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 22.00011</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">"1992-02-29 12:00:00"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">"2014-03-01 01:00:00"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 22.00011</code></pre>
</div>
</div>
<div id="avance_age_age-revolu-ou-age-au-dernier-anniversaire" class="section level2">
<h2>Ã‚ge rÃ©volu ou Ã¢ge au dernier anniversaire</h2>
<p>Une fois que lâ€™on sait calculer un Ã¢ge exact, le calcul dâ€™un Ã¢ge rÃ©volu est assez simple. Il suffit de ne garder que la partie entiÃ¨re de lâ€™Ã¢ge exact (approche conseillÃ©e).</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1980-01-09"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"2015-01-01"</span>)
<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 34.97808</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trunc</span>(<span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>))</code></pre>
<pre><code>[1] 34</code></pre>
<p>Une autre approche consiste Ã  convertir lâ€™intervalle en objet de type <code data-package="lubridate" data-rdocumentation="Period-class">Period</code> et Ã  ne prendre en compte que les annÃ©es.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.period</span>(<span class="kw">interval</span>(naiss, evt))</code></pre>
<pre><code>[1] "34y 11m 23d 0H 0M 0S"</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.period</span>(<span class="kw">interval</span>(naiss, evt))@year</code></pre>
<pre><code>[1] 34</code></pre>
</div>
<div id="avance_age_age-par-difference-de-millesimes" class="section level2">
<h2>Ã‚ge par diffÃ©rence de millÃ©simes</h2>
<p>Lâ€™Ã¢ge par diffÃ©rence de millÃ©simes, encore appelÃ© Ã¢ge atteint dans lâ€™annÃ©e, sâ€™obtient tout simplement en soustrayant lâ€™annÃ©e de naissance Ã  lâ€™annÃ©e de lâ€™Ã©vÃ©nement.</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"1980-01-09"</span>)
evt &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">"2015-01-01"</span>)
<span class="kw">year</span>(evt) -<span class="st"> </span><span class="kw">year</span>(naiss)</code></pre>
<pre><code>[1] 35</code></pre>
<div class="note">
<p>Lâ€™ensemble des fonctions prÃ©sentÃ©es peuvent Ãªtre appliquÃ©es Ã  des vecteurs et, par consÃ©quent, aux colonnes dâ€™un tableau de donnÃ©es (<em>data.frame</em>).</p>
<p>Le package <strong class="package">eeptools</strong> fournit de son cÃ´tÃ© une fonction <code data-package="eeptools">age_calc</code><a href="#avance_age_fn1" class="footnoteRef" id="avance_age_fnref1"><sup>1</sup></a> qui permet le calcul des Ã¢ges exacts et rÃ©volus.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(eeptools)</code></pre>
<pre><code>Loading required package: ggplot2
Loading required package: MASS</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"1980-01-09"</span>)
evt &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2015-01-01"</span>)
<span class="kw">age_calc</span>(naiss, evt, <span class="dt">units =</span> <span class="st">"years"</span>, <span class="dt">precise =</span> <span class="ot">TRUE</span>)</code></pre>
<pre><code>[1] 34.97814</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">time_length</span>(<span class="kw">interval</span>(naiss, evt), <span class="st">"years"</span>)</code></pre>
<pre><code>[1] 34.97808</code></pre>
<p>La mÃ©thode utilisÃ©e par <code data-package="eeptools">age_calc</code> donne des rÃ©sultats lÃ©gÃ¨rement diffÃ©rent de ceux de <code data-package="lubridate">time_length</code>. Il est donc conseillÃ© dâ€™utiliser de prÃ©fÃ©rence le package <strong class="package">lubridate</strong>.</p>
<p>En lâ€™absence du package lubridate, il reste facile de calculer une durÃ©e en jours avec les fonctions de base de <strong>R</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r">naiss &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"1900-01-01"</span>)
evt &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"1999-12-31"</span>)
evt -<span class="st"> </span>naiss</code></pre>
<pre><code>Time difference of 36523 days</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.integer</span>(evt -<span class="st"> </span>naiss)</code></pre>
<pre><code>[1] 36523</code></pre>
</div>
</div>
<div class="footnotes">
<hr/>
<ol>
<li id="avance_age_fn1"><p><a href="https://github.com/jknowles/eeptools/blob/master/R/age_calc.R" class="uri">https://github.com/jknowles/eeptools/blob/master/R/age_calc.R</a><a href="#avance_age_fnref1">â†©</a></p></li>
</ol>
</div>

</article>
</div>

<script language="javascript" type="text/javascript">
$(document).ready(function () {

    // Identifier les <pre> fermant
    $('pre').next("*:not(pre)").prev().addClass('last'); // Dernier <pre> de chaque groupe contigu de <pre>
    $('pre').parent().each(function (){
      $(this).children('pre').last().addClass('last');
    }); // Si <pre> est le dernier enfant de son parent

    // Ajout liens rdocumentation
    $("code[data-package]").each(function( index ) {
      pack = $(this).attr('data-package');
      if ($(this).attr('data-rdocumentation') !== undefined) {
        rdocumentation = $(this).attr('data-rdocumentation');
        page = ' (' + $(this).attr('data-rdocumentation') + ')';
      } else {
        rdocumentation = $(this).text();
        page = '';
      }
      fonction = $(this).text();
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+pack+'/functions/'+rdocumentation+'">');
    });

    $("strong.package").each(function( index ) {
      $(this).wrap('<a href="http://www.rdocumentation.org/packages/'+$(this).text()+'">');
    });

    // Figures (numérotation intra chapitre + ajout id pour liste des figures)
    $("article").each(function(){
      chap = $(this).attr('id');
      $(this).find("figure").each(function(index){
        if ($(this).children("figcaption").length > 0)
          $(this).children("figcaption:first").prepend('<span class="figure-number">Figure '+(index+1)+'.</span> ');
        else
          $(this).append($("<figcaption>").append('<span class="figure-number">Figure '+(index+1)+'</span>'));
        if ($(this).attr('id') == undefined) $(this).attr('id', chap + '_fig_' + (index+1));
      });



    });



});

</script>

</body>
</html>
